<? 
	include("../php_scripts/connect_database.php");
	include("php_scripts/kpi_kpi_form_detail_3.php");	
        
        //เซตการแสดงจุดทศนิยม  13/02/2018
        $decimal_point = 4;
	//echo $isLockYear;	
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
</head>
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">
	function change_current_page( page ){
		form1.current_page.value = page;
		form1.submit();
	}
	
	function MM_openBrWindow(theURL,winName,features) { //v2.0
	  window.open(theURL,winName,features);
	}
	
	function call_more_editor (fieldname) {
		var getdate = new Date();
		MM_openBrWindow("maximize_editor.html?fieldname="+fieldname+"&gatedate="+getdate,'moreeditor','toolbar=no,location=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=550,height=590')
	}
	
	
	//---เพื่อแสดงรายละเอียดของ 2.2	
	function mouseX(evt) {
		if (!evt) evt = window.event; 
		if (evt.pageX) 
			return evt.pageX; 
		else if (evt.clientX)
			return evt.clientX + (document.documentElement.scrollLeft ?  document.documentElement.scrollLeft : document.body.scrollLeft); 
		else 
			return 0;
	}
	function mouseY(evt) {
		if (!evt) evt = window.event; 
		if (evt.pageY) 
			return evt.pageY; 
		else if (evt.clientY)
			return evt.clientY + (document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop); 
		else 
			return 0;
	}
	function addElement(details,x,y,w_x,h_y) {
	var nis = document.getElementById('myDivShadow');
	
	if (!nis) {
		var nis = document.createElement('myDivShadow');
	}
	nis.style.display='';
	pics = "../attachment/pic_personal/shadow.png";
	nis.innerHTML = '<p align="left"><img src="'+pics+'" width="'+w_x+'" height="'+h_y+'" align="middle" /></img></p>';
	nis.style.width = w_x;
	nis.style.height = h_y;
	nis.style.border = '1px blue outset';
	nis.style.left = x+1;
	nis.style.top = y-10+1;
	var ni = document.getElementById('myDiv');
	if (!ni) {
		var ni = document.createElement('myDiv');
	}
	
	ni.style.display='';
	//if (!details) details = "../attachment/pic_personal/9.jpg";
	ni.innerHTML = '<br><p align="left" ><a href="#" onClick="removeElement();" style="text-decoration:none;color:#ffffff;word-break: break-all;">'+details+'</a></p>';	//<img src="images/pic_arrow_shadow.png" width="85" height="12"  align="left" /></img>
	ni.style.width = w_x;
	ni.style.height = h_y;
	ni.style.border = '1px RED outset';
	ni.style.left = x;
	ni.style.top = y-10;
}
function removeElement() {
 	var d = document.getElementById('myDiv');
 	if (d) {
		d.style.display='none';
	}
 	var ds = document.getElementById('myDivShadow');
 	if (ds) {
		ds.style.display='none';
	}
}
	function show_kpi_competence_level(details,w_x,h_y){
		var m_x = mouseX(window.event);
		var m_y = mouseY(window.event);
		//alert("pic_name="+pic_name+",mouseX="+m_x+",mouseY="+m_y);
		addElement(details,m_x,m_y,w_x,h_y);		
//		alert("body.clientH="+document.body.clientHeight);
	}
//---------------------------------------------
</script>
<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<? if (!$HIDE_HEADER) { ?>
	<tr>
    	<td height="10"><?include("header_menu.html")?></td>
  	</tr>
	<? } ?>
    	<tr> 
	  <td align="left" valign="top"><? $OPTIONAL_TITLE="".(($HIDE_HEADER)?"ส่วนที่ 3. ผลการประเมิน":"") ; include("current_location.html");?></td>
	</tr>
  	<tr>
    	<td align="left" valign="top"><form name="form1" method="post" action="kpi_kpi_form_detail_3.html" enctype="multipart/form-data">
          <input type="hidden" name="current_page" value="<?=$current_page?>">
          <input type="hidden" name="total_page" value="<?=$total_page?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
	      <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
	      <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
	      <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3?>">
          <input type="hidden" name="command" value="">
          <input type="hidden" name="KF_ID" value="<?=$KF_ID?>">
          <input type="hidden" name="PER_ID" value="<?=$PER_ID?>">
          <input type="hidden" name="MINISTRY_ID" value="<?=$MINISTRY_ID?>">
          <input type="hidden" name="DEPARTMENT_ID" value="<?=$DEPARTMENT_ID?>">
          <input type="hidden" name="PG_ID" value="<?=$PG_ID?>">
	      <input type="hidden" name="HIDE_HEADER" value="<?=$HIDE_HEADER?>">
	      <input type="hidden" name="SUBPAGE" value="<?=$SUBPAGE?>">
          <input type="hidden" name="txtSCORE_KPI" value="<?=$SCORE_KPI?>">
          <input type="hidden" name="txtSCORE_COMPETENCE" value="<?=$SCORE_COMPETENCE?>">
		<?php
			$cmd = "select * from PER_KPI_FORM where KF_ID = $KF_ID	 ";
				$db_dpis->send_cmd($cmd);
				$data = $db_dpis->get_array();
				$ACCEPT_FLAG = $data[ACCEPT_FLAG];
				$OTH_DESC = $data[OTH_DESC];

		?>
&nbsp;
<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_body_3">
	<tr>
	  <td width="50%" height="25" align="center" <?=$SUBPAGE==1?"class=\"table_body\"":""?>>
	  <span style="cursor:hand;" onClick="form1.SUBPAGE.value=1;form1.submit();">ผลการประเมิน</span>
	  </td>
	  <td align="center" <?=$SUBPAGE==2?"class=\"table_body\"":""?>>
	  <span style="cursor:hand;" onClick="form1.SUBPAGE.value=2;form1.txtSCORE_KPI.value=<?=$SCORE_KPI?>;form1.txtSCORE_COMPETENCE.value=<?=$SCORE_COMPETENCE?>;form1.submit();">ความเห็นของผู้บังคับบัญชาชั้นต้น</span>
	  </td>
	</tr>
</table>
<div style="display:<?=$SUBPAGE==1?"block":"none"?>">
&nbsp;
  <table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
        <tr>
          <td height="25" class="table_body_2">&nbsp;&nbsp;คะแนนผลสำเร็จของงาน</td>
          </tr>
        <tr>
          <td height="5"></td>
          </tr>
        <tr>
		  <td width="28%" height="22" align="center"><table width="70%" border="0" cellpadding="0" cellspacing="0" class="label_normal">
            <tr>
              <td height="50" align="center"><table width="100%" border="0" cellpadding="1" cellspacing="1" class="label_normal">
                <tr>
                  <td height="22" align="center">ผลรวมของคะแนนผลสำเร็จของงาน</td>
                </tr>
				<tr>
				  <td height="1" bgcolor="#000000"></td>
				</tr>
                <tr>
                  <!--td height="22" align="center">จำนวน "ผลสำเร็จของงาน" x 5 (คะแนนเต็ม)</td-->
                  <td height="22" align="center">น้ำหนักรวม "ผลสำเร็จของงาน" x 5 (คะแนนเต็ม)</td>
                </tr>
              </table></td>
              <td width="20%" align="center"><table width="70%" border="0" cellpadding="1" cellspacing="1" class="input_table">
                <tr>
                  <td height="22" align="center" class="table_body_2_over">
                      <?=$SCORE_KPI?>
                  </td>
                </tr>
				<tr>
				  <td height="1" bgcolor="#000000"></td>
				</tr>
                <tr>
                  <td height="22" align="center" class="table_body_2_over"><?=$TOTAL_KPI_WEIGHT?> x 5</td>
                </tr>
              </table></td>
              <td width="10%" align="center">=</td>
              <td width="20%" align="center"><table width="70%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
                <tr>
                  <td height="44" align="center">
                  <?=number_format($TMP_SCORE_KPI, $decimal_point)?>
                  </td>
                </tr>
              </table></td>
            </tr>            
          </table></td>
		</tr>
        <tr>
          <td height="5"></td>
          </tr>
        <tr>
          <td height="25" class="table_body_2">&nbsp;&nbsp;คะแนนสมรรถนะ</td>
          </tr>
        <tr>
          <td height="5"></td>
          </tr>
        <tr>
		  <td width="28%" height="22" align="center"><table width="70%" border="0" cellpadding="0" cellspacing="0" class="label_normal">
            <tr>
              <td height="50" align="center"><table width="100%" border="0" cellpadding="1" cellspacing="1" class="label_normal">
                <tr>
                  <td height="22" align="center">ผลรวมของคะแนนสมรรถนะทั้งหมด</td>
                </tr>
				<tr>
				  <td height="1" bgcolor="#000000"></td>
				</tr>
                <tr>
				<? 
                                
                                if ($COMPETENCY_SCALE==1) { ?>		
                  <td height="22" align="center">จำนวน "สมรรถนะ" x 3 (คะแนนเต็ม)</td>
				<? } elseif ($COMPETENCY_SCALE==2 || $COMPETENCY_SCALE==5 || $COMPETENCY_SCALE==6) { ?>		
                  <td height="22" align="center">5 (คะแนนเต็ม)</td>
				<? } elseif ($COMPETENCY_SCALE==3) { ?>		
                  <td height="22" align="center">ผลรวมระดับสมรรถนะที่คาดหวัง</td>
				<? } ?>
                </tr>
              </table></td>
              <td width="20%" align="center"><table width="70%" border="0" cellpadding="1" cellspacing="1" class="input_table">
                <tr>
                  <td height="22" align="center" class="table_body_2_over">
                  <?php
                  echo $SCORE_COMPETENCE;
                  //echo number_format($SCORE_COMPETENCE, $decimal_point);
                  ?>
                  </td>
                </tr>
				<tr>
				  <td height="1" bgcolor="#000000"></td>
				</tr>
                <tr>
				<? if ($COMPETENCY_SCALE==1) { ?>		
                  <td height="22" align="center" class="table_body_2_over"><?=$COUNT_COMPETENCE?> x 3</td>
				<? } elseif ($COMPETENCY_SCALE==2 || $COMPETENCY_SCALE==5 || $COMPETENCY_SCALE==6) { ?>		
                  <td height="22" align="center" class="table_body_2_over"><?=$FULL_SCORE?></td>
				<? } elseif ($COMPETENCY_SCALE==3) { ?>		
                  <td height="22" align="center" class="table_body_2_over"><?=$SUM_TARGET_LEVEL?></td>
				 <? } ?>
                </tr>
              </table></td>
              <td width="10%" align="center">=</td>
              <td width="20%" align="center"><table width="70%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
                <tr>
                  <td height="44" align="center">
                  <?=number_format($TMP_SCORE_COMPETENCE, $decimal_point)?>
                  </td>
                </tr>
              </table></td>
            </tr>
            
          </table></td>
		</tr>
        <tr>
          <td height="5"></td>
          </tr>
        <tr>
          <td height="25" class="table_body_2">&nbsp;&nbsp;ผลการประเมินโดยรวม</td>
          </tr>
        <tr>
          <td height="5"></td>
          </tr>
        <tr>
		  <td height="22" align="center"><table width="70%" border="0" cellpadding="1" cellspacing="1" class="label_normal">
            <tr class="table_head" align="center">
              <td width="30%" height="25">องค์ประกอบ</td>
              <td width="15%">น้ำหนัก</td>
              <td>การคำนวณ</td>
              <td width="15%">ผลการประเมิน</td>
            </tr>
            <tr class="table_body">
              <td height="30">&nbsp;&nbsp;1.ผลสำเร็จของงาน</td>
              <td align="center"><?=$PERFORMANCE_WEIGHT?> %</td> 
              <td align="left">&nbsp;&nbsp;ส่วนที่ 1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="text" value="<?=number_format($TMP_SCORE_KPI, $decimal_point)?>" class="textbox" readonly size="5" style="text-align:right">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?=$PERFORMANCE_WEIGHT?>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</td>
              <td align="right"><?=number_format($SUM_KPI, 2)?>&nbsp;&nbsp;&nbsp; </td>
            </tr>
            <tr class="table_body">
              <td height="30">&nbsp;&nbsp;2.สมรรถนะ</td>
              <td align="center"><?=$COMPETENCE_WEIGHT?> % </td>
              <td align="left">&nbsp;&nbsp;ส่วนที่ 2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="text" value="<?=number_format($TMP_SCORE_COMPETENCE, $decimal_point)?>" class="textbox" readonly size="5" style="text-align:right">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?=$COMPETENCE_WEIGHT?>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</td>
              <td align="right"><?=number_format($SUM_COMPETENCE, 2)?>&nbsp;&nbsp;&nbsp; </td>
            </tr>
<?  if($BKK_FLAG != 1){ ?>
            <tr class="table_body" <?=$onmouse_event?>>
              <td height="30">
			       <span onMouseOver="show_kpi_competence_level('<?=$OTH_DESC?>',550,280);" onMouseOut="removeElement();" style="cursor:hand">&nbsp;&nbsp;3.อื่น ๆ  &nbsp;&nbsp;  </span>	  
			  </td>
              <td align="center"><?=$OTHER_WEIGHT?> % </td>
              <td align="left">&nbsp;&nbsp;ส่วนที่ 3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                <input type="text" name="SCORE_OTHER" value="<? if($SCORE_OTHER){ echo  number_format($SCORE_OTHER, $decimal_point);}else{ echo ''; }?>" class="textbox" size="5" 
                       style="text-align:right" <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2))?"":"readonly"?>>
                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<?=$OTHER_WEIGHT?>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=</td>
              <td align="right"><?=number_format($SUM_OTHER, 2)?>&nbsp;&nbsp;&nbsp; </td>
            </tr>
<?  } ?>
            <tr class="table_head" align="center">
              <td height="30" colspan="3">ผลการประเมินโดยรวม (ผลสำเร็จของงาน) + (สมรรถนะ)<?=($BKK_FLAG!=1)?" + (อื่น ๆ)":"";?></td>
              <td align="right" class="table_body_2">
                  <span class="label_alert">
                    <?php echo number_format($SUM_TOTAL, 2)?>&nbsp;&nbsp;&nbsp;
                  </span>
              </td>
            </tr>
          </table></td>
		</tr>
        <tr>
          <td height="5"></td>
          </tr>
		<? if($KF_ID) : ?>
        <tr align="center">
          <td height="25">
      		  <?if( $isLockYear=='UNLOCK' && ($PAGE_AUTH["edit"]=="Y" && $ACCEPT_FLAG == "" && $KF_SCORE_STATUS==0 &&($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2)) ){?>
			  <?	if ($BUTTON_DISPLAY==1 ) { ?>
      		  <input name="Submit22" type="submit" class="button" onClick="form1.command.value='UPDATE';" value="<?=$BNT_EDIT_TITLE?>">
			  <? } else { ?>
            <input name="image" type="image" onClick="form1.command.value='UPDATE';" src="images/save.png" alt="<?=$BNT_EDIT_TITLE?>" border="0">
            &nbsp;&nbsp;&nbsp;
            <?}?>
			  <?}?>          
               <?	if ($BUTTON_DISPLAY==1) { ?>
               <input type="submit" name="Reset2" value="<?=$CANCEL_TITLE?>" onClick="form1.command.value='CANCEL'; " class="button" >
               <? } else { ?>
               <input name="image" type="image" onClick="form1.command.value='CANCEL'; " src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>" border="0">
&nbsp;&nbsp;&nbsp;
<?}?>
			  </td>
        </tr>
		<? endif; ?>
        <tr>
          <td height="5"></td>
          </tr>
        <tr>
          <td height="5"></td>
          </tr>
      </table></td>
    </tr>
  </table>
  &nbsp;
</div>
<div style="display:<?=$SUBPAGE==2?"block":"none"?>">
&nbsp;
  <table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
        <tr>
          <td height="25" class="table_head">&nbsp;&nbsp;ความเห็นของผู้บังคับบัญชาชั้นต้น</td>
          </tr>
		<tr class="table_body_2">
		  <td height="22"><table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
            <tr>
              <td width="15%" height="22" align="right"><?=$FULLNAME_TITLE?>&nbsp;:&nbsp;</td>
              <td width="35%">&nbsp;<?=$REVIEW_PER_NAME?></td>
              <td width="15%" align="right"><?=$PL_TITLE?>&nbsp;:&nbsp;</td>
              <td>&nbsp;<?=$REVIEW_PL_NAME?></td>
            </tr>
            <tr>
              <td height="22" align="right"><?=$MINISTRY_TITLE?>&nbsp;:&nbsp;</td>
              <td>&nbsp;<?=$REVIEW_MINISTRY_NAME?></td>
              <td align="right"><?=$DEPARTMENT_TITLE?>&nbsp;:&nbsp;</td>
              <td>&nbsp;<?=$REVIEW_DEPARTMENT_NAME?></td>
            </tr>
          </table></td>
		  </tr>
        <tr>
          <td height="5"></td>
          </tr>
          <?php 
          $chk_readonly=FALSE;
          if($KF_SCORE_STATUS==0){ //0-อนุญาตให้เห็นคะแนน 1-ไม่อนุญาตให้เห็นคะแนน
            $chk_readonly=TRUE;
          }
          //echo 'chk_readonly:'.$chk_readonly.'<br>';
          ?>
		<tr>
		  <td height="22">&nbsp;&nbsp;ความเห็นด้านผลงาน (ระบุจุดเด่นและ/หรือสิ่งที่ควรแก้ไข) </td>
		  </tr>
		<tr>
		  <td height="22" align="center"><textarea name="RESULT_COMMENT" rows="5" class="selectbox" style="width:85%" <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y" ) && ($PER_ID_REVIEW==$SESS_PER_ID ) && $chk_readonly)?"":"readonly"?>><?=$RESULT_COMMENT?></textarea></td>
		  </tr>
		<tr>
		  <td height="22">&nbsp;&nbsp;ความเห็นด้านสมรรถนะ (ระบุสมรรถนะที่โดดเด่นและ/หรือสมรรถนะที่ควรได้รับการพัฒนา) </td>
		  </tr>
		<tr>
		  <td height="22" align="center"><textarea name="COMPETENCE_COMMENT" rows="5" class="selectbox" style="width:85%" <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y"  ) && ($PER_ID_REVIEW==$SESS_PER_ID ) && $chk_readonly)?"":"readonly"?>><?=$COMPETENCE_COMMENT?></textarea></td>
		  </tr>
                  <?php
                  
                  $ACCEPT_CONFIG=TRUE; //TRUE คลิกได้
                  if($IS_ACCEPT_CONFIG==1 && isset($ACCEPT_FLAG) ){
                    if($ACCEPT_FLAG=='0' || $ACCEPT_FLAG=='1'){$ACCEPT_CONFIG=FALSE;}  //FALSE คลิกไม่ได้
                  }
                  
                  $chk_disabled='disabled';
                  if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ( $USER_AUTH || $PER_ID_REVIEW==$SESS_PER_ID ) &&($PER_ID_REVIEW0!=$SESS_PER_ID) || $SESS_USERGROUP == 1 ){
                    $chk_disabled='';
                  }
                  if($ACCEPT_CONFIG==FALSE){
                    $chk_disabled='disabled';
                  }
                  ?>
		  <tr>
			<td align="center">
			<input type="checkbox" name="CH_KF_STATUS"  value="1"  <? if($KF_STATUS=='1'){ echo "checked"; }?> <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($USER_AUTH || $PER_ID_REVIEW==$SESS_PER_ID) && ($PER_ID_REVIEW0!=$SESS_PER_ID) || $SESS_USERGROUP == 1)?"":"disabled"?>>ไม่อนุญาตให้ผู้ให้ข้อมูลแก้ไขคะแนน
			<input type="checkbox" name="CH_KF_SCORE_STATUS"  value="1"  <? if($KF_SCORE_STATUS=='1'){ echo "checked"; }?> 
                        <?=$chk_disabled;?>
                        >อนุญาตให้เห็นคะแนน</td>
		  </tr>
        <tr>
          <td height="5"></td>
          </tr>
        <!--tr>
          <td height="25" class="table_head">&nbsp;&nbsp;ความเห็นเกี่ยวกับการเลื่อนขั้นเงินเดือน</td>
          </tr>
        <tr>
          <td height="5"></td>
          </tr>
		<tr>
		  <td height="22" align="center"><table width="95%" border="0" cellpadding="0" cellspacing="0" class="label_normal">
            <tr>
              <td width="45%" align="center" valign="top"><table width="98%" border="0" cellpadding="0" cellspacing="0" class="label_normal">
                <tr>
                  <td height="22"><input type="checkbox" name="SALARY_RESULT" value="1" onClick="if(this.checked){ form1.SALARY_RESULT[1].checked=false; form1.SALARY_RESULT[2].checked=false; form1.SALARY_RESULT[3].checked=false; }" <?=($SALARY_RESULT==1)?"checked":""?> <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2))?"":"disabled"?>>ควรเลื่อนขั้นเงินเดือน 1 ขั้น</td>
                </tr>
                <tr>
                  <td height="22"><input type="checkbox" name="SALARY_RESULT" value="2" onClick="if(this.checked){ form1.SALARY_RESULT[0].checked=false; form1.SALARY_RESULT[2].checked=false; form1.SALARY_RESULT[3].checked=false; }" <?=($SALARY_RESULT==2)?"checked":""?> <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2))?"":"disabled"?>>ควรเลื่อนขั้นเงินเดือน 0.5 ขั้น</td>
                </tr>
                <tr>
                  <td height="22"><input type="checkbox" name="SALARY_RESULT" value="3" onClick="if(this.checked){ form1.SALARY_RESULT[0].checked=false; form1.SALARY_RESULT[1].checked=false; form1.SALARY_RESULT[3].checked=false; }" <?=($SALARY_RESULT==3)?"checked":""?> <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2))?"":"disabled"?>>ไม่ควรเลื่อนขั้นเงินเดือน</td>
                </tr>
              </table></td>
              <td align="center" valign="top"><table width="98%" border="0" cellpadding="0" cellspacing="0" class="input_table">
                <tr>
                  <td height="22" class="table_head">ระบุเหตุผลในการเสนอเลื่อนขั้นเงินเดือน</td>
                </tr>
                <tr>
                  <td align="center"><textarea name="SALARY_REMARK1" rows="5" class="selectbox" style="width:100%" <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2))?"":"readonly"?>><?=$SALARY_REMARK1?></textarea></td>
                </tr>
              </table></td>
            </tr>
            <tr>
              <td height="5" colspan="2" align="center" valign="top"></td>
              </tr>
            <tr>
              <td align="center" valign="top"><table width="98%" border="0" cellpadding="0" cellspacing="0" class="label_normal">
                <tr>
                  <td height="22"><input type="checkbox" name="SALARY_RESULT" value="4" onClick="if(this.checked){ form1.SALARY_RESULT[0].checked=false; form1.SALARY_RESULT[1].checked=false; form1.SALARY_RESULT[2].checked=false; }" <?=($SALARY_RESULT==4)?"checked":""?> <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2))?"":"disabled"?>>ควรเลื่อนขั้นเงินเดือน 1.5 ขั้นสำหรับรอบที่ 2 ตามกฏ ก.พ. ว่าด้วยการเลื่อนขั้นเงินเดือน พ.ศ.2544 ข้อ 11 วรรคสาม</td>
                </tr>
              </table></td>
              <td align="center" valign="top"><table width="98%" border="0" cellpadding="0" cellspacing="0" class="input_table">
                <tr>
                  <td height="22" class="table_head">ระบุเหตุว่าผลการประเมินดีเด่นเข้าเกณฑ์เลื่อนขั้นเงินเดือน 1 ขั้นในครั้งแรกแต่มีข้อจำกัดเรื่องโควตา และผลการประเมินดีเด่นอีกในครั้งที่ 2 และมีโควตาให้เลื่อนขั้นเงินเดือนได้อย่างไรบ้าง </td>
                </tr>
                <tr>
                  <td align="center"><textarea name="SALARY_REMARK2" rows="5" class="selectbox" style="width:100%" <?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && ($PER_ID_REVIEW==$SESS_PER_ID || $USER_AUTH2))?"":"readonly"?>><?=$SALARY_REMARK2?></textarea></td>
                </tr>
              </table></td>
            </tr>
          </table></td>
		  </tr>
		<tr>
		  <td height="22">&nbsp;</td>
		  </tr>
        <tr>
          <td height="5"></td>
          </tr-->
		<? if($KF_ID) : ?>
        <tr align="center">
            <td height="25">
                <? //(($ACCEPT_FLAG !='' && $KF_SCORE_STATUS==1) ||   || ( || )
                     //$PER_ID_REVIEW0!=$SESS_PER_ID
                    //$ChkInformant=1;//แก้ไขได้
                    if($PER_ID_REVIEW0==$SESS_PER_ID && $KF_STATUS==1){ //ผู้ให้ข้อมูล ถูกกำหนดสิทธิ ไม่อนุญาตให้ผู้ให้ข้อมูลแก้ไขคะแนน
                      //$ChkInformant=0;//แก้ไขไม่ได้
                      $PAGE_AUTH["edit"]="N";
                    }
                    if( (($PAGE_AUTH["edit"]=="Y"&&($USER_AUTH || $PER_ID_REVIEW==$SESS_PER_ID )) ||  $SESS_USERGROUP == 1) && $isLockYear=='UNLOCK'  ){
                    ?>
                    <? if ($BUTTON_DISPLAY==1) { ?>
                            <input name="Submit22" type="submit" class="button" onClick="form1.command.value='UPDATE';" value="<?=$BNT_EDIT_TITLE?>">
                    <? } else { ?>
                            <input name="image" type="image" onClick="form1.command.value='UPDATE';" src="images/save.png" alt="<?=$BNT_EDIT_TITLE?>" border="0">&nbsp;&nbsp;&nbsp;
                    <? }?>
                <? }?>          
                <? if ($BUTTON_DISPLAY==1) { ?>
                        <input type="submit" name="Reset2" value="<?=$CANCEL_TITLE?>" onClick="form1.command.value='CANCEL';" class="button" >
                <? } else { ?>
                        <input name="image" type="image" onClick="form1.command.value='CANCEL';" src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>" border="0">&nbsp;&nbsp;&nbsp;
                <? }?>
            </td>
        </tr>
		<? endif; ?>
        <tr>
          <td height="5"></td>
          </tr>
      </table></td>
    </tr>
  </table>
  &nbsp;
</div>
<input type="hidden" name="current_list" value="<?=$current_list?>">
        </form>	
		</td>
	</tr>
</table>
<div id="myDivShadow" style="position:absolute;left:110pt;top:20pt;;width:160px;;font-weight:bold;"></div>
<div id="myDiv" style="position:absolute;left:100pt;top:10pt;;width:160px;;font-weight:bold;"></div>

<?
	include("jqModalDialog.html");
?>
</body>
<? if (!$HIDE_HEADER) { ?>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<? } ?>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
</script>
</html>
<?php 

/*ตรวจสอบคะแนนจากส่วนที่ 2.1*/
$cmd = "select 	count(*) AS CNT21
        from PER_PERFORMANCE_GOALS a, PER_KPI b, PER_PERFORMANCE_REVIEW c
        where  a.pg_evaluate IS null and a.KF_ID=$KF_ID and a.KPI_ID=b.KPI_ID(+) and b.PFR_ID=c.PFR_ID(+) ";
$db_dpis->send_cmd($cmd);
$data = $db_dpis->get_array();
$cnt21 =  trim($data[CNT21]);

/*ตรวจสอบคะแนนจากส่วนที่ 2.2*/
$cmd22 = "select count(*) AS CNT22
        from PER_KPI_COMPETENCE a, PER_COMPETENCE b
        where (a.KC_EVALUATE is null or a.KC_WEIGHT is null) and a.KF_ID=$KF_ID and a.CP_CODE=b.CP_CODE(+) and b.DEPARTMENT_ID=$DEPARTMENT_ID  
        order by a.CP_CODE";
$db_dpis->send_cmd($cmd22);
$data22 = $db_dpis->get_array();
$cnt22 =  trim($data22[CNT22]);
/**/
if( !empty($cnt21) || !empty($cnt22) ){
?>
<script>
call_openDialog("alert_kpi_refer3.html",1200,800,"!!!แจ้งเตือน!!!");
$(".ui-dialog-titlebar").hide();
</script>
<?php }?>