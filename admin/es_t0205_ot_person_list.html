<? 
	include("../php_scripts/connect_database.php");
    include("php_scripts/load_per_control.php");
	include("../php_scripts/calendar_data.php");
	include("php_scripts/es_t0205_ot_person_list.php");  
    $db_dpis4 = new connect_dpis($dpisdb_host, $dpisdb_name, $dpisdb_user, $dpisdb_pwd); 
    //	กำหนดค่า default timezone		//phpinfo();
	function set_default_timezone($timezone){
		if (version_compare(phpversion(), '5', '>=')){
			if(function_exists('date_default_timezone_set')) { 
				$result_set = date_default_timezone_set($timezone); 	// PHP  >= 5.1.0
				//echo date_default_timezone_get();	// PHP  >= 5.1.0
			} 
		}else{		// < version 5
			$result_set = ini_set('date.timezone',$timezone);
		}
	return $result_set;
	}
    
    
    
    
    
	/* echo '<pre>';
    print_r($PAGE_AUTH);*/
	set_default_timezone('Asia/Bangkok');	// ทำเวลาให้เป็นเวลาโซนที่กำหนด
	
	$UPDATE_DATE = date("Y-m-d H:i:s");
	$CREATE_DATE = date("Y-m-d H:i A", time());
	$TODATE = date("Y-m-d");
	$temp_date = explode("-", $TODATE);
	$temp_todate = ($temp_date[0]) ."-". $temp_date[1] ."-". $temp_date[2];
	
	if(!$search_date_max) {		// จากเดือนปัจจุบันไปอีก 60 วัน
        $search_abs_endmonth = ($temp_date[1] + 0);
        if($search_abs_endmonth<10) $search_abs_endmonth = "0".($search_abs_endmonth);
        $search_abs_endyear = $temp_date[0];
		$max_date = get_max_date($search_abs_endmonth, $search_abs_endyear);
		//$search_date_max = $max_date."/". $search_abs_endmonth ."/". ($search_abs_endyear + 543);
        $search_date_max = date("d")."/". $search_abs_endmonth ."/". ($search_abs_endyear + 543);
	}

    switch($CTRL_TYPE){
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
	} // end switch case



	switch($SESS_USERGROUP_LEVEL){								
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
		case 5 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
		case 6 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$search_org_id_1 = $ORG_ID_1;
			$search_org_name_1 = $ORG_NAME_1;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
	} // end switch case
    
    
    
    $cmd2 = " select POS_ID,ORG_ID,POEM_ID,POEMS_ID,POT_ID,ORG_ID_1,PER_OT_FLAG from PER_PERSONAL where PER_ID=$SESS_PER_ID"; 
    $db_dpis2->send_cmd($cmd2);
    $data2 = $db_dpis2->get_array();
    $PER_POS_ID = $data2[POS_ID]; /*หาคนภายใต้หน่วยงานตามกฏหมาย ข้าราชการ*/
    $PER_POEM_ID = $data2[POEM_ID]; /*หาคนภายใต้หน่วยงานตามกฏหมาย ลูกจ้างประจำ*/
    $PER_POEMS_ID = $data2[POEMS_ID]; /*หาคนภายใต้หน่วยงานตามกฏหมาย พนักงานราชการ*/
    $PER_POT_ID = $data2[POT_ID]; /*หาคนภายใต้หน่วยงานตามกฏหมาย ลูกจ้างชั่วคราว*/
    
    $PER_ORG_ID = $data2[ORG_ID]; /*หาคนภายใต้หน่วยงานตามหมอบหมายงาน*/
    $PER_ORG_ID_1 = $data2[ORG_ID_1]; /*หาคนภายใต้หน่วยงานตามหมอบหมายงาน ต่ำกว่าสำนัก 1 ระดับ*/
	$PER_OT_FLAG = $data2[PER_OT_FLAG]; /*รหัสเจ้าของ OT ตามกฏหมาย*/

	//echo "PER_ORG_ID=".$PER_ORG_ID." || "."PER_OT_FLAG=".$PER_OT_FLAG;
    
    //หาว่าอยู่กลุ่ม กจ. กรม หรือไม่--------------------------------
    $cmd4 = "	select	 b.CODE from	user_detail a, user_group b
					where a.group_id=b.id AND a.ID=".$SESS_USERID;
    $db_dpis2->send_cmd($cmd4);
    $data4 = $db_dpis2->get_array();
    if ($data4[CODE]) {
        $NAME_GROUP_HRD = $data4[CODE];
    }else{
        $NAME_GROUP_HRD = "";
    }
    
    
    
    if(!$Submit3 && !$image2){ if($P_OTTYPE_ORGANIZE ==2){$select_org_structure=1;}else{$select_org_structure=0;}}
    
    
    // $P_OTTYPE_ORGANIZE  1= กฏหมาย, 2=มอบหมายงาน
    
    $ShowConfig_OT = "ตามกฎหมาย";
    if($P_OTTYPE_ORGANIZE=='2'){$ShowConfig_OT = "ตามมอบหมายงาน";}
    
     if ($SESS_USERGROUP !=1 && $NAME_GROUP_HRD!='HRD'){
    	
      	if($P_OTTYPE_ORGANIZE ==2){ // มอบหมาย
                $cmd3 = " select ORG_NAME from PER_ORG_ASS where ORG_ID=$PER_ORG_ID"; 
                $db_dpis2->send_cmd($cmd3);
                $data3 = $db_dpis2->get_array();
                $search_org_name = $data3[ORG_NAME];
                $search_org_id = $PER_ORG_ID;
                
                if($PER_OT_FLAG!=$PER_ORG_ID){
                    $cmd3 = " select ORG_NAME from PER_ORG_ASS where ORG_ID=$PER_OT_FLAG"; 
                    $db_dpis2->send_cmd($cmd3);
                    $data3 = $db_dpis2->get_array();
                    $search_org_name_1 = $data3[ORG_NAME];
                    $search_org_id_1 = $PER_OT_FLAG;
                }
         }else{ // กฏหมาย
         
    			if($PER_POS_ID){ /*หาคนภายใต้หน่วยงานตามกฏหมาย ข้าราชการ*/
                	$fromTable = "PER_POSITION";
                    $whereTable = " c.POS_ID=$PER_POS_ID";
                }elseif($PER_POEM_ID){ /*หาคนภายใต้หน่วยงานตามกฏหมาย ลูกจ้างประจำ*/
                	$fromTable = "PER_POS_EMP";
                    $whereTable = " c.POEM_ID=$PER_POEM_ID";
                }elseif($PER_POEMS_ID){ /*หาคนภายใต้หน่วยงานตามกฏหมาย พนักงานราชการ*/
                	$fromTable = "PER_POS_EMPSER";
                    $whereTable = " c.POEMS_ID=$PER_POEMS_ID";
                }elseif($PER_POT_ID){ /*หาคนภายใต้หน่วยงานตามกฏหมาย ลูกจ้างชั่วคราว*/
                	$fromTable = "PER_POS_TEMP";
                    $whereTable = " c.POT_ID=$PER_POT_ID";
                }
                
                $cmd3 = " select g.ORG_NAME ,g.ORG_ID,g1.ORG_NAME as ORG_NAME_1 ,g1.ORG_ID as ORG_ID_1
                   from $fromTable c 
                   LEFT JOIN PER_ORG  g on (g.ORG_ID=c.ORG_ID)
                   LEFT JOIN PER_ORG  g1 on (g1.ORG_ID=c.ORG_ID_1)
                   where $whereTable "; 
                $db_dpis2->send_cmd($cmd3);
                $data3 = $db_dpis2->get_array();
                $search_org_name = $data3[ORG_NAME];
                $search_org_id = $data3[ORG_ID];
                
                if($PER_OT_FLAG==$data3[ORG_ID_1]){
                	$search_org_name_1 = $data3[ORG_NAME_1];
                	$search_org_id_1 = $data3[ORG_ID_1];
                }
         }
        
        if(!$search_date_min) { // หาวันที่เริ่มต้นหลังจากปิดงวดโอที เดือนล่าสุด
    
            $cmd2 = " select max(CONTROL_ID) as CONTROL_ID  from TA_PER_OT where DEPARTMENT_ID=$search_org_id and CONTROL_ID IS NOT NULL "; 
            $db_dpis2->send_cmd($cmd2);
            $data2 = $db_dpis2->get_array();
            
            if (!empty($data2[CONTROL_ID])){
                $cmd2 = " select END_DATE  from TA_PER_OT_CONTROL where CONTROL_ID=".$data2[CONTROL_ID]; 
                $db_dpis2->send_cmd($cmd2);
                $data3 = $db_dpis2->get_array();

                if (!empty($data3[END_DATE])){
                	$dateEnd_date = substr($data3[END_DATE],8,2)."-".substr($data3[END_DATE],5,2)."-".substr($data3[END_DATE],0,4);
                    $datetomorow = date('d-m-Y', strtotime("+1 day", strtotime("$dateEnd_date")));
                     $search_date_min = substr($datetomorow,0,2)."/". substr($datetomorow,3,2) ."/". (substr($datetomorow,6,4) + 543);
                }else{
                    $search_date_min = "01/". $temp_date[1] ."/". ($temp_date[0] + 543);
                }
            }else{
            	$search_date_min = "01/". $temp_date[1] ."/". ($temp_date[0] + 543);
            }
            
		}
    }else{
    	 if(!$search_date_min) {
			$search_date_min = "01/". $temp_date[1] ."/". ($temp_date[0] + 543);
		}
    
    }
    
   
    
    /*-------------------------------------------------------------*/
    
    if( !$current_page ) $current_page = 1;
	if(!$data_per_page) $data_per_page = 30;
	$start_record = ($current_page - 1) * $data_per_page;
    
    $Neworg = '';
    if( $SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD'){ 
       	if($select_org_head == 1){  // หน่วยงานที่สังกัด 
        	 if($select_org_structure == 0){ //ตามกฏหมาย
             	if($search_org_id_1){
                	$arr_search_condition[] = "(c.ORG_ID_1=$search_org_id_1 or d.ORG_ID_1=$search_org_id_1 or e.ORG_ID_1=$search_org_id_1 or j.ORG_ID_1=$search_org_id_1)";
                }elseif($search_org_id){
                  //echo "1";
                   $arr_search_condition[] = "(c.ORG_ID=$search_org_id or d.ORG_ID=$search_org_id or e.ORG_ID=$search_org_id or j.ORG_ID=$search_org_id)";
                }else{
                	//echo "2";
                   $arr_search_condition[] = "(a.DEPARTMENT_ID = $search_department_id)";
                }
            }else{ //ตามมอบหมาย
            	if($search_org_id_1){
                	$arr_search_condition[] = "(a.ORG_ID_1=$search_org_id_1)";
                }elseif($search_org_id){
                	//echo "3";
                   $arr_search_condition[] = "(a.ORG_ID=$search_org_id)";
                }else{
                	//echo "4";
                   $arr_search_condition[] = "(a.DEPARTMENT_ID = $search_department_id)";
                }
            
            }
            
         }else{ // หน่วยงานเจ้าของเรื่อง (OT)
         	if($search_org_id_1){
            	$arr_search_condition[] = "(ot.DEPARTMENT_ID=$search_org_id AND ot.ORG_LOWER1=$search_org_id_1)";
                $Neworg = " AND (ot.DEPARTMENT_ID=$search_org_id AND ot.ORG_LOWER1=$search_org_id_1)";
            }elseif($search_org_id){
            	//echo "5";
                $arr_search_condition[] = "(ot.DEPARTMENT_ID=$search_org_id AND ot.ORG_LOWER1=-1)";
                $Neworg = " AND (ot.DEPARTMENT_ID=$search_org_id AND ot.ORG_LOWER1=-1)";
            }else{
            	//echo "6";
                $arr_search_condition[] = "(ot.ORG_ID=$search_department_id AND ot.DEPARTMENT_ID=-1  )";
                $Neworg = " AND (ot.ORG_ID=$search_department_id AND ot.DEPARTMENT_ID=-1)";
            }
         }
    }else{ // กจ. สำนัก
    	//echo "7";
        if($search_org_id_1){
        	$arr_search_condition[] = "(ot.DEPARTMENT_ID= $search_org_id AND ot.ORG_LOWER1=$search_org_id_1)";
        	$Neworg = " AND (ot.DEPARTMENT_ID=$search_org_id AND ot.ORG_LOWER1=$search_org_id_1)";
        }else{
    		$arr_search_condition[] = "(ot.DEPARTMENT_ID= $search_org_id AND ot.ORG_LOWER1=-1)";
        	$Neworg = " AND (ot.DEPARTMENT_ID=$search_org_id AND ot.ORG_LOWER1=-1)";
        }
    }
   
   	if(trim($search_name)) $arr_search_condition[] = "(a.PER_NAME like '".trim($search_name)."%' or UPPER(a.PER_ENG_NAME) like UPPER('".trim($search_name)."%'))";
   	 if(trim($search_surname)) $arr_search_condition[] = "(a.PER_SURNAME like '".trim($search_surname)."%' or UPPER(a.PER_ENG_SURNAME) like UPPER('".trim($search_surname)."%'))";
    
    if(trim($search_pay_no))  $arr_search_condition[] = "(trim(c.POS_NO) = '$search_pay_no' and a.PER_TYPE = 1)";
    if(trim($search_level_no)) $arr_search_condition[] = "(trim(a.LEVEL_NO) = '". trim($search_level_no) ."')";
    if(trim($search_pl_code)) $arr_search_condition[] = "(trim(c.PL_CODE) = '". trim($search_pl_code) ."')";
    if(trim($search_pm_code)) $arr_search_condition[] = "(trim(c.PM_CODE) = '". trim($search_pm_code) ."')";
    if(trim($search_per_type)) 	$arr_search_condition[] = "(a.PER_TYPE = $search_per_type)";
    
    $condition_date = "";
    if($search_date_min && $search_date_max){ 
		 $tmpsearch_date_min =  save_date($search_date_min);
         $tmpsearch_date_max =  save_date($search_date_max);
         $arr_search_condition[] = " ( ot.OT_DATE BETWEEN  '$tmpsearch_date_min' and '$tmpsearch_date_max') ";
         $condition_date = " AND  ( OT_DATE BETWEEN  '$tmpsearch_date_min' and '$tmpsearch_date_max') ";
	}else if($search_date_min && empty($search_date_max)){ 
		 $tmpsearch_date_min =  save_date($search_date_min);
         $arr_search_condition[] = " (ot.OT_DATE='$tmpsearch_date_min') ";
         $condition_date = " AND (OT_DATE='$tmpsearch_date_min') ";
    }else if(empty($search_date_min) && $search_date_max){ 
		 $tmpsearch_date_max =  save_date($search_date_max);
         $arr_search_condition[] = " (ot.OT_DATE='$tmpsearch_date_max') ";
         $condition_date = " AND (OT_DATE='$tmpsearch_date_max') ";
    }
    
    /*เช็คการคำนวน Ot จากเจ้าของเรื่อง*/
    $condition_OT = "";
    if ($SESS_USERGROUP !=1 && $NAME_GROUP_HRD!='HRD'){
        	if($search_org_id_1){
     			$condition_OT = " AND DEPARTMENT_ID=" .$search_org_id." AND ORG_LOWER1=".$search_org_id_1;
            }else{
            	$condition_OT = " AND DEPARTMENT_ID=" .$search_org_id;
            }

    }else{ 
    	if($select_org_head=="0"){
        	if($search_org_id_1){
            	$condition_OT = " AND DEPARTMENT_ID=" .$search_org_id." AND ORG_LOWER1=".$search_org_id_1;
        	}elseif($search_org_id){
            	$condition_OT = " AND DEPARTMENT_ID=$search_org_id";
            }else{
            	$condition_OT = " AND ORG_ID=$search_department_id AND DEPARTMENT_ID=-1";
            }
     		
        }
        
    }

    
    
    $search_condition = "";
	if(count($arr_search_condition)) $search_condition = " and " . implode(" and ", $arr_search_condition);
	
   // if($command == "SEARCH") {
    
         $cmd = " select 	count( distinct ot.PER_ID) as count_data 
         
                             from  TA_PER_OT ot
                                                left join PER_PERSONAL a on(a.PER_ID=ot.PER_ID) 
                                                left join PER_ORG b on(b.ORG_ID=a.ORG_ID) 
                                                left join PER_POSITION c on(c.POS_ID=a.POS_ID) 
                                                left join PER_POS_EMP d on(d.POEM_ID=a.POEM_ID) 
                                                left join PER_POS_EMPSER e on(e.POEMS_ID=a.POEMS_ID) 
                                                left join PER_LEVEL f on(f.LEVEL_NO=a.LEVEL_NO) 
                                                left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                                                left join PER_MGT h on(h.PM_CODE=c.PM_CODE)
                                                left join PER_LINE i on(i.PL_CODE=c.PL_CODE)
                                                left join PER_POS_TEMP j on (j.POT_ID=a.POT_ID)
                             where 		1=1 
                                            $search_condition ";
            $db_dpis->send_cmd($cmd);
            $data = $db_dpis->get_array();
            $data = array_change_key_case($data, CASE_LOWER);
            $count_data = $data[count_data];	
     // }
?>

<html>
<head>
<title><?=$webpage_title;?> - <?=$MENU_TITLE_LV0;?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1;?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2;?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3;?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE"> <!--//---เพิ่มมาจาก personal_master_form--->
<META HTTP-EQUIV="Cache-Control" CONTENT="NO-CACHE"> <!--//---เพิ่มมาจาก personal_master_form--->
<link rel="stylesheet" href="<?=$cssfileselected;?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/> <!--//---เพิ่มมาจาก personal_master_form--->
</head>
<!-------------------------------------------------------------------------------------------->
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<!-------------------------------------------------------------------------------------------->
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">
	function change_current_page( page ){
		form1.current_page.value = page;
		form1.submit();
	}

	function changedateformat(name,str) {
		var arr = str.split('/');
		if((str) && (str != arr[0]+'/'+arr[1]+'/'+arr[2])){
			name.value = str.substr(0,2) + "/" + str.substr(2,2) + "/"  + str.substr(4,4) ;
		}
		chk_date(name, "BDH");
	}
	
	function confirm_delete(data_id ,MINDATE,MAXDATE, data_label,DATA_OT_DATE,CARDNO){
		if(confirm("คุณต้องการลบข้อมูลนี้ [ " + data_label + " วันที่ทำ OT "+DATA_OT_DATE+" ] ใช่หรือไม่?")){
			form1.command.value = "DELETE";
			form1.HIDPER_ID.value = data_id;
			form1.HIDOT_DATEMIN.value = MINDATE;
			form1.HIDOT_DATEMAX.value = MAXDATE;
			form1.HIDPER_CARDNO.value = CARDNO;
			form1.submit();
		} // end if
	}
	


    function call_rtf_pdf_report(report_type) {
	    var  report_type
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")));?>";
		//document.form1.target = "_blank";

		 if (report_type==1){
		document.form1.action = "report/rpt_es_t0205_ot_person.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate+"&FLAG_RTF=1";
		}else if (report_type==0){ 
		document.form1.action = "report/rpt_es_t0205_ot_person.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate+"&FLAG_RTF=0";
		}
		
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "es_t0205_ot_person_list.html";
	} 
	
	function call_export_file() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")));?>";
		document.form1.action = "report/rpt_es_t0205_ot_person_xls.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate;
		
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "es_t0205_ot_person_list.html";
	}	

	function call_sort(flag) {
		form1.order_by.value=flag;		form1.sort_by.value=flag;
		if(form1.sort_type.value==flag+":asc"){
			form1.sort_type.value=flag+":desc";
		}else{ //desc
			form1.sort_type.value=flag+":asc";
		}		
		form1.command.value='SEARCH';
		form1.submit();
	} // end function call_sort
	
	function call_add_person() {
		var PerSonID=form1.HideID.value;	
	    call_openDialog("es_search_ot_person.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	}
	
	function call_add_personShow() {
		var PerSonID=form1.HideID.value;	
	    call_openDialog("es_search_ot_person_show.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	}
	//function call_add_personShow() {
	//	var PerSonID=form1.HideID.value;	
	  //  call_openDialog("es_search_ot_person_show.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	//}
	
	
	function call_search_ministry() {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$MINISTRY_TITLE;?>");		
	}
	
	function call_search_department() {	
		var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$MINISTRY_ID":"form1.search_ministry_id.value");?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(MINISTRY_ID != ""){
			parameter = "&send_by=search_department&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$DEPARTMENT_TITLE;?>");		
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT;?>');
			form1.btn_ministry.focus();
			<? } ?>
		} // end if
	}	
	
	function call_search_org_0() {	
		var DEPARTMENT_ID = <?=(($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4)?"$DEPARTMENT_ID":"form1.search_department_id.value");?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(DEPARTMENT_ID != ""){
			if(form1.select_org_structure[0].checked){
				org_search_file ="search_org";
			}else if(form1.select_org_structure[1].checked) {
				org_search_file ="search_org_ass"; 
			}
			parameter = "&send_by=search_org_0&OL_CODE=03&ORG_ID_REF=" + DEPARTMENT_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,900,600,"<?=$ORG_TITLE;?>");		
		
		}else{
				<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
				alert('<?=$DEPARTMENT_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
				alert('<?=$DEPARTMENT_ALERT;?>');
				form1.btn_department.focus();
			<? } ?>
		} // end if
	}
	
	function call_search_org1() {	
		var ORG_ID = form1.search_org_id.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(ORG_ID != ""){
			if(form1.select_org_structure[0].checked){
				org_search_file ="search_org";
			}else if(form1.select_org_structure[1].checked) {
				org_search_file ="search_org_ass"; 
			}
			parameter = "&send_by=search_org1&OL_CODE=04&ORG_ID_REF=" + ORG_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$ORG_TITLE1?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$ORG_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$ORG_ALERT;?>');
			form.btn_org_1.focus();
			<? } ?>
		} // end if
	}
	
	function returnFrom(src, returnValue){
		 if  (src.indexOf("search_org") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				if (arrValue[7]=="search_ministry") {
					form1.search_ministry_id.value = arrValue[0];
					form1.search_ministry_name.value = arrValue[1];
					form1.search_department_id.value = "";
					form1.search_department_name.value = "";
					form1.search_org_id.value = "";
					form1.search_org_name.value = "";
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_department") {
					form1.search_department_id.value = arrValue[0];
					form1.search_department_name.value = arrValue[1];
					form1.search_org_id.value = "";
					form1.search_org_name.value = "";
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_org_0") {
					form1.search_org_id.value = arrValue[0];
					form1.search_org_name.value = arrValue[1];
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_org1") {
					form1.search_org_id_1.value = arrValue[0];
					form1.search_org_name_1.value = arrValue[1];
				
				}
			} // end if
	
		} else if  (src.indexOf("search_mgt") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				form1.search_pm_code.value = arrValue[0];
				form1.search_pm_name.value = arrValue[1];
			} // end if
			
		} else if  (src.indexOf("search_perline") > -1 || src.indexOf("search_pos_name") > -1 || src.indexOf("search_empser_pos_name") > -1 || src.indexOf("search_temp_pos_name") > -1) {
			if(returnValue){
			    arrValue = returnValue.split("<::>");
				form1.search_pl_code.value = arrValue[0];
				form1.search_pl_name.value = arrValue[1];
			} // end if
		
		}else if  (src.indexOf("es_add_ot_person_dop") > -1) {
			form1.command.value='';
			form1.submit();
			
		}else if  (src.indexOf("es_t0205_ot_person_update") > -1) {
                    if(returnValue){
                            //location.reload();
                           form1.submit() =  form1.current_page.value=0;
                    } // end if		
		}else if  (src.indexOf("es_search_ot_person") > -1) {
			form1.SELECTED_PER_ID.value = returnValue;
			//alert(returnValue);
			if(returnValue){
				//form1.btn_ministryShow.style.display = "block";
				form1.btn_ministryShow.style.display = "";
			}else{
				form1.btn_ministryShow.style.display = "none";
			} // end if
		}else{
			arrValue = returnValue.split("<::>");	
			form1.HideID.value = arrValue[1];
			var TotalNum = 0;
			if(arrValue[1] !=""){
				var Total = arrValue[1].split(",");
				TotalNum=Total.length;
				document.getElementById("btn_ministryShow").style.display='';
			}else{
				document.getElementById("btn_ministryShow").style.display='none';
			}
			document.getElementById("DIVPERSONNOSCAN_ID").innerHTML = "<br>รายชื่อบุคลากร ทั้งสิ้นที่เลือกไว้ <font color='red'>"+TotalNum+"</font> รายการ <br>";
		
			
		}	
		
		tt.value = returnValue;
		
	} // end if
	
		function call_search_result() {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("es_search_noscan_result.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,850,600,"รายชื่อบุคคลากรที่ทำ OT");		
	}	
	
	function selValue(){
		
		var inputElems = document.getElementsByTagName("input"),
        count = 0;
		
        for (var i=0; i<inputElems.length; i++) {       
           if (inputElems[i].type == "checkbox" && inputElems[i].name.substr(0,15)=="PERSONNOSCAN_ID" ){
              count++;

           }

        }

		var valID = '';
		for(i=1;i<=count;i++){
		
				if(eval("form1.PERSONNOSCAN_ID"+i+".checked")==true){
					valID = valID +eval("form1.PERSONNOSCAN_ID"+i+".value")+",";
				}
		
		}
		
		var valStrID = valID.substr(0,valID.length - 1);
		form1.HideID.value = valStrID;
	}
	
	function SaveData(f){
		
		if(f.TIME_START.value=="") {
			alert("กรุณาระบุ วันที่ทำ OT");
			f.TIME_START.focus();
			return false;
		} 
		
		if(f.TIME_START.value !="" && f.TIME_END.value !="") {
			arrValueS = f.TIME_START.value.split("/");
			arrValueE = f.TIME_END.value.split("/");
			var START =arrValueS[2]+''+arrValueS[1]+''+arrValueS[0];
			var END = arrValueE[2]+''+arrValueE[1]+''+arrValueE[0];
			if(parseInt(START) > parseInt(END)){
				alert("วันที่สิ้นสุด ต้องมากกว่า วันที่เริ่มต้น");
				f.TIME_END.focus();
				return false;
			}
			
		} 
		
		
                if(f.SELECTED_PER_ID.value==""){
			alert('กรุณาเลือก รายชื่อบุคลากร');
			return false;
		}
		/*if(f.HideID.value==""){
			alert('กรุณาเลือก รายชื่อบุคลากร');
			return false;
		}*/
		
		form1.submit();
	}
	
	function UpdateData(f){
		
		if(f.START_TIME_HH.value+''+f.START_TIME_II.value !="0000") {
			var START =f.START_TIME_HH.value+''+f.START_TIME_II.value;
			var END = f.END_TIME_HH.value+''+f.END_TIME_II.value;
			if(parseInt(START) >= parseInt(END)){
				alert("เวลาสิ้นสุด ต้องมากกว่า เวลาเริ่มต้น");
				f.END_TIME_HH.focus();
				return false;
			}
			
		} 
		
		
		form1.submit();
	}
	
	
	
	
	function call_search_perline() {	
		var parameter = "";
		var PER_TYPE = form1.search_per_type.options[form1.search_per_type.options.selectedIndex].value
		parameter = "&PER_TYPE="+PER_TYPE;
		if(PER_TYPE==1 || PER_TYPE == 0){
		    call_openDialog("search_perline.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POSITION_TITLE;?>");		
		}else if(PER_TYPE==2){
		    call_openDialog("search_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_EMP_TITLE;?>");		
		}else if(PER_TYPE==3){
		    call_openDialog("search_empser_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_EMPSER_TITLE;?>");		
		}else if(PER_TYPE==4){
		    call_openDialog("search_temp_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_TEMP_TITLE;?>");		
		}
	}
	
	function call_search_mgt () {	
		var parameter = "";
	    call_openDialog("search_mgt.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$PM_TITLE;?>");		
	}
	
	
	function ChkdelAll(obj){
		
		var count = document.forms[0].elements.length;
		for (i=0; i<count; i++) 
		{
			var element = document.forms[0].elements[i]; 
			if(element.type == 'checkbox' && obj.checked){
				
				if(element.type == 'checkbox' && element.name.substr(0,6)=="ChkDel" )
				 {
					 	element.checked=true;	
				   }
				  
			}else{
				
				if(element.type == 'checkbox' && element.name.substr(0,6)=="ChkDel" )
				 {
					 element.checked=false; 
				  }
			}
	
		}
		
		var valID = '';
		for(x=1;x<=form1.hdnLine.value;x++){
			if(eval("form1.ChkDel"+x+".checked")==true){
				
				valID = valID +eval("form1.ChkDel"+x+".value")+",";
			}
			
		}
		var valStrID = valID.substr(0,valID.length - 1);
		form1.HidedelID.value = valStrID;
		
	}
	
	
	function CheckDel(){
		var Total = document.form1.hdnLine.value;
		var count = document.forms[0].elements.length;
	   
	   var iNum=0; 
		for (i=0; i<count; i++) 
		  {
			var element = document.forms[0].elements[i]; 
			
			if(element.type == 'checkbox' && element.name.substr(0,6)=="ChkDel" && element.type != document.getElementById("ChkdelALL") && element.checked == true )
			{
				iNum=iNum+1;
			 }
			
			 if(element.checked == false )
			 {
				document.getElementById("ChkdelALL").checked=false;
			  }  
				   
		}
		
		if(iNum==Total){
			document.getElementById("ChkdelALL").checked=true;
		}else{
			document.getElementById("ChkdelALL").checked=false;
		}  
		
		
		var valID = '';
		for(x=1;x<=form1.hdnLine.value;x++){
			if(eval("form1.ChkDel"+x+".checked")==true){
				
				valID = valID +eval("form1.ChkDel"+x+".value")+",";
			}
			
		}
		var valStrID = valID.substr(0,valID.length - 1);
		form1.HidedelID.value = valStrID;
		
	}
	
	
	function seldelValue(){
		var StrChk = false;
		for(i=1;i<=form1.hdnLine.value;i++){
		
				if(eval("form1.ChkDel"+i+".checked")==true){
					StrChk = true;
				}
		}
		
		if(StrChk== false){
			alert('กรุณาเลือกรายชื่อบุคลากร');
			return false;
		}else{
			if(confirm("คุณต้องการลบ ใช่หรือไม่ ?")){
				form1.submit();
			} // end if
	    }
	

}
	
	
function ResetData(f){
	
	f.search_org_name.value="";
	f.search_org_id.value="";
	f.search_org_name_1.value="";
	f.search_org_id_1.value="";
	f.search_name.value="";
	f.search_surname.value="";
	<? if($SESS_DEPARTMENT_NAME=="กรมการปกครอง"){?>
	f.search_pay_no.value="";
	<? }?>
	f.search_level_no.value="";
	f.search_pl_name.value="";
	f.search_pl_code.value="";
	f.search_pm_name.value="";
	f.search_pm_code.value="";
	f.search_per_type.value="1";
	f.search_date_min.value="";
	f.search_date_max.value="";
	f.search_per_type.value="0";

	
	if(f.SESS_USERGROUP.value ==1 || f.NAME_GROUP_HRD.value == 'HRD'){
		document.getElementById('select_org_head1').checked = true;
		document.getElementById('select_org_structure1').checked = true;
	}else{
		document.getElementById('select_org_structure_ot1').checked = true;
	}
	

}

function ResetDataSave(f){
	document.getElementById("DIVPERSONNOSCAN_ID").innerHTML = "";		
	f.HideID.value = "";
	f.TIME_START.value="";
	f.TIME_END.value="";
	f.SELECTED_PER_ID.value="";
	document.getElementById('OT_Status2').checked = true;
	document.getElementById("btn_ministryShow").style.display='none';

}





function call_add_personShowHis(PerSonID,OT_MIN,OT_MAX,Neworg) {
	    call_openDialog("es_t0205_ot_person_update.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&HIDPER_ID="+PerSonID+"&HIDOT_MIN="+OT_MIN+"&HIDOT_MAX="+OT_MAX+"&HIDNeworg="+Neworg,1000,700,"กำหนดบุคคลที่ทำ OT");		
            $(".ui-state-default").hide();
            $(".ui-button-icon-primary").hide();
}
	
function chkDisable(){
	if(document.getElementById('select_org_head1').checked == true){
		document.getElementById('select_org_structure1').checked = true;
	}else{
		document.getElementById('select_org_structure1').checked = true;
	}

}

function call_select_person() {
    var PerSonID=form1.HideID.value;	
    parameter = "&SELECTED_LIST=" + form1.SELECTED_PER_ID.value;
    //call_openDialog("select_person.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,800,"รายชื่อ<?=$PERSON_TITLE?>");		
    call_openDialog("es_search_ot_person.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID+parameter,1000,700,"รายชื่อบุคลากร");		
}

function call_show_person() {	
    var PerSonID=form1.HideID.value;
    parameter = "&SELECTED_LIST=" + form1.SELECTED_PER_ID.value;
    call_openDialog("es_search_ot_person_show.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID+parameter,1000,700,"รายชื่อบุคลากร");		
}
	//function call_add_personShow() {
	//	var PerSonID=form1.HideID.value;	
	  //  call_openDialog("es_search_ot_person_show.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	//}
	
function DataShow() {
	call_openDialog("es_show_information.html",200,200,"คำอธิบายการดึงข้อมูลลงเวลาเพื่อใช้ในงาน OT");		
}

function chkCause(){
	var d = '01';
	var m = document.getElementById('search_month').value;
	if(m.length ==1){
		m = "0" + m;
	}
	var y = parseInt(document.getElementById('search_year').value) - 543;
	var ymd = y +'-'+ m +'-' +d;
	var today = new Date(ymd);
	var maxDate= new Date( today.getFullYear(), today.getMonth()+1,0).toJSON().slice(0,10);
	var tmpdateMin = d+'/'+maxDate.substring(5, 7)+'/'+(parseInt(maxDate.substring(0, 4))+543);
	var tmpdateMax = (parseInt(maxDate.substring(8, 10))+1)+'/'+maxDate.substring(5, 7)+'/'+(parseInt(maxDate.substring(0, 4))+543);
	document.getElementById('search_date_min').value = tmpdateMin;
	document.getElementById('search_date_max').value = tmpdateMax;
}

function ChkAllAllow(obj){
	var count = document.forms[0].elements.length;
    for (i=0; i<count; i++) 
      {
			var element = document.forms[0].elements[i]; 
			if(element.type == 'checkbox' && obj.checked){
				
				if(element.type == 'checkbox' && element.name.substr(0,13)=="list_allow_id" )
				 {
					 	element.checked=true;	
				   }
				  
			}else{
				
				if(element.type == 'checkbox' && element.name.substr(0,13)=="list_allow_id" )
				 {
					 element.checked=false; 
				  }
			}
            
    	}
}

function set_uncheck_all(ischecked,name,id){
	if(ischecked==false && name.checked==true)		name.checked=false;
}

</script>
<?  //เช็คปุ่มที่ได้ค่าออกมา ว่าเป็นปุ่มเพิ่มหรือแก้ไข 
	if($PAGE_AUTH["edit"]=="Y" && $UPD) 
	$Submit = "Submit_edit";
	else if(!$VIEW && $PAGE_AUTH["add"]=="Y") 
	$Submit = "Submit_add";    
?>

<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<tr>
    	<td height="10"><? include("header_menu.html");?></td>
  	</tr>
    <tr> 
	  <td align="left" valign="top">
<?	
		if ($UPD) $OPTIONAL_TITLE=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE=" &gt; ดูข้อมูล";
		include("current_location.html");
?>
	  </td>
	</tr>
  	<tr>
    	<td align="left" valign="top"><form name="form1" method="post" action="es_t0205_ot_person_list.html" enctype="multipart/form-data">
          <input type="hidden" name="current_page" value="<?=$current_page;?>">
          <input type="hidden" name="total_page" value="<?=$total_page;?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0;?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1;?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2;?>">
		  <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3;?>">
          <input type="hidden" name="command" value="<?=$command;?>">
          <input type="hidden" name="table" value="<?=$table;?>">
          <input type="hidden" name="HIDPER_ID" value="<?=$HIDPER_ID;?>">
          <input type="hidden" name="HIDOT_DATEMIN" value="<?=$HIDOT_DATEMIN;?>">
          <input type="hidden" name="HIDOT_DATEMAX" value="<?=$HIDOT_DATEMAX;?>">
          <input type="hidden" name="HIDHOLYDAY_FLAG" value="<?=$HIDHOLYDAY_FLAG;?>">
          <input type="hidden" name="HIDPER_CARDNO" value="<?=$HIDPER_CARDNO;?>">
          <input type="hidden" name="HID_SESS_ORG_SETLEVEL" value="<?=$SESS_ORG_SETLEVEL;?>">
          <input type="hidden" name="HIDAPPROVE_FLAG" value="<?=$HIDAPPROVE_FLAG;?>">
        <input type="hidden" name="PER_AUDIT_FLAG" value="<?=$PER_AUDIT_FLAG;?>">
        <input type="hidden" name="NAME_GROUP_HRD" value="<?=$NAME_GROUP_HRD;?>">
        <input type="hidden" name="SESS_USERGROUP" value="<?=$SESS_USERGROUP;?>">
        <!-- Release 5.2.1.7 begin-->
        <? if($SESS_PER_ID != ""){ $SELECTED_PER_ID = -1; } ?>
        <input type="hidden" name="SELECTED_PER_ID" value="<?=$SELECTED_PER_ID;?>">
        
        <!-- Release 5.2.1.7 end-->
&nbsp;
<table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
  	  <td width="15%"><table width="100%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
  	    <tr>
  	      <td height="22" align="center" class="table_body_3"><a href="#" style="text-decoration: none">กำหนดบุคลากร</a></td>
	      </tr>
	    </table></td>
       <td width="15%"><table width="100%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
  	    <tr>
  	      <td height="22" align="center" class="table_body"><a href="es_t0205_ot_person_allow.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>" style="text-decoration: none">ตรวจทาน</a></td>
	      </tr>
	    </table></td>
	  <td width="65%">
      <? 
      /*$cmd = "	select	 b.CODE from	user_detail a, user_group b
					where a.group_id=b.id AND a.ID=".$SESS_USERID;
                    $result = $db->send_cmd($cmd);
                    if ($result) {
                    	$data = $db->get_array();
                    	$NAME_GROUP_HRD = $data[CODE];
                    }else{
                        $NAME_GROUP_HRD = "";
                    }
      		if($SESS_USERGROUP_LEVEL<=4 && ($NAME_GROUP_HRD=="HRD") || ($SESS_USERGROUP==1) ||  (count($SESS_AuditArray) > 0)){ */ ?>
              <table width="23%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
                <tr>
                  <td height="22" align="center" class="table_body"><a href="es_t0207_ot_check_list.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>" style="text-decoration: none">สรุปบัญชีเบิกจ่าย OT</a></td>
                  </tr>
                </table>
        <? //}?>
        </td>
	</tr>
  </table>
  <table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table" 
  onKeyPress="return keyEnter(event,document.form1.<?=$Submit;?>);">
    <tr>
      <td>
      
        
               
               
          
      
      <table width="100%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal" >
        <? if (!$UPD) { ?>
        <tr>
          <td colspan="2" height="5"></td>
          </tr>
          
               <tr>
          <td width="35%" align="right" height="25"><span class="label_alert">*</span>&nbsp;ช่วงวันที่ทำ OT&nbsp;:&nbsp;</td>
          <td width="65%" height="25">
		  	<input name="TIME_START" type="text" class="textbox" id="TIME_START" value="" style="width:15%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.TIME_START,this.value)">
		  	<input type="reset" class="button" onClick="return showCalendar('TIME_START', 'dd/mm/y', '<?=$SESS_HOLIDAY?>');" value="<?=$SELECT_TITLE;?>">&nbsp;&nbsp;-&nbsp;	&nbsp;   	  
            
           <input name="TIME_END" type="text" class="textbox" id="TIME_END" value="" style="width:15%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.TIME_END,this.value)">
		  	<input type="reset" class="button" onClick="return showCalendar('TIME_END', 'dd/mm/y', '<?=$SESS_HOLIDAY?>');" value="<?=$SELECT_TITLE;?>"> 
            </td>	   
        </tr>
        
        <tr>
          <td width="35%" align="right" height="25">กำหนดเวลาที่ทำ OT&nbsp;:&nbsp;</td>
          <td width="65%" height="25">
          <input type="radio" name="OT_Status" value="1" id="OT_Status1" > เช้า
          <input type="radio" name="OT_Status" value="2" id="OT_Status2" checked> เย็น
          <input type="radio" name="OT_Status" value="3" id="OT_Status3"> ทั้งเช้าและเย็น
		  	</td>	   
        </tr>
        
         <tr valign="top">
          <td  align="right" height="25"><span class="label_alert">*</span>&nbsp;รายชื่อบุคลากร&nbsp;:&nbsp;</td>
          <td height="25" align="left">
          <input type="button" name="btn_ministry2" value=" กำหนดบุคลากร " class="button" onClick="call_select_person();" ><!-- call_add_person-->
            
            <input type="hidden" value="" id="HideID" name="HideID"></input>
            &nbsp;&nbsp;
          <input type="button" name="btn_ministryShow" id="btn_ministryShow" style="display:none"  value=" แสดงรายชื่อที่เลือก " class="button" onClick="call_show_person();" > <!-- call_add_personShow -->
           <br/>
            <label id="DIVPERSONNOSCAN_ID"></label>
          <br/>
          </td>
        </tr>
        <? }?>

        <tr>
        	<td align="left" width="35%">&nbsp;
            <!--<input type="button" name="btn_otatt" value=" ดึงข้อมูลการลงเวลา " class="button" onClick="return call_add_personShowHis();">-->
            
            </td>
          <td height="30">
            <? 

            $BNTdisabled ='';
            $BNTcolor="";
            $BNTtitle="";
            if($SESS_USERGROUP_LEVEL<4){ $BNTdisabled ='disabled'; $BNTcolor="color:#ACA6A6";$BNTtitle="title='ไม่ได้รับสิทธิ์'";}
            if($PAGE_AUTH["add"]=="Y"){
			  		if ($BUTTON_DISPLAY==1) { ?>
            			<input name="Submit_add"  type="submit" class="button" onClick="form1.command.value='ADD';  return SaveData(form1);" value="  <?=$ADD_TITLE;?>  " style="<?=$BNTcolor;?>" <?=$BNTdisabled;?> <?=$BNTtitle;?>>
            		<? } else { ?>
            			<input name="image" type="image" onClick="form1.command.value='ADD';  return SaveData(form1);" src="images/save.png" alt="<?=$ADD_TITLE;?>" border="0" <?=$BNTdisabled;?> <?=$BNTtitle;?> >
            		<?}?>
            <?}
			  		if ($BUTTON_DISPLAY==1) { ?>
            			<input name="Reset2" type="button" onClick="return ResetDataSave(form1);" class="button" value=" <?=$CLEAR_TITLE;?> ">
            	<? } else { ?>
           		 	<img src="images/default.jpg" alt="<?=$CLEAR_TITLE;?>" width="32" height="32" border="0" onClick="return ResetDataSave(form1);">&nbsp;
			<?}?>
            &nbsp;&nbsp;&nbsp;
            <input name="buttoninfor" title="Information" type="button" class="button" onClick="return DataShow();" value="  i  ">
            

         </td>
        </tr>
        
        <?   if($SESS_USERGROUP_LEVEL<4){ ?>
        	<tr>
                <td height="30" colspan="2" align="center"><font color='red' size="+1">การกำหนดบุคลากรทำ OT เฉพาะสิทธิ์การเข้าถึงข้อมูลในระดับกรม, สำนัก/กอง, ต่ำกว่าสำนัก/กอง เท่านั้น</font>
                </td>
        	</tr>
        <? }?>
        
      </table>
      
      
      
      
      
      
      
      </td>
    </tr>
  </table>
  
  
  
  <table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
		  <tr>
		  	<td height="22" align="center" class="table_body"><?=$SEARCH_TITLE;?></td>
		  </tr>		
	  </table></td>
	</tr>
  </table>
  <table width="95%" align="center"  border="0" cellspacing="0" cellpadding="0" onKeyPress="return keyEnter(event,document.form1.Submit3);">
        <tr>
          <td align="center" class="input_table">
          
          <table width="100%"  border="0" cellpadding="1" cellspacing="1" class="label_normal">
          <? if( $SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD'){ ?>
                <tr>
                  <td height="22" align="right" valign="top">เงื่อนไขค้นหาข้อมูลจากหน่วยงาน&nbsp;:&nbsp;</td>
                  <td colspan="3">
                    <input name="select_org_head" id="select_org_head1" type="radio" value="0" onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';return chkDisable();" <?=($select_org_head==0)?"checked":""?>> หน่วยงานเจ้าของเรื่อง (OT)
                    <input name="select_org_head" id="select_org_head2" type="radio" value="1" onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';return chkDisable();" <?=($select_org_head==1)?"checked":""?>> หน่วยงานที่สังกัด
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input name="select_org_structure" id="select_org_structure1" type="radio" value="0" <?=($select_org_structure==0 || empty($select_org_head))?"checked":""?> onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';"> <?=$LAW_STRUCTURE_TITLE;?>
                    <input name="select_org_structure" id="select_org_structure2" type="radio" value="1" <?=($select_org_structure==1 )?"checked":""?> onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';"> <?=$ASSIGN_STRUCTURE_TITLE;?>
                  </td>
                </tr>
             <? }?> 
            
            <tr>
                     <td width="19%" height="22" align="right"> <?=$MINISTRY_TITLE;?>&nbsp;:&nbsp;</td>
                     <td width="32%">
                       <input type="text" name="search_ministry_name" value="<?=$search_ministry_name;?>" style="width:77%" class="textbox"  readonly="true" >
                       <input type="hidden" name="search_ministry_id" value="<?=$search_ministry_id;?>">
                       <? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
                       <input type="button" name="btn_ministry" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_ministry()" >
                       <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_ministry_name.value=''; form1.search_ministry_id.value=''; form1.search_department_name.value=''; form1.search_department_id.value=''; form1.search_org_name.value=''; form1.search_org_id.value='';  return false;" align="center" alt="ล้างค่า">		 
                       <? } // end if ?>	
                       </td>
                     <td width="16%" align="right"><span class="label_alert">*</span> <?=$DEPARTMENT_TITLE;?>&nbsp;:&nbsp;</td>
                     <td width="33%">
                       <input type="text" name="search_department_name" value="<?=$search_department_name;?>" style="width:75%" class="textbox"  readonly="true" >
                       <input type="hidden" name="search_department_id" value="<?=$search_department_id;?>">
                       <? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
                       <input type="button" name="btn_department" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_department()" >
                       <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_department_name.value=''; form1.search_department_id.value=''; form1.search_org_name.value=''; form1.search_org_id.value='';  return false;" align="center" alt="ล้างค่า">
                       <? } // end if ?>
                       </td>
                   </tr>
                   
                   <? if( $SESS_USERGROUP !=1 && $NAME_GROUP_HRD !='HRD'){ ?>
				   <!--<tr>
				     <td height="22" align="right">หน่วยงานเจ้าของเรื่อง OT&nbsp;:&nbsp;</td>
				     <td height="22" colspan="3">
                    	<input name="select_org_structure_ot" id="select_org_structure_ot1" type="radio" value="0" <?=($select_org_structure_ot==0)?"checked":"";?>> ตาม<?=$LAW_STRUCTURE_TITLE;?>&nbsp;
                    	<input name="select_org_structure_ot" id="select_org_structure_ot2" type="radio" value="1" <?=($select_org_structure_ot==1)?"checked":"";?>> ตาม<?=$ASSIGN_STRUCTURE_TITLE;?>
                    </td>
		        </tr>-->
                <? } // end if ?>
				   <tr>
              <td height="22" align="right"><?=$ORG_TITLE;?>&nbsp;:&nbsp;</td>
              <td height="22"><input type="text" name="search_org_name" id="search_org_name" value="<?=$search_org_name;?>" style="width:77%" class="textbox"  readonly="true" >
                <input type="hidden" name="search_org_id" value="<?=$search_org_id;?>">
                <? if($SESS_USERGROUP==1 || $NAME_GROUP_HRD=='HRD'){ ?>
                <input type="button" name="btn_org" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_org_0()" >
                <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name.value=''; form1.search_org_id.value=''; return false;" align="center" alt="ล้างค่า">
                <? } // end if ?>
                	</td>
                	<td height="22" align="right"><?=$ORG_TITLE1;?>&nbsp;:&nbsp;</td>
                    <td height="22">
                    <input type="text" name="search_org_name_1" value="<?=$search_org_name_1;?>" style="width:75%" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id_1" value="<?=$search_org_id_1;?>">
                  <? if($SESS_USERGROUP==1 || $NAME_GROUP_HRD=='HRD'){ ?>
                  <input type="button" name="btn_org_1" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_org1()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form.search_org_name_1.value=''; form.search_org_id_1.value=''; return false;" align="center" alt="ล้างค่า">
                  <? } // end if ?>
                	</td>
              </tr> 
            <tr>
              <td height="22" align="right"><?=$NAME_TITLE?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_name"  value="<?=$search_name;?>" style="width:77%" class="textbox" ></td>
              <td align="right"><?=$SURNAME_TITLE?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_surname" value="<?=$search_surname;?>" style="width:75%" class="textbox" ></td>
		      </tr>
            
            <tr>
              <td height="22" align="right"><? if ($SESS_DEPARTMENT_NAME=="กรมการปกครอง") { ?><?=$PAY_NO_TITLE;?><? } else { ?><?=$LEVEL_TITLE;?><? } ?>&nbsp;:&nbsp;</td>
              <td><? if ($SESS_DEPARTMENT_NAME=="กรมการปกครอง") { ?>
              		<input type="text" name="search_pay_no" value="<?=$search_pay_no;?>" style="width:30%" class="textbox" onKeyPress="return DigitOnly();">
              <? } else { ?>
              		<select class="selectbox" name="search_level_no"  onChange="<?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW)?" check_salary_type(1, this.value);":""?>">
                        <option value="" <?=($search_level_no=="")?"selected":""?>>== <?=$LEVEL_TITLE;?> ==</option>
                        <?
                            $where = "";
                            $cmd = "	select LEVEL_NO_MIN, LEVEL_NO_MAX FROM PER_LINE	where PL_CODE = '$search_pl_code' ";
                            $count_per_line = $db_dpis->send_cmd($cmd);
        //					echo "cmd=$cmd ($count_data)<br>";
                            if ($count_per_line) {
                                $data = $db_dpis->get_array();
                                $LEVEL_NO_MIN = trim($data[LEVEL_NO_MIN]); 
                                $LEVEL_NO_MAX = trim($data[LEVEL_NO_MAX]); 
                                $where = "";
                                if ($LEVEL_NO_MIN)
                                    $where .= " and LEVEL_NO >= '$LEVEL_NO_MIN' ";
                                if ($LEVEL_NO_MAX)
                                    $where .= " and LEVEL_NO <= '$LEVEL_NO_MAX' ";
                            }
        
                            $cmd = " select LEVEL_NO, LEVEL_NAME from PER_LEVEL where PER_TYPE = 1 and LEVEL_ACTIVE = 1 $where order by LEVEL_SEQ_NO ";
                            $db_dpis->send_cmd($cmd);
                            while($data = $db_dpis->get_array()){					
                                $TMP_LEVEL_NO = $data[LEVEL_NO];
                                $TMP_LEVEL_NAME = $data[LEVEL_NAME];
                          ?>
                        <option value="<?=$TMP_LEVEL_NO;?>" <?=(trim($search_level_no)==trim($TMP_LEVEL_NO))?"selected":""?>><?=$TMP_LEVEL_NAME;?></option>
                        <?
                            } // end while
                          ?>
                    </select>
              <? } ?>
              
			  </td>
				
              <td height="22" align="right"><?=$PER_TYPE_TITLE;?>&nbsp;:&nbsp;</td>
              <td><select name="search_per_type" >
			    <?  foreach($PERSON_TYPE as $key=>$value){  
					 $disinput[$key] = "";		$disinput[0]="";		$chinput[$key] = "";		
					if($SESS_PER_TYPE==0){	//ทั้งหมด
					   	if(trim($search_per_type)){
							$chinput[$SESS_PER_TYPE] = "";		$chinput[$search_per_type] = " selected";
						}else{
							$chinput[$SESS_PER_TYPE] = " selected";
						}
					}else{	//ประเภทอื่น
						$chinput[$key]=" selected";		 $chinput[0]="";		$disinput[$key]="";		$styleline[$key]="display:block";
					}
				?><option value="<?=$key;?>" <?=$chinput[$key]." ".$disinput[$key];?>><?=$value;?></option><?  } ?>
			    <? if($SESS_PER_TYPE==0 && $BKK_FLAG!=1){ ?><option value="0" <?=$chinput[0]." ".$disinput[0];?>>ทั้งหมด</option><? } ?>
			    </select>
              </td>
            </tr>
				<tr>
          <td height="25" align="right"><?=$PL_TITLE;?>&nbsp;:&nbsp;</td>
          <td>
		  	<input type="text" name="search_pl_name" value="<?=$search_pl_name;?>" style="width:75%" class="textbox"  readonly>
            <input type="button" name="Input" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_perline()">
			<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_pl_name.value=''; form1.search_pl_code.value=''; return false;" align="center" alt="ล้างค่า">
			<input type="hidden" name="search_pl_code" value="<?=trim($search_pl_code);?>"></td>
          <td height="25" align="right"><?=$PM_TITLE;?>&nbsp;:&nbsp;</td>
          <td>
		  	<input type="text" name="search_pm_name" value="<?=$search_pm_name;?>" style="width:75%" class="textbox"  readonly>
            <input type="button" name="Input" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_mgt()">
			<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_pm_name.value=''; form1.search_pm_code.value=''; return false;" align="center" alt="ล้างค่า">

            <input type="hidden" name="search_pm_code" value="<?=trim($search_pm_code);?>">          </td>
            </tr>
            <tr>
              <td height="22" align="right">ประจำเดือน&nbsp;:&nbsp;</td>
              <td height="22" colspan="2">
              				<select name="search_month" id="search_month" class="selectbox" style="width:35%" onclick="return chkCause();">
                          <? for($i=1; $i<=12; $i++){ ?>
                          <option value="<?=$i;?>" <?=(($search_month==$i) || (!isset($search_month) && $i==(date("m") + 0)))?"selected":"";?>>
                            <?=$month_full[$i][TH];?>
                      </option>
                          <? } // end for ?>
                  </select>
                  <input type="hidden" name="hidM" value="<?=date("m");?>">
                        
                        <input type="text" name="search_year" id="search_year" value="<?=trim($search_year)?$search_year:(date("Y") + 543);?>" class="textbox" style="width:20%" onKeyPress="return DigitOnly();" maxlength="4" onChange="return chkCause();">
                        </td>
              <td>&nbsp;</td>
            </tr>
			<tr>
			  <td height="22" align="right">ช่วงวันที่ทำ OT&nbsp;:&nbsp;</td>
			  <td>
              <input name="search_date_min" type="text" class="textbox" id="search_date_min" value="<?=$search_date_min;?>" style="width:31%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_date_min,this.value)">
		  	<input type="reset" class="button" onClick="return showCalendar('search_date_min', 'dd/mm/y', '<?=$SESS_HOLIDAY;?>');" value="<?=$SELECT_TITLE;?>">&nbsp;&nbsp;-&nbsp;	&nbsp;   	  
            
           <input name="search_date_max" type="text" class="textbox" id="search_date_max" value="<?=$search_date_max;?>" style="width:31%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_date_max,this.value)">
		  	<input type="reset" class="button" onClick="return showCalendar('search_date_max', 'dd/mm/y', '<?=$SESS_HOLIDAY;?>');" value="<?=$SELECT_TITLE;?>">
			    </td>
			  <td height="22" align="right">&nbsp;</td>
			  <td>
                
                </td>
			  </tr>

            <tr>
              <td colspan="4" height="5"></td>
            </tr>          
            <tr>
              <td align="center" colspan="4"><? if ($BUTTON_DISPLAY==1) { ?>
                <input name="Submit3" type="submit" class="button" value="<?=$SEARCH_TITLE;?>" onClick="form1.command.value='SEARCH';form1.current_page.value=0;">
                
                <input name="Reset" type="button" class="button" onClick="return ResetData(form1);" value="<?=$CLEAR_TITLE;?>">
                <? } else { ?>
                <input name="image2" type="image" onClick="form1.command.value='SEARCH';javascript:form1.current_page.value=0;" src="images/search.png" alt="<?=$SEARCH_TITLE;?>">
                 
                <input name="image" type="image" onClick="return ResetData(form1);" src="images/cancel.gif" alt="<?=$CANCEL_TITLE;?>" border="0">
                <?}?>
                &nbsp;&nbsp;&nbsp;<font color="red">หน่วยงานเจ้าของเรื่อง OT (<?=$ShowConfig_OT;?>)</font>
                </td>
            </tr>

          </table>
          
          
          </td>
        </tr>
		<tr>
		  <td>
		  <table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
<tr><td><input type="hidden" name="order_by" value="<?=$order_by;?>">
    <input type="hidden" name="sort_by" value="<?=$sort_by;?>">
    <input type="hidden" name="sort_type" value="<?=$sort_type;?>">
    <?=$SORT_TITLE;?>
</td>
</tr>
</table>
		  <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
            <tr>
              <td width="26%" height="22"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_report" type="button" class="button" style="width:150" value="<?=$PDF_TITLE;?>" onClick="call_rtf_pdf_report(0);"> 
				       <? if ($RTF_FLAG==1) { ?>
                <input name="btn21" type="button" class="button" style="width:150" value="<?=$RTF_TITLE;?>" onClick="call_rtf_pdf_report(1);"> 
	                    <? } ?>
                <?  } else { ?>
                <img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE;?>" onClick="call_rtf_pdf_report(0);"> 
			        	 <? if ($RTF_FLAG==1) { ?>
                <img src="images/doc_icon_word.jpg" border="0" alt="<?=$RTF_TITLE;?>" onClick="call_rtf_pdf_report(1);"> 
	                     <? } ?>
                <? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
              <td width="59%" align="center">พบข้อมูล <?=$MENU_TITLE_LV2;?> ทั้งสิ้น <?=($count_data);?> รายการ</td>
              <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE;?>" onClick="call_export_file();">
                <?  } else { ?>
                <img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE;?>" onClick="call_export_file();">
                <? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
            </tr>
          </table></td>
		</tr>
  </table>  
  <?
  
  	//if($command == "SEARCH") {
        
  		if(!$sort_by) $sort_by=1;
        if(!$sort_type) $sort_type="1:asc";
        $arrSort=explode(":",$sort_type);
        $SortType[$arrSort[0]]	=$arrSort[1];
        if(!$order_by) $order_by=1;
    
        if($order_by==1){	//(ค่าเริ่มต้น)
            $order_str = "ORDER BY q1.FULLNAME_SHOW ".$SortType[$order_by];
        }elseif($order_by==2) {	//สังกัด
            $order_str = " ORDER BY q1.ORG_ID ".$SortType[$order_by].",q1.EMP_ORG_ID ".$SortType[$order_by].",q1.EMPS_ORG_ID ".$SortType[$order_by].",q1.POT_ORG_ID ".$SortType[$order_by];
        }


		$total_page = ceil( $count_data / $data_per_page );
		$page_link = create_link_page($total_page, $current_page);
        $data_num = $data_per_page * ($current_page - 1);
		$limit_data = "";
		
		if($DPISDB=="oci8"){
			$rec_start = (($current_page-1) * $data_per_page) + 1;
			$rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
			$cmd = " select		*
                         from (
                             select	 q1.*
                             from (
                                 select 	distinct
                                 			ot.PER_ID,a.PER_TYPE,
                                            g.PN_SHORTNAME||a.PER_NAME||' '||a.PER_SURNAME  AS FULLNAME_SHOW,
                                            c.POS_NO,d.POEM_NO,e.POEMS_NO,
                                            (select min(OT_DATE) from TA_PER_OT 
                                               where  PER_ID=ot.PER_ID $condition_date $condition_OT) AS OT_MIN,
                                            (select max(OT_DATE) from TA_PER_OT 
                                               where PER_ID=ot.PER_ID $condition_date $condition_OT) AS OT_MAX,
                                            (select sum(NUM_HRS) from TA_PER_OT 
                                               where SET_FLAG !=0 AND PER_ID=ot.PER_ID $condition_date $condition_OT) AS NUM_HRS,
                                            (select sum(AMOUNT) from TA_PER_OT 
                                               where SET_FLAG !=0 AND PER_ID=ot.PER_ID $condition_date $condition_OT) AS AMOUNT,
                                              c.PL_CODE, d.PN_CODE, e.EP_CODE,j.TP_CODE, c.ORG_ID,
                                              d.ORG_ID as EMP_ORG_ID, e.ORG_ID as EMPS_ORG_ID,
                                              j.ORG_ID AS POT_ORG_ID,j.POT_NO,a.PER_CARDNO,a.PER_STATUS
                                            from  TA_PER_OT ot
                                            left join PER_PERSONAL a on(a.PER_ID=ot.PER_ID) 
                                            left join PER_ORG b on(b.ORG_ID=a.ORG_ID) 
                                            left join PER_POSITION c on(c.POS_ID=a.POS_ID) 
                                            left join PER_POS_EMP d on(d.POEM_ID=a.POEM_ID) 
                                            left join PER_POS_EMPSER e on(e.POEMS_ID=a.POEMS_ID) 
                                            left join PER_LEVEL f on(f.LEVEL_NO=a.LEVEL_NO) 
                                            left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                                            left join PER_MGT h on(h.PM_CODE=c.PM_CODE)
                                            left join PER_LINE i on(i.PL_CODE=c.PL_CODE)
                                            left join PER_POS_TEMP j on (j.POT_ID=a.POT_ID)
                                 where 		1=1
                                                $search_condition 
                                				
                            ) q1 $order_str
                        ) where rownum between $rec_start and $rec_end ";
		} // end if
        
        //echo "<pre>".$cmd;
		$count_page_data = $db_dpis->send_cmd($cmd);
		if($count_page_data){
?>
  <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
    <tr align="center" class="table_head">
      <td nowrap width="7%"><strong>ลำดับที่</strong></td>
      <td nowrap width="25%" height="21" onClick="call_sort(1);"><strong>
        <? if($order_by==1&&$sort_by==1){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        ชื่อ-สกุล</strong></td>
      <td width="30%" onClick="call_sort(2);"><? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>สำนัก/กองตามกฎหมาย</td>
      <td width="12%">จำนวนชั่วโมง</td>
      <td width="12%">จำนวนเงิน</td>
      <td width="8%">รายละเอียด</td>
      <?if($PAGE_AUTH["del"]=="Y"){?>
      <td width="6%"><?=$DEL_TITLE;?>
      </td>
      <?}?>
    </tr>
     <? 
			$current_list = "";
			$data_count = 0;
  			while($data = $db_dpis->get_array()) :
				$data_count++;
                $data_num++;
				if($data_count > $data_per_page) break;
				$DATA_PER_ID = $data[PER_ID];
                $DATA_PER_ID_OT = $data[PER_ID]."_".$data[OT_MIN]."_".$data[OT_MAX]."_".$data[PER_CARDNO];
                $OT_MIN = $data[OT_MIN];
                $OT_MAX = $data[OT_MAX];
                $PER_CARDNO = $data[PER_CARDNO];
				$current_list .= ((trim($current_list))?",":"") . "'$DATA_PER_ID'";
                $DATA_FULLNAME_SHOW = trim($data[FULLNAME_SHOW]);
				$DATA_OT_MIN = show_date_format($data[OT_MIN], $DATE_DISPLAY);
                $DATA_OT_MAX = show_date_format($data[OT_MAX], $DATE_DISPLAY);
                $DATA_POS_NO = $data[POS_NO].$data[POEM_NO].$data[POEMS_NO];  
                $DATA_DATEOT = $DATA_OT_MIN ." ถึง ".$DATA_OT_MAX;
                if(!empty($data[NUM_HRS])){
                	$DATA_NUM_HRS = number_format($data[NUM_HRS]);
                }else{
                	$DATA_NUM_HRS ="";
                }
                
                if(!empty($data[AMOUNT])){
                	$DATA_AMOUNT = number_format($data[AMOUNT]);
                }else{
                	$DATA_AMOUNT ="";
                }
                
                $DATA_PER_TYPE = trim($data[PER_TYPE]);
                if($DATA_PER_TYPE==1){ 
					$TMP_POS_NO = $data[POS_NO];
					$TMP_POS_NO_NAME = $data[POS_NO_NAME];
					$TMP_PER_TYPE = "ข้าราชการ";
					$TMP_ORG_ID = $data[ORG_ID];
					$TMP_ORG_ID_1 = $data[ORG_ID_1];
					$TMP_PL_CODE = $data[PL_CODE];
					$TMP_PT_CODE = trim($data[PT_CODE]);
					$TMP_PM_CODE = $data[PM_CODE];

					$cmd = " select PL_NAME from PER_LINE where PL_CODE='$TMP_PL_CODE' ";
					$db_dpis2->send_cmd($cmd);
					$data2 = $db_dpis2->get_array();
					$DATA_PL_NAME = $data2[PL_NAME];
					
					$cmd = " select PT_NAME from PER_TYPE where trim(PT_CODE)='$TMP_PT_CODE' ";
					$db_dpis2->send_cmd($cmd);
					$data2 = $db_dpis2->get_array();
					$TMP_PT_NAME = $data2[PT_NAME];
					
					$cmd = " select PM_NAME from PER_MGT where PM_CODE='$TMP_PM_CODE' ";
					$db_dpis2->send_cmd($cmd);
					$data2 = $db_dpis2->get_array();
					$TMP_PM_NAME = $data2[PM_NAME];
					
					if ($RPT_N)
		    			$TMP_POSITION = (trim($TMP_PM_NAME) ?"$TMP_PM_NAME (":"") . (trim($TMP_PL_NAME)? "$TMP_PL_NAME$POSITION_LEVEL" : "") . (trim($TMP_PM_NAME) ?")":"");
					else
		    			$TMP_POSITION = (trim($TMP_PM_NAME) ?"$TMP_PM_NAME (":"") . (trim($TMP_PL_NAME)?($TMP_PL_NAME ." ". level_no_format($TMP_LEVEL_NO) . (($TMP_PT_NAME != "ทั่วไป" && $TMP_LEVEL_NO >= 6)?"$TMP_PT_NAME":"")):"") . (trim($TMP_PM_NAME) ?")":"");
				}elseif($DATA_PER_TYPE==2){ 
					$TMP_POS_NO = $data[POEM_NO];
					$TMP_POS_NO_NAME = $data[POEM_NO_NAME];
					$TMP_PER_TYPE = "ลูกจ้างประจำ";
					$TMP_ORG_ID = $data[EMP_ORG_ID];
					$TMP_PL_CODE = $data[PN_CODE];

					$cmd = " select PN_NAME from PER_POS_NAME where PN_CODE='$TMP_PL_CODE' ";
					$db_dpis2->send_cmd($cmd);
					$data2 = $db_dpis2->get_array();
					$DATA_PL_NAME = $data2[PN_NAME];

					$TMP_POSITION = $DATA_PL_NAME;
				} elseif ($DATA_PER_TYPE == 3) {
					$TMP_POS_NO = $data[POEMS_NO];
					$TMP_POS_NO_NAME = $data[POEMS_NO_NAME];
					$TMP_PER_TYPE = "พนักงานราชการ";
					$TMP_ORG_ID = $data[EMPS_ORG_ID];					
					$TMP_PL_CODE = $data[EP_CODE];

					$cmd = " select EP_NAME from PER_EMPSER_POS_NAME where EP_CODE='$TMP_PL_CODE' ";
					$db_dpis2->send_cmd($cmd);
					$data2 = $db_dpis2->get_array();
					$DATA_PL_NAME = $data2[EP_NAME];

					$TMP_POSITION = $DATA_PL_NAME;
								
				} elseif ($DATA_PER_TYPE == 4) {
					$TMP_POS_NO = $data[POT_NO];
					$TMP_POS_NO_NAME = $data[POT_NO_NAME];
					$TMP_PER_TYPE = "ลูกจ้างชั่วคราว";
					$TMP_ORG_ID = $data[POT_ORG_ID];					
					$TMP_PL_CODE = $data[TP_CODE];

					$cmd = " select TP_NAME from PER_TEMP_POS_NAME where TP_CODE='$TMP_PL_CODE' ";
					$db_dpis2->send_cmd($cmd);
					//echo $cmd;
					$data2 = $db_dpis2->get_array();
					$DATA_PL_NAME = $data2[TP_NAME];

					$TMP_POSITION = $DATA_PL_NAME; 
				} // end if
                
                
                if($TMP_ORG_ID){
					$cmd = " select ORG_ID_REF, ORG_NAME from PER_ORG where ORG_ID=$TMP_ORG_ID ";
					$db_dpis2->send_cmd($cmd);
					$data2 = $db_dpis2->get_array();
					$DATA_ORG_NAME = $data2[ORG_NAME];
				}
                
                $curstyle = "";
                if($data[PER_STATUS]== 2){		//พ้นจากส่วนราชการ
                    $curstyle.="color:#FF0000"; 
                } // end if	
                
                
                             
  ?>
    <tr class="table_body"  onMouseOver="this.className='table_body_over';" onMouseOut="this.className='table_body';" style="<?=$curstyle; ?>">
      <td align="center"><?=$data_num;?></td>
      <td height="25" align="left">&nbsp;<?=$DATA_FULLNAME_SHOW;?></td>
      <td align="left">&nbsp;<?=$DATA_ORG_NAME;?></td>
      <td align="center"><?=$DATA_NUM_HRS;?></td>
      <td align="right"><?=$DATA_AMOUNT;?>&nbsp;</td>
       <td align="center">
            <a href="<?=("javascript:call_add_personShowHis('".$DATA_PER_ID."','".$OT_MIN."','".$OT_MAX."','".$Neworg."')")?>"><img src="images/desc.gif" border="0" alt="ดูรายละเอียด"></a>
       </td>
       
       <?if($PAGE_AUTH["del"]=="Y"){?>
                    <td align="center">
                        <input type="checkbox"  id="list_allow_id[]" name="list_allow_id[]" onClick="set_uncheck_all(this.checked,form1.list_allow_all,this.id)"  value="<?=$DATA_PER_ID_OT;?>">
                    </td>
              <?}?>

    </tr>
    
    <?	 endwhile;?>
    <? if($PAGE_AUTH["del"]=="Y"){?>
    <tr class="table_footer" height="21">
      <td>&nbsp;</td>
	  <td>&nbsp;</td>
	  <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td >&nbsp;</td>
      <td>&nbsp;</td>
      <td align="center">
              <input type="checkbox" name="list_allow_all" value="1" title="ลบทั้งหมด"  onClick="return ChkAllAllow(form1.list_allow_all);">
              <br>
               <? if ($BUTTON_DISPLAY==1) { ?>
                		<input type="submit" name="Submit43" value="  ลบ  " onClick="form1.command.value='DELETE'" class="button" style="width:99%" title="ลบข้อมูล">
                <?  } else { ?>
                		<input name="image33" type="image" onClick="form1.command.value='DELETE'" src="images/delete.gif" border="0" title="ลบข้อมูล">
                <? } ?>
        </td>
    </tr>
	<?}?>
  </table>
   <? //} /* end if($command == "SEARCH") {*/ ?>
  <? if($total_page > 1) : ?>
  <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td><?=$page_link;?></td>
    </tr>
  </table>
   
  <? endif; ?>&nbsp;
  <? } // if  count show ?>
  			<input name="hdnLine" type="hidden" value="<?=$data_count;?>">
  			<input type="hidden" name="current_list" value="<?=$current_list;?>">
    	</form>	
		</td>
	</tr>
</table>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
function call_add_personDup(ID,TIME_START,TIME_END,OT_Status) {
		var PerSonID = ID.replace("-1,", ""); 
		var START =TIME_START;
		var END = TIME_END;
		var OTStatus = OT_Status;
	   call_openDialog("es_add_ot_person_dop.html?send_by=es_add_ot_person_dop&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&HideID="+PerSonID+"&TIME_START="+START+"&TIME_END="+END+'&OT_STATUS='+OTStatus,1000,700,"รายชื่อบุคลากรที่ทำ OT และมีช่วงวันที่ตามที่เลือกซ้ำในฐานข้อมูล");
	  
	}
<?php if($OpenDialog=="1"){?>
	call_add_personDup('<?=$Dup_ID;?>','<?=$Dup_TIME_START;?>','<?=$Dup_TIME_END;?>','<?=$Dup_OT_Status;?>');
<?php }?>
</script>
</html>
