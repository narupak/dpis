<? 
	include("../php_scripts/connect_database.php");
	include("php_scripts/session_start.php");
	include("php_scripts/function_share.php");	
	include("php_scripts/load_per_control.php");
	
	$prefix_form = "";
	if($from_parent=="acting_comdtl") {
    	$prefix_name = "data_acting_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_acting_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="รักษาราชการแทน/รักษาราชการในตำแหน่ง";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'07','509','510'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="assign_comdtl") {
    	$prefix_name = "data_assign_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_assign_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="มอบหมายงาน/ปฏิบัติราชการแทน";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'521'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="compensation_salpromote_comdtl_empser") {
    	$prefix_name = "data_compensation_salpromote_comdtl_empser";
        $prefix_form = "data_salpromote_comdtl_form";
		$PER_TYPE = 3;
		if (!$COM_SITE) $COM_SITE = "data_compensation_salpromote_comdtl_empser";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="เลื่อนเงินเดือนพนักงานราชการ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'507','05'"; 
	    else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="compensation_salpromote_comdtl") {
    	$prefix_name = "data_compensation_salpromote_comdtl";
        $prefix_form = "data_salpromote_comdtl_form";
		if (!$COM_SITE) $COM_SITE = "data_compensation_salpromote_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="เลื่อนเงินเดือนข้าราชการ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'507','05'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="help_comdtl") {
    	$prefix_name = "data_help_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_help_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="ช่วยราชการ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'522'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="map_emp_comdtl") {
    	$prefix_name = "data_map_emp_comdtl";
		$PER_TYPE = 2;
		if (!$COM_SITE) $COM_SITE = "data_map_emp_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="จัดระบบตำแหน่งลูกจ้างประจำ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'02','502'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="map_type_new_comdtl") {
    	$prefix_name = "data_map_type_new_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_map_type_new_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="จัดคนลงตาม พรบ.ใหม่";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'02','502'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="move_comdtl_N") {
    	$prefix_name = "data_move_comdtl_N";
        $prefix_form = "data_move_comdtl_form_N";
		if (!$COM_SITE) $COM_SITE = "data_move_comdtl_N";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="จัดคนลงตามโครงสร้างส่วนราชการใหม่";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'02','502'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="move_req_comdtl") {
    	$prefix_name = "data_move_req_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_move_req_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="ย้าย";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'02','502'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="move_salary") {
    	$prefix_name = "data_move_salary";
		if (!$COM_SITE) $COM_SITE = "data_move_salary";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="ตัดโอนอัตราเงินเดือนข้าราชการ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'523'";
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="promote_e_p_comdtl") {
    	$prefix_name = "data_promote_e_p_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_promote_e_p_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="เลื่อน";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'04','504'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="retire_comdtl") {
    	$prefix_name = "data_retire_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_retire_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="ออกจากส่วนราชการ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'06','511'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="salpromote_new_comdtl") {
    	$prefix_name = "data_salpromote_new_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_salpromote_new_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="ปรับอัตราเงินเดือนใหม่";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'524'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="salreceive_comdtl") {
    	$prefix_name = "data_salreceive_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_salreceive_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="รับเงินเดือนตามคุณวุฒิ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'506'"; 
    	else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
	} else if ($from_parent=="transfer_req_comdtl") {
    	$prefix_name = "data_transfer_req_comdtl";
		if (!$COM_SITE) $COM_SITE = "data_transfer_req_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="บรรจุ/แต่งตั้ง/รับโอน";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'01','501','503'";
	    else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
   } else if ($from_parent=="salpromote_comdtl") {
    	$prefix_name = "data_salpromote_comdtl";
		if($BKK_FLAG==1){
			$PER_TYPE = 1;
		}else{	
			$PER_TYPE = 2;
		}
		if (!$COM_SITE) $COM_SITE = "data_salpromote_comdtl";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="เลื่อนขั้นเงินเดือนลูกจ้างประจำ";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "'05','507'"; 
	    else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
    } else {
    	$prefix_name = "";
		if (!$COM_SITE) $COM_SITE = "";
		if (!$COM_TYPE_NM) $COM_TYPE_NM="";
		if (!$COM_GROUP_IN) $COM_GROUP_IN  = "";
	    else $COM_GROUP_IN=stripslashes($COM_GROUP_IN);
    }

	if (!$ORG_ID) $ORG_ID  = ($search_org_id=="NULL" ? "0" : $search_org_id);
//	echo "prefix_name=$prefix_name<br>";

   	if (!$SELECT_TAB_ID)  $SELECT_TAB_ID = "a1";
    if (!$command_for)  $command_for = "1";
	if (!$tabstatus)  $tabstatus = "$COM_SEARCH_TITLE,$COM_ADD_TITLE,$ADD_PERSON_TITLE";
    
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
</head>
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 

	<link rel="STYLESHEET" type="text/css" href="codebase/dhtmlxtabbar.css">
	<script  src="codebase/dhtmlxcommon.js"></script>
	<script  src="codebase/dhtmlxtabbar.js"></script>
	<script  src="codebase/dhtmlxtabbar_start.js"></script>
	<style>
	.dhx_tab_element div{
		valign:center;
	}
	</style>

<script language="JavaScript">

	function refresh_opener(returnValue){
		var arr = returnValue.split("<::>");
		
		form1.command_for.value = arr[0];
		// เครื่องหมาย ! หมายถึงไม่เปลี่ยนค่านั้น
		if (arr[1]!="!") form1.COM_ID.value = arr[1];
		if (arr[3]!="!") form1.ORG_ID.value = arr[3];
		if (arr[4]!="!") form1.PER_TYPE.value = arr[4];
		if (arr[5]!="!") form1.CMD_SEQ.value = arr[5];
		if (arr[6]!="!") form1.COUNT_COMDTL.value = arr[6];
		if (arr[7]!="!") form1.COM_CONFIRM.value = arr[7]; // = 1 คือ confirm

//		alert("command:"+form1.command.value+",2:"+form1.command2.value+",3:"+form1.command3.value);

		if (form1.COM_CONFIRM.value!="1") {
			if (arr[8].indexOf("UPD") > -1)  form1.command2.value = "UPDATE";
			else if (arr[8].indexOf("VIEW") > -1)  form1.command2.value = "VIEW";
			else if (arr[8]!="!") form1.command2.value = "";
		} else form1.command2.value = "VIEW"; // ถ้ามีการยืนยันแล้ว สถานนะ tab 2 จะเป็น VIEW อย่างเดียว

		if (form1.COM_CONFIRM.value!="1") {
			if (arr[9].indexOf("UPD") > -1)  form1.command3.value = "UPDATE";
			else if (arr[9].indexOf("VIEW") > -1)  form1.command3.value = "VIEW";
			else if (arr[9]!="!") form1.command3.value = "";
		} else form1.command3.value = "VIEW"; // ถ้ามีการยืนยันแล้ว สถานนะ tab 3 จะเป็น VIEW อย่างเดียว

		if (form1.command_for.value=="1" && form1.COM_ID.value.length == 0) {
			form1.tabstatus.value = "<?=$COM_SEARCH_TITLE?>,<?=$COM_ADD_TITLE?>,<?=$ADD_PERSON_TITLE?>";
		} else  {
			var arr1 = form1.tabstatus.value.split(",");
			if (form1.command2.value=="UPDATE")  arr1[1] = "แก้ไขข้อมูล";
			else if (form1.command2.value=="VIEW")  arr1[1] = "ดูข้อมูล";
			else arr1[1] = "<?=$COM_ADD_TITLE?>";
			if (form1.command3.value=="UPDATE")  arr1[2] = "แก้ไขข้อมูลบุคคล";
			else if (form1.command3.value=="VIEW")  arr1[2] = "ดูข้อมูลบุคคล";
			else arr1[2] = "<?=$ADD_PERSON_TITLE?>";
			form1.tabstatus.value = arr1.join(",");
		}
		if (form1.command_for.value=="2") form1.command.value = form1.command2.value;
		else	if (form1.command_for.value=="3") form1.command.value = form1.command3.value;
		else 	form1.command.value = "";
		
//		alert("returnValue:"+returnValue+"==<0>"+form1.command_for.value+"<1>"+form1.COM_ID.value+"<2>"+arr[2]+"<3>"+form1.ORG_ID.value+"<4>"+form1.PER_TYPE.value+"<5>"+form1.CMD_SEQ.value+"<6>"+form1.COUNT_COMDTL.value+"<7>"+form1.COM_CONFIRM.value+"<8>"+	form1.command2.value+"<9>"+	form1.command3.value+"..."+form1.command.value);
		
		form1.SELECT_TAB_ID.value = "a"+arr[0];	// กำหนดให้แสดง tab ที่ส่งค่ามา
		form1.submit();
	} // end if

</script>
<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<tr>
    	<td height="10"><?include("header_menu.html")?></td>
  	</tr>
    <tr> 
	  <td align="left" valign="top">
<?	
		if ($UPD) $OPTIONAL_TITLE=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE=" &gt; ดูข้อมูล";
		include("current_location.html");
?>
	  </td>	
	</tr>
  	<tr>
    	<td align="left" valign="top">
		<form name="form1" method="post" action="data_all_comdtl_tab.html" enctype="multipart/form-data">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
		  <input type="hidden" name="SELECT_TAB_ID" value="<?=$SELECT_TAB_ID?>">
          <input type="hidden" name="command" value="<?=$command?>">
          <input type="hidden" name="command2" value="<?=$command2?>">
          <input type="hidden" name="command3" value="<?=$command3?>">
          <input type="hidden" name="command_for" value="<?=$command_for?>">
     	  <input type="hidden" name="PER_TYPE" value="<?=$PER_TYPE?>">
     	  <input type="hidden" name="COM_ID" value="<?=$COM_ID?>">
     	  <input type="hidden" name="CMD_SEQ" value="<?=$CMD_SEQ?>">
       	  <input type="hidden" name="COM_GROUP_IN" value="<?=$COM_GROUP_IN?>">
       	  <input type="hidden" name="COM_SITE" value="<?=$COM_SITE?>">
       	  <input type="hidden" name="COM_TYPE_NM" value="<?=$COM_TYPE_NM?>">
       	  <input type="hidden" name="ORG_ID" value="<?=$ORG_ID?>">
       	  <input type="hidden" name="COUNT_COMDTL" value="<?=$COUNT_COMDTL?>">
          <input type="hidden" name="tabstatus" value="<?=$tabstatus?>">
       	  <input type="hidden" name="COM_CONFIRM" value="<?=$COM_CONFIRM?>">
       	  <input type="hidden" name="from_parent" value="<?=$from_parent?>">
		</form>
		</td>
	</tr>
</table>
<?
	if ($command_for=="2" && $command2=="VIEW")  $uv2 = "&VIEW=1";
	else if ($command_for=="2" && $command2=="UPDATE")  $uv2 = "&UPD=1"; 
    else $uv2 = "";
	if ($command_for=="3" && ($command3=="VIEW" || $COM_CONFIRM=="1")) $uv3 = "&VIEW=1";
	else if ($command_for=="3" && $command3=="UPDATE") $uv3 = "&UPD=1"; 
    else $uv3 = "";
?>
<div id="a_tabbar" style="left:10px;width:1200px;height:600px"></div>
<?
   	if ($command_for=="1") {
?>
    <div id="html_1">
			<iframe frameborder="0" scrolling="auto" src="data_req_command.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>&PER_TYPE=<?=$PER_TYPE?>&COM_SITE=<?=$COM_SITE; ?>&COM_TYPE_NM=<?=$COM_TYPE_NM; ?>&COM_GROUP_IN=<?=stripslashes($COM_GROUP_IN); ?>" width="100%" height="100%">ค้นหาบัญชีแนบท้ายคำสั่ง</iframe><!--เพื่อให้เมื่อกลับมาเลือกที่แท็บอีกครั้ง แสดงข้อมูลทั้งหมด--->
	</div>
<?
	} // end if ($command_for=="1")
   	if ($command_for=="2") {
?>
    <div id="html_2">
			<iframe frameborder="0" scrolling="auto" src="<?=$prefix_name?>.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>&COM_ID=<?=$COM_ID?><?=$uv2?>" width="100%" height="100%">เพิ่ม แก้ไข บัญชีแนบท้ายคำสั่ง</iframe>
	</div>
<?
	} // end if ($command_for=="2")
   	if ($command_for=="3") {
		if (($command=="UPDATE" && $COM_CONFIRM!="1") || ($command=="VIEW" && $COUNT_COMDTL > 0)) { ?>
    <div id="html_3">
			<iframe frameborder="0" scrolling="auto" src="<?=(!$prefix_form?$prefix_name.'_form':$prefix_form)?>.html?UPD=1&COM_ID=<?=$COM_ID?>&CMD_SEQ=<?=$CMD_SEQ?>&PER_TYPE=<?=$PER_TYPE?>&COM_CONFIRM=<?=$COM_CONFIRM?>&MINISTRY_ID=<?=$MINISTRY_ID?>&DEPARTMENT_ID=<?=$DEPARTMENT_ID?>&MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?><?=$uv3?>" width="100%" height="100%"><?=$ADD_PERSON_TITLE?></iframe>
	</div>
<? 	} else {
			if ($command_for >= "3") { ?>
				<div id="html_5">
						<iframe frameborder="0" scrolling="auto" src="<?=(!$prefix_form?$prefix_name.'_form':$prefix_form)?>.html?COM_ID=<?=$COM_ID?>&CMD_SEQ=<?=$CMD_SEQ?>&PER_TYPE=<?=$PER_TYPE?>&COM_CONFIRM=<?=$COM_CONFIRM?>&MINISTRY_ID=<?=$MINISTRY_ID?>&DEPARTMENT_ID=<?=$DEPARTMENT_ID?>&MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?><?=$uv3?>" width="100%" height="100%"><?=$ADD_PERSON_TITLE?></iframe>
				</div>
<? 		}
	 	}
	}
?>
<script>
            tabbar=new dhtmlXTabBar("a_tabbar","top");
            tabbar.setImagePath("codebase/imgs/");
			tabbar.setOffset(5); 
//			tabbar.setMargin(10); 
			tabbar.setSkinColors("#FCFBFC","#F4F3EE");
 
// 			alert(">for>"+form1.command_for.value+"::"+form1.command.value+"::"+form1.COM_ID.value+"::"+form1.COUNT_COMDTL.value);
//			alert(form1.tabstatus.value);
			var arr_status = form1.tabstatus.value.split(",");

//			if (form1.command_for.value=="2") {
//				if (form1.command.value == "UPDATE")		arr_status[1] = "แก้ไขข้อมูล";
//				else if (form1.command.value == "VIEW")	arr_status[1] = "ดูข้อมูล";
//			} else if (form1.command_for.value=="3") {
//				if (form1.command.value == "UPDATE") 	arr_status[2] = "แก้ไขรายการบุคคล";
//				else if (form1.command.value == "VIEW")	arr_status[2] = "ดูรายการบุคคล";
//			}
//			if (form1.COM_CONFIRM.value == "1") 	arr_status[2] = "ดูรายการบุคคล";
				
			form1.tabstatus.value = arr_status.join(",");

            tabbar.addTab("a1",arr_status[0],"130px");
			tabbar.addTab("a2",arr_status[1],"100px");
			if ((form1.command.value == "UPDATE" && form1.COM_CONFIRM.value != "1") || (form1.command.value == "VIEW" && form1.COUNT_COMDTL.value > 0)) {
				tabbar.addTab("a3",arr_status[2],"120px");
				//if (form1.COUNT_COMDTL.value  > "0")
					//tabbar.addTab("a4",arr_status[3],"140px");
			} else {
				if (form1.command_for.value >= "3") {
					tabbar.addTab("a3",arr_status[2],"120px");
					//if (form1.COUNT_COMDTL.value  > "0")
						//tabbar.addTab("a4",arr_status[3],"140px");
				}
			}

			if (form1.command_for.value=="1") {
				tabbar.setContent("a1","html_1");
			}
			if (form1.command_for.value=="2") {
				tabbar.setContent("a2","html_2");
			}
			if (form1.command_for.value=="3") {
				if ((form1.command.value == "UPDATE" && form1.COM_CONFIRM.value != "1") || (form1.command.value == "VIEW" && form1.COUNT_COMDTL.value > 0)) {
					tabbar.setContent("a3","html_3");
				//if (form1.COUNT_COMDTL.value  > "0")
					//tabbar.setContent("a4","html_4");
				} else {
					if (form1.command_for.value >= "3") {
						tabbar.setContent("a3","html_5");
						/*if (form1.COUNT_COMDTL.value  > "0") {
							tabbar.setContent("a4","html_6");
						}*/
					}
				}
			}
			
			tabbar.setTabActive(form1.SELECT_TAB_ID.value);
			tabbar.attachEvent("onSelect", function(id,last_id){
				form1.SELECT_TAB_ID.value = id;
				if (id=="a1") { // ทุกครั้งที่กด tab1 จะเป็นสถานะเริ่มต้น
					refresh_opener("1<::><::><::><::><::><::><::><::><::>");
				} else if (id=="a2") { 
					refresh_opener("2<::>!<::>!<::>!<::>!<::><::>!<::>!<::>!<::>");
				} else { // id=="a3"
					if (form1.COM_CONFIRM.value!="1") {
						refresh_opener("3<::>!<::>!<::>!<::>!<::><::>!<::>!<::>!<::>");
					} else
						alert("โปรดเลือกรายการบุคคลที่ต้องการดูรายละเอียดข้างล่าง...");
				}
          	});
</script>
<br>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
<?=$alert_adding_command?>
</script>
</html>
