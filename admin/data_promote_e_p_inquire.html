<? 
	include("../php_scripts/connect_database.php");
	include("php_scripts/session_start.php");
	include("php_scripts/function_share.php");
	include("php_scripts/function_list.php");
	include("php_scripts/load_per_control.php");
	
	$db_dpis1 = new connect_dpis($dpisdb_host, $dpisdb_name, $dpisdb_user, $dpisdb_pwd, $dpisdb_port);
	$db_dpis2 = new connect_dpis($dpisdb_host, $dpisdb_name, $dpisdb_user, $dpisdb_pwd, $dpisdb_port);

	switch($CTRL_TYPE){
		case 2 :
			$PV_CODE = $PROVINCE_CODE;
			$PV_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$ORG_ID_M1 = $MINISTRY_ID;
			$ORG_NAME_M1 = $MINISTRY_NAME;
			break;
		case 4 :
			$ORG_ID_M1 = $MINISTRY_ID;
			$ORG_NAME_M1 = $MINISTRY_NAME;
			$ORG_ID_M2 = $DEPARTMENT_ID;
			$ORG_NAME_2 = $DEPARTMENT_NAME;
			break;
	} // end switch case

	switch($SESS_USERGROUP_LEVEL){
		case 2 :
			$PV_CODE = $PROVINCE_CODE;
			$PV_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$ORG_ID_M1 = $MINISTRY_ID;
			$ORG_NAME_M1 = $MINISTRY_NAME;
			break;
		case 4 :
			$ORG_ID_M1 = $MINISTRY_ID;
			$ORG_NAME_M1 = $MINISTRY_NAME;
			$ORG_ID_M2 = $DEPARTMENT_ID;
			$ORG_NAME_2 = $DEPARTMENT_NAME;
			break;
		case 5 :
			$ORG_ID_M1 = $MINISTRY_ID;
			$ORG_NAME_M1 = $MINISTRY_NAME;
			$ORG_ID_M2 = $DEPARTMENT_ID;
			$ORG_NAME_2 = $DEPARTMENT_NAME;
			$ORG_ID_M3 = $ORG_ID;
			$ORG_NAME_3 = $ORG_NAME;
			break;
		case 6 :
			$ORG_ID_M1 = $MINISTRY_ID;
			$ORG_NAME_M1 = $MINISTRY_NAME;
			$ORG_ID_M2 = $DEPARTMENT_ID;
			$ORG_NAME_2 = $DEPARTMENT_NAME;
			$ORG_ID_M3 = $ORG_ID;
			$ORG_NAME_3 = $ORG_NAME;
			$ORG_ID_M4 = $ORG_ID_1;
			$ORG_NAME_4 = $ORG_NAME_1;
			break;
	} // end switch case

	if(!isset($show_topic)) $show_topic = 1;
	if( !$current_page ) $current_page = 1;
	if(!$data_per_page) $data_per_page = 30;
	$start_record = ($current_page - 1) * $data_per_page;

	if(!$PER_TYPE_SEARCH)	$PER_TYPE_SEARCH = 1;
	if(!$PER_TYPE)						$PER_TYPE=1; 

	$UPDATE_DATE = date("Y-m-d H:i:s");	
//echo 'show_topic>>>'.$show_topic;
	if($show_topic==1){	// data_promote_e_p_inquire_search.html   [ ค้นหาข้อมูล ]
		if ($PER_TYPE_SEARCH == 1) {
			$field = "PRO_DATE as PDATE, POS_ID as PID";
			$table = "PER_PROMOTE_P";
			$cmd_position = "	select POS_NO as PNO,POS_NO_NAME as PNONAME, a.PL_CODE as PCODE,PL_NAME as PNAME from PER_POSITION a, PER_LINE b 
										where a.PL_CODE=b.PL_CODE and POS_ID=";
			$field_limit_data = "(PRO_DATE + POS_ID + PER_ID)";
			$orderby = "PRO_DATE, POS_ID";		
			
			if (trim($POS_POEM_ID_SEARCH)) $arr_search_condition[] = "(POS_ID = $POS_POEM_ID_SEARCH)";
		} elseif ($PER_TYPE_SEARCH == 2) {
			$field = "PRO_DATE as PDATE, POEM_ID as PID"; 
			$table = "PER_PROMOTE_E";
			$cmd_position = "	select POEM_NO as PNO, POEM_NO_NAME as PNONAME, a.PN_CODE as PCODE, PN_NAME as PNAME from PER_POS_EMP a, PER_POS_NAME b
										where a.PN_CODE=b.PN_CODE and POEM_ID=";
			$field_limit_data = "(PRO_DATE + POEM_ID + PER_ID)";
			$orderby = "PRO_DATE, POEM_ID";
	
			if (trim($POS_POEM_ID_SEARCH)) $arr_search_condition[] = "(POEM_ID = $POS_POEM_ID_SEARCH)";
		} elseif ($PER_TYPE_SEARCH == 3) {
			$field = "PRO_DATE as PDATE, POEMS_ID as PID"; 
			$table = "PER_PROMOTE_E";
			$cmd_position = "	select POEMS_NO as PNO,POEMS_NO_NAME as PNONAME, a.EP_CODE as PCODE,EP_NAME as PNAME from PER_POS_EMPSER a, PER_EMPSER_POS_NAME b
										where a.EP_CODE=b.EP_CODE and POEM_ID=";
			$field_limit_data = "(PRO_DATE + POEMS_ID + PER_ID)";
			$orderby = "PRO_DATE, POEM_ID";
			
			if (trim($POS_POEM_ID_SEARCH)) $arr_search_condition[] = "(POEMS_ID = $POS_POEM_ID_SEARCH)";		
		} elseif ($PER_TYPE_SEARCH == 4) {
			$field = "PRO_DATE as PDATE, POT_ID as PID"; 
			$table = "PER_PROMOTE_E";
			$cmd_position = "select POT_NO as PNO,POT_NO_NAME as PNONAME, a.TP_CODE as PCODE,TP_NAME as PNAME from PER_POS_TEMP a, PER_TEMP_POS_NAME b
										where a.TP_CODE=b.TP_CODE and POT_ID=";
			$field_limit_data = "(PRO_DATE + POT_ID + PER_ID)";
			$orderby = "PRO_DATE, POT_ID";
			
			if (trim($POS_POEM_ID_SEARCH)) $arr_search_condition[] = "(POT_ID = $POS_POEM_ID_SEARCH)";		
		}
	
		if (trim($PRO_DATE_START)) {
			$temp = explode("/", $PRO_DATE_START);
			$temp_date = ($temp[2] - 543) ."-". $temp[1] ."-". $temp[0];
			$arr_search_condition[] = "(PRO_DATE > '$temp_date')";
		}
		if (trim($PRO_DATE_END)) {
			$temp = explode("/", $PRO_DATE_END);
			$temp_date = ($temp[2] - 543) ."-". $temp[1] ."-". $temp[0];
			$arr_search_condition[] = "(PRO_DATE < '$temp_date')";	
		}
		if($DEPARTMENT_ID){ 
			$arr_search_condition[] = "(DEPARTMENT_ID=$DEPARTMENT_ID)";
		}elseif($MINISTRY_ID){
			$cmd = " select ORG_ID from PER_ORG where ORG_ID_REF=$MINISTRY_ID ";
			$db_dpis->send_cmd($cmd);
			while($data=$db_dpis->get_array()) $arr_org[] = $data[ORG_ID];
			$arr_search_condition[] = "(DEPARTMENT_ID in (". implode(",", $arr_org) ."))";
		}elseif($PV_CODE){
			$cmd  = " select distinct ORG_ID_REF from PER_ORG where OL_CODE='03' and PV_CODE='$PV_CODE' ";
			$db_dpis->send_cmd($cmd);
			while($data = $db_dpis->get_array()) $arr_org[] = $data[ORG_ID_REF];
			$arr_search_condition[] = "(DEPARTMENT_ID in (". implode(",", $arr_org) ."))";
		} // end if
		
		$search_condition = "";
		if ($arr_search_condition) $search_condition = "where " . implode(" and ", $arr_search_condition);
	
		$cmd =" select distinct $field from $table $search_condition ";
		$count_data = $db_dpis->send_cmd($cmd);
		//echo "%%%%".$cmd;
		//$db_dpis->show_error();
	
		$total_page = ceil( $count_data / $data_per_page );
		$page_link = create_link_page($total_page, $current_page);
		$limit_data = "";	
		//echo 'total_page>>>>'.$total_page;
		if($command=="CANCEL"){
			//เคลียร์ค่าเมื่อกดแท็บ เพิ่ม ใหม่
			$PRO_DATE="";
			$POS_POEM_NO="";
			$POS_POEM_NO_NAME="";
			$POS_POEM_NAME="";
			$PL_PN_NAME="";
			$PL_PN_CODE="";
			$LEVEL_START=0;
			$LEVEL_END=0;
			$EN_NAME="";
			$EN_CODE="";
			$YEAR_START="";
			$YEAR_END="";
			$SAL_START="";
			$SAL_END="";
		}
	}else if($show_topic==2){
		// กรณีที่เป็นการค้นหาข้อมูลที่ส่งมาจาก tab1 หรือ data_promote_e_p_quality (p0309 เดิม)
		if ($firstfrom=="data_promote_e_p_quality" && $POS_POEM_ID && $PRO_DATE && $table_select && $command && $PER_TYPE) {
				echo "<script language='JavaScript'>ProcessUploading();</script>";
		}
			
		include("php_scripts/data_promote_e_p_inquire.php");
                 
	//	echo ">>>POS_POEM_NO=$POS_POEM_NO, POS_POEM_NAME=$POS_POEM_NAME, PRO_DATE=$PRO_DATE, table_select=$table_select, command=$command, PER_TYPE=$PER_TYPE, firstfrom=$firstfrom, DEPARTMENT_ID=$DEPARTMENT_ID<br>";
		// ==================== select จากเงื่อนไขสำหรับผู้ที่มีคุณสมบัติได้เลื่อนระดับ ======================		
		if ($command == "SEARCH") { 
			include("php_scripts/data_promote_e_p_inquire_query_search.php");
		}
		
		// ==================== select จากข้อมูลที่บันทึกไว้ใน PER_PROMOTE..... =====================
		if ($command == "SELECT") {
			include("php_scripts/data_promote_e_p_inquire_query_select.php");
		}
	//	echo "data_promote_e_p_inquire.html :: command=$command || table=$table || PER_TYPE=$PER_TYPE || UPD=$UPD<br> cmd_save=$cmd_save<br>";	
	} // end show_topic

//	echo "$show_topic // data_promote_e_p_inquire.html :: command=$command || table=$table || PER_TYPE=$PER_TYPE || UPD=$UPD<br> cmd_save=$cmd_save<br>";	
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
</head>
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">
    function change_current_page( page ){
		form0.current_page.value = page;
		form0.submit();
	}
	var FName = new Array('form0','form1');	//form ทั้งหมด
	function change_div(div_id){	
			eval("document.all.DIV_TOPIC_" + eval(FName[div_id-1]).show_topic.value + ".style.display='none'");
			eval("document.all.DIV_TOPIC_" + div_id + ".style.display='block'");
	
			eval("document.all.CELL_TOPIC_" + eval(FName[div_id-1]).show_topic.value + ".className='table_body'");
			eval("document.all.CELL_TOPIC_" + div_id + ".className='table_body_3'");
			eval(FName[div_id-1]).show_topic.value = div_id;
			if(div_id==1){
				form0.command.value='SEARCH';
			}else if(div_id==2){
				form0.command.value='';
				form1.command.value='';
			}
			eval(FName[div_id-1]).submit();
	}

//---จาก data_promote_e_p_inquire_search.html
	function changedateformat(name,str) {
		var arr = str.split('/');
		if((str) && (str != arr[0]+'/'+arr[1]+'/'+arr[2])){
			name.value = str.substr(0,2) + "/" + str.substr(2,2) + "/"  + str.substr(4,4) ;
		}
		chk_date(name, "BDH");
	}
	
	function call_search_perline_perposname_inquire () {	
		if(form0.DEPARTMENT_ID.value.trim()==""){ 
			alert('<?=$DEPARTMENT_ALERT?>');
			form0.btn_department.focus();
		return false;
		}else{
			parameter = "&send_by=search_perline_perposname_inquire&isLock=1&LOCK_MINISTRY_ID=" + form0.MINISTRY_ID.value + "&LOCK_DEPARTMENT_ID=" + form0.DEPARTMENT_ID.value;
			if (form0.PER_TYPE_SEARCH.value == 1)
		    	call_openDialog("search_position.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POSITION_TITLE?>");		
			else if (form0.PER_TYPE_SEARCH.value == 2)
		    	call_openDialog("search_pos_emp.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POS_EMP_TITLE?>");		
			else if (form0.PER_TYPE_SEARCH.value == 3)
			    call_openDialog("search_pos_empser.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POS_EMPSER_TITLE?>");		
			else if (form0.PER_TYPE_SEARCH.value == 4)
			    call_openDialog("search_pos_temp.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POS_TEMP_TITLE?>");		
		} //end else
	}
	
	function call_search_ministry () {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$MINISTRY_TITLE?>");		
	}

	function call_search_department () {	
		var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$MINISTRY_ID":"form0.ORG_ID_1.value")?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(MINISTRY_ID != ""){
			parameter = "&send_by=search_department&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$DEPARTMENT_TITLE?>");		
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT?>');
			form0.btn_ministry.focus();
			<? } ?>
		} // end if
	}

	function clear_form () {
		form0.PER_TYPE_SEARCH[0].selected = true;
		form0.PRO_DATE_START.value = "";
		form0.PRO_DATE_END.value = "";
		form0.POS_POEM_NO_SEARCH.value = "";
		<? if ($POSITION_NO_CHAR=="Y") { ?>form0.POS_POEM_NO_NAME_SEARCH.value = "";<? } ?>
		form0.POS_POEM_ID_SEARCH.value = "";
		form0.PL_PN_CODE_SEARCH.value = "";
		form0.PL_PN_NAME_SEARCH.value= "";
	}

//---จาก data_promote_e_p_inquire.html
	function call_search_position () {	
		<?  if($BKK_FLAG!=1 && $MFA_FLAG!=1){ ?>
		if(form1.ORG_ID_M2.value.trim()==""){ 
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
			return false;
		}
		<? } ?>
		parameter = "&send_by=search_position&isLock=1&LOCK_MINISTRY_ID=" + form1.ORG_ID_M1.value + "&LOCK_DEPARTMENT_ID=" + form1.ORG_ID_M2.value;
		if (form1.PER_TYPE.value == 1)
	    	call_openDialog("search_position.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POSITION_TITLE?>");		
		else if (form1.PER_TYPE.value == 2)
	    	call_openDialog("search_pos_emp.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POS_EMP_TITLE?>");		
		else if (form1.PER_TYPE.value == 3)
		    call_openDialog("search_pos_empser.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POS_EMPSER_TITLE?>");		
			else if (form1.PER_TYPE.value == 4)
		    call_openDialog("search_pos_temp.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POS_TEMP_TITLE?>");		
	}
	
	function call_search_perline_perposname () {	
		if(form1.ORG_ID_M2.value.trim()==""){ 
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
		} // end if
		parameter = "&isLock=1&LOCK_MINISTRY_ID=" + form1.ORG_ID_M1.value + "&LOCK_DEPARTMENT_ID=" + form1.ORG_ID_M2.value;
		if (form1.PER_TYPE[0].selected == true)
	 	   call_openDialog("search_perline.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POSITION_TITLE?>");		
		else if (form1.PER_TYPE[1].selected == true)
	    call_openDialog("search_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$POS_EMP_TITLE?>");		
	}

	function call_search_education () {	
		parameter = "";
	    call_openDialog("search_education.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$EN_TITLE?>");		
	}
	
	function call_search_ministry_dtl () {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		parameter = "&send_by=search_ministry_dtl&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$MINISTRY_TITLE?>");		
	}

	function call_search_department_dtl () {	
		var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$MINISTRY_ID":"form1.ORG_ID_M1.value")?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(MINISTRY_ID != ""){
			parameter = "&send_by=search_department_dtl&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$DEPARTMENT_TITLE?>");		
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT?>');
			form1.btn_ministry.focus();
			<? } ?>
		} // end if
	}

	function call_search_org () {	
		var DEPARTMENT_ID = <?=(($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4)?"$DEPARTMENT_ID":"form1.ORG_ID_02.value")?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(DEPARTMENT_ID != ""){
			parameter = "&send_by=search_org&OL_CODE=03&ORG_ID_REF=" + DEPARTMENT_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"<?=$ORG_TITLE?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$DEPARTMENT_ALERT?>ม (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
			<? } ?>
		} // end if
	}

	function clear_form () {
		form1.LEVEL_START.value = "";
		form1.LEVEL_END.value = "";
		form1.PL_PN_CODE.value = "";
		form1.PL_PN_NAME.value = "";
		form1.EN_CODE.value = "";
		form1.EN_NAME.value = "";
		<? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
		form1.ORG_ID_M1.value = "";
		form1.ORG_NAME_M1.value = "";
		<? } // end if ?>
		<? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
		form1.ORG_ID_M2.value = "";
		form1.ORG_NAME_2.value = "";
		<? } // end if ?>
		form1.ORG_ID_M3.value = "";
		form1.ORG_NAME_3.value = "";
		form1.YEAR_START.value = "";
		form1.YEAR_END.value = "";
		form1.SAL_START.value = "";
		form1.SAL_END.value = "";
		form1.SELECTED_LIST.value = "";
	}

	function check_save_promote (val1) {	
		parameter = "";
		form1.SELECTED_LIST.value = "";
		if (form1.PRO_DATE.value == "")
			alert ("กรุณาใส่วันที่ประมวลผล");
		else if (form1.POS_POEM_ID.value == "") 
			alert ("กรุณาใส่เลขที่ตำแหน่ง");
		else {
			document.all.PROCESS_IFRAME.src = "find_promote_e_p_inquire.html?PRO_DATE=" + form1.PRO_DATE.value + "&POS_POEM_ID=" + form1.POS_POEM_ID.value + "&DEPARTMENT_ID=" + form1.ORG_ID_M2.value + "&table=" + val1;
		}		// end if
	}			// end if

	function update_list(isChecked, PER_ID){
		var countChecked = 0;
		var SELECTED_LIST = form1.SELECTED_LIST.value;
		
		if(SELECTED_LIST != ""){ 
			var arrTemp = SELECTED_LIST.split(",");
//			alert(arrTemp.length);
			var countChecked = arrTemp.length;
			SELECTED_LIST = "," + SELECTED_LIST + ",";
		} // end if

		if(isChecked){
			if(countChecked < 3){
				if(SELECTED_LIST=="") SELECTED_LIST = "," + PER_ID + ",";
				else SELECTED_LIST += (PER_ID + ",");	
			}else{
				alert("สามารถเลือกจำนวนคนที่ต้องการนำเสนอได้มากที่สุด 3 คนเท่านั้น");
				eval("form1.SELECT_PER_" + PER_ID + ".checked = false;");
			} // end if
		}else{
			SELECTED_LIST = SELECTED_LIST.replace(("," + PER_ID + ","), ",");
			if(SELECTED_LIST==",") SELECTED_LIST = "";
//			if(form1.CHECKALL.checked) form1.CHECKALL.checked = false;
		} // end if
//		alert(SELECTED_LIST);
		form1.SELECTED_LIST.value = SELECTED_LIST.substr(1, (SELECTED_LIST.lastIndexOf(",") - 1));
		
//__	alert(countChecked+' :: '+SELECTED_LIST+' = '+form1.SELECTED_LIST.value);
	}
	
	function del_personal_promote_e_p(per_id, name, per_type) {
		if (confirm("คุณต้องการลบผู้ที่มีคุณสมบัติได้เลื่อนตำแหน่ง [ " + name + " ] หรือไม่ ?")) {
			form1.action += "?DEL_PERSON=1&DEL_PER_ID=" + per_id + "&DEL_PER_TYPE=" + per_type;
			form1.submit();
		}
	}
	
	function call_personal_promote_e_p() {	
		parameter = "";
	    call_openDialog("search_person.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,600,"รายชื่อ<?=$PERSON_TITLE?>");		
	}	
	
	function call_presentation(){
		if(form1.chksave_promote.value>0 && form1.command.value.trim() != "SELECT"){
			alert("บันทึกผลการค้นหาก่อน");
			return;
		} // end if
		
		if(form1.SELECTED_LIST.value.trim() != "" ){
			//__alert(form1.SELECTED_LIST.value.trim());
			var PRO_DATE = form1.PRO_DATE.value.trim();
			var arrTemp = PRO_DATE.split("/");
			PRO_DATE = (parseInt(arrTemp[2], 10) - 543) + "-" + arrTemp[1] + "-" + arrTemp[0];
			parameter = "&PRO_DATE=" + PRO_DATE + "&POS_POEM_ID=" + form1.POS_POEM_ID.value + "&SELECTED_LIST=" + form1.SELECTED_LIST.value.trim();
	    	call_openDialog("data_promote_e_p_presentation.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1200,800,"นำเสนอข้อมูลข้าราชการที่มีคุณสมบัติได้เลื่อนตำแหน่ง");		
		}else{
			alert("เลือกบุคคลที่ต้องการนำเสนอ (ไม่เกิน 3 คน)");
		} // end if
	} // end if

	function ProcessUploading() {
	//	alert(document.getElementById("obj_uploading"));
		document.getElementById("obj_uploading").style.display = "block";
		document.getElementById("obj_uploading").style.top = document.body.scrollTop + ((document.body.clientHeight / 2) + 5);
		document.getElementById("obj_uploading").style.left = document.body.scrollLeft  + ((document.body.clientWidth / 2) - 80);
		document.getElementById("obj_uploading").style.visibility = "visible";
		return true;
	}

	function call_pdf_report() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "ข้าราชการที่มีคุณสมบัติได้เลื่อนตำแหน่ง<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form1.target = "_blank";
		document.form1.action = "report/rpt_data_promote_e_p_inquire.php?report_title=" + report_title + "&UTC" + rptDate;
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "data_promote_e_p_inquire.html";
	} 
	
	function call_export_file() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "ข้าราชการที่มีคุณสมบัติได้เลื่อนตำแหน่ง<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form1.target = "_blank";
		document.form1.action = "report/rpt_data_promote_e_p_inquire_xls.php?report_title=" + report_title + "&UTC" + rptDate;
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "data_promote_e_p_inquire.html";
	}	
	
	function check_salary_type( VAR_TYPE, VALUE ){
		if(VAR_TYPE==1){
			var LEVEL_START = VALUE;
			var objPerType = document.getElementsByName("PER_TYPE");
			for(var i=0; i<objPerType.length; i++)	if(form1.PER_TYPE[i].selected) PER_TYPE = form1.PER_TYPE[i].value;
		}else{
			var PER_TYPE = VALUE;
			var LEVEL_START = form1.LEVEL_START.value;
			form1.submit();
		} 

		if(PER_TYPE==2){
			form1.PER_SALARY.readOnly = true;
			document.all.btn_salary.disabled = false;
		}else{
			if(LEVEL_START == ""){
				form1.PER_SALARY.readOnly = true;
				document.all.btn_salary.disabled = true;
			}else{			
				document.all.PROCESS_IFRAME.src = "find_salary_type.html?PER_TYPE=" + PER_TYPE + "&LEVEL_START=" + LEVEL_START;
			} 
		} // end if
	} 
		
	function returnFrom(src, returnValue){
//		alert("src="+src+"("+returnValue+")");
		 if  (src.indexOf("search_org") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				if (arrValue[7]=="search_ministry") {
					form0.MINISTRY_ID.value = arrValue[0];
					form0.MINISTRY_NAME.value = arrValue[1];
					form0.DEPARTMENT_ID.value = "";
					form0.DEPARTMENT_NAME.value = "";
				}else if (arrValue[7]=="search_department") {
					form0.DEPARTMENT_ID.value = arrValue[0];
					form0.DEPARTMENT_NAME.value = arrValue[1];
				}else if (arrValue[7]=="search_ministry_dtl") {
					form1.ORG_ID_M1.value = arrValue[0];
					form1.ORG_NAME_M1.value = arrValue[1];
					form1.ORG_ID_M2.value = "";
					form1.ORG_NAME_2.value = "";
					form1.ORG_ID_M3.value = "";
					form1.ORG_NAME_3.value = "";
				}else if (arrValue[7]=="search_department_dtl") {
					form1.ORG_ID_M2.value = arrValue[0];
					form1.ORG_NAME_2.value = arrValue[1];
					form1.ORG_ID_M3.value = "";
					form1.ORG_NAME_3.value = "";
				}else if (arrValue[7]=="search_org") {
					form1.ORG_ID_M3.value = arrValue[0];
					form1.ORG_NAME_3.value = arrValue[1];
				}
			} // end if
		} else if  (src.indexOf("search_position") > -1 || src.indexOf("search_pos_emp") > -1 || src.indexOf("search_pos_empser") > -1 || src.indexOf("search_pos_temp") > -1) {
			if  (src.indexOf("search_position") > -1) $send_pos = 20;
			else if  (src.indexOf("search_pos_emp") > -1) $send_pos = 7;
			else if  (src.indexOf("search_pos_empser") > -1) $send_pos = 6;
			else if  (src.indexOf("search_pos_temp") > -1) $send_pos = 6;
			if(returnValue){
				arrValue = returnValue.split("<::>");
				if (arrValue[$send_pos]=="search_perline_perposname_inquire") {
					form0.POS_POEM_ID_SEARCH.value = arrValue[0];
					form0.POS_POEM_NO_SEARCH.value = arrValue[1];
					form0.PL_PN_NAME_SEARCH.value = arrValue[2];			
					form0.PL_PN_CODE_SEARCH.value = arrValue[3];
					<? if ($POSITION_NO_CHAR=="Y") { ?>
						if (form0.PER_TYPE_SEARCH.value == 1)		form0.POS_POEM_NO_NAME_SEARCH.value = arrValue[6]; 
						if (form0.PER_TYPE_SEARCH.value == 2)		form0.POS_POEM_NO_NAME_SEARCH.value = arrValue[6]; 
						if (form0.PER_TYPE_SEARCH.value == 3)		form0.POS_POEM_NO_NAME_SEARCH.value = arrValue[4]; 
						if (form0.PER_TYPE_SEARCH.value == 4)		form0.POS_POEM_NO_NAME_SEARCH.value = arrValue[5]; 
					<? } ?>
				} else if (arrValue[$send_pos]=="search_position") {
					form1.POS_POEM_ID.value = arrValue[0];
					form1.POS_POEM_NO.value = arrValue[1];
					form1.POS_POEM_NAME.value = arrValue[2];
					<? if ($POSITION_NO_CHAR=="Y") { ?>
						if (form1.PER_TYPE.value == 1)		form1.POS_POEM_NO_NAME.value = arrValue[6]; 
						if (form1.PER_TYPE.value == 2)		form1.POS_POEM_NO_NAME.value = arrValue[6]; 
						if (form1.PER_TYPE.value == 3)		form1.POS_POEM_NO_NAME.value = arrValue[4]; 
						if (form1.PER_TYPE.value == 4)		form1.POS_POEM_NO_NAME.value = arrValue[5]; 
					<? } ?>
				}
			} // end if
		} else if  (src.indexOf("search_perline") > -1 || src.indexOf("search_pos_name") > -1 || src.indexOf("search_empser_pos_name") > -1 || src.indexOf("search_temp_pos_name") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				form1.PL_PN_CODE.value = arrValue[0];
				form1.PL_PN_NAME.value = arrValue[1];
			} // end if
		} else if  (src.indexOf("search_education") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				form1.EN_CODE.value = arrValue[0];
				form1.EN_NAME.value = arrValue[1];
			} // end if
		} else if  (src.indexOf("search_person") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				var per_id = arrValue[0];
				var name = arrValue[1];
				var per_cardno = arrValue[2];
				var per_type = arrValue[5];
				
				if ( arrValue[0] && arrValue[1] ) {
					if (confirm("กรุณายืนยันการเพิ่มผู้ที่มีคุณสมบัติได้เลื่อนตำแหน่ง [ " + name + " ]")) {			
						form1.action += "?ADD_PERSON=1&ADD_PER_ID=" + per_id + "&ADD_PER_TYPE=" + per_type + "&ADD_PER_CARDNO=" + per_cardno;
						form1.submit();
					}
				}
			} // end if
		} 		
//		$( "#d_frame" )[0].src="";
//		alert("returnValue="+tt.value);
		tt.value = returnValue;
	} // end if
	
</script>
<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
<? if (!$HEAD_HIDE) { ?>
	<tr>
    	<td height="10"><?include("header_menu.html")?></td>
  	</tr>
    <tr> 
	  <td align="left" valign="top">
<?	
		if ($UPD) $OPTIONAL_TITLE.=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE.=" &gt; ดูข้อมูล";
		include("current_location.html");
?>		</td>
	</tr>
<? } ?>
  	<tr>
    	<td align="left" valign="top"><table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td><table width="30%" cellpadding="1" cellspacing="1" class="input_table" style="border-style:solid;" border="1">  
		  <tr>
		  	<td id="CELL_TOPIC_1" nowrap="nowrap" height="22" align="center" class="<?=($show_topic==1)?"table_body_3":"table_body"?>"><span style="cursor:hand;" onClick="change_div(1);">ค้นหาข้อมูล</span></td>
			<td  id="CELL_TOPIC_2" nowrap="nowrap" height="22" align="center" class="<?=($show_topic==2)?"table_body_3":"table_body"?>"><span style="cursor:hand;"  onClick="change_div(2);"><? if($UPD){ echo"แก้ไข"; }else if($VIEW){ echo "ดู"; }else{ echo "เพิ่ม"; } ?>ข้อมูล</span></td>
		  </tr>
	  </table></td>
	</tr>
</table>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
  	<tr>
    	<td align="left" valign="top"><form name="form0" method="post" action="data_promote_e_p_inquire.html" enctype="multipart/form-data">
		<input type="hidden" name="current_page" value="<?=$current_page?>">
		<input type="hidden" name="total_page" value="<?=$total_page?>">
		<input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		<input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		<input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
		<input type="hidden" name="command" value="<?=$command?>">
		<input type="hidden" name="show_topic" value="<?=$show_topic?>">
<div id="DIV_TOPIC_1" style="display:<?=($show_topic==1)?"block":"none"?>;"> 
<!---มาจาก data_promote_e_p_quality_search.html แล้วนี่---> 
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
  	<tr>
	  <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">  
		<tr><td height="3"></td></tr>
        <tr>
          <td height="22" align="center"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                      <tr> 
                        <td height="22" align="right"><?=$PER_TYPE_TITLE?>&nbsp;:&nbsp;</td>
                        <td colspan="3">
					<select name="PER_TYPE_SEARCH" onKeyPress="return keyEnter(event,document.form0.Submit2);">
					<?  foreach($PERSON_TYPE as $key=>$value){  ?><option value="<?=$key; ?>"<?=($PER_TYPE_SEARCH==$key)?"selected":""?>><?=$value; ?></option><?  } ?>
					</select></td>
                      </tr>
                      <tr>
                        <td width="20%" height="22" align="right"><span class="label_alert">*</span>&nbsp;<?=$MINISTRY_TITLE?>&nbsp;:&nbsp;</td>
                        <td width="30%">
							<input type="text" name="MINISTRY_NAME" value="<?=$MINISTRY_NAME?>" style="width:75%" class="textbox" readonly>
							<? if(($CTRL_TYPE==1 || $CTRL_TYPE==2) && !($isLock && $LOCK_MINISTRY_ID)){ ?>
							<input type="button" name="btn_ministry" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_ministry()">
             <input name="image" type="image" onClick="form0.MINISTRY_ID.value=''; form0.MINISTRY_NAME.value=''; form0.DEPARTMENT_ID.value=''; form0.DEPARTMENT_NAME.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
							<? } // end if ?>
							<input type="hidden" name="MINISTRY_ID" value="<?=$MINISTRY_ID?>">						</td>
                        <td width="20%" align="right"><span class="label_alert">*</span>&nbsp;<?=$DEPARTMENT_TITLE?>&nbsp;:&nbsp;</td>
                        <td>
							<input type="text" name="DEPARTMENT_NAME" value="<?=$DEPARTMENT_NAME?>" style="width:75%" class="textbox" readonly>
							<? if($CTRL_TYPE != 4 && !($isLock && $LOCK_DEPARTMENT_ID)){ ?>
							<input type="button" name="btn_department" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_department()">
             <input name="image" type="image" onClick="form0.DEPARTMENT_ID.value=''; form0.DEPARTMENT_NAME.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
							<? } // end if ?>
							<input type="hidden" name="DEPARTMENT_ID" value="<?=$DEPARTMENT_ID?>">						</td>
                      </tr>
                      <tr> 
                        <td height="22" align="right">วันที่ประมวลผล&nbsp;:&nbsp;</td>
                        <td>
							<input type="text" name="PRO_DATE_START" id="PRO_DATE_START" value="<?=$PRO_DATE_START?>" class="textbox" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.PRO_DATE_START,this.value)" <?=($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y")?"":"readonly"?>>&nbsp;&nbsp;
							<input type="reset" class="button" onClick="return showCalendar('PRO_DATE_START', 'dd/mm/y');" value="<?=$SELECT_TITLE?>">                        </td>
                        <td align="right"><?=$TO_DATE_TITLE?>&nbsp;:&nbsp;</td>
                        <td><input type="text" name="PRO_DATE_END" id="PRO_DATE_END" value="<?=$PRO_DATE_END?>" class="textbox" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.PRO_DATE_END,this.value)" <?=($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y")?"":"readonly"?>> 
                          &nbsp;&nbsp; <input type="reset" class="button" onClick="return showCalendar('PRO_DATE_END', 'dd/mm/y');" value="<?=$SELECT_TITLE?>">                        </td>
                      </tr>
                      <tr> 
                        <td align="right"><?=$POS_NO_TITLE?>&nbsp;:&nbsp;</td>
                        <td><? if ($POSITION_NO_CHAR=="Y") { ?><input type="text" name="POS_POEM_NO_NAME_SEARCH" value="<?=$POS_POEM_NO_NAME_SEARCH?>" class="textbox" style="width:40%" readonly>&nbsp;<? } ?><input name="POS_POEM_NO_SEARCH" type="text" class="textbox" value="<?=$POS_POEM_NO_SEARCH?>" readonly>
                          <input name="POS_POEM_ID_SEARCH" type="hidden" id="POS_POEM_ID_SEARCH" value="<?=$POS_POEM_ID_SEARCH?>">
                          &nbsp;						
                                <input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกเลขที่ตำแหน่ง" onClick="call_search_perline_perposname_inquire();"></td>
                        <td align="right"><?=$PL_TITLE?>&nbsp;:&nbsp;</td>
                        <td>
							  	<input name="PL_PN_NAME_SEARCH" type="text" class="textbox" style="width:75%" value="<?=$PL_PN_NAME_SEARCH?>" readonly> 
                                <input name="PL_PN_CODE_SEARCH" type="hidden"  value="<?=$PL_PN_CODE_SEARCH?>">						</td>
                      </tr>
                    </table></td>
        </tr>
        <tr align="center">
          <td height="25"><!----<? if ($BUTTON_DISPLAY==1) { ?>
				<input name="Submit1" type="button" class="button" onClick="window.parent.close(); self.close();" value="<?=$CLOSE_WINDOW_TITLE?>">	<? } else { ?>
              <img src="images/cancel2.png" alt="<?=$CLOSE_WINDOW_TITLE?>" width="32" height="32" border="0" onClick="window.parent.close(); self.close();">
      		  <?}  echo "&nbsp; &nbsp;"; ?>--->			  
				<? if ($BUTTON_DISPLAY==1) { ?>
				<input name="Submit2" type="submit" class="button" onClick="form0.command.value='SEARCH';" value="<?=$SEARCH_TITLE?>">
				<?  } else { ?>
              <input name="image2" type="image" onClick="form0.command.value='SEARCH';" src="images/search.png" alt="<?=$SEARCH_TITLE?>">
              <? } echo "&nbsp; &nbsp;"; ?>
			  <? if ($BUTTON_DISPLAY==1) { ?>
      		  	<input name="Reset1" type="button" class="button" value="<?=$CLEAR_TITLE?>" onClick="clear_form();"> 
				<? } else { ?>
            <img src="images/default.jpg" alt="<?=$CLEAR_TITLE?>" width="32" height="32" border="0" onClick="clear_form();">
				<?} echo "&nbsp; &nbsp;"; ?> 
          </td>
        </tr>
      </table></td>
    </tr>
  </table>
  <table width="95%" align="center" cellpadding="0" cellspacing="0">
    <tr>
	  <td height="30" align="center" class="label_hilight">พบข้อมูลวันที่ประมวลผล/ตำแหน่ง ของข้าราชการที่มีคุณสมบัติได้เลื่อนตำแหน่งทั้งสิ้น <?=($count_data + 0)?> รายการ</td>
    </tr>
</table>  
<?
	if($current_page > 1){
		if($DPISDB=="odbc"){
			$limit_data = " and ($field_limit_data) not in (select top $start_record ($field_limit_data) from $table $search_condition order by $orderby) ";
		}elseif($DPISDB=="mysql"){
			$limit_data = " limit " . (($current_page - 1) * $data_per_page) . ", " . $data_per_page;
		}
	} // end if 
	
	if($DPISDB=="odbc"){
		$cmd = "	select		distinct top $data_per_page 
											$field, DEPARTMENT_ID
							from		$table
											$search_condition
											$limit_data
							order by 	$orderby 	";	
	}elseif($DPISDB=="oci8"){
		$rec_start = (($current_page-1) * $data_per_page) + 1;
		$rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
		$cmd = "select * from (
						   select rownum rnum, q1.* from ( 
								  select 		distinct $field, DEPARTMENT_ID
								  from 			$table
								  		 			$search_condition
								  order by 	$orderby  
						   )  q1
					) where rnum between $rec_start and $rec_end  ";				 					 
	}elseif($DPISDB=="mysql"){
		$cmd = "	select		distinct $field, DEPARTMENT_ID
							from		$table
										$search_condition
							order by 	$orderby
										$limit_data 	";	
	} // end if
	//echo "<br>SHOW_SEARCH -----> $cmd";
	$count_page_data = $db_dpis->send_cmd($cmd);
	//$db_dpis->show_error();
	if ($count_page_data) {
?>
  <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
    <tr align="center" class="table_head">
	  <td width="10%" height="21"><strong><?=$SEQ_NO_TITLE?></strong></td>
      <td width="15%"><strong>วันที่</strong></td>
      <td width="15%"><strong><?=$POS_NO_TITLE?></strong></td>
      <td><strong><?=$CMD_POSITION_TITLE?></strong></td>
      <td width="25%"><strong><?=$DEPARTMENT_TITLE?></strong></td>
    </tr>
    <?
	$current_list = "";
	$data_count = 0;
	while ($data = $db_dpis->get_array()) {
		$data_count++;
		if($data_count > $data_per_page) break;
		$TMP_PRO_DATE = show_date_format($data[PDATE], 1);
		$TMP_POS_ID = $data[PID];
		
		$cmd = $cmd_position . $TMP_POS_ID;
		$db_dpis2->send_cmd($cmd);
		$data2 = $db_dpis2->get_array();
		$TMP_POS_NO = $data2[PNO];
		$TMP_POS_NO_NAME = $data2[PNONAME];
		$TMP_POS_NAME = $data2[PNAME];
		
		$TMP_DEPARTMENT_ID = $data[DEPARTMENT_ID];
		$cmd = " select ORG_NAME from PER_ORG where ORG_ID=$TMP_DEPARTMENT_ID ";
		$db_dpis2->send_cmd($cmd);
		$data2 = $db_dpis2->get_array();
		$TMP_DEPARTMENT_NAME = $data2[ORG_NAME];
	
		$returnValue = "$TMP_POS_ID<::>$TMP_POS_NO<::>$TMP_POS_NAME<::>$TMP_PRO_DATE<::>$table<::>$PER_TYPE<::>$TMP_POS_NO_NAME";

		$class = "table_body";
		$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
		if(false){ 
			$class = "table_body_over";
			$onmouse_event = "";
		} // end if	
?>
<tr class="<?=$class?>" <?=$onmouse_event?> style="cursor:hand;" onClick="<?=("javascript:form1.POS_POEM_ID.value='$TMP_POS_ID';form1.command.value='SELECT';form1.PRO_DATE.value='$TMP_PRO_DATE';form1.POS_POEM_NO.value='$TMP_POS_NO'; if(form1.POS_POEM_NO_NAME){ form1.POS_POEM_NO_NAME.value='$TMP_POS_NO_NAME'; } form1.POS_POEM_NAME.value='$TMP_POS_NAME';form1.PL_PN_CODE.value='$PCODE';form1.PL_PN_NAME.value='$PNAME';form1.current_page.value=1;form1.show_topic.value=2;form1.submit()")?>">  <!--- ถ้ากดข้อมูลหน้านี้ เข้าที่ data_promote_e_p_inquire_query_select.php --->
            <td height="25" align="center"><?=$data_count?></td>
			<td align="center"><?=$TMP_PRO_DATE?></td>
			<td align="center"><?=$TMP_POS_NO_NAME.$TMP_POS_NO?></td>
			<td>&nbsp;<?=$TMP_POS_NAME; ?></td>
			<td>&nbsp;<?=$TMP_DEPARTMENT_NAME?></td>
	  </tr>
    <? } ?>
	<?if($PAGE_AUTH["edit"]=="Y"){?>
    <tr class="table_footer" height="21">
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
	  <td>&nbsp;</td>
    </tr>
	<?}?>
  </table>
  <? 
  
  
  if($total_page > 1) : ?>
  <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td align="center"><?=$page_link?></td>
    </tr>
  </table>
        <? endif; ?>
        &nbsp; 
        <? } // if  count show ?>
        <input type="hidden" name="current_list" value="<?=$current_list?>">
</div>		
        </form>	
		</td>
	</tr>
</table>

<tr>
    	<td align="left" valign="top"><form name="form1" method="post" action="data_promote_e_p_inquire.html" enctype="multipart/form-data">
		 <?
		 //$SELECTED_LIST=""; 
		 //echo $SELECTED_LIST; ?>
		  <input type="hidden" name="current_page" value="<?=$current_page?>">
          <input type="hidden" name="total_page" value="<?=$total_page?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
          <input type="hidden" name="command" value="<?=$command?>">
          <input type="hidden" name="table_select" value="<?=$table_select?>">
		  <input type="hidden" name="chksave_promote" value="">
  		  <input type="hidden" name="SELECTED_LIST" value="<?=$SELECTED_LIST?>">
		<input type="hidden" name="show_topic" value="<?=$show_topic?>"> 
<div id="DIV_TOPIC_2" style="display:<?=($show_topic==2)?"block":"none"?>;"> 
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
  	<tr>
	  <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">  
		<tr><td height="3"></td></tr>
        <tr>
          <td height="22" align="center"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                      <tr> 
                        <td width="20%" height="22" align="right"><?=$PER_TYPE_TITLE?>&nbsp;:&nbsp;</td>
                        <td width="30%"><select name="PER_TYPE" onChange="check_salary_type(2, this.value);">
                          <?  foreach($PERSON_TYPE as $key=>$value){  ?>
                          <option value="<?=$key; ?>"<?=($PER_TYPE==$key)?"selected":""?>>
                            <?=$value; ?>
                            </option>
                          <?  } ?>
                        </select></td>
                        <td width="15%" align="right"><span class="label_alert">*</span>&nbsp;วันที่ประมวลผล&nbsp;:&nbsp;</td>
                        <td><input type="text" name="PRO_DATE" id="PRO_DATE" value="<?=$PRO_DATE?>"  class="textbox" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.PRO_DATE,this.value)" <?=($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y")?"":"readonly"?>>&nbsp;&nbsp; 
							<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>						
						  	<input name="btnPRO_DATE" type="reset" class="button" onClick="return showCalendar('PRO_DATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');" value="<?=$SELECT_TITLE?>"> 
							<? endif; ?>                        </td>
                      </tr>
                      <tr> 
                        <td align="right"><?=$POS_NO_TITLE;?>&nbsp;:&nbsp;</td>
                        <td><? if ($POSITION_NO_CHAR=="Y") { ?><input type="text" name="POS_POEM_NO_NAME" value="<?=$POS_POEM_NO_NAME?>" class="textbox" style="width:40%" readonly><? } ?>&nbsp;<input type="text" name="POS_POEM_NO" value="<?=$POS_POEM_NO?>" class="textbox"  style="width:30%" readonly>&nbsp;&nbsp;
                          <input type="hidden" name="POS_POEM_ID" value="<?=$POS_POEM_ID?>">
                          <? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
			   					<input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกเลขที่ตำแหน่ง" onClick="call_search_position();">
								<? endif; ?>						</td>
                        <td align="right"><?=$CMD_POSITION_TITLE;?>&nbsp;:&nbsp;</td>
                        <td><input type="text" name="POS_POEM_NAME" value="<?=$POS_POEM_NAME?>" style="width:80%" class="textbox" readonly></td>
                      </tr>
		      </table></td>
	 </tr>
        <tr>
          <td height="5" align="center"><iframe src="javascript:;" id="PROCESS_IFRAME" frameborder="0" height="5" scrolling="no">ตรวจสอบการบันทึกข้อมูลลง per_promote... </iframe></td>
          </tr>	 
        <tr align="center">
          <td height="25">	  
<? if ($count_data && $command == "SEARCH") : ?>
		<? if ($BUTTON_DISPLAY==1) { ?>
		  	<input name="button5" type="button" class="button" value="<?=$CANCEL_TITLE?>แก้ไข" onClick="form1.command.value='';form1.current_page.value=1;">
		<? } else { ?>
               <img src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>แก้ไข" width="32" height="32" border="0" onClick="form1.command.value='';form1.current_page.value=1;form1.submit();">
		<?}  echo "&nbsp; &nbsp;"; ?> 
		<? if ($BUTTON_DISPLAY==1) { ?>
			  <input name="Submit2" type="button" class="button" onClick="check_save_promote('<?=$table_select?>');" value="<?=$SAVE_SEARCH_TITLE?>">
		<?  } else { ?>      
			  <img src="images/save.png" alt="<?=$SAVE_SEARCH_TITLE?>" width="32" height="32" border="0" onClick="check_save_promote('<?=$table_select?>');" >
		<? } echo "&nbsp; &nbsp;"; ?>
<? endif; ?>		
          </td>
        </tr>
      </table></td>
    </tr>
</table>
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
   
        <tr>
          <td height="22" align="center"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
			 <tr><td width="20%" colspan="4"></td></tr>
			 <tr><td align="center"><b>&reg;&nbsp;เงื่อนไขการค้นหา</b></td><td colspan="3"></td></tr>
			 <tr>
				<td width="15%" align="right"><span class="label_alert">*</span>&nbsp;<?=$MINISTRY_TITLE;?>&nbsp;:&nbsp;</td>
               	<td width="35%"><input type="text" name="ORG_NAME_M1" value="<?=$ORG_NAME_M1?>" style="width:80%" class="textbox" readonly>
					<input type="hidden" name="ORG_ID_M1"  value="<?=$ORG_ID_M1?>">
					<? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
					<input type="button" name="btn_ministry" class="button" value="<?=$SELECT_TITLE?>" title="<?=$MINISTRY_SELECT?>" onClick="call_search_ministry_dtl();">
             <input name="image" type="image" onClick="form1.ORG_ID_M1.value=''; form1.ORG_NAME_M1.value=''; form1.ORG_ID_M2.value=''; form1.ORG_NAME_2.value=''; form1.ORG_ID_M3.value=''; form1.ORG_NAME_3.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
					<? } // end if ?>			   </td>
			   <td width="15%" align="right"><? if($BKK_FLAG!=1 && $MFA_FLAG!=1){ ?><span class="label_alert">*</span>&nbsp;<? } ?><?=$DEPARTMENT_TITLE;?>&nbsp;:&nbsp;</td>
			   <td width="35%"><input type="text" name="ORG_NAME_2" value="<?=$ORG_NAME_2?>" style="width:80%" class="textbox" readonly>
			     <input type="hidden" name="ORG_ID_M2"  value="<?=$ORG_ID_M2?>">
			     <? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
				 <input type="button" name="btn_department" class="button" value="<?=$SELECT_TITLE?>" title="<?=$DEPARTMENT_SELECT?>" onClick="call_search_department_dtl();">
             <input name="image" type="image" onClick="form1.ORG_ID_M2.value=''; form1.ORG_NAME_2.value=''; form1.ORG_ID_M3.value=''; form1.ORG_NAME_3.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
				 <? } // end if ?></td></tr>
			 <tr>
			   <td align="right"><?=$PL_TITLE?>&nbsp;:&nbsp;</td>
			   <td><input type="text" name="PL_PN_NAME" value="<?=$PL_PN_NAME?>" style="width:80%" class="textbox" readonly>
					  <input type="hidden" name="PL_PN_CODE" value="<?=$PL_PN_CODE?>">
					  <? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
					  <input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PL_TITLE?>" onClick="call_search_perline_perposname();">
             <input name="image" type="image" onClick="form1.PL_PN_CODE.value=''; form1.PL_PN_NAME.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
					  <? endif; ?></td>
				<td align="right"><?=$ORG_TITLE;?>&nbsp;:&nbsp;</td>
                <td><input type="text" name="ORG_NAME_3" value="<?=$ORG_NAME_3?>" style="width:80%" class="textbox" readonly>
                  <input type="hidden" name="ORG_ID_M3" value="<?=$ORG_ID_M3?>">
                  <? if($SESS_USERGROUP_LEVEL < 5) : ?>
                  <input type="button" name="btn_org" class="button" value="<?=$SELECT_TITLE?>" onClick="call_search_org();">
             <input name="image" type="image" onClick="form1.ORG_ID_M3.value=''; form1.ORG_NAME_3.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
                  <? endif; ?>				</td></tr>
			 <tr>
				<td align="right"><?=$EN_TITLE; ?>&nbsp;:&nbsp;</td>
               	<td><input type="text" name="EN_NAME" value="<?=$EN_NAME?>" style="width:80%" class="textbox" readonly>
					<input type="hidden" name="EN_CODE" value="<?=$EN_CODE?>">
					<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
					<input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกวุฒิการศึกษา" onClick="call_search_education();">
             <input name="image" type="image" onClick="form1.EN_CODE.value=''; form1.EN_NAME.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
					<? endif; ?>				</td>
				<td align="right">&nbsp;</td>
				<td><input name="select_org_structure" type="radio" value="0" <?=($select_org_structure==0 || $SESS_ORG_STRUCTURE==0)?"checked":""?> <?=($SESS_ORG_STRUCTURE==1)?"disabled":"" ?> onClick="form1.ORG_ID_M3.value='';form1.ORG_NAME_3.value='';"><?=$LAW_STRUCTURE_TITLE?>&nbsp;
                    <input name="select_org_structure" type="radio" value="1" <?=($select_org_structure==1 || $SESS_ORG_STRUCTURE==1)?"checked":""?> <?=($SESS_ORG_STRUCTURE==0)?"disabled":"" ?> onClick="form1.ORG_ID_M3.value='';form1.ORG_NAME_3.value='';"><?=$ASSIGN_STRUCTURE_TITLE?></td>
			 </tr>
			 <tr>
               <td align="right"><?=$LEVEL_TITLE?>
                 &nbsp;:&nbsp;</td>
			   <td><!--? list_per_level('LEVEL_START', $LEVEL_START); ?-->
			     <select class="selectbox" name="LEVEL_START" onChange="<?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW)?"check_salary_type(1, this.value);":""?>">
                   <option value="" <?=($LEVEL_START=="")?"selected":""?>>==<?=$LEVEL_TITLE?>==</option>
                   <?
					  if ($ISCS_FLAG==1) $where = "and LEVEL_NO in $LIST_LEVEL_NO"; 
				  	$cmd = " select LEVEL_NO, LEVEL_NAME from PER_LEVEL where PER_TYPE = $PER_TYPE and LEVEL_ACTIVE = 1 $where order by LEVEL_SEQ_NO ";
					$db_dpis1->send_cmd($cmd);
					while($data1 = $db_dpis1->get_array()){					
						$TMP_LEVEL_NO = $data1[LEVEL_NO];
						$TMP_LEVEL_NAME = $data1[LEVEL_NAME];
				  ?>
                   <option value="<?=$TMP_LEVEL_NO?>" <?=(trim($LEVEL_START)==trim($TMP_LEVEL_NO))?"selected":""?>>
                   <?=$TMP_LEVEL_NAME?>
                   </option>
                   <?
				  	} // end while
				  ?>
                 </select></td>
			   <td align="right">ถึง&nbsp;:&nbsp;</td>
			   <td><!--? list_per_level('LEVEL_END', $LEVEL_END); ?-->
                   <select class="selectbox" name="LEVEL_END" onChange="<?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW)?"check_salary_type(1, this.value);":""?>">
                     <option value="" <?=($LEVEL_END=="")?"selected":""?>>== <?=$LEVEL_TITLE?> ==</option>
                     <?
					  if ($ISCS_FLAG==1) $where = "and LEVEL_NO in $LIST_LEVEL_NO"; 
				  	$cmd = " select LEVEL_NO, LEVEL_NAME from PER_LEVEL where PER_TYPE = $PER_TYPE and LEVEL_ACTIVE = 1 $where order by LEVEL_SEQ_NO ";
					$db_dpis1->send_cmd($cmd);
					while($data1 = $db_dpis1->get_array()){					
						$TMP_LEVEL_NO = $data1[LEVEL_NO];
						$TMP_LEVEL_NAME = $data1[LEVEL_NAME];
				  ?>
                     <option value="<?=$TMP_LEVEL_NO?>" <?=(trim($LEVEL_END)==trim($TMP_LEVEL_NO))?"selected":""?>>
                       <?=$TMP_LEVEL_NAME?>
                       </option>
                     <?
				  	} // end while
				  ?>
                   </select></td>
			   </tr>
			 <tr>
				<td align="right">ระยะเวลาในการดำรงตำแหน่งปัจจุบัน&nbsp;:&nbsp;</td>
				<td><input type="text" name="YEAR_START" value="<?=$YEAR_START?>" class="textbox" size="12" onKeyPress="return DigitOnly();">&nbsp;&nbsp;ปี</td>
				<td align="right">ถึง&nbsp;:&nbsp;</td>
				<td><input type="text" name="YEAR_END" value="<?=$YEAR_END?>" class="textbox" size="12" onKeyPress="return DigitOnly();"></td>
			 </tr>	
			 <tr>
					<td align="right">นับถึงวันที่&nbsp;:&nbsp;</td>
                        <td><input type="text" name="CHECK_DATE" id="CHECK_DATE" value="<?=$CHECK_DATE?>"  class="textbox" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.CHECK_DATE,this.value)" <?=($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y")?"":"readonly"?>>&nbsp;&nbsp; 
							<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>						
						  	<input name="btnCHECK_DATE" type="reset" class="button" onClick="return showCalendar('CHECK_DATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');" value="<?=$SELECT_TITLE?>"> 
							<? endif; ?>                        </td>
			 </tr>
			 <tr>
				<td align="right"><?=$SALARY_TITLE;?>&nbsp;:&nbsp;</td>
				<td><input type="text" name="SAL_START" value="<?=$SAL_START?>" class="textbox" size="12" onKeyPress="return NumOnly();"></td>
				<td align="right">ถึง&nbsp;:&nbsp;</td>
				<td><input type="text" name="SAL_END" value="<?=$SAL_END?>" class="textbox" size="12" onKeyPress="return NumOnly();"></td>
			 </tr>				  			 			 
		      </table></td>
	 </tr>
        <tr>
          <td height="5" align="center"></td>
        </tr>	 
        <tr align="center">
          <td height="25">
				<? if ($BUTTON_DISPLAY==1) { ?>
				<script>BKK_FLAG = '<?=$BKK_FLAG; ?>';		MFA_FLAG = '<?=$MFA_FLAG; ?>';	</script> 
			<input name="Submit2" type="submit" class="button" onClick="if(form1.PRO_DATE.value==''){	 alert('กรุณาเลือกวันที่ประมวลผล'); form1.btnPRO_DATE.focus();	return false;	}	if(form1.ORG_ID_M2.value.trim()!='' || BKK_FLAG==1 || MFA_FLAG==1){ 		
				form1.command.value='SEARCH';form1.current_page.value=1; ProcessUploading(); }else{ alert('<?=$DEPARTMENT_ALERT?>');  return false; }" value="<?=$SEARCH_TITLE?>">
				<?  } else { ?>
              <input name="image2" type="image" onClick="if(form1.PRO_DATE.value==''){	 alert('กรุณาเลือกวันที่ประมวลผล');	form1.btnPRO_DATE.focus();	return false; }	if(form1.ORG_ID_M2.value.trim()!='' || BKK_FLAG==1 || MFA_FLAG==1){ 		
				form1.command.value='SEARCH';form1.current_page.value=1; ProcessUploading(); }else{ alert('<?=$DEPARTMENT_ALERT?>');  return false; }" src="images/search.png" alt="<?=$SEARCH_TITLE?>">
              <? } echo "&nbsp; &nbsp;"; ?>
		  <? if ($BUTTON_DISPLAY==1) { ?>
		  	<input name="button5" type="button" class="button" value="<?=$CANCEL_TITLE?>" onClick="form1.command.value='CANCEL';form1.current_page.value=1;form1.show_topic.value=1;form1.submit();">
			<? } else { ?>
               <img src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>" width="32" height="32" border="0" onClick="form1.command.value='CANCEL';form1.current_page.value=1;form1.show_topic.value=1;form1.submit();">
      		  <?}  echo "&nbsp; &nbsp;"; ?>  
			  <? if ($BUTTON_DISPLAY==1) { ?>
      		  	<input name="Reset1" type="button" class="button" value="<?=$CLEAR_TITLE?>" onClick="clear_form();"> 
				<? } else { ?>
            <img src="images/default.jpg" alt="<?=$CLEAR_TITLE?>" width="32" height="32" border="0" onClick="clear_form();">&nbsp;
				<?} echo "&nbsp; &nbsp;"; ?>
			<? if ($command == "SELECT") { ?>
			<? if ($BUTTON_DISPLAY==1) { ?>
			<input name="Submit4" type="button" class="button" onClick="call_personal_promote_e_p();" value="<?=$ADD_PERSON_TITLE?>" style="width:125">
			<? } else { ?>
            <img src="images/select_person.png" alt="<?=$ADD_PERSON_TITLE?>" width="32" height="32" border="0" onClick="call_personal_promote_e_p();">&nbsp;
			<?}?>
			<? } // if ?>
          </td>
        </tr>
      </table></td>
    </tr>
  </table>
  
    <table width="95%" align="center"  border="0" cellspacing="0" cellpadding="0">
	<tr><td height="21">&nbsp;</td></tr>	
    <tr><td>
	<table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
            <tr height="22">
<? if (trim($PRO_DATE) && $POS_POEM_ID) : ?>
              <td width="15%"><? if($PAGE_AUTH["print"]=="Y" && $command=="SELECT"){ ?><? if ($BUTTON_DISPLAY==1) { ?>
	<input name="btn_report" type="button" class="button" style="width:150" value="<?=$PDF_TITLE?>" onClick="call_pdf_report();"><?  } else { ?>
	<img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE?>" onClick="call_pdf_report();"><? } ?>
              <? }else{ echo "&nbsp;"; } ?></td> 
<? endif; ?>
<?
//echo '>>>>>>>>'.$cmd_search.'<<<<<';
	if($cmd_search){
		$count_page_data = $db_dpis->send_cmd($cmd_search);
                $count_page_data = $db_dpis->send_cmd($cmd_search_count);
	}/*else if($cmd_show){	//ไม่มีตัวแปรนี้
		$count_page_data = $db_dpis->send_cmd($cmd_show);
	}*/
//echo "<===<br>$count_page_data : $cmd_search	<br>====>";
//$db_dpis->show_error();		echo "<hr>";	//ถ้าเยอะๆเป็น 3-4 พัน error
?>
              <td align="center">พบข้อมูล<?=$MENU_TITLE_LV2?>ทั้งสิ้น <?=($count_page_data + 0)?> รายการ</td>
<? if (trim($PRO_DATE) && $POS_POEM_ID) : ?>						  
              <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y" && $command=="SELECT"){ ?><? if ($BUTTON_DISPLAY==1) { ?>
	<input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE?>" onClick="call_export_file();"><?  } else { ?>
	<img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE?>" onClick="call_export_file();"><? } ?>
              <? }else{ echo "&nbsp;"; } ?></td> 
<? endif; ?>			  
            </tr>
          </table>  
	</td></tr>
</table>
<?	
	//echo "<br>MAIN_SHOW [ $POS_POEM_NO + $PER_TYPE + $PL_PN_CODE]  : : $show_topic :: $count_page_data ---><hr> $command : $cmd_search - $cmd_show";
	if ($count_page_data) { 
?>
        <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
<tr align="center" class="table_head"> 
            <td width="3%"><input name="Reset1" type="button" class="button" value="<?=$SELECT_TITLE?>" onClick="call_presentation();" alt="นำเสนอ" title="นำเสนอ"> </td>
			<td width="5%" height="21"><strong><?=$SEQ_NO_TITLE;?></strong></td>
			<td width="18%"><strong><?=$FULLNAME_TITLE;?></strong></td>
			<td width="17%"><strong><?=$CMD_POSITION_TITLE;?></strong></td>
			<td><strong>สังกัด</strong></td>
			<td width="8%"><strong><?=$POS_NO_TITLE;?></strong></td>
			<td width="8%"><strong><?=$SALARY_TITLE;?></strong></td>
			<td width="8%">วันเข้าสู่ระดับ</td>
			<td width="11%">ระยะเวลาที่ดำรงตำแหน่ง<br>(ปี/เดือน/วัน)</td>			
			<td width="11%">อายุราชการ<br>(ปี/เดือน/วัน)</td>
			<? //if ($command=="SELECT") : ?>
			<td width="4%"><?=$DEL_TITLE;?></td>
			<? //endif; ?>
</tr>
<?
	$current_list = "";
	$data_count = 0;
	$data_num = $data_per_page * ($current_page - 1);
	while ($data = $db_dpis->get_array()) {
		$data_count++;
		$data_num++;
		if($data_count > $data_per_page) break;
		$TMP_PER_ID = $data[PER_ID];
		$TMP_PER_TYPE = $data[PER_TYPE];		
		$current_list .= ((trim($current_list))?",":"") . $TMP_PER_ID;
		$TMP_PN_CODE = trim($data[PRENAME_CODE]);
		if($TMP_PN_CODE){
			$cmd = " select PN_NAME from PER_PRENAME where trim(PN_CODE)='$TMP_PN_CODE' ";
			$db_dpis2->send_cmd($cmd);
			$data2 = $db_dpis2->get_array();
			$TMP_PN_NAME = trim($data2[PN_NAME]);
		} // end if		
		$TMP_PER_NAME = trim($TMP_PN_NAME) . trim($data[PER_NAME]) ." ". trim($data[PER_SURNAME]);
		$TMP_SALARY = number_format(trim($data[PER_SALARY]), 2, '.', ',');
		$TMP_POS_CHANGE_DATE = show_date_format($data[POS_CHANGE_DATE], $DATE_DISPLAY);
		$TMP_PER_STARTDATE = show_date_format($data[PER_STARTDATE], 1);
		$TMP_PER_STARTDATE = date_difference(date("Y-m-d"), trim($data[PER_STARTDATE]), "full");

		$TMP_LEVEL_NO = trim($data[LEVEL_NO]);

		// หา วันเข้าสู่ระดับ
		$cmd = "select min(POH_EFFECTIVEDATE) as EFFECTIVEDATE
						from PER_POSITIONHIS
						where PER_ID=$TMP_PER_ID
						order by min(POH_EFFECTIVEDATE)";
		$db_dpis2->send_cmd($cmd);
		$data2 = $db_dpis2->get_array();
		$TMP_EFFECTIVEDATE = show_date_format($data2[EFFECTIVEDATE], $DATE_DISPLAY);

		$TMP_POH_EFFECTIVEDATE = "";
		if($PER_TYPE == 1){
			$cmd = " select			POH_EFFECTIVEDATE
							 from			PER_POSITIONHIS
							 where		PER_ID=$TMP_PER_ID and LEVEL_NO='$TMP_LEVEL_NO'
							 order by		POH_EFFECTIVEDATE ";
		}elseif($PER_TYPE == 2){
			$cmd = " select			POH_EFFECTIVEDATE
							 from			PER_POSITIONHIS
							 where		PER_ID=$TMP_PER_ID and LEVEL_NO='$TMP_LEVEL_NO'
							 order by		POH_EFFECTIVEDATE ";
		}elseif($PER_TYPE == 3){
			$cmd = " select			POH_EFFECTIVEDATE
							 from			PER_POSITIONHIS
							 where		PER_ID=$TMP_PER_ID and LEVEL_NO='$TMP_LEVEL_NO' 
							 order by		POH_EFFECTIVEDATE ";
		} // end if
		$db_dpis1->send_cmd($cmd);
//		$db_dpis1->show_error();
		$data1 = $db_dpis1->get_array();
		$TMP_POH_EFFECTIVEDATE = substr(trim($data1[POH_EFFECTIVEDATE]), 0, 10);
		$TMP_POS_STARTDATE = "";
		if ($CHECK_DATE) {
			$tmp_date = save_date($CHECK_DATE);
			if($TMP_POH_EFFECTIVEDATE && $TMP_POH_EFFECTIVEDATE!="-") $TMP_POS_STARTDATE = date_difference($tmp_date, $TMP_POH_EFFECTIVEDATE, "full");
		} else {
			if($TMP_POH_EFFECTIVEDATE && $TMP_POH_EFFECTIVEDATE!="-") $TMP_POS_STARTDATE = date_difference(date("Y-m-d"), $TMP_POH_EFFECTIVEDATE, "full");
		}

		if($PER_TYPE==1){
			$TMP_POS_NO = trim($data[POS_NO_NAME]).trim($data[POS_NO]);
			$TMP_PL_CODE = trim($data[PL_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select PL_NAME from PER_LINE where trim(PL_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[PL_NAME]);
			} // end if		
		}elseif($PER_TYPE==2){
			$TMP_POS_NO = trim($data[POEM_NO_NAME]).trim($data[POEM_NO]);
			$TMP_PL_CODE = trim($data[PN_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select PN_NAME from PER_POS_NAME where trim(PN_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[PN_NAME]);
			} // end if		
		}elseif($PER_TYPE==3){
			$TMP_POS_NO = trim($data[POEMS_NO_NAME]).trim($data[POEMS_NO]);
			$TMP_PL_CODE = trim($data[EP_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select EP_NAME from PER_EMPSER_POS_NAME where trim(EP_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[EP_NAME]);
			} // end if		
		}elseif($PER_TYPE==4){
			$TMP_POS_NO = trim($data[POT_NO_NAME]).trim($data[POT_NO]);
			$TMP_PL_CODE = trim($data[TP_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select TP_NAME from PER_TEMP_POS_NAME where trim(TP_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[TP_NAME]);
			} // end if		
		} // end if

		$TMP_PT_CODE = trim($data[PT_CODE]);
		if($TMP_PT_CODE){
			$cmd = " select PT_NAME from PER_TYPE where trim(PT_CODE)='$TMP_PT_CODE' ";
			$db_dpis2->send_cmd($cmd);
			$data2 = $db_dpis2->get_array();
			$TMP_PT_NAME = trim($data2[PT_NAME]);
		} // end if		

		$TMP_PM_CODE = trim($data[PM_CODE]);
		if($TMP_PM_CODE){
			$cmd = " select PM_NAME from PER_MGT where trim(PM_CODE)='$TMP_PM_CODE' ";
			$db_dpis2->send_cmd($cmd);
			$data2 = $db_dpis2->get_array();
			$TMP_PM_NAME = $data2[PM_NAME];
		} // end if
		
		$cmd = " select LEVEL_NAME, POSITION_LEVEL from PER_LEVEL where LEVEL_NO='$TMP_LEVEL_NO' ";
		$db_dpis2->send_cmd($cmd);
		$data2 = $db_dpis2->get_array();
		$LEVEL_NAME = $data2[LEVEL_NAME];
		$POSITION_LEVEL = $data2[POSITION_LEVEL];
		if (!$POSITION_LEVEL) $POSITION_LEVEL = $LEVEL_NAME;
		
		if ($RPT_N)
		    $TMP_POSITION = (trim($TMP_PM_NAME) ?"$TMP_PM_NAME (":"") . (trim($TMP_PL_NAME)? "$TMP_PL_NAME$POSITION_LEVEL" : "") . (trim($TMP_PM_NAME) ?")":"");
		else
		    $TMP_POSITION = (trim($TMP_PM_NAME) ?"$TMP_PM_NAME (":"") . (trim($TMP_PL_NAME)?($TMP_PL_NAME ." ". level_no_format($TMP_LEVEL_NO) . (($TMP_PT_NAME != "ทั่วไป" && $TMP_LEVEL_NO >= 6)?"$TMP_PT_NAME":"")):"") . (trim($TMP_PM_NAME) ?")":"");
		
		$TMP_ORG_ID = trim($data[ORG_ID]);
		if($TMP_ORG_ID){
			$cmd = " select ORG_NAME,ORG_SHORT from PER_ORG where ORG_ID=$TMP_ORG_ID ";
			$db_dpis2->send_cmd($cmd);
			//$db_dpis2->show_error();
			$data2 = $db_dpis2->get_array();
			if($data2[ORG_SHORT]){
				$TMP_ORG = $data2[ORG_SHORT];
			}else{
				$TMP_ORG = $data2[ORG_NAME];
			}
		} // end if
	
		$class = "table_body";
		$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
		if($PER_ID==$TMP_PER_ID){ 
			$class = "table_body_over";
			$onmouse_event = "";
		} // end if		
?>
          <tr class="<?=$class?>" <?=$onmouse_event?>> 
		    <td align="center"><input type="checkbox" name="SELECT_PER_<?=$TMP_PER_ID?>" value="<?=$TMP_PER_ID?>" onClick="update_list(this.checked, <?=$TMP_PER_ID?>);"></td>
		    <td height="25" align="center"><?=$data_num?></td>
		<td>&nbsp;<?=$TMP_PER_NAME?></td>
		<td>&nbsp;<?=$TMP_POSITION?></td>
		<td nowrap="nowrap">&nbsp;<?=$TMP_ORG?></td>
		<td align="center"><?=$TMP_POS_NO?></td>
		<td align="right"><?=$TMP_SALARY?>&nbsp;</td>
		<td align="center"><?=$TMP_EFFECTIVEDATE?></td>
		<td>&nbsp;<?=$TMP_POS_STARTDATE?></td>
		<td>&nbsp;<?=$TMP_PER_STARTDATE?></td>
		<td align="center">
			<? if ($command == "SELECT") { ?>
				<img src="images/b_drop.png" alt="ลบข้อมูล" width="15" height="15" border="0" style="cursor:hand" onClick="del_personal_promote_e_p('<?=$TMP_PER_ID?>','<?=$TMP_PER_NAME?>','<?=$TMP_PER_TYPE?>')">
			<? } else { echo "<font color='red'>-</font>"; } // if ?></td>
          </tr>
          <? } ?>
          <?if($PAGE_AUTH["edit"]=="Y"){?>
          <tr class="table_footer" height="21"> 
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
	     <td>&nbsp;</td>
          </tr>
          <?}?>
        </table>
  <? if($total_page > 1) : ?>
  <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td align="center"><?=$page_link?></td>
    </tr>
  </table>
        <? endif; ?>
        &nbsp; 
        <? } // if ($count_page_data) ?>
        <input type="hidden" name="current_list" value="<?=$current_list?>">
</div>
        </form>	
		</td>
	</tr>
</table>
<?
	include("jqModalDialog.html");
?>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
</script>
<script><?=$alert_save_success?></script>
<!-- Layer for uploading -->
<div style="position:absolute;width:160;height:160; visibility:hidden; display:none;" id="obj_uploading">
  <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="160" height="160">
    <param name="movie" value="images/uploading.swf">
    <param name="quality" value="high">
    <embed src="images/uploading.swf" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="160" height="160"></embed>
  </object>
</div>
<!-- Layer for uploading -->
</html>
