<? 
	include("../php_scripts/connect_database.php");
	include("php_scripts/session_start.php");
	include("php_scripts/function_share.php");
	include("php_scripts/load_per_control.php");
	
	$db_dpis1 = new connect_dpis($dpisdb_host, $dpisdb_name, $dpisdb_user, $dpisdb_pwd, $dpisdb_port);
  	$db_dpis2 = new connect_dpis($dpisdb_host, $dpisdb_name, $dpisdb_user, $dpisdb_pwd, $dpisdb_port);
	
	if(!$current_page) $current_page = 1;
	if(!$data_per_page) $data_per_page = 30;
	$start_record = ($current_page - 1) * $data_per_page;
	if($KPI_PER_TYPE)	$PER_TYPE = $KPI_PER_TYPE;
	if(!$PER_TYPE)	$PER_TYPE = 1;
	if($KPI_PER_TYPE)	$search_PER_TYPE = $KPI_PER_TYPE;
	if(!$search_PER_TYPE)	$search_PER_TYPE = 1;
	
	//echo " => $show_topic  /  $page_action ; $UPD <- $command -> $VIEW ( $PL_CODE *** $CP_CODE ~~ $MINISTRY_ID + $MINISTRY_NAME ) ( $DEPARTMENT_ID + $DEPARTMENT_NAME ) <br>";

	switch($CTRL_TYPE){
		case 2 :
			$PV_CODE = $PROVINCE_CODE;
			$PV_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			break;
	} // end switch case

	switch($SESS_USERGROUP_LEVEL){
		case 2 :
			$PV_CODE = $PROVINCE_CODE;
			$PV_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			break;
		case 5 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			break;
		case 6 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$search_org_id_1 = $ORG_ID_1;
			$search_org_name_1 = $ORG_NAME_1;
			break;
	} // end switch case

	if(!isset($show_topic)) $show_topic = 1;
	if(!$page_action)	$page_action="add";
        //echo $show_topic;
	if($show_topic==1){
		include("php_scripts/kpi_per_type_competence.php"); 
	}elseif($show_topic==2){
		if($page_action=="add"){			
			include("php_scripts/kpi_per_type_competence_add.php"); 
		}else if($page_action=="upd"){
			include("php_scripts/kpi_per_type_competence_upd.php"); 
		}  
	}
    
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
<script type="text/JavaScript">
<!--
function MM_jumpMenu(targ,selObj,restore){ //v3.0
  eval(targ+".location='"+selObj.options[selObj.selectedIndex].value+"'");
  if (restore) selObj.selectedIndex=0;
}
//-->
</script>
</head>
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript" type="text/javascript" src="java_scripts/ajax_search.js"></script>
<script language="JavaScript">
	var FName = new Array('form0','form1');	//form ทั้งหมด
	function change_current_page_data(page,formName){
		eval(formName).current_page.value = page;
		//alert(formName);
		eval(formName).submit(); 
	}

	function refresh_opener1(returnValue){
		var arr = returnValue.split("<::>");
		
		form1.command_for.value = arr[0];
		if(arr[0]==1){
			form1.page_action.value = 'add';
		}else if(arr[0]==2){
			form1.page_action.value = 'upd';
		}
//		alert("1.1..");
		// เครื่องหมาย ! หมายถึงไม่เปลี่ยนค่านั้น
			//_____if (arr[1]!="!") form1.PER_TYPE.value = arr[1];
//		alert("1.2.."+(arr[0]==1?"add":(arr[0]==2?"upd":"")));
		if(arr[0]==1) {	// add
			//_____if (arr[2]!="!") form1.ORG_ID.value = arr[2];
		}else if(arr[0]==2){	// upd
//			if (arr[2]!="!") form1.ORG_ID2.value = arr[2];
			//_____if (arr[2]!="!") form1.ORG_ID.value = arr[2];
			form1.KPI_PER_TYPE.value = arr[1];
		}
		// check arr[3] for update or view for personal_master_form
//		alert("1.3..");
		if (arr[3].indexOf("UPD") > -1) {
			form1.command.value = "UPDATE";
			form1.DEPARTMENT_ID.value = arr[2];
		} else if (arr[3].indexOf("VIEW") > -1) {
			form1.command.value = "VIEW";
		} else { 
			if (arr[3]!="!") form1.command.value = "";
		}
		
		form1.SELECT_TAB_ID.value = "a"+arr[0];	// กำหนดให้แสดง tab ที่ส่งค่ามา
		form1.show_topic.value = 2;
		form1.submit();
	} // end if

	function change_div(div_id){	
			eval("document.all.DIV_TOPIC_" + eval(FName[div_id-1]).show_topic.value + ".style.display='none'");
			eval("document.all.DIV_TOPIC_" + div_id + ".style.display='block'");
	
			eval("document.all.CELL_TOPIC_" + eval(FName[div_id-1]).show_topic.value + ".className='table_body'");
			eval("document.all.CELL_TOPIC_" + div_id + ".className='table_body_3'");
			eval(FName[div_id-1]).show_topic.value = div_id;
			eval(FName[div_id-1]).submit();
		if(div_id==1){
			form0.current_page.value=1; 
			form0.submit();
		}else if(div_id==2){
			form1.page_action.value = 'add';
			form1.submit();
		}
	}

	function call_update_competence (per_type, org) {	
		refresh_opener1("2<::>"+per_type+"<::>"+org+"<::>UPD");
	}

	function confirm_delete_competence(per_type, org , data_label){
		if(confirm("คุณต้องการลบ  การประเมินสมรรถนะจำแนกตามประเภทบุคลากร และ<?=$DEPARTMENT_TITLE?> [ " + data_label + " ] ใช่หรือไม่ ?")){
			form0.command.value = "DELETE";
			form0.del_per_type.value = per_type;
			form0.del_department_id.value = org;			
			form0.submit();
		} // end if
	}
	
	function call_pdf_report() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form0.target = "_blank";
		document.form0.action = "report/rpt_kpi_per_type_competence.php?report_title=" + report_title + "&UTC" + rptDate;
		document.form0.submit();
		document.form0.target = "_self";
		document.form0.action = "kpi_per_type_competence.html";
	} 
	
	function call_export_file() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form0.target = "_blank";
		document.form0.action = "report/rpt_kpi_per_type_competence_xls.php?report_title=" + report_title + "&UTC" + rptDate;
		document.form0.submit();
		document.form0.target = "_self";
		document.form0.action = "kpi_per_type_competence.html";
	}	
	
	function call_sort(flag) {
		form0.order_by.value=flag;		form0.sort_by.value=flag;
		if(form0.sort_type.value==flag+":asc"){
			form0.sort_type.value=flag+":desc";
		}else{ //desc
			form0.sort_type.value=flag+":asc";
		}		
		form0.command.value='SEARCH';
		form0.submit();
	} // end function call_sort
	
	//---จาก kpi_per_type_competence_add.html
	function call_exit () {	
		refresh_opener("1<::>1");
	}
	
	function checkadd(f) {
		if(f.PER_TYPE[0].checked==false && f.PER_TYPE[1].checked==false) {
			alert("กรุณาระบุ ประเภทบุคลากร");
			return false;
		}else if(f.MINISTRY_ID.value=="") {
			alert("กรุณาระบุ กระทรวง");
			f.MINISTRY_NAME.focus();
			return false;
		} else if(f.DEPARTMENT_ID.value=="") {
			alert("กรุณาระบุ กรม");
			f.DEPARTMENT_NAME.focus();
			return false;
		} else if(f.CP_NAME.value=="") {
			alert("กรุณาระบุ สมรรถนะ");
			f.CP_NAME.focus();
			return false;
		} else {
			f.command.value='ADD';
			f.submit();
		return true;
		}
	}

//จาก kpi_per_type_competence_upd.html
	function call_search_competence (code, name, department_id) {	
		parameter = "&search_department_id=" + department_id;
		cp_code = eval("form1." + code);
		cp_name = eval("form1." + name);
	    call_openDialog("search_competence.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$COMPETENCE_TITLE?>");		
	}

	function confirm_delete(data_id1 , data_id2 , data_label1 , data_label2){
		if(confirm("คุณต้องการลบข้อมูลนี้ [ " + data_label1 + " : " + data_label2 + " ]  ใช่หรือไม่ ?")){
			form1.command.value = "DELETE";
			form1.PER_TYPE.value = data_id1;
			form1.CP_CODE.value = data_id2
			form1.submit();
		} // end if
	}
	
	function checkupdate(f) {
		if(f.PER_TYPE[0].checked==false && f.PER_TYPE[1].checked==false) {
			alert("กรุณาระบุ ประเภทบุคลากร");
			return false;
		} else if(f.CP_NAME.value=="") {
			alert("กรุณาระบุ สมรรถนะ");
			f.CP_NAME.focus();
			return false;
		} else if(f.MINISTRY_ID.value=="") {
			alert("กรุณาระบุ กระทรวง");
			f.MINISTRY_NAME.focus();
			return false;
		} else if(f.DEPARTMENT_ID.value=="") {
			alert("กรุณาระบุ กรม");
			f.DEPARTMENT_NAME.focus();
			return false;
		} else if(f.CP_NAME.value=="") {
			alert("กรุณาระบุ สมรรถนะ");
			f.CP_NAME.focus();
			return false;
		} else{  						
			f.command.value='UPDATE';
			f.submit();
		return true;
		}
	}

	function call_pdf_report_upd() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form1.target = "_blank";
		document.form1.action = "report/rpt_kpi_per_type_competence_upd.php?report_title=" + report_title + "&table=<?=$table?>&UTC" + rptDate;
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "kpi_per_type_competence_upd.html";
	} 
	
	function call_export_file_upd() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form1.target = "_blank";
		document.form1.action = "report/rpt_kpi_per_type_competence_upd_xls.php?report_title=" + report_title + "&table=<?=$table?>&UTC" + rptDate;
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "kpi_per_type_competence_upd.html";
	}	
	
	function clear_form() {
		form1.CP_CODE.value = "";
		form1.CP_NAME.value = "";
		form1.upd_cp_code.value = "";
	}

	function checkadd_cp(f) {
//		alert("checkadd_cp");
		if(f.PER_TYPE[0].checked==false && f.PER_TYPE[1].checked==false) {
			alert("กรุณาระบุ ประเภทบุคลากร");
			return false;
		}else if(f.MINISTRY_ID.value=="") {
			alert("กรุณาระบุ กระทรวง");
			f.MINISTRY_NAME.focus();
			return false;
		} else if(f.DEPARTMENT_ID.value=="") {
			alert("กรุณาระบุ กรม");
			f.DEPARTMENT_NAME.focus();
			return false;
		} else if(f.CP_NAME.value=="") {
			alert("กรุณาระบุ สมรรถนะ");
			f.CP_NAME.focus();
			return false;
		} else {
			f.command.value='ADD';
			f.submit();
		return true;
		}
	}

	//------//////////////
	function call_select_ministry () {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		parameter = "&send_by=select_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$MINISTRY_TITLE?>");		
	}

	function call_select_department () {	
		var MINISTRY_ID = "<?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$MINISTRY_ID":"")?>";
		if(MINISTRY_ID == "" && form1.MINISTRY_ID.value)	MINISTRY_ID = form1.MINISTRY_ID.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(MINISTRY_ID != ""){
			parameter = "&send_by=select_department&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$DEPARTMENT_TITLE?>");		
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT?>');
			form1.btn_ministry.focus();
			<? } ?>
		} // end if
	}
	
	function call_search_ministry () {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$MINISTRY_TITLE?>");		
	}

	function call_search_department () {	
		var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$search_ministry_id":"form0.search_ministry_id.value")?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(MINISTRY_ID != ""){
			parameter = "&send_by=search_department&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$DEPARTMENT_TITLE?>");		
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT?>');
			form0.btn_search_ministry.focus();
			<? } ?>
		} // end if
	} 
	
	function call_clear_search() {
		form0.search_PER_TYPE[0].checked = false;	form0.search_PER_TYPE[1].checked = false;
		form0.current_page.value = 0;
//		alert("1..form0.search_department_name.value="+form0.search_department_name.value);
		form0.search_department_name.value = "";
		form0.search_department_id.value = "";
//		alert("2..form0.search_department_name.value="+form0.search_department_name.value);
	}
	
	function gen_data(){
		if(confirm('ต้องการสร้างข้อมูลการประเมินสมรรถนะจำแนกตามประเภทบุคลากร และ<?=$DEPARTMENT_TITLE?> ใช่หรือไม่ (ข้อมูลเก่าที่มีอยู่จะถูกลบไปทั้งหมดก่อน) ???')){ 
			if(form0.search_PER_TYPE[0].checked==false && form0.search_PER_TYPE[1].checked==false) {
				alert('กรุณาระบุ ประเภทบุคลากร');
				return false; 
			}else{ 
				form0.command.value='GENDATA'; 
				return ProcessUploading(); 
			}
		}else{
			return false; 
		}
	}

	function returnFrom(src, returnValue){
//		alert("src="+src+"("+returnValue+")");
		 if  (src.indexOf("search_org") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				if (arrValue[7]=="select_ministry") {
					form1.MINISTRY_ID.value = arrValue[0];
					form1.MINISTRY_NAME.value = arrValue[1];
					form1.DEPARTMENT_ID.value = "";
					form1.DEPARTMENT_NAME.value = "";
				} else if (arrValue[7]=="select_department") {
					form1.DEPARTMENT_ID.value = arrValue[0];
					form1.DEPARTMENT_NAME.value = arrValue[1];
				} else if (arrValue[7]=="search_ministry") {
					form0.search_ministry_id.value = arrValue[0];
					form0.search_ministry_name.value = arrValue[1];
					form0.search_department_id.value = "";
					form0.search_department_name.value = "";
				} else if (arrValue[7]=="search_department") {
					form0.search_department_id.value = arrValue[0];
					form0.search_department_name.value = arrValue[1];
				}
			} // end if
		} else if  (src.indexOf("search_competence") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				cp_code.value = arrValue[0];
				cp_name.value = arrValue[1];
			} // end if
		} 		
//		$( "#d_frame" )[0].src="";
//		alert("returnValue="+tt.value);
		tt.value = returnValue;
	} // end if
	
</script>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
<? if (!$HEAD_HIDE) { ?>
	<tr>
    	<td height="10"><?include("header_menu.html")?></td>
  	</tr>
    <tr> 
	  <td align="left" valign="top">
<?	
		if ($UPD) $OPTIONAL_TITLE.=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE.=" &gt; ดูข้อมูล";
		include("current_location.html");
?>		</td>
	</tr>
<? } ?>
<tr>	<td align="left" valign="top"><table width="95%" align="center" cellpadding="0" cellspacing="0">
		<tr>	<td><table width="30%" cellpadding="1" cellspacing="1" class="input_table" style="border-style:solid;" border="0">  
		  <tr>
			<td id="CELL_TOPIC_1" nowrap="nowrap" height="22" align="center" class="<?=($show_topic==1)?"table_body_3":"table_body"?>"><span style="cursor:hand;" onClick="change_div(1);"> <?=$SEARCH_TITLE?></span></td>
			<td  id="CELL_TOPIC_2" nowrap="nowrap" height="22" align="center" class="<?=($show_topic==2)?"table_body_3":"table_body"?>"><span style="cursor:hand;"  onClick="change_div(2);"><? if($show_topic==2){ if($page_action=="add"){ echo "เพิ่ม"; }else if($page_action=="upd"){ echo "แก้ไข"; }  }else{   echo "เพิ่ม";	} ?>ข้อมูล</span></td>
			</tr> </table></td></tr>
</table></tr></td>

<tr>	<td align="left" valign="top">
<!---SEARCH DTL--->
<div id="DIV_TOPIC_1" style="display:<?=($show_topic==1)?"block":"none"?>;">  
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
  	<tr>
    	<td align="left" valign="top">
<form name="form0" method="post" action="kpi_per_type_competence.html" enctype="multipart/form-data">
          <input type="hidden" name="current_page" value="<?=$current_page?>">
          <input type="hidden" name="total_page" value="<?=$total_page?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
		  <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3?>">
          <input type="hidden" name="command" value="">
          <input type="hidden" name="table" value="<?=PER_TYPE_COMPETENCE?>">
		<input type="hidden" name="upd_per_type" value="<?=$upd_per_type?>">
		<input type="hidden" name="upd_department_id" value="<?=$upd_department_id?>">
		<input type="hidden" name="upd_cp_code" value="<?=$upd_cp_code?>">
          <input type="hidden" name="del_per_type" value="<?=$del_per_type?>">
		   <input type="hidden" name="del_cp_code" value="<?=$del_cp_code?>">
          <input type="hidden" name="del_department_id" value="<?=$del_department_id?>">
		  <input type="hidden" name="page_action" value="<?=$page_action?>"> 
		  <input type="hidden" name="show_topic" value="<?=$show_topic?>">
 <?
  	if(trim($search_PER_TYPE)) $arr_search_condition[] = "(a.PER_TYPE like '$search_PER_TYPE%')";
   	if($search_department_id){
		$arr_search_condition[] = "(a.DEPARTMENT_ID = $search_department_id)";
	}elseif($search_ministry_id){
		$cmd = " select ORG_ID from PER_ORG where ORG_ID_REF=$search_ministry_id ";
		$db_dpis->send_cmd($cmd);
		while($data = $db_dpis->get_array()) $arr_org[] = $data[ORG_ID];
		$arr_search_condition[] = "(a.DEPARTMENT_ID in (". implode(",", $arr_org) ."))";
	} // end if

	$search_condition = "";
	$search_condition_count = "";
	if(count($arr_search_condition)){
		$search_condition = " and " . implode(" and ", $arr_search_condition);
		$search_condition_count = " where " . implode(" and ", $arr_search_condition);
	}
	
	if(!$sort_by) $sort_by=1;
		$sort_type = (isset($sort_type))?  $sort_type : "1:asc";
		$arrSort=explode(":",$sort_type);
		$SortType[$arrSort[0]]	=$arrSort[1];
		if(!$order_by) $order_by=1;
		
		if($order_by==1){	//(ค่าเริ่มต้น) 
		$order_str = "a.PER_TYPE ".$SortType[$order_by];
		}elseif($order_by==2) {	
		$order_str = "a.DEPARTMENT_ID ".$SortType[$order_by];
	}

	$cmd = "	select 	a.PER_TYPE, a.DEPARTMENT_ID
					from 	PER_TYPE_COMPETENCE a, PER_COMPETENCE c  
					where 	a.PER_TYPE=$search_PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
							$search_condition 
					group by 	a.DEPARTMENT_ID, a.PER_TYPE
					order by 	$order_str ";
	$db_dpis->send_cmd($cmd);
//	$db_dpis->show_error();
	$data = array_change_key_case($data, CASE_LOWER);
	$count_data = $db_dpis->num_rows();
/*
	$cmd = "	select 	a.CP_CODE
					from 		PER_TYPE_COMPETENCE a, PER_COMPETENCE c  
					where 	a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
							$search_condition 
					order by 	$order_str ";
	$count_data = $db_dpis->send_cmd($cmd);
	*/
  ?>
    <table width="95%" align="center"  border="0" cellspacing="0" cellpadding="0">
        <tr><td align="center" class="input_table"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
        <tr>
            <td width="15%" align="right"><?=$MINISTRY_TITLE?>&nbsp;:&nbsp;</td>
			<td width="35%">
                <input type="text" name="search_ministry_name" value="<?=$search_ministry_name?>" style="width:80%" class="textbox" readonly>
                <input type="hidden" name="search_ministry_id" value="<?=$search_ministry_id?>">
                <? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
                    <input type="button" name="btn_search_ministry" class="button" value="<?=$SELECT_TITLE?>" title="<?=$MINISTRY_SELECT?>" onClick="call_search_ministry();">
             <input name="image" type="image" onClick="form0.search_ministry_id.value=''; form0.search_ministry_name.value=''; form0.search_department_id.value=''; form0.search_department_name.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
                <? } // end if ?>				</td>
                <td width="15%" align="right"><?=$DEPARTMENT_TITLE?>&nbsp;:&nbsp;</td>
				<td width="35%">
                <input type="text" name="search_department_name" value="<?=$search_department_name?>" style="width:80%" class="textbox" readonly>
                <input type="hidden" name="search_department_id" value="<?=$search_department_id?>">
                <? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
                    <input type="button" name="btn_search_department" class="button" value="<?=$SELECT_TITLE?>" title="<?=$DEPARTMENT_SELECT?>" onClick="call_search_department();">
                    <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form0.search_department_name.value=''; form0.search_department_id.value=''; return false;" align="center" alt="ล้างค่า">
                <? } // end if ?>				</td>
				</tr>
				<tr>
                <td width="15%" align="right"><?=$PER_TYPE_TITLE;?>&nbsp;:&nbsp;</td>
				<td width="35%">
						<input name="search_PER_TYPE" type="radio" value="1" <? if($search_PER_TYPE=='1')  { ?> checked  <? } ?> >&nbsp;ข้าราชการ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<?  if($ISCS_FLAG != 1 && $BKK_FLAG != 1){ ?>
						<input name="search_PER_TYPE" type="radio" value="3" <? if($search_PER_TYPE=='3')  { ?> checked  <? } ?> >&nbsp;พนักงานราชการ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;								
			<? } ?>            </td>
          <td align="right"><input type="checkbox" name="COMPETENCE_FLAG" value="1">&nbsp;</td>
          <td>สร้างสมรรถนะประจำสายงาน </td>
        </tr>
        <tr>
            <td width="20%" align="center" colspan="4">
                    <? if ($BUTTON_DISPLAY==1) { ?>
                        <input name="btn2" type="submit" class="button" value="<?=$SEARCH_TITLE?>" onClick="javascript:form0.current_page.value=0; ">
                        <input name="btn3" type="submit" class="button" value="<?=$SHOW_ALL_TITLE?>" onClick="javascript:call_clear_search();">
                    <? } else { ?>
                        <input name="image2" type="image" onClick="javascript:form0.current_page.value=0;" src="images/search.png" alt="<?=$SEARCH_TITLE?>">
                        <input name="image2" type="image" onClick="javascript:call_clear_search();">
                    <? } ?>
                    <input name="Submit22" type="submit" class="button" onClick="return gen_data();" value="สร้างข้อมูลการประเมินสมรรถนะจำแนกตามประเภทบุคลากร และ<?=$DEPARTMENT_TITLE?> (ลบแล้วสร้างใหม่)" style="width:350">            </td></tr>
        </table>
        </td></tr>
    </table>
	
<tr><td align="left" valign="top">
		<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
		<tr><td><input type="hidden" name="order_by" value="<?=$order_by?>">
			<input type="hidden" name="sort_by" value="<?=$sort_by;?>">
			<input type="hidden" name="sort_type" value="<?=$sort_type?>"><?=$SORT_TITLE?></td></tr>
		</table>
		<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_body_3">
				<tr>
					  <td width="15%" height="22"><? if($PAGE_AUTH["print"]=="Y"){ ?>
						<? if ($BUTTON_DISPLAY==1) { ?>
						<input name="btn_report" type="button" class="button" style="width:150" value="<?=$PDF_TITLE?>" onClick="call_pdf_report();">
						<?  } else { ?>
						<img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE?>" onClick="call_pdf_report();">
						<? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
					  <td align="center">พบข้อมูล<?=$MENU_TITLE_LV1?>ทั้งสิ้น <?=($count_data + 0)?> รายการ</td>
					  <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y"){ ?>
						<? if ($BUTTON_DISPLAY==1) { ?>
						<input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
						<?  } else { ?>
						<img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
						<? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
				</tr>
		</table> 
<?
  	$total_page = ceil( $count_data / $data_per_page );
	$page_link = create_link_page_data($total_page, $current_page,'form0');   
	$limit_data = "";
	
//	if($current_page > 1){
		if($DPISDB=="mysql"){
			$limit_data = " limit " . (($current_page - 1) * $data_per_page) . ", " . $data_per_page;
		}
//	} // end if

	if($DPISDB=="odbc"){
		$select_top = ($current_page==$total_page)?($count_data - ($data_per_page * ($current_page - 1))):$data_per_page;
		$cmd = "	select	*
						from	(					
							select	top $select_top *
							from	(
									select	top ". ($data_per_page * $current_page) ."
												a.PER_TYPE, count(a.CP_CODE) as cnt, a.DEPARTMENT_ID
									from	PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
									where 	a.CP_CODE=c.CP_CODE and a.DEPARTMENT_ID=c.DEPARTMENT_ID
											$search_condition 
									group by 	a.PER_TYPE, a.DEPARTMENT_ID
									order by $order_str
									)
							order by $order_str
							)
					order by $order_str ";
	}elseif($DPISDB=="oci8"){
		$rec_start = (($current_page-1) * $data_per_page) + 1;
		$rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
		$cmd = "select * from (
						   select rownum rnum, q1.* from ( 
								  select 	a.PER_TYPE, count(a.CP_CODE) as cnt, a.DEPARTMENT_ID
								  from 		PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
								  where 	a.CP_CODE=c.CP_CODE and a.DEPARTMENT_ID=c.DEPARTMENT_ID
											$search_condition 
								  group by 	a.PER_TYPE, a.DEPARTMENT_ID
								  order by 	$order_str
						   )  q1
					) where rnum between $rec_start and $rec_end  ";						   
	}elseif($DPISDB=="mysql"){
		$cmd = "	select 	a.PER_TYPE, count(a.CP_CODE) as cnt, a.DEPARTMENT_ID
						from 	PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
						where 	a.CP_CODE=c.CP_CODE and a.DEPARTMENT_ID=c.DEPARTMENT_ID
								$search_condition 
						group by 	a.PER_TYPE, a.DEPARTMENT_ID
						order by 	$order_str
					$limit_data ";
	} // end if
	
//	echo "====> ".$cmd;
	$count_page_data = $db_dpis->send_cmd($cmd);
//	$db_dpis->show_error();
	if ($count_page_data) {
		$current_list = "";
		$data_count = $data_num = 0;
		$data_num = ($current_page - 1) * $data_per_page;
	}
	
	$arr_cp_model = (array) null;
	$cmd1 = " select distinct CP_MODEL from PER_COMPETENCE order by CP_MODEL ";
	$db_dpis2->send_cmd($cmd1);
//	$db_dpis2->show_error();
	while ($data2 = $db_dpis2->get_array()) {
		$temp_CP_MODEL = $data2[CP_MODEL];
		$ST_CP_MODEL="";
		if($temp_CP_MODEL==1) $ST_CP_MODEL = "หลัก";
		elseif($temp_CP_MODEL==2) $ST_CP_MODEL = "ผู้บริหาร";
		elseif($temp_CP_MODEL==3) $ST_CP_MODEL = "ประจำสายงาน";
		$arr_cp_model[$temp_CP_MODEL] = $ST_CP_MODEL;
	} // end loop while data2
	
	$arr_content = (array) null;
	$data_count = 0;
	while ($data = $db_dpis->get_array()) {
		$temp_PER_TYPE = $data[PER_TYPE];
		$temp_DEPARTMENT_ID = $data[DEPARTMENT_ID];
		$arr_content[$data_count][per_type] = $temp_PER_TYPE;
		if($temp_PER_TYPE==1)	$temp_PER_TYPE_NAME= "ข้าราชการ";
		else if($temp_PER_TYPE==3)	$temp_PER_TYPE_NAME= "พนักงานราชการ";
		$arr_content[$data_count][code] = $data[cnt];
		$arr_content[$data_count][name] = $temp_PER_TYPE_NAME;
		$arr_content[$data_count][department_id] = $temp_DEPARTMENT_ID;
		
		$cmd = "	select 	c.CP_MODEL, count(c.CP_MODEL) as CNT
						from 	PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
						where 	a.PER_TYPE='$temp_PER_TYPE' and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$temp_DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
						group by 	c.CP_MODEL
						order by 	c.CP_MODEL ";
		$db_dpis2->send_cmd($cmd);
//		$db_dpis2->show_error();
//		echo "$cmd<br>";
		while ($data2 = $db_dpis2->get_array()) {
			$temp_CP_MODEL = $data2[CP_MODEL];
			$arr_content[$data_count][$temp_CP_MODEL][1] = $data2[CNT];
		} // end loop while data2
		$cmd = "	select 	c.CP_MODEL, count(c.CP_MODEL) as CNT
						from 	PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
						where 	a.PER_TYPE='$temp_PER_TYPE' and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$temp_DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
						group by 	c.CP_MODEL
						order by 	c.CP_MODEL ";
		$db_dpis2->send_cmd($cmd);
//		$db_dpis2->show_error();
//		echo "$cmd<br>";
		while ($data2 = $db_dpis2->get_array()) {
			$temp_CP_MODEL = $data2[CP_MODEL];
			$arr_content[$data_count][$temp_CP_MODEL][0] = $data2[CNT];
//			echo "arr_content[$data_count][$temp_CP_MODEL][0] = ".$data2[CNT]."<br>";
		} // end loop while data2
		$data_count++;
	} // end loop while data
if($count_data){
?>
<table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
  <tr align="center" class="table_head">
    <td width="5%"><?=$SEQ_NO_TITLE;?></td>
    <td width="10%" height="22" onClick="call_sort(1);"><? if($order_by==1&&$sort_by==1){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        <strong>
          <?=$PER_TYPE_TITLE;?>
        </strong></td>
    <?
		$cnt_cp_model = count($arr_cp_model);
		$w_cnt_cp_model = floor(47 / $cnt_cp_model);
        if ($w_cnt_cp_model > 10) {
        	$w_name = 30 + (47 - $cnt_cp_model * 10);	// เพิ่มส่วนที่เกินจาก 10 ไปให้กับ column ชื่อ
		} else {
        	$w_name = 30;
        }
    	if($SESS_USERGROUP_LEVEL==1 || $SESS_USERGROUP_LEVEL==2){ ?>
    <td width="<?=$w_name?>%" onClick="call_sort(2);"><? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        <strong>
          <?=$MINISTRY_TITLE?>
        </strong></td>
    <? } ?>
    <? if($SESS_USERGROUP_LEVEL==1 || $SESS_USERGROUP_LEVEL==2 || $SESS_USERGROUP_LEVEL==3){ ?>
    <td width="<?=$w_name?>%" onClick="call_sort(2);"><? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        <strong>
          <?=$DEPARTMENT_TITLE?>
        </strong></td>
    <? }elseif($SESS_USERGROUP_LEVEL==3){ ?>
    <td width="<?=$w_name?>%" onClick="call_sort(2);"><? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        <strong>
          <?=$DEPARTMENT_TITLE?>
        </strong></td>
    <? } ?>
    <? $cnt_cp_model=3; /*Release 5.2.1.2 fix ลำดับไว้ตาม โมเดล*/
		for ($cp_model_i = 1; $cp_model_i < $cnt_cp_model+1; $cp_model_i++) { ?>
    <td><strong>สมรรถนะ<br>
          <?=$arr_cp_model[$cp_model_i]?>
    </strong></td>
    <? }
      	if($PAGE_AUTH["edit"]=="Y"){?>
    <td width="4%"><?=$EDIT_TITLE;?></td>
    <?}?>
    <?if($PAGE_AUTH["del"]=="Y"){?>
    <td width="4%"><?=$DEL_TITLE?></td>
    <?}?>
  </tr>
  <?
		for ($data_count = 0; $data_count < count($arr_content); $data_count++) {
			$data_num++;
			$temp_primary = $temp_PER_TYPE;
			$current_list .= ((trim($current_list))?", ":"") . "'" . $temp_primary ."'";
			$class = "table_body";
			$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
			$temp_PER_TYPE = $arr_content[$data_count][per_type];
			$temp_PER_NAME = $arr_content[$data_count][name];
			$temp_CP_CODE = $arr_content[$data_count][code];
			$temp_DEPARTMENT_ID = $arr_content[$data_count][department_id];

			$cmd = " select ORG_NAME, ORG_ID_REF from PER_ORG where ORG_ID=$temp_DEPARTMENT_ID ";
			$db_dpis2->send_cmd($cmd);
			$data_dpis2 = $db_dpis2->get_array();
			$temp_DEPARTMENT_NAME = $data_dpis2[ORG_NAME];
			$ORG_ID_REF = $data_dpis2[ORG_ID_REF];

			$cmd = " select ORG_NAME from PER_ORG where ORG_ID=$ORG_ID_REF ";
			$db_dpis2->send_cmd($cmd);
			$data_dpis2 = $db_dpis2->get_array();
			$temp_MINISTRY_NAME = $data_dpis2[ORG_NAME];
	?>
  <tr class="<?=$class?>" <?=$onmouse_event?>>
    <td align="center"><?=$data_num?></td>
    <td>&nbsp;
        <?=$temp_PER_NAME?></td>
    <? if($SESS_USERGROUP_LEVEL==1 || $SESS_USERGROUP_LEVEL==2){ ?>
    <td>&nbsp;
        <?=$temp_MINISTRY_NAME?></td>
    <? } ?>
    <? if($SESS_USERGROUP_LEVEL==1 || $SESS_USERGROUP_LEVEL==2 || $SESS_USERGROUP_LEVEL==3){ ?>
    <td>&nbsp;
        <?=$temp_DEPARTMENT_NAME?></td>
    <? } ?>
    <? $max_cp_model=3; /*Release 5.2.1.2 fix code Model*/
		//for($ii = 1; $ii < count($arr_cp_model)+1; $ii++) { /*เดิม*/
                for($ii = 1; $ii < $max_cp_model+1; $ii++) {
			$val1 = $arr_content[$data_count][$ii][1];
			$cp_count = (!$val1 && !$val0 ? "" : (!$val1 ? "0" : $val1));
	?>
    <td align="center">&nbsp;
        <?=$cp_count?></td>
    <?
		} // end loop for CP_MODEL
		if($PAGE_AUTH["edit"]=="Y"){ ?>
    <td align="center">&nbsp;<a href="<?=("javascript:call_update_competence ('$temp_PER_TYPE', $temp_DEPARTMENT_ID);")?>"><img src="images/b_edit.png" border="0" alt="แก้ไขข้อมูล"></a>
        <!--$temp_PER_TYPE ที่ขึ้นต้นด้วย 0 มันจะไม่ส่งค่าไป ต้องใส่ '' ---></td>
    <?}?>
    <?if($PAGE_AUTH["del"]=="Y"){?>
    <td align="center" width="3%">&nbsp;<a href="<?=("javascript:confirm_delete_competence('$temp_PER_TYPE',$temp_DEPARTMENT_ID, '$temp_PER_NAME $temp_DEPARTMENT_NAME')")?>"><img src="images/b_drop.png" border="0" alt="<?=$DEL_TITLE.$menu_lv3_label;?>"></a></td>
    <?}?>
  </tr>
  <? } ?>
  <!-- end loop $data_count -->
  <tr class="table_footer">
    <td>&nbsp;</td>
    <td>&nbsp;</td>
    <? if($SESS_USERGROUP_LEVEL==1 || $SESS_USERGROUP_LEVEL==2){ ?>
    <td>&nbsp;</td>
    <? } ?>
    <? if($SESS_USERGROUP_LEVEL==1 || $SESS_USERGROUP_LEVEL==2 || $SESS_USERGROUP_LEVEL==3){ ?>
    <td>&nbsp;</td>
    <? } ?>
    <? for ($cp_model_i = 1; $cp_model_i < $cnt_cp_model+1; $cp_model_i++) { ?>
    <td>&nbsp;</td>
    <? } ?>
    <?if($PAGE_AUTH["edit"]=="Y"){?>
    <td>&nbsp;</td>
    <?}?>
    <?if($PAGE_AUTH["del"]=="Y"){?>
    <td>&nbsp;</td>
    <?}?>
  </tr>
</table>
<? if($total_page > 1) : ?>
<table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td><?=$page_link;?></td>
    </tr>
  </table>
  <? endif; ?>
  <? } // end if($count_data)
  ?>
</td></tr>
 <input type="hidden" name="current_list" value="<?=$current_list?>">
</form>
</table>
</div>
</tr></td>

<tr>	<td align="left" valign="top">
<!---ADD DTL--->
<div id="DIV_TOPIC_2" style="display:<?=($show_topic==2)?"block":"none"?>;">  
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
  	<tr>
    	<td align="left" valign="top">
<form name="form1" method="post" action="kpi_per_type_competence.html" enctype="multipart/form-data">
	<input type="hidden" name="current_page" value="<?=$current_page?>">
	<input type="hidden" name="total_page" value="<?=$total_page?>">
	<input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
	<input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
	<input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
	<input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3?>">
	<input type="hidden" name="command" value="<?=$command;?>">
	<input type="hidden" name="table" value="PER_TYPE_COMPETENCE">
	<input type="hidden" name="upd_per_type" value="<?=$upd_per_type?>">
	<input type="hidden" name="upd_department_id" value="<?=$upd_department_id?>">
	<input type="hidden" name="upd_cp_code" value="<?=$upd_cp_code?>">		  		  
	<input type="hidden" name="SELECT_TAB_ID" value="<?=$SELECT_TAB_ID?>">
	<input type="hidden" name="command_for" value="<?=$command_for?>">
	<input type="hidden" name="show_topic" value="<?=$show_topic?>">
	<input type="hidden" name="page_action" value="<?=$page_action?>"> 
	
	<input type="hidden" name="KPI_PER_TYPE" value="<?=$KPI_PER_TYPE?>"> 
<? if($page_action=="add"){ ?>
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
        <tr>
          <td height="22" align="center"><table width="95%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                      <tr>
                        <td align="right"><span class="label_alert">*</span><?=$PER_TYPE_TITLE?>&nbsp;:&nbsp;</td>
          <td width="72%">
						<input name="PER_TYPE" type="radio" value="1" <? if($PER_TYPE=='1')  { ?> checked  <? } ?> >&nbsp;ข้าราชการ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<?  if($ISCS_FLAG != 1 && $BKK_FLAG != 1){ ?>
						<input name="PER_TYPE" type="radio" value="3" <? if($PER_TYPE=='3')  { ?> checked  <? } ?> >&nbsp;พนักงานราชการ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;								
			<? } ?>
           </td>
        </tr>
       
        <tr>
			<td align="right" height="22"><span class="label_alert">*</span>&nbsp;<?=$MINISTRY_TITLE?>&nbsp;:&nbsp;</td>
			<td>
			<input type="text" name="MINISTRY_NAME" value="<?=$MINISTRY_NAME?>" style="width:80%" class="textbox" readonly><input type="hidden" name="MINISTRY_ID" value="<?=$MINISTRY_ID?>">
			<? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3 && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW){ ?>&nbsp;<input type="button" name="btn_ministry" class="button" value="<?=$SELECT_TITLE?>" title="<?=$MINISTRY_SELECT?>" onClick="call_select_ministry();"><? } // end if ?></td>
        </tr>
        <tr>
			<td align="right"><span class="label_alert">*</span>&nbsp;<?=$DEPARTMENT_TITLE?>&nbsp;:&nbsp;</td>
			<td>
			<input type="text" name="DEPARTMENT_NAME" value="<?=$DEPARTMENT_NAME?>" style="width:80%" class="textbox" readonly><input type="hidden" name="DEPARTMENT_ID" value="<?=$DEPARTMENT_ID?>">
			<? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4 && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW){ ?>&nbsp;<input type="button" name="btn_department" class="button" value="<?=$SELECT_TITLE?>" title="<?=$DEPARTMENT_SELECT?>" onClick="call_select_department();">			
            <? } // end if ?></td>
     </tr>
        <tr>
          <td width="28%" align="right"><span class="label_alert">*</span>&nbsp;<?=$COMPETENCE_TITLE?>&nbsp;:&nbsp;</td>
          <td width="72%"><input type="text" name="CP_NAME" value="<?=$CP_NAME?>" style="width:40%" class="textbox" readonly>&nbsp;&nbsp;
		  		<input type="hidden" name="CP_CODE" value="<?=$CP_CODE?>"> 
				<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
				<input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกสมรรถนะ" onClick="call_search_competence('CP_CODE', 'CP_NAME','DEPARTMENT_ID');">
				<? endif; ?>				
		  </td>
        </tr>
        <tr><td>&nbsp;&nbsp;</td><td>&nbsp;&nbsp;</td></tr>
        <tr align="center">
          <td height="25" colspan="2">
		  <? if ($UPD) { ?>
      		  <?if($PAGE_AUTH["edit"]=="Y"){?> 
			  <? if ($BUTTON_DISPLAY==1) { ?>
      		  <input name="submit3" type="button" class="button" onClick="checkupdate(form1);" value="<?=$EDIT_TITLE?>">
      		  <? } else { ?>
              <input name="image3" type="image" onClick="checkupdate(form1);" src="images/save.png" alt="<?=$EDIT_TITLE?>" border="0">
              <?}?>
      		  <?}?> 
              <? if ($BUTTON_DISPLAY==1) { ?>
              <input type="submit" name="reset4" value="<?=$CANCEL_TITLE?>" onClick="form1.command.value='CANCEL'" class="button" >
              <? } else { ?>
              <input name="image4" type="image" onClick="form1.command.value='CANCEL'" src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>" border="0">
              <?}?>
      		  <? } else { ?> 
	  		  <?if($PAGE_AUTH["add"]=="Y"){?> 
			  <? if ($BUTTON_DISPLAY==1) { ?>
	  		  <input name="submit5" type="button" class="button" onClick="checkadd_cp(form1);" value="<?=$ADD_TITLE?>">
	  		  <? } else { ?>
              <input name="image5" type="image" onClick="checkadd_cp(form1);" src="images/save.png" alt="<?=$ADD_TITLE?>" border="0">
              <?}?>
	  		  <?}?> 
			  <? 	if ($BUTTON_DISPLAY==1) { ?>
      		  <input name="reset6" type="button" class="button" value="<?=$CLEAR_TITLE?>" onClick="clear_form();">
      		  <? } else { ?>
              <img src="images/default.jpg" alt="<?=$CLEAR_TITLE?>" width="32" height="32" border="0" onClick="form1.reset();">&nbsp;
              <?}?> 
              <?}?>
			  </td>
				</tr>
                    </table></td>
        </tr>
      </table></td>
    </tr>
  </table>
<tr><td align="left" valign="top">
		<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
		<tr><td><input type="hidden" name="order_by" value="<?=$order_by?>">
			<input type="hidden" name="sort_by" value="<?=$sort_by;?>">
			<input type="hidden" name="sort_type" value="<?=$sort_type?>"><?=$SORT_TITLE?></td></tr>
		</table>
		<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_body_3">
				<tr>
					  <td width="15%" height="22"><? if($PAGE_AUTH["print"]=="Y"){ ?>
						<? if ($BUTTON_DISPLAY==1) { ?>
						<input name="btn_report" type="button" class="button" style="width:150" value="<?=$PDF_TITLE?>" onClick="call_pdf_report_upd();">
						<?  } else { ?>
						<img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE?>" onClick="call_pdf_report_upd();">
						<? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
					  <td align="center">พบข้อมูล<?=$MENU_TITLE_LV1?>ทั้งสิ้น <?=($count_data + 0)?> รายการ</td>
					  <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y"){ ?>
						<? if ($BUTTON_DISPLAY==1) { ?>
						<input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE?>" onClick="call_export_file_upd();">
						<?  } else { ?>
						<img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE?>" onClick="call_export_file_upd();">
						<? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
				</tr>
		</table> 
<?
  	$total_page = ceil( $count_data / $data_per_page );
	$page_link = create_link_page_data($total_page, $current_page,'form0');   
	$limit_data = "";
	
//	if($current_page > 1){
		if($DPISDB=="mysql"){
			$limit_data = " limit " . (($current_page - 1) * $data_per_page) . ", " . $data_per_page;
		}
//	} // end if

	if($DPISDB=="odbc"){
		$cmd = "	select	a.PER_TYPE, a.CP_CODE, CP_NAME
						from	PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
						where 	a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$DEPARTMENT_ID and a.CP_CODE=c.CP_CODE 
									$search_condition 
						order by a.PER_TYPE, a.CP_CODE ";
	}elseif($DPISDB=="oci8"){
		$cmd = "  select 		a.PER_TYPE, a.CP_CODE, CP_NAME 
						  from 		PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
						  where 	a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
										$search_condition 
						  order by 	a.PER_TYPE, a.CP_CODE ";
	}elseif($DPISDB=="mysql"){
		$cmd = "	select 		a.PER_TYPE, a.CP_CODE, CP_NAME 
						from 		PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
						where 		a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
										$search_condition 
						order by 	a.PER_TYPE, a.CP_CODE ";
	} // end if
//	echo "add cmd=$cmd<br>";				
	$count_page_data = $db_dpis->send_cmd($cmd);
//	$db_dpis->show_error();
//	echo "$CP_CODE -> $cmd";
	$data_count = $data_num = 0;
?>
<table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
   <tr align="center" class="table_head">
	  <td width="8%"><?=$SEQ_NO_TITLE?></td>
      <td width="60%" height="22"><strong><?=$COMPETENCE_TITLE?></strong></td>
      <?if($PAGE_AUTH["edit"]=="Y"){?>
      <td width="5%"><?=$EDIT_TITLE?></td>
      <?}?>
      <?if($PAGE_AUTH["del"]=="Y"){?>
      <td width="5%"><?=$DEL_TITLE?></td>
      <?}?>
      <!--<td width="10%"><strong><?=$ACTIVE_TITLE?></strong></td>-->
	 </tr>
<?
	while ($data = $db_dpis->get_array()) {
		$data_count++;
		$data_num++;
		if($data_count > $data_per_page) break;
		$TMP_PER_TYPE = $data[PER_TYPE];
		$temp_cp_code = $data[CP_CODE];	
		$temp_primary = $TMP_PER_TYPE ."||". $temp_cp_code;
		$current_list .= ((trim($current_list))?", ":"") . "'" . $temp_primary ."'";
		$temp_department_id = $data[DEPARTMENT_ID];
		$TMP_CP_NAME = $data[CP_NAME];		

		$class = "table_body";
		$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
		if($PER_TYPE ."||". $CP_CODE==$temp_primary){ 
			$class = "table_body_over";
			$onmouse_event = "";
		}
?>
    <tr class="<?=$class?>" <?=$onmouse_event?>>
	  <td align="center"><?=$data_num?></td>
      <td>&nbsp;<?=$TMP_CP_NAME?></td>
	  <?if($PAGE_AUTH["edit"]=="Y"){?>
      <td align="center">&nbsp;<a href="<?=("javascript:form1.action+='?UPD=1';form1.PER_TYPE.value='".$TMP_PER_TYPE."';form1.CP_CODE.value='".$temp_cp_code."';form1.command.value='';form1.submit();")?>"><img src="images/b_edit.png" border="0" alt="แก้ไขข้อมูล"></a></td>
	  <?}?>
	  <?if($PAGE_AUTH["del"]=="Y"){?>
      <td align="center">&nbsp;<a href="<?=("javascript:confirm_delete('".$TMP_PER_TYPE."','".$temp_cp_code."','".$temp_cp_code."','".$TMP_CP_NAME."');")?>"><img src="images/b_drop.png" border="0" alt="ลบข้อมูล"></a></td>
	  <?}?>
    </tr>
<? } // end while ?>
  </table> 
<? } //end page_action add ?>		
<?  if($page_action=="upd"){ // แก้ไข ?>
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
        <tr>
          <td height="22" align="center"><table width="95%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                      <tr>
                        <td align="right"><span class="label_alert">*</span><?=$PER_TYPE_TITLE?>&nbsp;:&nbsp;</td>
          <td width="72%">
						<input name="PER_TYPE" type="radio" value="1" <? if($PER_TYPE=='1')  { ?> checked  <? } ?> >&nbsp;ข้าราชการ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
			<?  if($ISCS_FLAG != 1 && $BKK_FLAG != 1){ ?>
						<input name="PER_TYPE" type="radio" value="3" <? if($PER_TYPE=='3')  { ?> checked  <? } ?> >&nbsp;พนักงานราชการ&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;								
			<? } ?>
           </td>
        </tr>
		<!---
		<tr>
                        <td align="right"><span class="label_alert">*</span>&nbsp;<?=$PL_TITLE?>&nbsp;:&nbsp;</td>
				<td width="72%"><input type="text" name="PL_NAME" value="<?=$PL_NAME?>" style="width:40%" class="textbox" readonly>&nbsp;&nbsp;
				<input type="hidden" name="PL_CODE" value="<?=$PL_CODE?>"></td>
        </tr>
        --->
		<tr>
			<td align="right" height="22"><span class="label_alert">*</span>&nbsp;<?=$MINISTRY_TITLE?>&nbsp;:&nbsp;</td>
			<td>
			<input type="text" name="MINISTRY_NAME" value="<?=$MINISTRY_NAME?>" style="width:80%" class="textbox" readonly>&nbsp;&nbsp;
			<input type="hidden" name="MINISTRY_ID" value="<?=$MINISTRY_ID?>"></td>
        </tr>
       
        <tr>
			<td align="right"><span class="label_alert">*</span>&nbsp;<?=$DEPARTMENT_TITLE?>&nbsp;:&nbsp;</td>
			<td>
			<input type="text" name="DEPARTMENT_NAME" value="<?=$DEPARTMENT_NAME?>" style="width:80%" class="textbox" readonly>&nbsp;&nbsp;
			<input type="hidden" name="DEPARTMENT_ID" value="<?=$DEPARTMENT_ID?>"></td>
      </tr>
        <tr>
          <td width="28%" align="right"><span class="label_alert">*</span>&nbsp;<?=$COMPETENCE_TITLE?>&nbsp;:&nbsp;</td>
          <td width="72%"><input type="text" name="CP_NAME" value="<?=$CP_NAME?>" style="width:40%" class="textbox" readonly>&nbsp;&nbsp;
		  		<input type="hidden" name="CP_CODE" value="<?=$CP_CODE?>"> 
				<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
				<input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกสมรรถนะ" onClick="call_search_competence('CP_CODE', 'CP_NAME','DEPARTMENT_ID');">
				<? endif; ?>				
		  </td>
        </tr>
        <tr align="center">
          <td height="25" colspan="2">
		  <? if ($UPD) { ?>
      		  <?if($PAGE_AUTH["edit"]=="Y"){?> 
			  <? if ($BUTTON_DISPLAY==1) { ?>
      		  <input name="Submit22" type="button" class="button" onClick="checkupdate(form1);" value="<?=$EDIT_TITLE?>">
      		  <? } else { ?>
              <input name="image2" type="image" onClick="checkupdate(form1);" src="images/save.png" alt="<?=$EDIT_TITLE?>" border="0">
              <?}?>
      		  <?}?> 
              <? if ($BUTTON_DISPLAY==1) { ?>
              <input type="submit" name="Reset2" value="<?=$CANCEL_TITLE?>" onClick="form1.command.value='CANCEL'" class="button" >
              <? } else { ?>
              <input name="image" type="image" onClick="form1.command.value='CANCEL'" src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>" border="0">
              <?}?>
      		  <? } else { ?> 
	  		  <?if($PAGE_AUTH["add"]=="Y"){?> 
			  <? if ($BUTTON_DISPLAY==1) { ?>
	  		  <input name="Submit2" type="button" class="button" onClick="checkadd_cp(form1);" value="<?=$ADD_TITLE?>">
	  		  <? } else { ?>
              <input name="image3" type="image" onClick="checkadd_cp(form1);" src="images/save.png" alt="<?=$ADD_TITLE?>" border="0">
              <?}?>
	  		  <?}?> 
			  <? 	if ($BUTTON_DISPLAY==1) { ?>
      		  <input name="Reset1" type="button" class="button" value="<?=$CLEAR_TITLE?>" onClick="clear_form();">
      		  <? } else { ?>
              <img src="images/default.jpg" alt="<?=$CLEAR_TITLE?>" width="32" height="32" border="0" onClick="form1.reset();">&nbsp;
              <?}?> 
              <?}?></td>
        </tr>
      </table></td>
    </tr>
  </table>
<?
  	if(trim($search_PER_TYPE)) $arr_search_condition[] = "(a.PER_TYPE like '$search_PER_TYPE%')";
  	if(trim($search_DEPARTMENT_ID)) $arr_search_condition[] = "(a.DEPARTMENT_ID like '$search_DEPARTMENT_ID%')";
  	if(trim($search_cp_code)) $arr_search_condition[] = "(a.CP_CODE like '%$search_cp_code%')";
	$search_condition = "";
	$search_condition_count = "";
	if(count($arr_search_condition)){
		$search_condition = " and " . implode(" and ", $arr_search_condition);
		$search_condition_count = " where " . implode(" and ", $arr_search_condition);
	}
	
	$cmd="	select 		count(a.PER_TYPE) as count_data
					from 		PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
					where 		a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
								$search_condition 
					order by 	a.PER_TYPE, a.CP_CODE 
					$limit_data ";
	$db_dpis->send_cmd($cmd);
//	$db_dpis->show_error();
	$data = $db_dpis->get_array();
	$data = array_change_key_case($data, CASE_LOWER);
	$count_data = $data[count_data];	
 ?>
 <table width="95%" align="center" cellpadding="0" cellspacing="0">
		<tr>
		  <td><table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
            <tr>
              <td width="15%" height="22"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_report" type="button" class="button" style="width:150" value="<?=$PDF_TITLE?>" onClick="call_pdf_report();">
                <?  } else { ?>
                <img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE?>" onClick="call_pdf_report();">
                <? } ?>
                <? }else{ echo "&nbsp;"; } ?></td>
              <td align="center">พบข้อมูล<?=$MENU_TITLE_LV1?>ทั้งสิ้น <?=($count_data + 0)?> รายการ</td>
              <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
                <?  } else { ?>
                <img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
                <? } ?>
                <? }else{ echo "&nbsp;"; } ?></td>
            </tr>
          </table></td></tr>
  </table>  
  <?
	$total_page = ceil( $count_data / $data_per_page );
	$page_link_upd = create_link_page_data($total_page, $current_page,'form1');
	$limit_data = "";
	
//	if($current_page > 1){
		if($DPISDB=="mysql"){
			$limit_data = " limit " . (($current_page - 1) * $data_per_page) . ", " . $data_per_page;
		}
//	} // end if

	if($DPISDB=="odbc"){
		$select_top = ($current_page==$total_page)?($count_data - ($data_per_page * ($current_page - 1))):$data_per_page;
		$cmd = "	select	*
					from	(					
							select	top $select_top *
							from	(
									select	top ". ($data_per_page * $current_page) ."
											a.PER_TYPE, a.CP_CODE, CP_NAME, a.DEPARTMENT_ID
									from	PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
									where 	a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$DEPARTMENT_ID and	a.CP_CODE=c.CP_CODE
											$search_condition 
									order by a.PER_TYPE, a.CP_CODE
									)
							order by a.PER_TYPE desc, a.CP_CODE desc
							)
					order by a.PER_TYPE, a.CP_CODE ";
	}elseif($DPISDB=="oci8"){
		$rec_start = (($current_page-1) * $data_per_page) + 1;
		$rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
		$cmd = "select * from (
						   select rownum rnum, q1.* from ( 
								  select 		a.PER_TYPE, a.CP_CODE, CP_NAME, a.DEPARTMENT_ID 
								  from 		PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
								  where 	a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$DEPARTMENT_ID and	a.CP_CODE=c.CP_CODE
											$search_condition 
								  order by 	a.PER_TYPE, a.CP_CODE
						   )  q1
					) where rnum between $rec_start and $rec_end  ";						   
	}elseif($DPISDB=="mysql"){
		$cmd = "	select 		a.PER_TYPE, a.CP_CODE, CP_NAME, a.DEPARTMENT_ID
					from 		PER_TYPE_COMPETENCE a, PER_COMPETENCE c 
					where 		a.PER_TYPE=$PER_TYPE and a.DEPARTMENT_ID=c.DEPARTMENT_ID and a.DEPARTMENT_ID=$DEPARTMENT_ID and a.CP_CODE=c.CP_CODE
								$search_condition 
					order by 	a.PER_TYPE, a.CP_CODE 
					$limit_data ";
	} // end if
	$count_page_data = $db_dpis->send_cmd($cmd);
//echo "upd -> cmd=$cmd<br>";
//$db_dpis->show_error();
	if ($count_page_data) {
		$current_list = "";
		$data_count = $data_num = 0;
		$data_num = ($current_page - 1) * $data_per_page;
?>
  <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
    <tr align="center" class="table_head">
	  <td width="8%"><?=$SEQ_NO_TITLE?></td>
      <td width="60%" height="22"><strong><?=$COMPETENCE_TITLE?></strong></td>
      <?if($PAGE_AUTH["edit"]=="Y"){?>
      <td width="5%"><?=$EDIT_TITLE?></td>
      <?}?>
      <?if($PAGE_AUTH["del"]=="Y"){?>
      <td width="5%"><?=$DEL_TITLE?></td>
      <?}?>
      <!--<td width="10%"><strong><?=$ACTIVE_TITLE?></strong></td>-->
	 </tr>
<?
	while ($data = $db_dpis->get_array()) {
		$data_count++;
		$data_num++;
		if($data_count > $data_per_page) break;
		$TMP_PER_TYPE = $data[PER_TYPE];
		$temp_cp_code = $data[CP_CODE];	
		$temp_primary = $TMP_PER_TYPE ."||". $temp_cp_code;
		$current_list .= ((trim($current_list))?", ":"") . "'" . $temp_primary ."'";
		$temp_department_id = $data[DEPARTMENT_ID];
		$TMP_CP_NAME = $data[CP_NAME];		
		
		$class = "table_body";
		$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
		if($PER_TYPE ."||". $CP_CODE==$temp_primary){ 
			$class = "table_body_over";
			$onmouse_event = "";
		} // end if
?>
    <tr class="<?=$class?>" <?=$onmouse_event?>>
	  <td align="center"><?=$data_num?></td>
      <td>&nbsp;<?=$TMP_CP_NAME?></td>
	  <?if($PAGE_AUTH["edit"]=="Y"){?>
      <td align="center">&nbsp;<a href="<?=("javascript:form1.action+='?UPD=1';form1.PER_TYPE.value='".$TMP_PER_TYPE."';form1.CP_CODE.value='".$temp_cp_code."';form1.command.value='';form1.submit()")?>"><img src="images/b_edit.png" border="0" alt="แก้ไขข้อมูล"></a></td>
	  <?}?>
	  <?if($PAGE_AUTH["del"]=="Y"){?>
      <td align="center">&nbsp;<a href="<?=("javascript:confirm_delete('".$TMP_PER_TYPE."','".$temp_cp_code."','".$temp_cp_code."','".$TMP_CP_NAME."')")?>"><img src="images/b_drop.png" border="0" alt="ลบข้อมูล"></a></td>
	  <?}?>
	  <!--<td>&nbsp;</td>-->
    </tr>
    <? } ?>
	<?if($PAGE_AUTH["edit"]=="Y"){?>
    <tr class="table_footer">
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <?if($PAGE_AUTH["edit"]=="Y"){?><td>&nbsp;</td><?}?>
      <?if($PAGE_AUTH["del"]=="Y"){?><td>&nbsp;</td><?}?>
	 <!--- <td>&nbsp;</td>--->
    </tr>
	<?}?>
  </table>
  <? if($total_page > 1) : ?>
  <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td><?=$page_link_upd; ?> </td>
    </tr>
  </table>
  <? endif; ?>&nbsp;
  <? } // if  count show ?>
<? } //end page_action upd ?>		
</td></tr>
    <input type="hidden" name="current_list" value="<?=$current_list?>">
 </form>
</table>
</div>
</tr></td>
</table>
<?
	include("jqModalDialog.html");
?>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
</html>
