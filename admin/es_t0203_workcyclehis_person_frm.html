<? 
	include("../php_scripts/connect_database.php");
	include("php_scripts/load_per_control.php");
	include("../php_scripts/calendar_data.php");
  
	include("php_scripts/es_t0203_workcyclehis_person_frm.php"); 
    
	if($select_org_structure==""){$select_org_structure=1;}
    if(!isset($show_topic)) $show_topic = 1;
    
    if(!$UPD){ $WC_CODE=2;}
    
   $search_per_status = (isset($search_per_status))?  $search_per_status : 2;

    switch($CTRL_TYPE){
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
	} // end switch case

	switch($SESS_USERGROUP_LEVEL){								
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
		case 5 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
		case 6 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$search_org_id_1 = $ORG_ID_1;
			$search_org_name_1 = $ORG_NAME_1;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
	} // end switch case
    
    
    /*-------------------------------------------------------------*/
    
    if( !$current_page ) $current_page = 1;
	if(!$data_per_page) $data_per_page = 30;
	$start_record = ($current_page - 1) * $data_per_page;

                
                if($search_org_id_1 && !$search_org_id_2 && !$search_org_id_3 && !$search_org_id_4 && !$search_org_id_5){ /* Release 5.1.0.4 */
                    if($select_org_structure==0){ //โครงสร้างตามกฎหมาย
                        $arr_search_condition[] = "(c.ORG_ID_1=$search_org_id_1 or d.ORG_ID_1=$search_org_id_1 or e.ORG_ID_1=$search_org_id_1 or j.ORG_ID_1=$search_org_id_1)";
                    }else if($select_org_structure==1){ //โครงสร้างตามมอบหมายงาน
                        $arr_search_condition[] = "(a.ORG_ID_1=$search_org_id_1)";
                    }
                }elseif($search_org_id_1 && $search_org_id_2 && !$search_org_id_3 && !$search_org_id_4 && !$search_org_id_5){ /* Release 5.1.0.4 */
                    if($select_org_structure==0){ //โครงสร้างตามกฎหมาย
                        $arr_search_condition[] = "(c.ORG_ID_2=$search_org_id_2 or d.ORG_ID_2=$search_org_id_2 or e.ORG_ID_2=$search_org_id_2 or j.ORG_ID_2=$search_org_id_2)";
                    }else if($select_org_structure==1){ //โครงสร้างตามมอบหมายงาน
                        $arr_search_condition[] = "(a.ORG_ID_2=$search_org_id_2)";
                    }
                }elseif($search_org_id_1 && $search_org_id_2 && $search_org_id_3 && !$search_org_id_4 && !$search_org_id_5){ /* Release 5.1.0.4 */
                    if($select_org_structure==0){ //โครงสร้างตามกฎหมาย
                        $arr_search_condition[] = "(c.ORG_ID_3=$search_org_id_3 or d.ORG_ID_3=$search_org_id_3 or e.ORG_ID_3=$search_org_id_3 or j.ORG_ID_3=$search_org_id_3)";
                    }else if($select_org_structure==1){ //โครงสร้างตามมอบหมายงาน
                        $arr_search_condition[] = "(a.ORG_ID_3=$search_org_id_3)";
                    }
                }elseif($search_org_id_1 && $search_org_id_2 && $search_org_id_3 && $search_org_id_4 && !$search_org_id_5){ /* Release 5.1.0.4 */
                    if($select_org_structure==0){ //โครงสร้างตามกฎหมาย
                        $arr_search_condition[] = "(c.ORG_ID_4=$search_org_id_4 or d.ORG_ID_4=$search_org_id_4 or e.ORG_ID_4=$search_org_id_4 or j.ORG_ID_4=$search_org_id_4)";
                    }else if($select_org_structure==1){ //โครงสร้างตามมอบหมายงาน
                        $arr_search_condition[] = "(a.ORG_ID_4=$search_org_id_4)";
                    }
                }elseif($search_org_id_1 && $search_org_id_2 && $search_org_id_3 && $search_org_id_4 && $search_org_id_5){ /* Release 5.1.0.4 */
                    if($select_org_structure==0){ //โครงสร้างตามกฎหมาย
                        $arr_search_condition[] = "(c.ORG_ID_5=$search_org_id_5 or d.ORG_ID_5=$search_org_id_5 or e.ORG_ID_5=$search_org_id_5 or j.ORG_ID_5=$search_org_id_5)";
                    }else if($select_org_structure==1){ //โครงสร้างตามมอบหมายงาน
                        $arr_search_condition[] = "(a.ORG_ID_5=$search_org_id_5)";
                    }
                }elseif($search_org_id){
			if($select_org_structure==0){
				$arr_search_condition[] = "(c.ORG_ID=$search_org_id or d.ORG_ID=$search_org_id or e.ORG_ID=$search_org_id or j.ORG_ID=$search_org_id)";
			}else if($select_org_structure==1){
				$arr_search_condition[] = "(a.ORG_ID=$search_org_id)";
			}
		}elseif($search_department_id){
			$arr_search_condition[] = "(a.DEPARTMENT_ID = $search_department_id)";
		}elseif($search_ministry_id){
			unset($arr_department);
			$cmd = " select ORG_ID from PER_ORG where ORG_ID_REF=$search_ministry_id and OL_CODE='02' ";
			if($SESS_ORG_STRUCTURE==1){	$cmd = str_replace("PER_ORG","PER_ORG_ASS",$cmd); 	}
			$db_dpis->send_cmd($cmd);
			while($data = $db_dpis->get_array()) $arr_department[] = $data[ORG_ID];
			$arr_search_condition[] = "(a.DEPARTMENT_ID in (". implode(",", $arr_department) ."))";
		}elseif($PROVINCE_CODE){
			$cmd = " select distinct ORG_ID_REF from PER_ORG where PV_CODE='$PROVINCE_CODE' and OL_CODE='03' ";
			if($SESS_ORG_STRUCTURE==1){	$cmd = str_replace("PER_ORG","PER_ORG_ASS",$cmd); 	}
			$db_dpis->send_cmd($cmd);
			while($data = $db_dpis->get_array()) $arr_department[] = $data[ORG_ID_REF];
			$arr_search_condition[] = "(a.DEPARTMENT_ID in (". implode(",", $arr_department) ."))";
		} // end if  
        
        if(trim($search_per_status) < 5) {
            $temp_per_status = $search_per_status - 1;		
            $arr_search_condition[] = "(a.PER_STATUS = $temp_per_status)";	
        }



   	if(trim($search_name)) $arr_search_condition[] = "(a.PER_NAME like '".trim($search_name)."%' or UPPER(a.PER_ENG_NAME) like UPPER('".trim($search_name)."%'))";
   	 if(trim($search_surname)) $arr_search_condition[] = "(a.PER_SURNAME like '".trim($search_surname)."%' or UPPER(a.PER_ENG_SURNAME) like UPPER('".trim($search_surname)."%'))";

	
    if(trim($search_cardno)) $arr_search_condition[] = "(a.PER_CARDNO ='".trim($search_cardno)."')";
    if(trim($search_offno)) $arr_search_condition[] = "(a.PER_OFFNO ='".trim($search_offno)."')";
    
    if(trim($search_pos_no))  {	
		if ($search_per_type == 1 || $search_per_type==5)
			$arr_search_condition[] = "(trim(c.POS_NO) = '".trim($search_pos_no)."')";
		elseif ($search_per_type == 2) 
			$arr_search_condition[] = "(trim(d.POEM_NO) = '".trim($search_pos_no)."')";		
		elseif ($search_per_type == 3) 	
			$arr_search_condition[] = "(trim(e.POEMS_NO) = '".trim($search_pos_no)."')";
		elseif ($search_per_type == 4) 	
			$arr_search_condition[] = "(trim(j.POT_NO) = '".trim($search_pos_no)."')";
		else if ($search_per_type==0)		//ทั้งหมด
			$arr_search_condition[] = "((trim(c.POS_NO) = '".trim($search_pos_no)."') or (trim(d.POEM_NO) = '".trim($search_pos_no)."') or (trim(e.POEMS_NO) = '".trim($search_pos_no)."') or (trim(j.POT_NO) = '".trim($search_pos_no)."')) ";
	}
    
    if(trim($search_pos_no_name)){
		if ($search_per_type == 1 || $search_per_type==5)
			$arr_search_condition[] = "(trim(c.POS_NO_NAME) like '".trim($search_pos_no_name)."%')";
		elseif ($search_per_type == 2) 
			$arr_search_condition[] = "(trim(d.POEM_NO_NAME) like '".trim($search_pos_no_name)."%')";		
		elseif ($search_per_type == 3) 	
			$arr_search_condition[] = "(trim(e.POEMS_NO_NAME) like '".trim($search_pos_no_name)."%')";
		elseif ($search_per_type == 4) 	
			$arr_search_condition[] = "(trim(j.POT_NO_NAME) like '".trim($search_pos_no_name)."%')";
		else if ($search_per_type==0)		//ทั้งหมด
			$arr_search_condition[] = "((trim(c.POS_NO_NAME) like '".trim($search_pos_no_name)."%') or (trim(d.POEM_NO_NAME) like '".trim($search_pos_no_name)."%') or 
			(trim(e.POEMS_NO_NAME) like '".trim($search_pos_no_name)."%') or (trim(j.POT_NO_NAME) like '".trim($search_pos_no_name)."%')) ";
	}
    
    if(trim($search_pay_no))  $arr_search_condition[] = "(trim(c.POS_NO) = '$search_pay_no' and a.PER_TYPE = 1)";
    if(trim($search_level_no)) $arr_search_condition[] = "(trim(a.LEVEL_NO) = '". trim($search_level_no) ."')";
    if(trim($search_pl_code)) $arr_search_condition[] = "(trim(c.PL_CODE) = '". trim($search_pl_code) ."')";
    if(trim($search_pm_code)) $arr_search_condition[] = "(trim(c.PM_CODE) = '". trim($search_pm_code) ."')";
    if(trim($search_per_type)) 	$arr_search_condition[] = "(a.PER_TYPE = $search_per_type)";
    
    if($search_date_min && $search_date_max){ 
		 $tmpsearch_date_min =  save_date($search_date_min);
         $tmpsearch_date_max =  save_date($search_date_max);
         $arr_search_condition[] = " (   (substr(wch.START_DATE,1,10)  BETWEEN '$tmpsearch_date_min' and '$tmpsearch_date_max') 
         					or  (substr(wch.END_DATE,1,10) BETWEEN '$tmpsearch_date_min' and '$tmpsearch_date_max' ) 
                            or ( '$tmpsearch_date_min'  BETWEEN substr(wch.START_DATE,1,10) and substr(wch.END_DATE,1,10) )
    						or ( '$tmpsearch_date_max'  BETWEEN substr(wch.START_DATE,1,10) and substr(wch.END_DATE,1,10) )
                            )";
	}else if($search_date_min && empty($search_date_max)){ 
		 $tmpsearch_date_min =  save_date($search_date_min);
         $arr_search_condition[] = " ('$tmpsearch_date_min' BETWEEN substr(wch.START_DATE,1,10) and  ( CASE WHEN wch.END_DATE IS NOT NULL THEN substr(wch.END_DATE,1,10) ELSE to_char(sysdate,'yyyy-mm-dd') END) ) ";
    }else if(empty($search_date_min) && $search_date_max){ 
		 $tmpsearch_date_max =  save_date($search_date_max);
         $arr_search_condition[] = " ('$tmpsearch_date_max' BETWEEN substr(wch.START_DATE,1,10) and ( CASE WHEN wch.END_DATE IS NOT NULL THEN substr(wch.END_DATE,1,10) ELSE to_char(sysdate,'yyyy-mm-dd') END) ) ";
    }

     if(trim($search_wc_code)) $arr_search_condition[] = "(wch.WC_CODE ='".trim($search_wc_code)."')";
     
     if($search_per_status_scan==1) {
    	 $arr_search_condition[] = "(TRG.CARD_NO is not null OR TRG.FINGER_COUNT is not null OR TRG.FACE_COUNT is not null )";
     }else if($search_per_status_scan==2) {
     	$arr_search_condition[] = "(TRG.CARD_NO is null AND TRG.FINGER_COUNT is null AND TRG.FACE_COUNT is null )";
     }
     
    
    $search_condition = "";
	if(count($arr_search_condition)) $search_condition = " and " . implode(" and ", $arr_search_condition);

	$Tmpsearch_per_status_workcyclehis = "";
    $Tmpsearch_per_status_workcyclehis = " AND wch.PER_ID is not  null
            															AND wch.WH_ID =(select max(WH_ID) as WH_ID FROM PER_WORK_CYCLEHIS WHERE PER_ID=wch.PER_ID) ";
                                                                        
    /* if($search_per_status_workcyclehis==2 ||$search_per_status_workcyclehis=="" ) {  // บุคลากรที่ได้บันทึกรอบการมาปฏิบัติงาน
            $Tmpsearch_per_status_workcyclehis = " AND wch.PER_ID is not  null
            															AND wch.WH_ID =(select max(WH_ID) as WH_ID FROM PER_WORK_CYCLEHIS WHERE PER_ID=wch.PER_ID) ";
    }else if($search_per_status_workcyclehis==1) {  // บุคลากรที่ยังไม่ได้บันทึกรอบการมาปฏิบัติงาน
    		$Tmpsearch_per_status_workcyclehis = " AND wch.PER_ID is null ";  
    
    }else{
    		$Tmpsearch_per_status_workcyclehis = " AND (wch.PER_ID is null OR (wch.PER_ID is not  null
            															AND wch.WH_ID =(select max(WH_ID) as WH_ID FROM PER_WORK_CYCLEHIS WHERE PER_ID=wch.PER_ID))) ";
    }*/
    
    
    $cmd = " select 	count(a.PER_ID) as count_data 
                         from  PER_PERSONAL a  
                                            left join  PER_WORK_CYCLEHIS wch on(a.PER_ID=wch.PER_ID)
                                            left join PER_WORK_CYCLE wc on(wc.WC_CODE=wch.WC_CODE)
                                            left join TA_REGISTERUSER TRG on (TRG.PER_ID=wch.PER_ID)
                                            left join PER_ORG b on(b.ORG_ID=a.ORG_ID) 
                                            left join PER_POSITION c on(c.POS_ID=a.POS_ID) 
                                            left join PER_POS_EMP d on(d.POEM_ID=a.POEM_ID) 
                                            left join PER_POS_EMPSER e on(e.POEMS_ID=a.POEMS_ID) 
                                            left join PER_LEVEL f on(f.LEVEL_NO=a.LEVEL_NO) 
                                            left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                                            left join PER_MGT h on(h.PM_CODE=c.PM_CODE)
                                            left join PER_LINE i on(i.PL_CODE=c.PL_CODE)
                                            left join PER_POS_TEMP j on (j.POT_ID=a.POT_ID)
                         where 	1=1 $Tmpsearch_per_status_workcyclehis
                                        $search_condition ";
        $db_dpis->send_cmd($cmd);
        $data = $db_dpis->get_array();
        $data = array_change_key_case($data, CASE_LOWER);
		$count_data = $data[count_data];	
?>
<html>
<head>
<title><?=$webpage_title;?> - <?=$MENU_TITLE_LV0;?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1;?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2;?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3;?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected;?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
</head>
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">
	function change_current_page( page ){
		form1.current_page.value = page;
		form1.submit();
	}

	function changedateformat(name,str) {
		var arr = str.split('/');
		if((str) && (str != arr[0]+'/'+arr[1]+'/'+arr[2])){
			name.value = str.substr(0,2) + "/" + str.substr(2,2) + "/"  + str.substr(4,4) ;
		}
		chk_date(name, "BDH");
	}
	
	function confirm_delete(data_id , data_label,dateStart){
		if(confirm("คุณต้องการลบข้อมูลรอบการมาปฏิบัติราชการนี้ [ " + data_label + " รอบวันที่ "+dateStart+"]  ใช่หรือไม่ ?")){
			form1.command.value = "DELETE";
			form1.HIDWH_ID.value = data_id;
			form1.submit();
		} // end if
	}
	
	function call_add_personShowHis(PerSonID) {
	    call_openDialog("es_search_scan_person_his.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"ประวัติกำหนดรอบการมาปฏิบัติราชการ");		
	}
	


    function call_rtf_pdf_report(report_type) {
	    var  report_type
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")));?>";

		 if (report_type==1){
		document.form1.action = "report/rpt_es_t0203_workcyclehis_person.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate+"&FLAG_RTF=1";
		}else if (report_type==0){ 
		document.form1.action = "report/rpt_es_t0203_workcyclehis_person.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate+"&FLAG_RTF=0";
		}
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "es_t0203_workcyclehis_person_frm.html";
	} 
	
	function call_export_file() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")));?>";

		document.form1.action = "report/rpt_es_t0203_workcyclehis_person_xls.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate;
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "es_t0203_workcyclehis_person_frm.html";
	}	

	function call_sort(flag) {
		form1.order_by.value=flag;		form1.sort_by.value=flag;
		if(form1.sort_type.value==flag+":asc"){
			form1.sort_type.value=flag+":desc";
		}else{ //desc
			form1.sort_type.value=flag+":asc";
		}		
		form1.command.value='SEARCH';
		form1.submit();
	} // end function call_sort
	
	function call_add_person() {
		var PerSonID=form1.HideID.value;	
		/*if(form1.TIME_START.value=="") {
			alert("กรุณาเลือกข้อมูล วันที่มาปฏิบัติราชการ");
			form1.TIME_START.focus();
			return false;
		} 
		if(form1.WC_CODE.value=="") {
			alert("กรุณาเลือกข้อมูล รอบการมาปฏิบัติราชการ");
			form1.WC_CODE.focus();
			return false;
		}
		var TIME_START=form1.TIME_START.value;	
		var TIME_END=form1.TIME_END.value;	
		var WC_CODE=form1.WC_CODE.value;
		
		+"&TIME_START="+TIME_START+"&TIME_END="+TIME_END+"&WC_CODE="+WC_CODE
			*/
	    call_openDialog("es_search_scan_person_more.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	}
	
	function call_add_personShow() {
		var PerSonID=form1.HideID.value;	
	    call_openDialog("es_search_scan_person_show.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	}
	
	function call_add_org() {
	    call_openDialog("es_search_scan_org.html?send_by=es_search_noscan_org&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>",1000,700,"ส่วนราชการ");		
	}
	
	function call_search_ministry() {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$MINISTRY_TITLE;?>");		
	}
	
	function call_search_department() {	
		var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$MINISTRY_ID":"form1.search_ministry_id.value");?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(MINISTRY_ID != ""){
			parameter = "&send_by=search_department&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$DEPARTMENT_TITLE;?>");		
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT;?>');
			form1.btn_ministry.focus();
			<? } ?>
		} // end if
	}	
	
	function returnFrom(src, returnValue){
		 if  (src.indexOf("search_org") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				if (arrValue[7]=="search_ministry") {
					form1.search_ministry_id.value = arrValue[0];
					form1.search_ministry_name.value = arrValue[1];
					form1.search_department_id.value = "";
					form1.search_department_name.value = "";
					form1.search_org_id.value = "";
					form1.search_org_name.value = "";
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_department") {
					form1.search_department_id.value = arrValue[0];
					form1.search_department_name.value = arrValue[1];
					form1.search_org_id.value = "";
					form1.search_org_name.value = "";
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_org_0") {
					form1.search_org_id.value = arrValue[0];
					form1.search_org_name.value = arrValue[1];
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_org1") {
					form1.search_org_id_1.value = arrValue[0];
					form1.search_org_name_1.value = arrValue[1];
                    form1.search_org_id_2.value = "";
					form1.search_org_name_2.value = ""; 
                    form1.search_org_id_3.value = "";
					form1.search_org_name_3.value = ""; 
                    form1.search_org_id_4.value = "";
					form1.search_org_name_4.value = ""; 
                    form1.search_org_id_5.value = "";
					form1.search_org_name_5.value = ""; 
				} else if (arrValue[7]=="search_org2") {
					form1.search_org_id_2.value = arrValue[0];
					form1.search_org_name_2.value = arrValue[1];
                    form1.search_org_id_3.value = "";
					form1.search_org_name_3.value = ""; 
                    form1.search_org_id_4.value = "";
					form1.search_org_name_4.value = ""; 
                    form1.search_org_id_5.value = "";
					form1.search_org_name_5.value = ""; 
				}else if (arrValue[7]=="search_org3") {
					form1.search_org_id_3.value = arrValue[0];
					form1.search_org_name_3.value = arrValue[1];
                    form1.search_org_id_4.value = "";
					form1.search_org_name_4.value = ""; 
                    form1.search_org_id_5.value = "";
					form1.search_org_name_5.value = ""; 
				}else if (arrValue[7]=="search_org4") {
					form1.search_org_id_4.value = arrValue[0];
					form1.search_org_name_4.value = arrValue[1];
                    form1.search_org_id_5.value = "";
					form1.search_org_name_5.value = ""; 
				}else if (arrValue[7]=="search_org5") {
					form1.search_org_id_5.value = arrValue[0];
					form1.search_org_name_5.value = arrValue[1];
				}
			} // end if
			
		 }else if(src.indexOf("search_work_cycle") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				if (arrValue[2]=="work_cycle_search") {
					form1.search_WC_CODE.value = arrValue[0];
					form1.search_WC_NAME.value = arrValue[1];	
				}else{
					form1.WC_CODE.value = arrValue[0];
					form1.WC_NAME.value = arrValue[1];	
				}
			} // end if
	
		} else if  (src.indexOf("search_mgt") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				form1.search_pm_code.value = arrValue[0];
				form1.search_pm_name.value = arrValue[1];
			} // end if
			
		} else if  (src.indexOf("search_perline") > -1 || src.indexOf("search_pos_name") > -1 || src.indexOf("search_empser_pos_name") > -1 || src.indexOf("search_temp_pos_name") > -1) {
			if(returnValue){
			    arrValue = returnValue.split("<::>");
				form1.search_pl_code.value = arrValue[0];
				form1.search_pl_name.value = arrValue[1];
			} // end if
				
		}else{
			arrValue = returnValue.split("<::>");	
			form1.HideID.value = arrValue[1];
			var TotalNum = 0;
			if(arrValue[1] !=""){
				var Total = arrValue[1].split(",");
				TotalNum=Total.length;
				document.getElementById("btn_ministryShow").style.display='';
			}else{
				document.getElementById("btn_ministryShow").style.display='none';
			}
			document.getElementById("DIVPERSONNOSCAN_ID").innerHTML = "<br>รายชื่อบุคลากร ทั้งสิ้นที่เลือกไว้ <font color='red'>"+TotalNum+"</font> รายการ <br>";

		}	
		
		tt.value = returnValue;
		
	} // end if
	

	function selValue(){
		
		var inputElems = document.getElementsByTagName("input"),
        count = 0;
		
        for (var i=0; i<inputElems.length; i++) {       
           if (inputElems[i].type == "checkbox" && inputElems[i].name.substr(0,15)=="PERSONNOSCAN_ID" ){
              count++;

           }

        }

		var valID = '';
		for(i=1;i<=count;i++){
		
				if(eval("form1.PERSONNOSCAN_ID"+i+".checked")==true){
					valID = valID +eval("form1.PERSONNOSCAN_ID"+i+".value")+",";
				}
		
		}
		
		var valStrID = valID.substr(0,valID.length - 1);
		form1.HideID.value = valStrID;
	}
	
	function SaveData(f){
		
		if(f.WC_CODE.value=="") {
			alert("กรุณาเลือกข้อมูล รอบการมาปฏิบัติราชการ");
			f.WC_CODE.focus();
			return false;
		} 
		
		if(f.TIME_START.value=="") {
			alert("กรุณาระบุ วันที่มาปฏิบัติราชการ");
			f.TIME_START.focus();
			return false;
		} 
		
		
		if(f.TIME_START.value !="" && f.TIME_END.value !="") {
			arrValueS = f.TIME_START.value.split("/");
			arrValueE = f.TIME_END.value.split("/");
			var START =arrValueS[2]+''+arrValueS[1]+''+arrValueS[0];
			var END = arrValueE[2]+''+arrValueE[1]+''+arrValueE[0];
			if(parseInt(START) > parseInt(END)){
				alert("วันที่สิ้นสุด ต้องมากกว่า วันที่เริ่มต้น");
				f.TIME_END.focus();
				return false;
			}
			
		} 
		
		
		
		
		
		if(f.HideID.value== ""){
			alert('กรุณาเลือกรายชื่อบุคลากร');
			return false;
		}
		
		
		if (confirm("แจ้งเตือน : กรณีระบบพบว่าบุคคลใดมีรอบวันที่ปฏิบัติราชการคาบเกี่ยวกับที่กำหนดไว้เดิม\nระบบจะบันทึกข้อมูลดังกล่าวเป็นรอบการมาปฏิบัติราชการ (รอบล่าสุด)\nกรณีทำรายการต่อ กรุณากดปุ่ม OK หากต้องการยกเลิกให้กดปุ่ม Cancel") == true) {
			form1.submit();
		}else{
			return false;
			
		}
	}
	
	function UpdateData(f){
		
		if(f.WC_CODE.value=="") {
			alert("กรุณาเลือกข้อมูล รอบการมาปฏิบัติราชการ");
			f.WC_CODE.focus();
			return false;
		} 
		
		if(f.TIME_START.value=="") {
			alert("กรุณาเลือกข้อมูล วันที่มาปฏิบัติราชการ");
			f.TIME_START.focus();
			return false;
		} 
		
		if(f.TIME_START.value !="") {
			arrValueS = f.TIME_START.value.split("/");
			var START =arrValueS[2]+''+arrValueS[1]+''+arrValueS[0];
			var END = f.HIDYMDCHKUpdate.value;
			if(parseInt(START) < parseInt(END)){
				alert("ระบบจะอนุญาตให้แก้ไขข้อมูลได้ก็ต่อเมื่อ\nวันที่เริ่มต้นตรงกับวันที่ปัจจุบัน หรือมากกว่า วันที่ปัจจุบันเท่านั้น\n   - หากมีการขอเปลี่ยนรอบการมาปฏิบัติราชการใหม่\n     ให้เจ้าหน้าที่ทำรายการกำหนดรอบฯ ใหม่");
				f.TIME_START.focus();
				return false;
			}
			
		}
		
		if(f.TIME_START.value !="" && f.TIME_END.value !="") {
			arrValueS = f.TIME_START.value.split("/");
			arrValueE = f.TIME_END.value.split("/");
			var START =arrValueS[2]+''+arrValueS[1]+''+arrValueS[0];
			var END = arrValueE[2]+''+arrValueE[1]+''+arrValueE[0];
			if(parseInt(START) > parseInt(END)){
				alert("วันที่สิ้นสุด ต้องมากกว่า วันที่เริ่มต้น");
				f.TIME_END.focus();
				return false;
			}
			
		} 
		
		
		
		
		
		form1.submit();
	}
	
	function call_search_work_cycle(code, name) {	
		parameter = "";
		WC_CODE = eval("form1." + code);
		WC_NAME = eval("form1." + name);
	    call_openDialog("search_work_cycle.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"รอบการมาปฏิบัติราชการ");		
	}
	
	function call_search_work_cycle_search(code, name) {	
		parameter = "&send_by=work_cycle_search";
		WC_CODE = eval("form1." + code);
		WC_NAME = eval("form1." + name);
	    call_openDialog("search_work_cycle.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"รอบการมาปฏิบัติราชการ");		
	}
	
	function call_search_org_0() {	
		var DEPARTMENT_ID = <?=(($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4)?"$DEPARTMENT_ID":"form1.search_department_id.value");?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(DEPARTMENT_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="search_org_ass"; 
			parameter = "&send_by=search_org_0&OL_CODE=03&ORG_ID_REF=" + DEPARTMENT_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,900,600,"<?=$ORG_TITLE;?>");		
		
		}else{
				<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
				alert('<?=$DEPARTMENT_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
				alert('<?=$DEPARTMENT_ALERT;?>');
				form1.btn_department.focus();
			<? } ?>
		} // end if
	}
	
	function call_search_org1() {	
		var ORG_ID = form1.search_org_id.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(ORG_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="search_org_ass"; 
			parameter = "&send_by=search_org1&OL_CODE=04&ORG_ID_REF=" + ORG_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$ORG_TITLE1;?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$ORG_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$ORG_ALERT;?>');
			form1.btn_org_1.focus();
			<? } ?>
		} // end if
	}
	
	function call_search_org2 () { /* Release 5.1.0.4 */	
		var ORG_ID = form1.search_org_id_1.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(ORG_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="search_org_ass"; 
			parameter = "&send_by=search_org2&OL_CODE=05&ORG_ID_REF=" + ORG_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$ORG_TITLE2?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$ORG1_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$ORG1_ALERT?>');
			form1.btn_org_2.focus();
			<? } ?>
		} // end if
	}
	
	function call_search_org3 () { /* Release 5.1.0.4 */	
		var ORG_ID = form1.search_org_id_2.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(ORG_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="search_org_ass"; 
			parameter = "&send_by=search_org3&OL_CODE=06&ORG_ID_REF=" + ORG_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$ORG_TITLE3?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$ORG2_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$ORG2_ALERT?>');
			form1.btn_org_3.focus();
			<? } ?>
		} // end if
	}
        function call_search_org4 () { /* Release 5.1.0.4 */	
		var ORG_ID = form1.search_org_id_3.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(ORG_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="search_org_ass"; 
			parameter = "&send_by=search_org4&OL_CODE=07&ORG_ID_REF=" + ORG_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$ORG_TITLE4?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$ORG3_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$ORG3_ALERT?>');
			form1.btn_org_4.focus();
			<? } ?>
		} // end if
	}
        function call_search_org5 () { /* Release 5.1.0.4 */	
		var ORG_ID = form1.search_org_id_4.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(ORG_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="search_org_ass"; 
			parameter = "&send_by=search_org5&OL_CODE=08&ORG_ID_REF=" + ORG_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$ORG_TITLE5?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$ORG4_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$ORG4_ALERT?>');
			form1.btn_org_5.focus();
			<? } ?>
		} // end if
	}
	
	
	function call_search_perline() {	
		var parameter = "";
		var PER_TYPE = form1.search_per_type.options[form1.search_per_type.options.selectedIndex].value
		parameter = "&PER_TYPE="+PER_TYPE;
		if(PER_TYPE==1 || PER_TYPE == 0){
		    call_openDialog("search_perline.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POSITION_TITLE;?>");		
		}else if(PER_TYPE==2){
		    call_openDialog("search_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_EMP_TITLE;?>");		
		}else if(PER_TYPE==3){
		    call_openDialog("search_empser_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_EMPSER_TITLE;?>");		
		}else if(PER_TYPE==4){
		    call_openDialog("search_temp_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_TEMP_TITLE;?>");		
		}
	}
	
	function call_search_mgt() {	
		var parameter = "";
	    call_openDialog("search_mgt.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$PM_TITLE;?>");		
	}
	
	
	
	
	
	function seldelValue(){
		var StrChk = false;
		for(i=1;i<=form1.hdnLine.value;i++){
		
				if(eval("form1.ChkDel"+i+".checked")==true){
					StrChk = true;
				}
		}
		
		if(StrChk== false){
			alert('กรุณาเลือกรายชื่อบุคลากร');
			return false;
		}else{
			if(confirm("คุณต้องการลบ ใช่หรือไม่ ?")){
				form1.submit();
			} // end if
	    }
	

}
	
	
function ResetData(f){
	
	f.search_org_name.value="";
	f.search_org_id.value="";
	f.search_org_name_1.value="";
	f.search_org_id_1.value="";
	f.search_org_name_2.value = "";
	f.search_org_id_2.value = "";
	var SETLEVEL = f.HID_SESS_ORG_SETLEVEL.value;
		if(SETLEVEL>=3){
			f.search_org_name_3.value = "";
			f.search_org_id_3.value = "";
			if(SETLEVEL>=4){
				f.search_org_name_4.value = "";
				f.search_org_id_4.value = "";
				if(SETLEVEL>=5){
					f.search_org_name_5.value = "";
					f.search_org_id_5.value = ""; 
				}
			}
		}
	document.getElementById('select_org_structure1').checked=true;
	f.search_name.value="";
	f.search_surname.value="";
	f.search_cardno.value="";
	f.search_offno.value="";
	<? if($POSITION_NO_CHAR=="Y"){?>
	f.search_pos_no_name.value="";
	<? }?>
	f.search_pos_no.value="";
	<? if($SESS_DEPARTMENT_NAME=="กรมการปกครอง"){?>
	f.search_pay_no.value="";
	<? }?>
	f.search_level_no.value="";
	f.search_pl_name.value="";
	f.search_pl_code.value="";
	f.search_pm_name.value="";
	f.search_pm_code.value="";
	f.search_per_type.value="0";
	f.search_per_status.value="2";
	f.search_date_min.value="";
	f.search_date_max.value="";
	f.search_per_status_scan.value="";
	f.search_wc_code.value="";
	
	
}

function ResetDataSave(f){
	document.getElementById("DIVPERSONNOSCAN_ID").innerHTML = "";		
	f.HideID.value = "";
	f.TIME_START.value="";
	f.TIME_END.value="";
	f.WC_CODE.value="";
	f.WC_START_HH.value = "00";	
	f.WC_START_II.value = "00";	
	f.WC_END_HH.value = "00";	
	f.WC_END_II.value = "00";	
	document.getElementById("btn_ministryShow").style.display='none';

}

function change_div(div_id){	
		var formname = new Array('form1','form1');
		for(var i=0; i < formname.length; i++){
			eval("document.all.DIV_TOPIC_" + eval(formname[i]).show_topic.value + ".style.display='none'");
			eval("document.all.DIV_TOPIC_" + div_id + ".style.display='block'");
			eval("document.all.CELL_TOPIC_" + div_id + ".className='table_body_3'");
			eval(formname[i]).show_topic.value = div_id;
		}
		document.getElementById("DIV_TOPIC_3").style.display='none';	
		form1.UPD.value=''; 
	}
	
</script>
<?
 if ($UPD)
 $Submit = "Submit_edit";
 else
  $Submit = "Submit_add";
 ?>
<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<tr>
    	<td height="10"><? include("header_menu.html");?></td>
  	</tr>
    <tr> 
	  <td align="left" valign="top">
<?	
		if ($UPD) $OPTIONAL_TITLE=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE=" &gt; ดูข้อมูล";
		include("current_location.html");
?>
	  </td>
	</tr>
  	<tr>
    	<td align="left" valign="top"><table width="95%" align="center" cellpadding="0" cellspacing="0"  id="DIV_TOPIC_3" style="display:<?=($show_topic==2)?"block":"none";?>;">
  			<tr>
	  			<td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-style:solid;" border="1">
		  			<tr>
							<td  id="CELL_TOPIC_1" height="22" align="center" class="<?=($show_topic==1)?"table_body_3":"table_body"?>"><span style="cursor:hand;"  onClick="change_div(1);"><?=$SEARCH_TITLE;?></span></td>
		  			</tr>		
	  			</table></td>
			</tr></table>
        
        
        <form name="form1" method="post" action="es_t0203_workcyclehis_person_frm.html" enctype="multipart/form-data">
          <input type="hidden" name="current_page" value="<?=$current_page;?>">
          <input type="hidden" name="total_page" value="<?=$total_page;?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0;?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1;?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2;?>">
		  <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3;?>">
          <input type="hidden" name="command" value="<?=$command;?>">
          <input type="hidden" name="table" value="<?=$table;?>">
			<input type="hidden" name="show_topic" value="<?=$show_topic;?>">
            <input type="hidden" name="HIDWH_ID" value="<?=$HIDWH_ID;?>">
            <input type="hidden" name="HIDPER_ID" value="<?=$HIDPER_ID;?>">
            <input type="hidden" name="HID_SESS_ORG_SETLEVEL" value="<?=$SESS_ORG_SETLEVEL;?>">
            <input type="hidden" name="HID_END_DATE" value="<?=$HID_END_DATE;?>">
            <input type="hidden" name="HIDYMDCHKUpdate" value="<?=(date('Y')+543).date('md');?>">
<div id="DIV_TOPIC_1" style="display:<?=($show_topic==1)?"block":"none"?>;"> 
&nbsp;
<table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
		  <tr>
		  	<td height="22" align="center" class="table_body"><?=($UPD)?"แก้ไข":"เพิ่ม"?>ข้อมูล</td>
		  </tr>		
	  </table></td>
	</tr>
  </table>
  <table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table" 
  onKeyPress="return keyEnter(event,document.form1.<?=$Submit;?>);">
    <tr>
      <td>
       <? if($UPD){?>
      <table width="100%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
        <tr height="5">
          <td width="18%"></td>
          <td width="30%"></td>
          <td width="16%"></td>
          <td width="31%"></td>
          </tr>
        	
        	
        	<tr>
        	  <td align="right" height="25">ชื่อ-สกุล&nbsp;:&nbsp;</td>
        	  <td >&nbsp;<?=$FULLNAME_SHOW;?></td>
        	  <td  align="right">ตำแหน่งในสายงาน&nbsp;:&nbsp;</td>
        	  <td  height="25">&nbsp;<?=$PL_NAME;?>
        	    
        	    </td>
      	  </tr>
               <tr>
                 <td align="right" height="25">สังกัดสำนัก/กอง&nbsp;:&nbsp;</td>
                 <td >&nbsp;<?=$ORG_NAME;?></td>
                 <td  align="right">ประเภทและระดับตำแหน่ง&nbsp;:&nbsp;</td>
                 <td  height="25">&nbsp;<?=$LEVEL_NAME;?></td>
               </tr>
               <tr>
                 <td height="25" colspan="4" align="right"><hr size="1"></td>
               </tr>
             </table>
             
        <? }?>
      <table width="100%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
        	
          <td align="right"><span class="label_alert">*</span>&nbsp;รอบการมาปฏิบัติราชการ&nbsp;:&nbsp;</td>
          <td>
            
            <select class="selectbox" name="WC_CODE">
                        <option value="" <?=($WC_CODE=="")?"selected":"";?>>== เลือก ==</option>
                        <?
                            $cmd = " select WC_CODE, WC_NAME from PER_WORK_CYCLE where WC_ACTIVE = 1 order by WC_SEQ_NO ASC, WC_CODE ASC  ";
                            $db_dpis->send_cmd($cmd);
                            while($data = $db_dpis->get_array()){					
                                $DB_WC_CODE = $data[WC_CODE];
                                $DB_WC_NAME = $data[WC_NAME];
                          ?>
                        <option value="<?=$DB_WC_CODE;?>" <?=(trim($DB_WC_CODE)==trim($WC_CODE))?"selected":"";?>><?=$DB_WC_NAME;?></option>
                        <?
                            } // end while
                          ?>
                    </select>
                      </td>
          </tr>
          <tr>
            <td  align="right" height="25"><span class="label_alert">*</span>&nbsp;วันที่เริ่มใช้&nbsp;:&nbsp;</td>
            <td width="63%" height="25" >
              <input name="TIME_START" type="text" class="textbox" id="TIME_START" value="<?=$TIME_START;?>" style="width:17%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.TIME_START,this.value)">
              <input type="reset" class="button" onClick="return showCalendar('TIME_START', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>">
              
              &nbsp;&nbsp;
              เวลา
              <select name="WC_START_HH">
                      <?
                      for($i=0; $i<24; $i++){
                            $ii = substr("0".$i,-2,2);
                      ?>
                        <option value="<?=$ii;?>" <? if($ii==$WC_START_HH){ echo 'selected';}?>>&nbsp;<?=$ii;?></option>
                      <? } ?>
			 	  </select>
           			 :
            		<select name="WC_START_II">
                      <?
                      for($i=0; $i<60; $i++){
                            $ii = substr("0".$i,-2,2);
                      ?>
                        <option value="<?=$ii;?>" <? if($ii==$WC_START_II){ echo 'selected';}?>>&nbsp;<?=$ii;?></option>
                      <? } ?>
			 		</select>
             		
              น.
              
              
                        </td>
          </tr>
          
          <tr>
            <td align="right">วันที่สิ้นสุด&nbsp;:&nbsp;</td>
            <td><input name="TIME_END" type="text" class="textbox" id="TIME_END" value="<?=$TIME_END;?>" style="width:17%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.TIME_END,this.value)">
              <input type="reset" class="button" onClick="return showCalendar('TIME_END', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>">
              &nbsp;&nbsp;
              เวลา
              <select name="WC_END_HH" id="WC_END_HH">
                      <?
                      for($i=0; $i<24; $i++){
                            $ii = substr("0".$i,-2,2);
                      ?>
                        <option value="<?=$ii;?>" <? if($ii==$WC_END_HH){ echo 'selected';}?>>&nbsp;<?=$ii;?></option>
                      <? } ?>
			 	  </select>
           			 :
            		<select name="WC_END_II" id="WC_END_II">
                      <?
                      for($i=0; $i<60; $i++){
                            $ii = substr("0".$i,-2,2);
                      ?>
                        <option value="<?=$ii;?>" <? if($ii==$WC_END_II){ echo 'selected';}?>>&nbsp;<?=$ii;?></option>
                      <? } ?>
			 		</select>
                    น.</td>
          </tr>
          <tr>
        
          
        
         <? if (!$UPD) { ?>
         <tr valign="top" id="DPerson">
          <td width="37%"  align="right" height="25"><span class="label_alert">*</span>&nbsp;รายชื่อบุคลากร&nbsp;:&nbsp;</td>
          <td height="25" align="left">
          <input type="button" name="btn_ministry2" value=" กำหนดบุคลากร " class="button" onClick="call_add_person();" >
            
            <input type="hidden" value="" id="HideID" name="HideID"></input>
            &nbsp;&nbsp;
            <input type="button" name="btn_ministryShow" id="btn_ministryShow" style="display:none"  value=" แสดงรายชื่อที่เลือก " class="button" onClick="call_add_personShow();" >
            <br/>
            <label id="DIVPERSONNOSCAN_ID"></label>
          <br/>
            </td>
          </tr>
          <? }?>
          
          <?  if ($UPD) {  ?>	
        <tr>
          <td align="right"><?=$UPDATE_USER_TITLE;?>&nbsp;:&nbsp;</td>
          <td colspan="3"><input name="SHOW_UPDATE_USER" type="text" style="width:40%" class="textbox" value="<?=$SHOW_UPDATE_USER;?>" readonly></td>
          </tr>
        <tr>
              <td width="37%" align="right"><?=$UPDATE_DATE_TITLE;?>&nbsp;:&nbsp;</td>
              <td colspan="3"><input name="SHOW_UPDATE_DATE" type="text" style="width:25%" class="textbox" value="<?=$SHOW_UPDATE_DATE;?>" readonly></td>
              </tr>
          <? }?>  
          
         <tr>
        	<td align="right">&nbsp;</td>
        	<td height="30"><? if ($UPD) { 
            if($PAGE_AUTH["edit"]=="Y"){
			  		if ($BUTTON_DISPLAY==1) { ?>
        	  <input name="Submit_edit" type="submit" class="button" onClick="form1.command.value='UPDATE';  return UpdateData(form1);" value="<?=$EDIT_TITLE;?>">
        	  <? } else { ?>
        	  <input name="image" type="image" onClick="form1.command.value='UPDATE';  return UpdateData(form1);" src="images/save.png" alt="<?=$EDIT_TITLE;?>" border="0">
        	  <?}?>
        	  <?}
		  		if ($BUTTON_DISPLAY==1) { ?>
        	  <input type="submit" name="Reset2" value=" <?=$CANCEL_TITLE;?> " onClick="form1.command.value='CANCEL'" class="button" >
        	  <? } else { ?>
        	  <input name="image" type="image" onClick="form1.command.value='CANCEL'" src="images/cancel.gif" alt="<?=$CANCEL_TITLE;?>" border="0">
        	  <?}?>
        	  <? } else { 
            if($PAGE_AUTH["add"]=="Y"){
			  		if ($BUTTON_DISPLAY==1) { ?>
        	  <input name="Submit_add" type="submit" class="button" onClick="form1.command.value='ADD';  return SaveData(form1);" value="<?=$ADD_TITLE;?>">
        	  <? } else { ?>
        	  <input name="image" type="image" onClick="form1.command.value='ADD';  return SaveData(form1);" src="images/save.png" alt="<?=$ADD_TITLE;?>" border="0">
        	  <?}?>
        	  <?}
			  	if ($BUTTON_DISPLAY==1) { ?>
        	  <input name="Reset2" type="button" onClick="return ResetDataSave(form1);" class="button" value="<?=$CLEAR_TITLE;?>">
        	  <? } else { ?>
        	  <img src="images/default.jpg" alt="<?=$CLEAR_TITLE;?>" width="32" height="32" border="0" onClick="return ResetDataSave(form1);">&nbsp;
        	  <?}?>
        	  <?}?></td>
        	</tr>
      </table></td>
    </tr>
  </table>
  
  
  
  <table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
		  <tr>
		  	<td height="22" align="center" class="table_body"><?=$SEARCH_TITLE;?></td>
		  </tr>		
	  </table></td>
	</tr>
  </table>
  <table width="95%" align="center"  border="0" cellspacing="0" cellpadding="0" 
  onKeyPress="return keyEnter(event,document.form1.Submit3);">
        <tr>
          <td align="center" class="input_table">
          
          <table width="100%"  border="0" cellpadding="1" cellspacing="1" class="label_normal">
          <tr>
                        <td height="22" align="right"></td>
                        <td colspan="3"><input name="select_org_structure" id="select_org_structure1" type="radio" value="0" <?=($select_org_structure==0 )?"checked":""?>  onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';form1.search_org_id_2.value='';form1.search_org_name_2.value='';form1.search_org_id_3.value='';form1.search_org_name_3.value='';form1.search_org_id_4.value='';form1.search_org_name_4.value='';form1.search_org_id_5.value='';form1.search_org_name_5.value='';" ><?=$LAW_STRUCTURE_TITLE;?>&nbsp;
                    <input name="select_org_structure" id="select_org_structure2" type="radio" value="1" <?=($select_org_structure==1)?"checked":""?>  onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';form1.search_org_id_2.value='';form1.search_org_name_2.value='';form1.search_org_id_3.value='';form1.search_org_name_3.value='';form1.search_org_id_4.value='';form1.search_org_name_4.value='';form1.search_org_id_5.value='';form1.search_org_name_5.value='';" ><?=$ASSIGN_STRUCTURE_TITLE;?>						</td>
              </tr>
            <tr>
              <td width="18%" height="22" align="right"><?=$MINISTRY_TITLE;?>&nbsp;:&nbsp;</td>
              <td width="32%">
			    <input type="text" name="search_ministry_name" value="<?=$search_ministry_name;?>" style="width:75%" class="textbox"  readonly="true" >
			    <input type="hidden" name="search_ministry_id" value="<?=$search_ministry_id;?>">
                <? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
			    <input type="button" name="btn_ministry" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_ministry()" >
			    <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_ministry_name.value=''; form1.search_ministry_id.value=''; form1.search_department_name.value=''; form1.search_department_id.value=''; form1.search_org_name.value=''; form1.search_org_id.value=''; form1.search_org_name_1.value=''; form1.search_org_id_1.value=''; return false;" align="center" alt="ล้างค่า">		 
                <? } // end if ?>	
                 </td>
              <td width="18%" align="right"><?=$DEPARTMENT_TITLE;?>&nbsp;:&nbsp;</td>
              <td width="32%">
			    <input type="text" name="search_department_name" value="<?=$search_department_name;?>" style="width:75%" class="textbox"  readonly="true" >
			    <input type="hidden" name="search_department_id" value="<?=$search_department_id;?>">
                <? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
				<input type="button" name="btn_department" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_department()" >
			    <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_department_name.value=''; form1.search_department_id.value=''; form1.search_org_name.value=''; form1.search_org_id.value=''; form1.search_org_name_1.value=''; form1.search_org_id_1.value=''; return false;" align="center" alt="ล้างค่า">
				<? } // end if ?>
                </td>
			  </tr>
				   <tr>
              <td height="22" align="right"><?=$ORG_TITLE?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_org_name" id="search_org_name" value="<?=$search_org_name?>" style="width:75%" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id" value="<?=$search_org_id?>">
                  <? if($SESS_USERGROUP_LEVEL < 5 || ($SESS_USERGROUP_LEVEL < 6 && $SESS_ORG_STRUCTURE==2 && !$search_org_id)){ ?>
                  <input type="button" name="btn_org" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org_0()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name.value=''; form1.search_org_id.value=''; return false;" align="center" alt="ล้างค่า">
                  <? } // end if ?></td>
              <td height="22" align="right"><?=$ORG_TITLE1?>&nbsp;:&nbsp;</td>
              <td>
                  <input type="text" name="search_org_name_1" value="<?=$search_org_name_1?>" style="width:75%" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id_1" value="<?=$search_org_id_1?>">
                  <? if($SESS_USERGROUP_LEVEL < 6 || ($SESS_USERGROUP_LEVEL <= 6 && $SESS_ORG_STRUCTURE==2 && !$search_org_id)){ ?>
                  <input type="button" name="btn_org_1" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org1()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name_1.value=''; form1.search_org_id_1.value=''; return false;" align="center" alt="ล้างค่า">
                  <? } // end if ?>
              </td>
            </tr>       
            <tr>
              <td height="22" align="right"><?=$ORG_TITLE2?>&nbsp;:&nbsp;</td>
              <td >
                  <input type="text" name="search_org_name_2" value="<?=$search_org_name_2?>" style="width:75%" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id_2" value="<?=$search_org_id_2?>">
                  <? if($SESS_USERGROUP_LEVEL < 7 || ($SESS_USERGROUP_LEVEL <= 7 && $SESS_ORG_STRUCTURE==2 && !$search_org_id)){ ?>
                  <input type="button" name="btn_org_2" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org2()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name_2.value=''; form1.search_org_id_2.value=''; return false;" align="center" alt="ล้างค่า">
                  <? } // end if ?>
              </td>
              <?php if($SESS_ORG_SETLEVEL!=2){  ?>
              <td height="22" align="right"><?=$ORG_TITLE3?>&nbsp;:&nbsp;</td>
              <td >
                  <input type="text" name="search_org_name_3" value="<?=$search_org_name_3?>" style="width:75%" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id_3" value="<?=$search_org_id_3?>">
                  <? if($SESS_USERGROUP_LEVEL < 8 || ($SESS_USERGROUP_LEVEL <= 8 && $SESS_ORG_STRUCTURE==2 && !$search_org_id)){ ?>
                  <input type="button" name="btn_org_3" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org3()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name_3.value=''; form1.search_org_id_3.value=''; return false;" align="center" alt="ล้างค่า">
                  <? } // end if ?>
              </td>
            </tr>
            <?php if($SESS_ORG_SETLEVEL!=3) { ?>
            <tr>
              <td height="22" align="right"><?=$ORG_TITLE4?>&nbsp;:&nbsp;</td>
              <td >
                  <input type="text" name="search_org_name_4" value="<?=$search_org_name_4?>" style="width:75%" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id_4" value="<?=$search_org_id_4?>">
                  <? if($SESS_USERGROUP_LEVEL < 9 || ($SESS_USERGROUP_LEVEL <= 9 && $SESS_ORG_STRUCTURE==2 && !$search_org_id)){ ?>
                  <input type="button" name="btn_org_4" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org4()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name_4.value=''; form1.search_org_id_4.value=''; return false;" align="center" alt="ล้างค่า">
                  <? } // end if ?>
              </td>
               <?php if($SESS_ORG_SETLEVEL!=3&&$SESS_ORG_SETLEVEL!=4) { ?>
                <td height="22" align="right"><?=$ORG_TITLE5?>&nbsp;:&nbsp;</td>
                <td >
                    <input type="text" name="search_org_name_5" value="<?=$search_org_name_5?>" style="width:75%" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id_5" value="<?=$search_org_id_5?>">
                  <? if($SESS_USERGROUP_LEVEL < 10 || ($SESS_USERGROUP_LEVEL <= 10 && $SESS_ORG_STRUCTURE==2 && !$search_org_id)){ ?>
                  <input type="button" name="btn_org_5" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org5()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name_5.value=''; form1.search_org_id_5.value=''; return false;" align="center" alt="ล้างค่า">
                  <? } // end if ?>
                </td>
                <?php }?>
            </tr>
             <?php }?>
            <?php }?>       
            <tr>
              <td height="22" align="right"><?=$NAME_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_name"  value="<?=$search_name;?>" style="width:75%" class="textbox" ></td>
              <td align="right"><?=$SURNAME_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_surname" value="<?=$search_surname;?>" style="width:75%" class="textbox" ></td>
		      </tr>
            <tr>
              <td height="22" align="right"><?=$CARDNO_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_cardno" value="<?=$search_cardno;?>" style="width:40%" maxlength="13" class="textbox" onKeyPress="return DigitOnly();"></td>
              <td height="22" align="right"><?=$OFFNO_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_offno" value="<?=$search_offno;?>" style="width:40%" maxlength="7" class="textbox" onKeyPress="return DigitOnly();"></td>
            </tr>
            <tr>
              <td height="22" align="right"><?=$POS_NO_TITLE;?>&nbsp;:&nbsp;</td>
              <td><? if ($POSITION_NO_CHAR=="Y") { ?>
			  <input type="text" name="search_pos_no_name" value="<?=$search_pos_no_name;?>" style="width:20%" class="textbox"  <?=($_GET[POS_ID])?"readonly":"" ?>>
			  	<? } ?>
			  <input type="text" name="search_pos_no" value="<?=$search_pos_no;?>" style="width:40%" class="textbox" onKeyPress="return DigitOnly();" <?=($_GET[POS_ID])?"readonly":"" ?>>
			  </td>
				
              <td height="22" align="right"><? if ($SESS_DEPARTMENT_NAME=="กรมการปกครอง") { ?><?=$PAY_NO_TITLE;?><? } else { ?><?=$LEVEL_TITLE;?><? } ?>&nbsp;:&nbsp;</td>
              <td>
              <? if ($SESS_DEPARTMENT_NAME=="กรมการปกครอง") { ?>
              		<input type="text" name="search_pay_no" value="<?=$search_pay_no;?>" style="width:30%" class="textbox" onKeyPress="return DigitOnly();">
              <? } else { ?>
              		<select class="selectbox" name="search_level_no"  onChange="<?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW)?" check_salary_type(1, this.value);":""?>">
                        <option value="" <?=($search_level_no=="")?"selected":""?>>== <?=$LEVEL_TITLE;?> ==</option>
                        <?
                            $where = "";
                            $cmd = "	select LEVEL_NO_MIN, LEVEL_NO_MAX FROM PER_LINE	where PL_CODE = '$search_pl_code' ";
                            $count_per_line = $db_dpis->send_cmd($cmd);
                            if ($count_per_line) {
                                $data = $db_dpis->get_array();
                                $LEVEL_NO_MIN = trim($data[LEVEL_NO_MIN]); 
                                $LEVEL_NO_MAX = trim($data[LEVEL_NO_MAX]); 
                                $where = "";
                                if ($LEVEL_NO_MIN)
                                    $where .= " and LEVEL_NO >= '$LEVEL_NO_MIN' ";
                                if ($LEVEL_NO_MAX)
                                    $where .= " and LEVEL_NO <= '$LEVEL_NO_MAX' ";
                            }
        
                            $cmd = " select LEVEL_NO, LEVEL_NAME from PER_LEVEL where PER_TYPE = 1 and LEVEL_ACTIVE = 1 $where order by LEVEL_SEQ_NO ";
                            $db_dpis->send_cmd($cmd);
                            while($data = $db_dpis->get_array()){					
                                $TMP_LEVEL_NO = $data[LEVEL_NO];
                                $TMP_LEVEL_NAME = $data[LEVEL_NAME];
                          ?>
                        <option value="<?=$TMP_LEVEL_NO;?>" <?=(trim($search_level_no)==trim($TMP_LEVEL_NO))?"selected":""?>><?=$TMP_LEVEL_NAME;?></option>
                        <?
                            } // end while
                          ?>
                    </select>
              <? } ?>
              </td>
            </tr>
				<tr>
          <td height="25" align="right"><?=$PL_TITLE;?>&nbsp;:&nbsp;</td>
          <td>
		  	<input type="text" name="search_pl_name" value="<?=$search_pl_name;?>" style="width:75%" class="textbox"  readonly>
            <input type="button" name="Input" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_perline()">
			<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_pl_name.value=''; form1.search_pl_code.value=''; return false;" align="center" alt="ล้างค่า">
			<input type="hidden" name="search_pl_code" value="<?=trim($search_pl_code);?>"></td>
          <td height="25" align="right"><?=$PM_TITLE;?>&nbsp;:&nbsp;</td>
          <td>
		  	<input type="text" name="search_pm_name" value="<?=$search_pm_name;?>" style="width:75%" class="textbox"  readonly>
            <input type="button" name="Input" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_mgt()">
			<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_pm_name.value=''; form1.search_pm_code.value=''; return false;" align="center" alt="ล้างค่า">
            <input type="hidden" name="search_pm_code" value="<?=trim($search_pm_code);?>">          </td>
            </tr>
			<tr>
			  <td height="22" align="right"><?=$PER_TYPE_TITLE;?>&nbsp;:&nbsp;</td>
			  <td><select name="search_per_type" >
			    <?  foreach($PERSON_TYPE as $key=>$value){  
					 $disinput[$key] = "";		$disinput[0]="";		$chinput[$key] = "";		
					if($SESS_PER_TYPE==0){	//ทั้งหมด
					   	if(trim($search_per_type)){
							$chinput[$SESS_PER_TYPE] = "";		$chinput[$search_per_type] = " selected";
						}else{
							$chinput[$SESS_PER_TYPE] = " selected";
						}
					}else{	//ประเภทอื่น
						$chinput[$key]=" selected";		 $chinput[0]="";		$disinput[$key]="";		$styleline[$key]="display:block";
					}
				?><option value="<?=$key;?>" <?=$chinput[$key]." ".$disinput[$key]; ?>><?=$value;?></option><?  } ?>
			    <? if($SESS_PER_TYPE==0 && $BKK_FLAG!=1){ ?><option value="0" <?=$chinput[0]." ".$disinput[0]; ?>>ทั้งหมด</option><? } ?>
			    </select></td>
			  <td  height="22" align="right">สถานภาพ&nbsp;:&nbsp;</td>
			  <td>
			    <select name="search_per_status" class="selectbox" >
			      <option value="2" <?=($search_per_status==2)?"selected":"";?>>&nbsp;<?=($BKK_FLAG==1)?ครอง:ปกติ?></option>
			      <option value="1" <?=($search_per_status==1)?"selected":"";?>>&nbsp;รอบรรจุ</option>
			      <option value="3" <?=($search_per_status==3)?"selected":"";?>>&nbsp;<?=($BKK_FLAG==1)?ไม่ครอง:$RETIRE_TITLE?></option>
			      <? if ($ISCS_FLAG==1){ ?><option value="4" <?=($search_per_status==4)?"selected":"";?>>&nbsp;รอเลขที่ตำแหน่ง</option><? } ?>
			      <option value="5" <?=($search_per_status==5)?"selected":"";?>>&nbsp;ทั้งหมด</option>
			      </select>		  </td>
			  </tr>
             <tr>
               <td align="right">ช่วงวันที่ปฏิบัติราชการ&nbsp;:&nbsp;</td>
               <td><input name="search_date_min" type="text" class="textbox" id="search_date_min" value="<?=$search_date_min;?>" style="width:32%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_date_min,this.value)">
                 <input type="reset" class="button" onClick="return showCalendar('search_date_min', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>">
  &nbsp;-&nbsp;
  <input name="search_date_max" type="text" class="textbox" id="search_date_max" value="<?=$search_date_max;?>" style="width:32%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_date_max,this.value)">
  <input type="reset" class="button" onClick="return showCalendar('search_date_max', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>"></td>
               <td class="label_hilight" align="right">ตรวจสอบการลงทะเบียน&nbsp;:&nbsp;</td>
               <td><select name="search_per_status_scan" class="selectbox" >
                 <option value="0" <?=($search_per_status_scan==0)?"selected":"";?>>&nbsp;ทั้งหมด</option>
                 <option value="1" <?=($search_per_status_scan==1)?"selected":"";?>>&nbsp;ลงทะเบียนแล้ว</option>
                 <option value="2" <?=($search_per_status_scan==2)?"selected":"";?>>&nbsp;ยังไม่ได้ลงทะเบียน</option>
                 </select></td>
             </tr>
             <tr>
               <td align="right">รอบการมาปฏิบัติราชการ&nbsp;:&nbsp;</td>
               <td>
                 <!--<input type="text" name="search_WC_NAME" value="<?=$search_WC_NAME;?>" style="width:75%" size="30" class="textbox" readonly>
                 <input type="hidden" name="search_WC_CODE" value="<?=$search_WC_CODE;?>"> 
                 <input type="button" name="search_BTWC" class="button" value="<?=$SELECT_TITLE;?>" alt="เลือกรอบการมาปฏิบัติราชการ" onClick="call_search_work_cycle_search('search_WC_CODE', 'search_WC_NAME');">
                 <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_WC_NAME.value=''; form1.search_WC_CODE.value=''; return false;" align="center" alt="ล้างค่า">-->
                 <select class="selectbox" name="search_wc_code">
                        <option value="" <?=($search_wc_code=="")?"selected":"";?>>== ทั้งหมด ==</option>
                        <?
                            $cmd = " select WC_CODE, WC_NAME from PER_WORK_CYCLE where WC_ACTIVE = 1 order by WC_SEQ_NO ASC, WC_CODE ASC  ";
                            $db_dpis->send_cmd($cmd);
                            while($data = $db_dpis->get_array()){					
                                $DB_WC_CODE = $data[WC_CODE];
                                $DB_WC_NAME = $data[WC_NAME];
                          ?>
                        <option value="<?=$DB_WC_CODE;?>" <?=(trim($DB_WC_CODE)==trim($search_wc_code))?"selected":"";?>><?=$DB_WC_NAME;?></option>
                        <?
                            } // end while
                          ?>
                    </select>
                 </td>
               <td class="label_hilight" align="right"><? //ตรวจสอบการกำหนดรอบฯ&nbsp;:?>&nbsp;</td>
               <td><!--<select name="search_per_status_workcyclehis" class="selectbox" >
			      <option value="1" <? if($search_per_status_workcyclehis==1){ echo "selected";}?>>&nbsp;ยังไม่ได้ลงทะเบียนลงทะเบียนแล้ว</option>
			      <option value="2" <? if($search_per_status_workcyclehis==2 || $search_per_status_workcyclehis==""){ echo "selected";}?>>&nbsp;ลงทะเบียนแล้ว</option>
                  <option value="3" <? if($search_per_status_workcyclehis==3){ echo "selected";}?>>&nbsp;ทั้งหมด</option>
			      </select>--></td>    
             </tr>
             
            <tr>
              <td colspan="4" height="5"></td>
            </tr>          
            <tr>
              <td align="center" colspan="4"><? if ($BUTTON_DISPLAY==1) { ?>
              <input name="Submit3" type="submit" class="button" value="<?=$SEARCH_TITLE;?>" onClick="form1.command.value='SEARCH';form1.current_page.value=0;">
                
                <input name="Reset" type="button" class="button" onClick="return ResetData(form1);" value="<?=$CLEAR_TITLE;?>">
                <? } else { ?>
                <input name="image2" type="image" onClick="form1.command.value='SEARCH';javascript:form1.current_page.value=0;" src="images/search.png" alt="<?=$SEARCH_TITLE;?>">
                 
                <input name="image" type="image" onClick="return ResetData(form1);" src="images/cancel.gif" alt="<?=$CANCEL_TITLE;?>" border="0">
                <?}?></td>
            </tr>

          </table>
          
          
          </td>
        </tr>
		<tr>
		  <td>
		  <table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
<tr><td><input type="hidden" name="order_by" value="<?=$order_by;?>">
    <input type="hidden" name="sort_by" value="<?=$sort_by;?>">
    <input type="hidden" name="sort_type" value="<?=$sort_type;?>">
    <?=$SORT_TITLE;?>
</td>
</tr>
</table>
		  <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
            <tr>
              <td width="26%" height="22"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_report" type="button" class="button" style="width:150" value="<?=$PDF_TITLE;?>" onClick="call_rtf_pdf_report(0);"> 
				       <? if ($RTF_FLAG==1) { ?>
                <input name="btn21" type="button" class="button" style="width:150" value="<?=$RTF_TITLE;?>" onClick="call_rtf_pdf_report(1);"> 
	                    <? } ?>
                <?  } else { ?>
                <img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE;?>" onClick="call_rtf_pdf_report(0);"> 
			        	 <? if ($RTF_FLAG==1) { ?>
                <img src="images/doc_icon_word.jpg" border="0" alt="<?=$RTF_TITLE;?>" onClick="call_rtf_pdf_report(1);"> 
	                     <? } ?>
                <? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
              <td width="59%" align="center">พบข้อมูล <?=$MENU_TITLE_LV2;?> ทั้งสิ้น <?=($count_data);?> รายการ</td>
              <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE;?>" onClick="call_export_file();">
                <?  } else { ?>
                <img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE;?>" onClick="call_export_file();">
                <? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
            </tr>
          </table></td>
		</tr>
  </table>  
  <?
  
  		if(!$sort_by) $sort_by=1;
        if(!$sort_type) $sort_type="1:asc";
        $arrSort=explode(":",$sort_type);
        $SortType[$arrSort[0]]	=$arrSort[1];
        if(!$order_by) $order_by=1;
    
        if($order_by==1){	//(ค่าเริ่มต้น)
            $order_str = "ORDER BY to_number(replace(c.POS_NO,'-','')) ".$SortType[$order_by].", to_number(replace(d.POEM_NO,'-','')) ".$SortType[$order_by].", to_number(replace(e.POEMS_NO,'-','')) ".$SortType[$order_by].", to_number(replace(j.POT_NO,'-','')) ".$SortType[$order_by];
        }elseif($order_by==2) {	//
            $order_str = "ORDER BY a.PER_NAME ".$SortType[$order_by].", a.PER_SURNAME ".$SortType[$order_by];
        } elseif($order_by==3) {	//
            $order_str = "ORDER BY wch.START_DATE ".$SortType[$order_by];
         } elseif($order_by==4) {	//
            $order_str = "ORDER BY wch.END_DATE ".$SortType[$order_by];
        } elseif($order_by==5) {	//
            $order_str =  "ORDER BY wch.WC_CODE  ".$SortType[$order_by];
        } 
    
		$total_page = ceil( $count_data / $data_per_page );
		$page_link = create_link_page($total_page, $current_page);
		$limit_data = "";
		
		if($DPISDB=="oci8"){
			$rec_start = (($current_page-1) * $data_per_page) + 1;
			$rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
			$cmd = " select		*
                         from (
                             select		rownum rnum, q1.*
                             from (
                                 select 	
                                 			wch.WH_ID,wc.WC_NAME,a.PER_TYPE,
                                            g.PN_SHORTNAME||a.PER_NAME||' '||a.PER_SURNAME  AS FULLNAME_SHOW,
                                            wch.START_DATE,wch.END_DATE,wch.REMARK,c.POS_NO,a.PER_ID,
                                            TRG.CARD_NO AS CARD_NO_S,TRG.FINGER_COUNT,TRG.FACE_COUNT,
                                            d.POEM_NO,e.POEMS_NO,j.POT_NO,a.PER_STATUS,TRG.ACTIVE_FLAG
                                            from  PER_PERSONAL a  
                                            left join PER_WORK_CYCLEHIS wch on(a.PER_ID=wch.PER_ID)
                                            left join PER_WORK_CYCLE wc on(wc.WC_CODE=wch.WC_CODE)
                                            left join TA_REGISTERUSER TRG on (TRG.PER_ID=wch.PER_ID)
                                            left join PER_ORG b on(b.ORG_ID=a.ORG_ID) 
                                            left join PER_POSITION c on(c.POS_ID=a.POS_ID) 
                                            left join PER_POS_EMP d on(d.POEM_ID=a.POEM_ID) 
                                            left join PER_POS_EMPSER e on(e.POEMS_ID=a.POEMS_ID) 
                                            left join PER_LEVEL f on(f.LEVEL_NO=a.LEVEL_NO) 
                                            left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                                            left join PER_MGT h on(h.PM_CODE=c.PM_CODE)
                                            left join PER_LINE i on(i.PL_CODE=c.PL_CODE)
                                            left join PER_POS_TEMP j on (j.POT_ID=a.POT_ID)
                                 where 	1=1 $Tmpsearch_per_status_workcyclehis
                                                $search_condition
                                				$order_str
                            ) q1
                        ) where rnum between $rec_start and $rec_end ";
		} // end if
		$count_page_data = $db_dpis->send_cmd($cmd);
		if($count_page_data){
?>
  <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
    <tr align="center" class="table_head">
      <td nowrap width="10%" onClick="call_sort(1);"><strong>
        <? if($order_by==1&&$sort_by==1){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        เลขที่ตำแหน่ง</strong></td>
      <td nowrap width="25%" height="21" onClick="call_sort(2);"><strong>
        <? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        ชื่อ-สกุล</strong></td>
      <td width="15%" height="21" onClick="call_sort(3);"><strong>
        <? if($order_by==3&&$sort_by==3){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        วัน-เวลาที่เริ่มใช้</strong></td>
      <td width="15%" onClick="call_sort(4);"><strong>
        <? if($order_by==4&&$sort_by==4){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        วัน-เวลาที่สิ้นสุดรอบ</strong></td>
      <td width="15%" height="21" onClick="call_sort(5);"><strong>
        <? if($order_by==5&&$sort_by==5){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        รอบการมาปฏิบัติราชการ</strong></td>
      <td width="4%">บัตร</td>
      <td width="4%">นิ้ว</td>
      <td width="4%">หน้า</td>
      <td width="4%">ประวัติ</td>
      <td width="4%"><strong><?=$EDIT_TITLE;?></strong></td>
      <td width="4%">
      <?=$DEL_TITLE;?>
      <!--<input name="ChkdelALL" id="ChkdelALL" type="checkbox" onClick="return ChkdelAll(form1.ChkdelALL);">-->
      </td>
    </tr>
     <? 
			$current_list = "";
			$data_count = 0;
  			while($data = $db_dpis->get_array()) :
				$data_count++;
				if($data_count > $data_per_page) break;
				$DATA_WH_ID = $data[WH_ID];
				$current_list .= ((trim($current_list))?",":"") . "'$DATA_WH_ID'";
                $DATA_FULLNAME_SHOW = trim($data[FULLNAME_SHOW]);
				$DATA_WC_NAME = trim($data[WC_NAME]);
				$DATA_START_DATE = show_date_format(substr($data[START_DATE],0,10), $DATE_DISPLAY)." ".substr($data[START_DATE],11,5);
                
                $DATA_END_DATE ="";
                if($data[END_DATE]){
					$DATA_END_DATE = show_date_format(substr($data[END_DATE],0,10), $DATE_DISPLAY)." ".substr($data[END_DATE],11,5);
                }
				$DATA_REMARK = trim($data[REMARK]);
                $DATA_POS_NO = trim($data[POS_NO]).trim($data[POEM_NO]).trim($data[POEMS_NO]).trim($data[POT_NO]); 
                $TMP_PER_TYPE =  trim($data[PER_TYPE]);     
                $temp_PER_ID = trim($data[PER_ID]); 
                $DATA_CARD_NO_S = trim($data[CARD_NO_S]); 
                $DATA_FINGER_COUNT = trim($data[FINGER_COUNT]);
                $DATA_FACE_COUNT = trim($data[FACE_COUNT]);
                
                $cmd2 = " select count(WH_ID) AS MAXCOUNT from PER_WORK_CYCLEHIS where PER_ID=$data[PER_ID]"; 
                $db_dpis2->send_cmd($cmd2);
                $data2 = $db_dpis2->get_array();
                $MAXCOUNT = $data2[MAXCOUNT];
                
                $curstyle="";
                if($data[PER_STATUS] == 2){		//พ้นจากส่วนราชการ
                    $DATA_POS_NO = "";
                    $curstyle="color:#FF0000"; 
                } // end if	
                
                $hintactive = "สถานะใช้งานในตาราง register";
                if($data[ACTIVE_FLAG] == 0){	
                	$hintactive = "สถานะถูกยกเลิกในตาราง register";
                }
                
                
                
  ?>
    <tr class="table_body"  onMouseOver="this.className='table_body_over';" onMouseOut="this.className='table_body';" >
      <td align="center" style="<?=$curstyle; ?>"><?=$DATA_POS_NO;?></td>
      <td height="25" align="left" style="<?=$curstyle; ?>">&nbsp;<?=$DATA_FULLNAME_SHOW;?></td>
      <td align="center" style="<?=$curstyle; ?>"><?=$DATA_START_DATE;?></td>
      <td align="center" style="<?=$curstyle; ?>"><?=$DATA_END_DATE;?></td>
      <td align="left" style="<?=$curstyle; ?>">&nbsp;<?=$DATA_WC_NAME;?> </td>
      <td align="center" title="<?=$hintactive;?>">
      <? if($DATA_CARD_NO_S=="" || $DATA_CARD_NO_S=="0"){
                    echo "<input type='image' name='imageField' id='imageField' src='images/checkbox_blank.jpg'>";
      	   }else{
           			echo "<input type='image' name='imageField' id='imageField' src='images/true.gif'>";
           }
      
      ?>
      </td>
      <td align="center" title="<?=$hintactive;?>">
      <? //if($data_count==1 || $data_count== 7){
      		if($DATA_FINGER_COUNT=="" || $DATA_FINGER_COUNT== 0){
      		
                    echo "<input type='image' name='imageField' id='imageField' src='images/checkbox_blank.jpg'>";
      	   }else{
           			echo "<input type='image' name='imageField' id='imageField' src='images/true.gif'>";
           }
      
      ?></td>
      <td align="center" title="<?=$hintactive;?>">
      <? 
      		if($DATA_FACE_COUNT=="" || $DATA_FACE_COUNT== 0){
                    echo "<input type='image' name='imageField' id='imageField' src='images/checkbox_blank.jpg'>";
      	   }else{
           			echo "<input type='image' name='imageField' id='imageField' src='images/true.gif'>";
           }
      
      ?></td>
      <td align="center"><a href="<?=("javascript:call_add_personShowHis('".$temp_PER_ID."')")?>"><img src="images/desc.gif"  alt="<?=$DETAIL_TITLE?>" width="24" height="24" border="0"></a></td>
      <td align="center">
      <? if(!empty($DATA_WH_ID)){ 
      			if($PAGE_AUTH["edit"]=="Y"){
      		?>
					<a href="<?=("javascript:form1.action+='?UPD=1';form1.HIDWH_ID.value='$DATA_WH_ID';form1.command.value='';form1.submit();");?>"><img src="images/b_edit.png" border="0" alt="<?=$EDIT_ALT;?>"></a>
      			
        <?  	}
        }?>
      </td>
      <td align="center">
      <? if(!empty($DATA_WH_ID)){ 
      			if($PAGE_AUTH["del"]=="Y"){
                
					if($MAXCOUNT>1){
      		?>
      					<a href="<?=("javascript:call_add_personShowHis('".$temp_PER_ID."')")?>"><img src="images/b_drop.png"  alt="<?=$DETAIL_TITLE?>" border="0"></a>
      				<?}else{ ?>
      					<a href="<?=("javascript:confirm_delete('".$DATA_WH_ID."','".$DATA_FULLNAME_SHOW."','".$DATA_START_DATE."')")?>"><img src="images/b_drop.png" border="0" alt="ลบข้อมูล"></a>	
      <?  	
      				}
                }
        }?>
      <!--<input name="ChkDel<?=$data_count;?>" id="ChkDel<?=$data_count;?>" type="checkbox" value="<?=$data[WH_ID];?>" onClick="return CheckDel();">-->
      </td>
    </tr>
    
    <?	 endwhile;?>
    <!--<tr class="table_footer">
      <td align="center"></td>
      <td height="25" align="left">&nbsp;</td>
      <td align="center">&nbsp;</td>
      <td align="center">&nbsp;</td>
      <td align="center">&nbsp;</td>
      <td align="left"><input type="hidden" value="" id="HidedelID" name="HidedelID"></input></td>
      <td align="center">&nbsp;</td>
      <td align="center">&nbsp;</td>
      <td align="center">
      
     <? 
      if(empty($search_per_status_workcyclehis) || $search_per_status_workcyclehis==1){
      		if ($BUTTON_DISPLAY==1) { ?>
            <input name="btndel" type="button" class="button" value=" ลบ " onClick="form1.command.value='DELETE'; return seldelValue();" title="ลบข้อมูลรอบการมาปฏิบัติราชการ">
            <? } else { ?>
            <input name="image" type="image" onClick="form1.command.value='DELETE'; return seldelValue();" src="images/cancel.gif" alt="ลบข้อมูลรอบการมาปฏิบัติราชการ" border="0">
            <?
            }
      }?>
      </td>
    </tr>
    -->
  </table>
  <? if($total_page > 1) : ?>
          <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
            <tr>
              <td><?=$page_link;?></td>
            </tr>
          </table>
  <? endif; ?>&nbsp;
  
  <? } // if  count show ?>
  			<input name="hdnLine" type="hidden" value="<?=$data_count;?>">
  			<input type="hidden" name="current_list" value="<?=$current_list;?>">
    </div>      
    	</form>	
        

        
        
 <div id="DIV_TOPIC_2" style="display:<?=($show_topic==2)?"block":"none"?>;">
 <?
	//==Check เลขบัตร ปชช ซ้ำ
	if($command=="CHKADD" && trim($PER_CARDNO)){
		$cmd2="select PER_CARDNO from PER_PERSONAL  where PER_CARDNO=$PER_CARDNO";
		$db_dpis->send_cmd($cmd2);
		$data2 = $db_dpis->get_array();
		$card_no=$data2[PER_CARDNO];
		$c_duplicate=0;
		if($card_no){		
			$c_duplicate=1;
			$err_text = "เลขประจำตัวประชาชนซ้ำ $PER_CARDNO";
		}
	} //end if
?>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<? if($MAIN_VIEW){ ?>
    <tr> 
	  <td align="left" valign="top">
<?	
		$OPTIONAL_TITLE="".(($HIDE_HEADER)?"ข้อมูลทั่วไป":"") ;
		if ($UPD) $OPTIONAL_TITLE.=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE.=" &gt; ดูข้อมูล";
		include("current_location.html");
?>
	  </td>	</tr>
	<? } // end if ?>
</table>
 </div>       
        
        
        
        
        
        
		</td>
	</tr>
</table>



</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
</script>
</html>
