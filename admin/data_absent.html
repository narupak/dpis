<?
include("../php_scripts/connect_database.php");
include("php_scripts/data_absent.php");

$url=$_SERVER["REQUEST_URI"];
$query_str = parse_url($url, PHP_URL_QUERY);
if(empty($current_url)){
    $current_url=$query_str;
}
if($PAGE_AUTH["add"]=="Y" &&  ($SESS_PER_ID == $PER_ID)){
			$check_it = 0;
}else{
			$check_it = 1;
}
//echo $check_it."/".$SESS_PER_ID." == ".$PER_ID;
		
if(!$PER_TYPE){
    $PER_TYPE=1;
}
$ABS_STARTPERIOD = (trim($ABS_STARTPERIOD))? $ABS_STARTPERIOD : 3;
$ABS_ENDPERIOD = (trim($ABS_ENDPERIOD))? $ABS_ENDPERIOD : 3;
$ABS_LETTER = (trim($ABS_LETTER))? $ABS_LETTER : 1;

if($select_org_structure==""){$select_org_structure=1;}

$search_ab_code = trim($search_ab_code);
$search_abs_startdate = trim($search_abs_startdate);
$search_abs_enddate = trim($search_abs_enddate);		

$per_id_search = "";
$per_id_join = "";
if($holiday_extra=="") $holiday_extra = 0;

/*if($SEARCHABS_PER_ID){// $SEARCHABS_PER_ID (ผู้ลาที่ค้นหา)  + $PER_ID (ล็อกอิน)
$arr_search_condition[] = "(a.PER_ID = $SEARCHABS_PER_ID and (a.PER_ID = $PER_ID or a.REVIEW1_PER_ID = $PER_ID or a.REVIEW2_PER_ID = $PER_ID or a.AUDIT_PER_ID = $PER_ID or a.APPROVE_PER_ID = $PER_ID))";
}else{*/
if ($SESS_PER_ID){
    if($search_onlyme_flag==1){
        $arr_search_condition[] = "(a.PER_ID = $SESS_PER_ID)";
        //$arr_condition[] = "(a.PER_ID = $SESS_PER_ID)";
    }else{
        if($SESS_PER_AUDIT_FLAG == 1){
            $arr_search_condition[] = "(a.PER_ID = $SESS_PER_ID or a.REVIEW1_PER_ID = $SESS_PER_ID or a.REVIEW2_PER_ID = $SESS_PER_ID or a.AUDIT_PER_ID = $SESS_PER_ID or a.APPROVE_PER_ID = $SESS_PER_ID OR a.update_user = $SESS_PER_ID OR 1=1)";
            //$arr_condition[] = "(a.PER_ID = $SESS_PER_ID or a.REVIEW1_PER_ID = $SESS_PER_ID or a.REVIEW2_PER_ID = $SESS_PER_ID or a.AUDIT_PER_ID = $SESS_PER_ID or a.APPROVE_PER_ID = $SESS_PER_ID OR a.update_user = $SESS_PER_ID)";
        }else{
            $arr_search_condition[] = "(a.PER_ID = $SESS_PER_ID or a.REVIEW1_PER_ID = $SESS_PER_ID or a.REVIEW2_PER_ID = $SESS_PER_ID or a.AUDIT_PER_ID = $SESS_PER_ID or a.APPROVE_PER_ID = $SESS_PER_ID)";
            //$arr_condition[] = "(a.PER_ID = $SESS_PER_ID or a.REVIEW1_PER_ID = $SESS_PER_ID or a.REVIEW2_PER_ID = $SESS_PER_ID or a.AUDIT_PER_ID = $SESS_PER_ID or a.APPROVE_PER_ID = $SESS_PER_ID)";
        }
    }
}
//}

if ($search_ab_code)		$arr_search_condition[] = "(a.AB_CODE = '$search_ab_code')";
if ($search_per_type){
$arr_search_condition[] = "(trim(b.PER_TYPE) = $search_per_type)";
}else if ($search_per_type==0)	{	//ทั้งหมด
$arr_search_condition[] = "(trim(b.PER_TYPE) in('1','2','3','4')) ";
}

if ($search_abs_startdate || $search_abs_enddate) {
    $temp_date = explode("/", $search_abs_startdate);
    $temp_start = ($temp_date[2] - 543) ."-". $temp_date[1] ."-". $temp_date[0];
    $temp_date = explode("/", $search_abs_enddate);
    $temp_end = ($temp_date[2] - 543) ."-". $temp_date[1] ."-". $temp_date[0];		
    //$arr_search_condition[] = "(a.ABS_STARTDATE >= '$temp_start' and a.ABS_ENDDATE <= '$temp_end')"; /*ก่อนปรับ*/
    $arr_search_condition[] = "( a.ABS_STARTDATE between '$temp_start' and '$temp_end'   
                                 OR  a.ABS_ENDDATE between '$temp_start' and '$temp_end' 
                                 OR '$temp_start' between  a.ABS_STARTDATE and a.ABS_ENDDATE 
                                 or '$temp_end' between  a.ABS_STARTDATE and a.ABS_ENDDATE )";
}
if(empty($Submit3) && empty($image22) ){
    if($SESS_PER_AUDIT_FLAG == 1){
        if($SESS_AuditArray[0][0] <>0){
           $cmd_ass = " select ORG_ID,ORG_NAME from PER_ORG_ASS where ORG_ID = ".$SESS_AuditArray[0][0]; 
           $db_dpis2->send_cmd($cmd_ass);
           $data_ass = $db_dpis2->get_array();
           $def_search_org_name = $data_ass[ORG_NAME];
           $def_search_org_id = $data_ass[ORG_ID];
        }
        /*ปิดไว้เพราะไม่ต้องการ def หากต้องการให้ def ให้เปิด จะแสดงที่ ช่องสำนัก/กอง*/
        //if(!$search_org_name)$search_org_name=$def_search_org_name;
        //if(!$search_org_id)$search_org_id=$def_search_org_id;
    }
}



if(!$search_abs_approve)	$search_abs_approve=3;
if($search_abs_approve==4){	
    $arr_search_condition[] = "(a.APPROVE_FLAG in(0,1,2) or a.APPROVE_FLAG is null)";
}else{
    if($search_abs_approve==3){
        $arr_search_condition[] = "( (a.APPROVE_FLAG = 0 or a.APPROVE_FLAG is null) and ( a.CANCEL_FLAG = 0 or a.CANCEL_FLAG = 8 or a.CANCEL_FLAG = 9 ))";
    } else{
        if($search_abs_approve==1)	$search_abs_approve_tmp = 1; 
        if($search_abs_approve==2)	$search_abs_approve_tmp = 2; 
        $arr_search_condition[] = "(a.APPROVE_FLAG in($search_abs_approve_tmp))";
    }
}

//echo $SESS_PER_AUDIT_FLAG."|<br/>";

if($search_cancel_flag==1) $arr_search_condition[] = "(a.CANCEL_FLAG = 1)"; 
$tCon='';
if($SESS_PER_AUDIT_FLAG == 1){
    $cnt_AuditArray=count($SESS_AuditArray);
    if($cnt_AuditArray>0){
        $tCon="(";
        for ($i=0; $i < $cnt_AuditArray; $i++) {
            if ($i>0)
                $tCon .= " or ";
            $tCon .= "( b.ORG_ID=" .$SESS_AuditArray[$i][0];
            if ($SESS_AuditArray[$i][1] != 0)
                $tCon .= ' and b.ORG_ID_1='. $SESS_AuditArray[$i][1];
            $tCon .= ")";
        }
        $conORGASS=' OR a.PER_ID='.$SESS_PER_ID;
        $tCon=$tCon.$conORGASS;
        //die($tCon.$conORGASS);
        $conditionto_audit ='';
        if(empty($search_org_id)){
            $conditionto_audit =" or a.REVIEW1_PER_ID = $SESS_PER_ID or a.REVIEW2_PER_ID = $SESS_PER_ID or a.AUDIT_PER_ID = $SESS_PER_ID or a.APPROVE_PER_ID = $SESS_PER_ID ";
        }

        $tCon .= " $conditionto_audit )";
        $arr_search_condition[] = $tCon;
    }else{
    	$arr_search_condition[] =" ( a.REVIEW1_PER_ID = $SESS_PER_ID or a.REVIEW2_PER_ID = $SESS_PER_ID or a.AUDIT_PER_ID = $SESS_PER_ID or a.APPROVE_PER_ID = $SESS_PER_ID) ";
    }

    if($search_org_id && $select_org_structure==0){
        $arr_search_condition[] = "(d.ORG_ID=$search_org_id or e.ORG_ID=$search_org_id or f.ORG_ID=$search_org_id or g.ORG_ID=$search_org_id)";
        //$arr_search_condition[] = "";
    }elseif($search_org_id && $select_org_structure==1){
        $arr_search_condition[] = "(b.ORG_ID=$search_org_id ) ";
    }
}elseif($search_org_id){
    if($select_org_structure=='0' || empty($select_org_structure) ) $arr_search_condition[] = "(d.ORG_ID=$search_org_id or e.ORG_ID=$search_org_id or f.ORG_ID=$search_org_id or g.ORG_ID=$search_org_id)";
    if($select_org_structure=='1' )$arr_search_condition[] = "(b.ORG_ID=$search_org_id)";			
}elseif($search_department_id){
    $arr_search_condition[] = "(b.DEPARTMENT_ID = $search_department_id)";
}elseif($search_ministry_id){
    $cmd = " select ORG_ID from PER_ORG where ORG_ID_REF=$search_ministry_id ";
    $db_dpis->send_cmd($cmd);
    while($data = $db_dpis->get_array()) $arr_org[] = $data[ORG_ID];
    $arr_search_condition[] = "(b.DEPARTMENT_ID in (". implode(",", $arr_org) ."))";
} // end if

if(trim($search_per_name)) $arr_search_condition[] = "(b.PER_NAME like '$search_per_name%')";
if(trim($search_per_surname)) $arr_search_condition[] = "(b.PER_SURNAME like '$search_per_surname%')";

// SORT -----------------------
if(!$sort_by) $sort_by=3;
$sort_type = (isset($sort_type))?  $sort_type : "3:desc";
$arrSort=explode(":",$sort_type);
$SortType[$arrSort[0]]	=$arrSort[1];

if(!$order_by) $order_by=3;

if($order_by==1){	//ชื่อ-สกุล
$order_str = "b.PER_NAME ".$SortType[$order_by].",b.PER_SURNAME ".$SortType[$order_by];
}elseif($order_by==2){	//ประเภท
$order_str = "AB_NAME ".$SortType[$order_by];
} elseif($order_by==3) {	//ตั้งแต่วันที่
$order_str = "ABS_STARTDATE ".$SortType[$order_by].",CREATE_DATE ".$SortType[$order_by];
//if($temp_todate){ 
//$having_str = "HAVING ABS_STARTDATE<= ('$temp_todate') ";
//}		
} elseif($order_by==4) {	//ถึงวันที่
$order_str =  "ABS_ENDDATE  ".$SortType[$order_by];
}elseif($order_by==5) {	//จำนวนวัน
$order_str = "ABS_DAY ".$SortType[$order_by];
}elseif($order_by==6) {	//การส่งใบลา
$order_str = "ABS_LETTER ".$SortType[$order_by];
}elseif($order_by==7) {	//อนุมัติ
$order_str = "a.APPROVE_FLAG ".$SortType[$order_by];
}elseif($order_by==8) {	//ประเภทบุคลากร
$order_str = "b.PER_TYPE ".$SortType[$order_by];
}elseif($order_by==9) {	//วันที่ส่งใบลา
$order_str = "a.CREATE_DATE ".$SortType[$order_by];
}
//--------------------------------

$search_condition = "";
if ($arr_search_condition)	$search_condition = " and " . implode(" and ", $arr_search_condition);


//if ($arr_condition) $condition = " and " . implode(" and ", $arr_condition);
//echo $search_condition;
$cmd =" 	select 		a.PER_ID 
from 		PER_ABSENT a, PER_PERSONAL b, PER_POSITION d, PER_POS_EMP e, PER_POS_EMPSER f, PER_POS_TEMP g 
where	 a.PER_ID=b.PER_ID and b.POS_ID=d.POS_ID(+) and b.POEM_ID=e.POEM_ID(+) and b.POEMS_ID=f.POEMS_ID(+) and b.POT_ID=g.POT_ID(+) 
$search_condition 
order by 	$order_str";
//echo '<pre>'.$cmd;
$count_data = $db_dpis->send_cmd($cmd);
//$db_dpis->show_error();

$total_page = ceil( $count_data / $data_per_page );
$page_link = create_link_page($total_page, $current_page);
$limit_data = "";	


$EditTextDisable = "";
if($ABS_APPROVE_FLAG==1 && $UPD==1){
$EditTextDisable = "disabled";
}


//หาว่าอยู่กลุ่ม กจ. กรม หรือไม่--------------------------------
    $cmd4 = "	select	 b.CODE from	user_detail a, user_group b
					where a.group_id=b.id AND a.ID=".$SESS_USERID;
    $db_dpis2->send_cmd($cmd4);
    $data4 = $db_dpis2->get_array();
    if ($data4[CODE]) {
        $NAME_GROUP_HRD = $data4[CODE];
    }else{
        $NAME_GROUP_HRD = "";
    }
    
    //echo ">>>".$NAME_GROUP_HRD;
    
$DAY = date("d");
$MOUNT = date("m");
$YEAR = date("Y")+543;
$GETDATENOW = $DAY.'/'.$MOUNT.'/'.$YEAR;  
?>
<html>
    <head>
        <title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?></title>
        <meta http-equiv="Content-Type" content="text/html; charset=windows-874">
        <link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
        <link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
        <style type="text/css">
            <!--
            .style1 {
                color: #FFFFFF;
                font-weight: bold;
            }
            .style2 {color: #FFFFFF}
            .style3 {color: #393E4E}
            .style4 {color: #000000}
            -->
        .EScontainer {
           height: auto;
           overflow: hidden;
        }

        .ESright {
            width: 230px;
            float: right;
            /*background: #aafed6;*/
        }

        .ESleft {
            float: none; /* not needed, just for clarification */
            /*background: #e8f6fe;*/
            /* the next props are meant to keep this block independent from the other floated one */
            width: auto;
            overflow: hidden;
        }
        </style>
    </head>
    <script type="text/javascript" src="java_scripts/chk_date.js"></script>
    <script type="text/javascript" src="java_scripts/calendar.js"></script>
    <script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
    <script type="text/javascript" src="java_scripts/function_utility.js"></script> 
	<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
    <script language="JavaScript">
         var cur_date = new Date("<?php echo $cur_date;?>");
         
        function change_current_page( page ){
            form1.current_page.value = page;
            form1.submit();
        }
	
	var check_it = "<?php echo $check_it;?>"
	
        function changedateformat(name,str) {
            var arr = str.split('/');
            if((str) && (str != arr[0]+'/'+arr[1]+'/'+arr[2])){
                name.value = str.substr(0,2) + "/" + str.substr(2,2) + "/"  + str.substr(4,4) ;
            }
            chk_date(name, "BDH");
        }
        function copydate(){

            if(form1.ABS_ENDDATE.value=='' && form1.ABS_STARTDATE.value!=''){
                form1.ABS_ENDDATE.value=form1.ABS_STARTDATE.value;
				
            }
			
			if(form1.ABS_STARTDATE.value!=''){
				get_age_over();
				calcDaysBetweenDateNew(1,'','NO');
			}
        }
        function confirm_delete(abs_id , ab_name){
            if(confirm("ต้องการลบประวัติการลา นี้ [ " + ab_name + " ]  ใช่หรือไม่ ?")){
                form1.command.value = "DELETE";
                form1.ABS_ID.value = abs_id;
                form1.submit();
            } // end if
        }
		
		var strVacationOver = function(abs_type){
			//alert('OK');
            if(abs_type=='04'){
                var req = new XMLHttpRequest();  //Inint_AJAX();
                req.onreadystatechange = function () {
                    if (req.readyState==4) {
                        if (req.status==200) {
                            //alert(req.responseText);
                            if(req.responseText=='OVER'){
                               // alert('ไม่อนุญาตให้ทำรายการ! (กรณีลาพักผ่อน กรุณายื่นใบลาล่วงหน้า)');
                               // document.getElementById("Submit_add2").style.color='gainsboro';
                               // document.getElementById("Submit_add2").disabled = true;
                               document.getElementById('ISOVER').value ='OVER';
                            }else{
                               document.getElementById('ISOVER').value ='';
                              //  document.getElementById("Submit_add2").style.color='black';
                              //  document.getElementById("Submit_add2").disabled = false;
                            }
                        }
                    }
                };
                var url = 'php_scripts/ajget_VacationOver.php';
                req.open("GET", url+'?abs_startdate='+form1.ABS_STARTDATE.value/*15/09/2559*/
                    +'&abs_startperiod='+document.getElementById('HID_ABS_STARTPERIOD').value
                    +'&PER_ID='+document.getElementById('PER_ID').value);
                req.setRequestHeader("Content-Type", "application/json;charset=utf-8"); // set Header
                req.send(); //ส่งค่า
				
            }else{
                document.getElementById('ISOVER').value ='';
				
            }
        }
	
        function compare_diff_date(startdate,enddate,type) {
            var StartDateArr  =  startdate.split("/");
            //var StartDateF = new Date(parseInt(StartDateArr[2])-543,parseInt(StartDateArr[1])-1,parseInt(StartDateArr[0]));
            var StartDateF = StartDateArr[2]+StartDateArr[1]+StartDateArr[0];
		   
            var StopDateArr  =  enddate.split("/");
            //var StopDateF = new Date(parseInt(StopDateArr[2])-543,parseInt(StopDateArr[1])-1,parseInt(StopDateArr[0]));
            var StopDateF = StopDateArr[2]+StopDateArr[1]+StopDateArr[0];

            //alert(StartDateF+'|'+StopDateF);
            if (StopDateF < StartDateF){
                //alert('1');
                return false;
            }else{
                //alert('2:'+type);
                if(type==1){
                    if(document.getElementById('ISOVER').value=='OVER'){
                        //alert('3');
                        return false;
                    }else{
                        //alert('4');
                        return true;
                    }
					
                }else{
                    //alert('5');
                    return true;
                }
                
            }
        }
	
        function MM_openBrWindow(theURL,winName,features) { //v2.0
            window.open(theURL,winName,features);
        }
	
        function call_search_ministry () {	
            var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
            parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
            call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$MINISTRY_TITLE?>");		
        }

        function call_search_department () {	
            var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$search_ministry_id":"form1.search_ministry_id.value")?>;
            var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
            if(MINISTRY_ID != ""){
                parameter = "&send_by=search_department&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
                call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$DEPARTMENT_TITLE?>");		
            }else{
                    <? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
                        alert('<?=$MINISTRY_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
                        <? }else{ ?>
                        alert('<?=$MINISTRY_ALERT?>');
                    form1.btn_search_ministry.focus();
                        <? } ?>
                } // end if
        }

        function call_search_org () {
            var DEPARTMENT_ID = <?=(($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4)?"$DEPARTMENT_ID":"form1.search_department_id.value")?>;
            if(DEPARTMENT_ID != ""){
                if(form1.select_org_structure[0].checked) org_search_file ="search_org";
                else if(form1.select_org_structure[1].checked) org_search_file ="search_org_ass"; 
                parameter = "&send_by="+org_search_file+"&OL_CODE=03&ORG_ID_REF=" + DEPARTMENT_ID;
                call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"<?=$ORG_TITLE?>");		
            }else{
                    <? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
                        alert('<?=$DEPARTMENT_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
                        <? }else{ ?>
                        alert('<?=$DEPARTMENT_ALERT?>');
                    form1.btn_department.focus();
                        <? } ?>
                } // end if
        }
	
        function call_search_person(var_type) {	
            parameter = "";
            if(form1.MINISTRY_ID.value)	parameter += "&isLock=1&LOCK_MINISTRY_ID="+form1.MINISTRY_ID.value;
            if(form1.DEPARTMENT_ID.value)	parameter += "&LOCK_DEPARTMENT_ID="+form1.DEPARTMENT_ID.value;
            if(form1.ORG_CHK_ASS_ID.value > 0){
				parameter += "&CHKType_ASS=1&LOCK_ORG_ID="+form1.ORG_CHK_ASS_ID.value;
			}else if(form1.ORG_ID.value){	
			 	parameter += "&CHKType_ASS=0&LOCK_ORG_ID="+form1.ORG_ID.value;
			}else{
				parameter += "&CHKType_ASS=1";
			}
            if(var_type=="APPROVE_" || var_type=="AUDIT_" || var_type=="REVIEW1_" || var_type=="REVIEW2_") {
                if(form1.PER_ID.value && var_type!="AUDIT_")						parameter += "&EXCEPT_PER_ID=" + form1.PER_ID.value;
                if(form1.APPROVE_PER_ID.value && var_type!="AUDIT_")	parameter += "," + form1.APPROVE_PER_ID.value;
                if(form1.AUDIT_PER_ID.value && var_type!="AUDIT_")		parameter += "," + form1.AUDIT_PER_ID.value;
                if(form1.REVIEW1_PER_ID.value && var_type!="AUDIT_")		parameter += "," + form1.REVIEW1_PER_ID.value;	
                if(form1.REVIEW2_PER_ID.value && var_type!="AUDIT_")	parameter += "," + form1.REVIEW2_PER_ID.value;
                if(var_type=="AUDIT_")					parameter += "&AUDIT_FLAG=1";
            }
            parameter += "&pageform=absent&send_by="+var_type; 
            call_openDialog("search_person.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,800,"รายชื่อ<?=$PERSON_TITLE?>");		
        	
			/* ของเดิม วันที่ 30/01/60 By Kittiphat
			 	if(form1.PER_ID.value && var_type!="AUDIT_")						parameter += "&EXCEPT_PER_ID=" + form1.PER_ID.value;
                if(form1.APPROVE_PER_ID.value && var_type!="AUDIT_")	parameter += "," + form1.APPROVE_PER_ID.value;
                if(form1.AUDIT_PER_ID.value && var_type!="AUDIT_")		parameter += "," + form1.AUDIT_PER_ID.value;
                if(form1.REVIEW1_PER_ID.value && var_type!="AUDIT_")		parameter += "," + form1.REVIEW1_PER_ID.value;	
                if(form1.REVIEW2_PER_ID.value && var_type!="AUDIT_")	parameter += "," + form1.REVIEW2_PER_ID.value;
			
			*/
		
		}
        function BtnChangeDate(ABS_ID,days){
            call_openDialog("data_absent_change.html?UPD=1&ABS_ID="+ABS_ID+'&Days='+days,1100,800,'ลดวันลา');
        }
        
        function BtnCencleAbsent(ABS_ID,days){
            call_openDialog("data_absent_cancel.html?UPD=1&ABS_ID="+ABS_ID+'&Days='+days,500,600,'เปลี่ยนแปลงวันลา');
        }
        function BtnChoicePrint(ABS_ID,TMP_AB_CODE,TMP_CANCEL_FLAG,TMP_APPROVE_FLAG){
            call_openDialog("data_absent_print.html?UPD=1&TMP_ABS_ID="+ABS_ID+'&TMP_AB_CODE='+TMP_AB_CODE+'&TMP_CANCEL_FLAG='+TMP_CANCEL_FLAG+'&TMP_APPROVE_FLAG='+TMP_APPROVE_FLAG,500,600,'พิมพ์ใบลา');
        }
        

        function call_search_absenttype (code, name) {	
            parameter = "";
            ab_code = eval('form1.'+code);
            ab_name = eval('form1.'+name);
            parameter = "&data_absent_flag=1";
            call_openDialog("search_absenttype.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,1100,800,"ประเภทการลา");		
        }
	
        function show_all_absent () {
            //form1.search_ab_code.value = ""; 
            //form1.search_ab_name.value = ""; 
            //form1.search_abs_startdate.value = ""; 
            //form1.search_abs_enddate.value = ""; 
            form1.search_abs_startdate.value = '';
            form1.search_abs_enddate.value = '';
            form1.search_abs_approve.value = 4;
            //form1.SEARCHABS_PER_ID.value = '';
            //form1.SEARCHABS_PER_NAME.value = '';
            form1.search_ab_code.value = '';
            form1.search_ab_name.value = '';
            form1.search_per_type[0].selected = true;
            form1.search_onlyme_flag.checked = false;
            form1.search_cancel_flag.checked = false;
            form1.current_page.value=0;	
            form1.submit();
        }
        
        
        function get_age_over(){
        //alert(form1.AB_CODE.value);
            if(form1.AB_CODE.value=='04'){
                var req = new XMLHttpRequest();  //Inint_AJAX();
                req.onreadystatechange = function () {
                    if (req.readyState==4) {
                        if (req.status==200) {
                            //alert('get_age_over '+req.responseText);
                            document.getElementById('txtPER_STARTDATE').value =req.responseText;
                        }
                    }
                };
                var url = 'php_scripts/ajget_age_over.php';
                req.open("GET", url+'?PER_ID='+form1.PER_ID.value+'&ABS_STARTDATE='+form1.ABS_STARTDATE.value);
                req.setRequestHeader("Content-Type", "application/json;charset=utf-8"); // set Header
                req.send(); //ส่งค่า
            }
        }
	
        function calcDaysBetweenDate(chkSave,command){
			if( form1.ABS_DAY.value <= "0" && form1.holiday_extra.value == 0 ){ // วันลาติดลบ คือลาครึ่งวัน ในวันหยุด
					
						alert("จำนวนวันลาไม่ถูกต้อง กรุณาตรวจสอบจำนวนวันลาอีกครั้ง");
						form1.butt_calc_absent.focus();
						return false;
			}
            <?php
            if($SESS_PER_ID==$APPROVE_PER_ID && ($VIEW || $UPD) ){
            ?>
            if( (document.getElementById('ABS_APPROVE_FLAG1').checked==false && document.getElementById('ABS_APPROVE_FLAG2').checked==false) ||
                (document.getElementById('ABS_APPROVE_FLAG1').checked==false && document.getElementById('ABS_APPROVE_FLAG2').checked==false)
               ){
                alert('ผู้อนุญาตการลา ยังไม่ได้แสดงความเห็น');
                form1.APPROVE_DISPLAY_DATE.focus();
                return false;
            }
            <?php
            }
            ?>
            
            //strVacationOver(document.getElementById('AB_CODE').value);
           
             // IE ใช้งานไม่ได้
            /*var date = cur_date;//new Date(); ajsysdate
            thisdate = date.getDate();
            thismonth = (parseInt(date.getMonth())+1);	
            if(thisdate.toString().length==1)			thisdate = "0"+thisdate;
            if(thismonth.toString().length==1)		thismonth = "0"+thismonth;	
            var tothisdate = thisdate + "/" + thismonth + "/" + (parseInt(date.getFullYear())+543);	//หาวันที่ วันปัจจุบัน*/
            var tothisdate =form1.hid_datenow.value;
            var str_start_date = form1.ABS_STARTDATE.value;
            var str_end_date = form1.ABS_ENDDATE.value;
            var ab_count = form1.AB_COUNT.value; 
		
            //alert(form1.AB_CODE.value+'!!'+tothisdate+' -- '+str_start_date);
            //alert(command+':'+form1.AB_CODE.value+':'+compare_diff_date(tothisdate, str_start_date,1));
            
            if(command=='ADD' && form1.AB_CODE.value=='04'){
                if(document.getElementById('txtPER_STARTDATE').value <600){
                    alert('ณ วันที่ลา อายุราชการยังไม่ถึง 6 เดือน ไม่สามารถลาพักผ่อนได้');
                    return false;
                }
            }
			
			//alert(tothisdate+'|'+str_start_date);
            
            //alert(command+'|'+compare_diff_date(tothisdate, str_start_date,1));
            if(form1.AB_NAME.value=="") {
                alert("กรุณาระบุ ประเภทการลา");
                form1.AB_NAME.focus();
                return false;
            } else if(str_start_date=="") {
                alert("กรุณาระบุ ตั้งแต่วันที่");
                form1.ABS_STARTDATE.focus();
                return false;
            } 
			
			<? if ($SESS_USERGROUP!=1  ){ ?>
				if(( command=='ADD' ) && (form1.AB_CODE.value!='01'&&form1.AB_CODE.value!='03'&&form1.AB_TYPE.value!='01') && compare_diff_date(tothisdate, str_start_date,1)==false){   // วันปัจจุบัน > วันที่ key เริ่มต้น (เฉพาะลาป่วย (01) และลากิจ (03) key ย้อนหลังได้ check เฉพาะวันเริ่มต้น)
					var strOver ='';
					if(document.getElementById('ISOVER').value=='OVER'){
						var strOver =' (กรณีลาพักผ่อน กรุณายื่นใบลาล่วงหน้า)';
					}
					
					alert('ไม่สามารถเพิ่มวันลาย้อนหลังของประเภท'+form1.AB_NAME.value+'ได้'+strOver); /*(กรณีลาพักผ่อน กรุณายื่นใบลาล่วงหน้า)*/
					form1.ABS_STARTDATE.focus();
					return false;
				} 
			<? }?>
			
			if(str_end_date=="") {
                alert("กรุณาระบุ  ถึงวันที่");
                form1.ABS_ENDDATE.focus();
                return false;
            } else if(compare_diff_date(str_start_date, str_end_date,0)==false){
                alert('กรุณาระบุ ถึงวันที่ ใหม่ ต้องมีค่ามากกว่า ตั้งแต่วันที่');
                form1.ABS_ENDDATE.focus();
                return false;
            } else if(document.all.DIV_REASON.style.display == "" && (form1.ABS_REASON && form1.ABS_REASON.value=="")) {
                alert("กรุณาระบุ  เหตุผลการลา");
                form1.ABS_REASON.focus();
                return false;
            } else if(form1.APPROVE_PER_ID.value=="") {
                alert("กรุณาระบุ  ผู้อนุญาตการลา");
                form1.btn_approve_person.focus();
                return false;
            } else {	
                    
                if(str_start_date){
                    var arrTmp = str_start_date.split("/");
                    var start_year = parseInt(arrTmp[2]) - 543;
                    var start_month = arrTmp[1];
                    var start_date = arrTmp[0];
				
                    str_start_date = start_month + "/" + start_date + "/" + start_year;
                }else{
				alert('st_4');
                    alert("ใส่วันที่เริ่มต้น");
                    form1.ABS_DAY.value = "";
                    form1.ABS_STARTDATE.focus();
                    return false;
                } // end if
                if(str_end_date){
                    var arrTmp = str_end_date.split("/");
                    var end_year = parseInt(arrTmp[2]) - 543;
                    var end_month = arrTmp[1];
                    var end_date = arrTmp[0];
				
                    str_end_date = end_month + "/" + end_date + "/" + end_year;
                }else{
                    if(form1.AB_CODE.value.trim() != "10"){	// is not late
                        alert("ใส่วันที่สิ้นสุด");
                        form1.ABS_DAY.value = "";
                        form1.ABS_ENDDATE.focus();
                        return false;
                    }
                } // end if
                        
                // check วันลาระหว่างเดือน มี.ค - เม.ย. และ ก.ย. - ต.ค.
                if((start_month=="03" && end_month=="04") || (start_month=="09" && end_month=="10")){
                    if(form1.AB_CODE.value.trim() == "04"){			// พักผ่อน		(ก.ย. - ต.ค.)
                       
                       if(start_month=="09" && end_month=="10"){
                            alert("ไม่สามารถลาลาพักผ่อนระหว่างเดือนกันยายน ถึงตุลาคมได้");
                            form1.ABS_DAY.value = "";
                            form1.ABS_STARTDATE.focus();
                            return false;
                        }
                    }else{		//  อื่นๆ		(มี.ค - เม.ย. และ ก.ย. - ต.ค.)
                        /*comment on version 5.0.1.9*/
                        /*if(start_month=="03" && end_month=="04"){
                            alert("ไม่สามารถลาระหว่างเดือนมีนาคม ถึงเมษายนได้");
                            form1.ABS_DAY.value = "";
                            form1.ABS_STARTDATE.focus();
                            return false;
                        }*/
                        
                        /*if(start_month=="09" && end_month=="10"){
                            alert("ไม่สามารถลาระหว่างเดือนกันยายน ถึงตุลาคมได้");
                            form1.ABS_DAY.value = "";
                            form1.ABS_STARTDATE.focus();
                            return false;
                        }*/
                    }
                } // end if

                if(form1.AB_CODE.value.trim() != "10"){			// is not late
                  
                    var STARTPERIOD = 0;
                    var objRadio = form1.ABS_STARTPERIOD;
                    STARTPERIOD = objRadio.options[objRadio.selectedIndex].value;
		
                    var ENDPERIOD = 0;
                    var objRadio = form1.ABS_ENDPERIOD;
                    ENDPERIOD = objRadio.options[objRadio.selectedIndex].value;
                    //				alert(STARTPERIOD+'+++'+ENDPERIOD);	

                    //				alert("date st ("+form1.ABS_STARTDATE.value+")-> en ("+form1.ABS_ENDDATE.value+")");
                    //document.all.PROCESS_IFRAME.src = "find_absent_day.html?linkfrom='data_absent'&chkSave=" + chkSave + "&PER_ID=" + form1.PER_ID.value + "&ABS_ID=" + form1.ABS_ID.value + "&AB_CODE=" + form1.AB_CODE.value + "&AB_COUNT=" + form1.AB_COUNT.value + "&STARTDATE=" + form1.ABS_STARTDATE.value + "&STARTPERIOD=" + STARTPERIOD + "&ENDDATE=" + form1.ABS_ENDDATE.value + "&ENDPERIOD=" + ENDPERIOD + "&VAR_DAY=ABS_DAY&command=" +command;
				
				
					if(form1.AB_CODE.value == '04' && (form1.AB_COUNT_04.value >= 0)){
						if(form1.CHK_NEXTYEAR.value == 1){ // ปีงบประมาณหน้า
				
						//alert((parseFloat(form1.ABS_DAY_NEXT_YAER.value) - parseFloat(form1.ABS_DAY.value)));
							/* เดิม if((parseFloat(form1.AB_COUNT_04_NEXTYEAR.value) - parseFloat(form1.ABS_DAY.value)) < 0){ */ // วันที่ลาพักผ่อนมา เกินวันที่ยังเหลือสิทธิ์
							if((parseFloat(form1.ABS_DAY_NEXT_YAER.value) - parseFloat(form1.ABS_DAY.value)) < 0 && (parseFloat(form1.ABS_DAY_NEXT_YAER.value)!=0)){ 
								alert("ไม่สามารถลาพักผ่อนเกิน "+parseFloat(form1.AB_COUNT_04_NEXTYEAR.value)+" วันได้");
								return false;
							}
						}else{
							if((parseFloat(form1.AB_COUNT_04.value) - parseFloat(form1.ABS_DAY.value)) < 0){ // วันที่ลาพักผ่อนมา เกินวันที่ยังเหลือสิทธิ์
								alert("ไม่สามารถลาพักผ่อนเกิน "+parseFloat(form1.AB_COUNT_04.value)+" วันได้");
								return false;
							}
						}
					}
					
					if((form1.ABS_DAY.value == "" || form1.ABS_DAY.value == "0") && form1.holiday_extra.value == 0){
					
						alert("จำนวนวันลาไม่ถูกต้อง กรุณาตรวจสอบจำนวนวันลาอีกครั้ง");
						form1.butt_calc_absent.focus();
						return false;
					}
					
					if(form1.HID_count_duplicate_date.value == "1"){
						alert("พบข้อมูลการลาในวันที่ต้องการลาแล้ว กรุณาเลือกวันที่ใหม่อีกครั้ง\nกรณีที่ได้มีการยกเลิกวันลาไปแล้ว ต้องได้รับการอนุมัติการยกเลิกวันลาก่อน จึงจะทำการลาในวันดังกล่าวได้");
						return false;
					}
					
					// ตรงนี้
					//return false;
                      
					var hol_exday = form1.holiday_extra.value;
					var abs_day_ = form1.ABS_DAY.value;
					var abs_day_old = form1.ABS_DAY_OLD.value;

					
					if(form1.EDIT_ABSENT_DAY.value == "Y" && abs_day_!= abs_day_old){
						if(confirm('จำนวนวันลาทั้งหมด ' +form1.ABS_DAY.value+' วัน ท่านยืนยันจำนวนวันลาดังกล่าวใช่หรือไม่?\nคลิกปุ่ม [OK] เพื่อยืนยันบันทึกข้อมูล\nคลิกปุ่ม [Cancel] เพื่อกลับไปตรวจสอบข้อมูลอีกครั้ง')){
							
							if (!form1.ABS_ID.value)				form1.command.value = "ADD";
							else if (form1.ABS_ID.value)		form1.command.value = "UPDATE";
							form1.submit();	
						}else{
                            
							if(hol_exday > 0 && check_it == 0){
							 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+1,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
						return false;	
					}
						
						}
						
					}else{
					
						if(hol_exday > 0 && check_it == 0){//ถ้ามีวันหยุดราชการ และ เป็นเจ้าตัว
							 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+0,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
						return false;	
						}
						
						if (!form1.ABS_ID.value)				form1.command.value = "ADD";
						else if (form1.ABS_ID.value)		form1.command.value = "UPDATE";
						form1.submit();	
					}
					
				
					
                    //alert("day="+form1.ABS_DAY.value);
                }else{										// is late     
                    form1.ABS_DAY.value = "1";
                    if (form1.AB_CODE.value) { 
                        if (!form1.ABS_ID.value)				form1.command.value = "ADD";
                        else if (form1.ABS_ID.value)		form1.command.value = "UPDATE";
                        form1.submit();	
                    }
                }
            } // end else
            return true;
        }
		
		
		function calcDaysBetweenDateNew(chkSave,command,chk){
            var tothisdate =form1.hid_datenow.value;
            var str_start_date = form1.ABS_STARTDATE.value;
            var str_end_date = form1.ABS_ENDDATE.value;
			
			//alert(tothisdate+'|'+str_start_date);
            
           //alert(compare_diff_date(tothisdate, str_start_date,1));
		   //alert('NEW='+document.getElementById('ISOVER').value);
            if(form1.AB_NAME.value=="") {
                alert("กรุณาระบุ ประเภทการลา");
                form1.AB_NAME.focus();
                return false;
            } else if(str_start_date=="") {
                alert("กรุณาระบุ ตั้งแต่วันที่");
                form1.ABS_STARTDATE.focus();
                return false;
			//} else if( (form1.AB_CODE.value!='01'&&form1.AB_CODE.value!='03'&&form1.AB_TYPE.value!='01') && compare_diff_date(tothisdate, str_start_date,1)==false){   // วันปัจจุบัน > วันที่ key เริ่มต้น (เฉพาะลาป่วย (01) และลากิจ (03) key ย้อนหลังได้ check เฉพาะวันเริ่มต้น)
                
            }
			
			/* || ($SESS_USERGROUP==1 && !isset($UPD)) */
			<? if ($SESS_USERGROUP!=1  ){ ?>
			
				if(chk=='YES'){
					if( (form1.AB_CODE.value!='01'&&form1.AB_CODE.value!='03'&&form1.AB_TYPE.value!='01') && compare_diff_date(tothisdate, str_start_date,1)==false){   // วันปัจจุบัน > วันที่ key เริ่มต้น (เฉพาะลาป่วย (01) และลากิจ (03) key ย้อนหลังได้ check เฉพาะวันเริ่มต้น)
						var strOver ='';
						if(document.getElementById('ISOVER').value=='OVER'){
							var strOver =' (กรณีลาพักผ่อน กรุณายื่นใบลาล่วงหน้า)';
						}
						alert('ไม่สามารถเพิ่มวันลาย้อนหลังของประเภท'+form1.AB_NAME.value+'ได้'+strOver); 
						form1.ABS_STARTDATE.focus();
						return false;
					}
				}
			
			<? }?>
			
            if(str_end_date=="") {
                //alert("กรุณาระบุ  ถึงวันที่");
				form1.ABS_ENDDATE.value = form1.ABS_STARTDATE.value;
                form1.ABS_ENDDATE.focus();
                return false;
            } else if(compare_diff_date(str_start_date, str_end_date,0)==false){
                alert('กรุณาระบุ ถึงวันที่ ใหม่ ต้องมีค่ามากกว่า ตั้งแต่วันที่');
                form1.ABS_ENDDATE.focus();
                return false;
           
            } else {	
                    
                if(str_start_date){
                    var arrTmp = str_start_date.split("/");
                    var start_year = parseInt(arrTmp[2]) - 543;
                    var start_month = arrTmp[1];
                    var start_date = arrTmp[0];
				
                    str_start_date = start_month + "/" + start_date + "/" + start_year;
                }else{
                    alert("ใส่วันที่เริ่มต้น");
                    form1.ABS_DAY.value = "";
                    form1.ABS_STARTDATE.focus();
                    return false;
                } // end if
                if(str_end_date){
                    var arrTmp = str_end_date.split("/");
                    var end_year = parseInt(arrTmp[2]) - 543;
                    var end_month = arrTmp[1];
                    var end_date = arrTmp[0];
				
                    str_end_date = end_month + "/" + end_date + "/" + end_year;
                }else{
                    if(form1.AB_CODE.value.trim() != "10"){	// is not late
                        alert("ใส่วันที่สิ้นสุด");
                        form1.ABS_DAY.value = "";
                        form1.ABS_ENDDATE.focus();
                        return false;
                    }
                } // end if
                        
                // check วันลาระหว่างเดือน มี.ค - เม.ย. และ ก.ย. - ต.ค.
                if((start_month=="03" && end_month=="04") || (start_month=="09" && end_month=="10")){
                    if(form1.AB_CODE.value.trim() == "04"){			// พักผ่อน		(ก.ย. - ต.ค.)
                       
                       if(start_month=="09" && end_month=="10"){
                            alert("ไม่สามารถลาลาพักผ่อนระหว่างเดือนกันยายน ถึงตุลาคมได้");
                            form1.ABS_DAY.value = "";
                            form1.ABS_STARTDATE.focus();
                            return false;
                        }
                    }else{		//  อื่นๆ		(มี.ค - เม.ย. และ ก.ย. - ต.ค.)

                    }
                } // end if

                if(form1.AB_CODE.value.trim() != "10"){			// is not late
					//alert(form1.nex_year.value);
                    var STARTPERIOD = 0;
                    var objRadio = form1.ABS_STARTPERIOD;
                    STARTPERIOD = objRadio.options[objRadio.selectedIndex].value;
		
                    var ENDPERIOD = 0;
                    var objRadio = form1.ABS_ENDPERIOD;
                    ENDPERIOD = objRadio.options[objRadio.selectedIndex].value;
                    //				alert(STARTPERIOD+'+++'+ENDPERIOD);	

                    //alert(form1.ABS_STARTDATE.value+"**"+form1.ABS_ENDDATE.value+"**"+form1.ABS_DAY.value);
					if(form1.ABS_STARTDATE.value!='' && form1.ABS_ENDDATE.value!=''){
						//alert('OK2');
                    	document.all.PROCESS_IFRAME.src = "find_absent_day.html?linkfrom='data_absent'&chkSave=" + chkSave + "&PER_ID=" + form1.PER_ID.value + "&ABS_ID=" + form1.ABS_ID.value + "&AB_CODE=" + form1.AB_CODE.value + "&AB_COUNT=" + form1.AB_COUNT.value + "&STARTDATE=" + form1.ABS_STARTDATE.value + "&STARTPERIOD=" + STARTPERIOD + "&ENDDATE=" + form1.ABS_ENDDATE.value + "&ENDPERIOD=" + ENDPERIOD + "&VAR_DAY=ABS_DAY&command=" +command;
					}
                   //alert("day="+form1.ABS_DAY.value);
                }else{										// is late
                            
                    form1.ABS_DAY.value = "1";
                    if (form1.AB_CODE.value) { 
                        if (!form1.ABS_ID.value)				form1.command.value = "ADD";

                        else if (form1.ABS_ID.value)		form1.command.value = "UPDATE";
                        form1.submit();	
                    }
                }
            } // end else

            return true;
        }

        function call_pdf_report() {
            var currDate = new Date();
            var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
            rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
            var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
            document.form1.target = "_blank";
            document.form1.action = "report/rpt_data_absent.php?report_title=" + report_title + "&UTC" + rptDate;
            document.form1.submit();
            document.form1.target = "_self";
            document.form1.action = "data_absent.html";
        } 
	function ProcessUploading(){
            document.getElementById("obj_uploading").style.display = "block";
            document.getElementById("obj_uploading").style.top = document.body.scrollTop + ((document.body.clientHeight / 2) + 5);
            document.getElementById("obj_uploading").style.left = document.body.scrollLeft  + ((document.body.clientWidth / 2) - 80);
            document.getElementById("obj_uploading").style.visibility = "visible";
            return true;
        }
        function calcDaysBetweenDateV2(){
            var req = new XMLHttpRequest();  //Inint_AJAX();
            req.onreadystatechange = function () {
                if (req.readyState==4) {
                    if (req.status==200) {
                        
                         document.getElementById('LblBetween').innerHTML  = req.responseText;
                         document.getElementById("obj_uploading").style.display = "none";
                         //return ProcessUploading();
                         //alert(req.responseText);
                         /*if(req.responseText=='1'){
                             alert('วันเดียวกัน เริ่มครึ่งเช้า สิ้นสุดครึ่งบ่าย ถือเป็น 1 วัน\nโปรดแก้ไขเป็น "ทั้งวัน" ');
                         }else if(req.responseText=='2'){
                             alert('วันเดียวกัน เริ่มครึ่งบ่าย สิ้นสุดครึ่งเช้า ไม่ถูกต้อง\nโปรดแก้ไข');
                         }else if(req.responseText=='3'){
                             alert('วันเดียวกัน เริ่มทั้งวัน สิ้นสุดครึ่งบ่าย ถือเป็น 1 วัน\nโปรดแก้ไขสิ้นสุดเป็น "ทั้งวัน" ');
                         }else if(req.responseText=='4'){
                             alert('วันเดียวกัน เริ่มครึ่งเช้า สิ้นสุดทั้งวัน ถือเป็น 1 วัน\nโปรดแก้ไขเริ่มเป็น "ทั้งวัน" ');
                         }else if(req.responseText=='5'){
                             alert('เริ่มวันแรกเป็นครึ่งเช้า เว้นบ่าย ไม่ถูกต้อง\nโปรดทำแยกเป็นลาอีก 1 รายการ');
                         }else if(req.responseText=='6'){    
                             alert('สิ้นสุดจบที่ครึ่งบ่าย เว้นเช้า ไม่ถูกต้อง\nโปรดทำแยกเป็นลาอีก 1 รายการ');
                         }else{
                             document.getElementById('LblBetween').innerHTML  = req.responseText;
                         }*/
                        /*if(req.responseText!=''){
                            alert('ไม่สามารถเปลี่ยนวันลาได้ เนื่องจากเกินช่วงวันลาที่ได้อนุมัตไปแล้ว');
                        }*/
                    }
                }
            };
            var url = 'php_scripts/genlistdateutf8.php';
            /*req.open("GET", url+'?OldBgnDay='+form1.OLD_ABS_STARTDATE.value
                +'&OldEndDay='+form1.OLD_ABS_ENDDATE.value
                +'&NewBgnDay='+form1.ABS_STARTDATE.value
                +'&NewEndDay='+form1.ABS_ENDDATE.value
                +'&ApproveFlag='+form1.HIDDEN_ABS_APPROVE_FLAG.value);*/
                var STARTPERIOD = 0;
		var objRadio = form1.ABS_STARTPERIOD;
		STARTPERIOD = objRadio.options[objRadio.selectedIndex].value;

		var ENDPERIOD = 0;
		var objRadio = form1.ABS_ENDPERIOD;
		ENDPERIOD = objRadio.options[objRadio.selectedIndex].value;
               
            req.open("GET", url+'?abs_startdate='+form1.ABS_STARTDATE.value
                +'&startperiod='+STARTPERIOD
                +'&abs_enddate='+form1.ABS_ENDDATE.value
                +'&endperiod='+ENDPERIOD
                +'&ab_code='+form1.AB_CODE.value
                +'&per_id='+form1.PER_ID.value);
            req.setRequestHeader("Content-Type", "application/json;charset=utf-8"); // set Header
            req.send(); //ส่งค่า
			if(check_it == 0){
				get_holiday_();
			}
			
        }
	function get_holiday_(){//หาวันหยุดพิเศษ
	PER_STARTDATE = $('#ABS_STARTDATE').val();
    PER_ENDDATE = $('#ABS_ENDDATE').val();
    
			$.ajax({
				   type: "POST",
				   url: "php_scripts/get_holiday.php",
				   cache: false,
				   data: {'PER_STARTDATE':PER_STARTDATE, 'PER_ENDDATE':PER_ENDDATE
                    
                   },
				   success: function(msg){
                    console.log(msg);
					msg = msg.split("|");
					intPublicHoliday = $.trim(msg[0]);
					intWorkDay = $.trim(msg[1]);
					$("#holiday_extra").val(intPublicHoliday);
					$("#work_day").val(intWorkDay);
					form1.ABS_DAY_OLD.value = form1.ABS_DAY.value;	
				   },error : function(jqXHR,textStatus,errorTrow){
				   alert("error");
					console.log(jqXHR.restponseText);
				   }
				 });
	}
		
		function calNextYear() {
			call_openDialogCenter("es_data_absent_nextyear.html?PER_ID="+form1.PER_ID.value+'&PER_STARTDATE='+form1.ABS_STARTDATE.value,650,500,'หมายเหตุ : กรณีลาพักผ่อนในรอบปีงบประมาณใหม่');
			
		}
		
		function calNextYearHave() {
			var req = new XMLHttpRequest();  //Inint_AJAX();
			req.onreadystatechange = function () {
                if (req.readyState==4) {
                    if (req.status==200) {
						alert(req.responseText);
						 form1.AB_COUNT_04_NEXTYEAR.value = req.responseText;
                    }
                }
            };
			
			
            req.open("GET", "php_scripts/es_data_absent_nextyear_have.php?PER_ID="+form1.PER_ID.value+'&PER_STARTDATE='+form1.ABS_STARTDATE.value);
            req.setRequestHeader("Content-Type", "application/json;charset=utf8"); // set Header
            req.send(); //ส่งค่า
			
		}
		
		
		
		
        function call_export_file() {
            var parameter = "";
            var currDate = new Date();
            var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
            rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
            var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
            if(form1.search_per_type.value)	parameter = "&search_per_type="+form1.search_per_type.value;
            //if(form1.search_onlyme_flag.checked==true)	var PER_ID = '<?=$SESS_PER_ID; ?>'; 	parameter = "&search_per_id="+PER_ID;
            if(form1.search_onlyme_flag.checked==true)	parameter = "&search_onlyme_flag="+form1.search_onlyme_flag.value;
            if(form1.search_abs_approve.value)	parameter = "&search_abs_approve="+form1.search_abs_approve.value;
            if(form1.search_cancel_flag.checked==true)	parameter = "&search_cancel_flag="+form1.search_cancel_flag.value;
            if(form1.search_abs_startdate.value)	parameter = "&search_abs_startdate="+form1.search_abs_startdate.value;
            if(form1.search_abs_enddate.value)	parameter = "&search_abs_enddate="+form1.search_abs_enddate.value;
            if(form1.search_ab_code.value)	parameter = "&search_ab_code="+form1.search_ab_code.value;
            document.form1.target = "_blank";
            document.form1.action = "report/rpt_data_absent_xls.php?report_title=" + report_title + "&UTC" + rptDate+parameter;
            document.form1.submit();
            document.form1.target = "_self";
            document.form1.action = "data_absent.html";
        }				

        function call_export_rtf (ABS_ID, AB_CODE) {
            var currDate = new Date();
            var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
            rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
            var report_title = "data_absent";
            document.form1.target = "_blank";
            document.form1.action = "report/rpt_data_absent_rtf.php?report_title=" + report_title +"&ABS_ID="+ABS_ID+"&AB_CODE="+AB_CODE+ "&UTC" + rptDate;
            document.form1.submit();
            document.form1.target = "_self";
            document.form1.action = "data_absent.html";
        }
        function call_export_rtf_cancel(ABS_ID, AB_CODE){
            var currDate = new Date();
            var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
            rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
            var report_title = "data_absent";
            document.form1.target = "_blank";
            document.form1.action = "report/rpt_data_absent_cancel_rtf.php?report_title=" + report_title +"&ABS_ID="+ABS_ID+"&AB_CODE="+AB_CODE+ "&UTC" + rptDate;
            document.form1.submit();
            document.form1.target = "_self";
            document.form1.action = "data_absent.html";
        }
	
        function call_menu_desc (cate, id, name, per_id) {	
            var ulink = cfile+'?CATEGORY='+cate+'&PER_ID='+ per_id+'&UPFOR='+name+'&LAST_SUBDIR='+id;		
            parameter = "";
            MM_openBrWindow(ulink+"&MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>&HIDE_HEADER=1<?=($MAIN_VIEW?"&MAIN_VIEW=1":"")?>&getdate=<?=date('YmdHis')?>" + parameter,'moreeditor','toolbar=no,location=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=950,height=1200');
        }

        function call_sort(flag,valOrderBY) {
            form1.order_by.value=flag;
            form1.sort_by.value=flag;
            /*if(form1.sort_type.value==flag+":asc"){
                            form1.sort_type.value=flag+":desc";
                    }else{ //desc
                            form1.sort_type.value=flag+":asc";
                    }*/
            //form1.sort_type.value=flag+":"+strOrder;
            if(form1.sort_type.value!=(flag+":"+valOrderBY)){
                if(valOrderBY=='asc'){valOrderBY='desc';}
                form1.sort_type.value=flag+":"+valOrderBY;
            }else{
                if(valOrderBY=='asc'){valOrderBY='desc';}else{valOrderBY='asc';}
                form1.sort_type.value=flag+":"+valOrderBY;
            }
            form1.command.value='SEARCH';
            form1.submit();
        } // end function call_sort
	
        function set_check_all(ischecked,name,count_data){
            for(var i=1; i <= count_data; i++){	
                if(ischecked==true){
                    if(eval(document.getElementById(name+i)))	eval(document.getElementById(name+i)).checked=true;
                }else{
                    if(eval(document.getElementById(name+i)))	eval(document.getElementById(name+i)).checked=false;
                }
            }
        }
	
        function set_uncheck_all(ischecked,name,id){
            if(ischecked==false && name.checked==true)		name.checked=false;
        }

        function e_ABS_STARTDATE() {
            //alert("e_ABS_STARTDATE==>"+form1.ABS_STARTDATE.value);
            /*		if (!form1.ABS_STARTDATE.value) {//
                            alert("กรุณาระบุ ตั้งแต่วันที่");
                            form1.ABS_STARTDATE.focus();
                            return false;
                    } else {*/
            if (form1.ABS_STARTDATE.value == form1.ABS_ENDDATE.value) {
                //				alert("ABS_START-->"+form1.ABS_STARTPERIOD.value);
                form1.ABS_STARTPERIOD.value = form1.ABS_ENDPERIOD.value;
                if (form1.ABS_ENDPERIOD.value < 3) {	// ถ้าเป็น ครึ่งวันหลัง
                    form1.ABS_ENDPERIOD.disabled = true;
                }
            }
            return true;
            /*		}*/
        }

        function e_ABS_ENDDATE() {
            //alert("e_ABS_ENDDATE==>"+form1.ABS_ENDDATE.value);
            /*		if (!form1.ABS_ENDDATE.value) {
                            alert("กรุณาระบุ ถึงวันที่");
                            form1.ABS_ENDDATE.focus();
                            return false;
                    } else {*/
            if (form1.ABS_STARTDATE.value == form1.ABS_ENDDATE.value) {
                //				alert("ABS_START-->"+form1.ABS_STARTPERIOD.value);
                if (form1.ABS_STARTPERIOD.value < 3) {	// ถ้าเป็น ครึ่งวันหลัง
                    form1.ABS_ENDPERIOD.value = form1.ABS_STARTPERIOD.value;
                    form1.ABS_ENDPERIOD.disabled = true;
                }
            }
			
			calcDaysBetweenDateNew(1,'','NO');
            return true;
			
            /*		}*/
        }

        function e_ABS_STARTPERIOD() {
            //		alert("_ABS_STARTPERIOD==>"+(!form1.ABS_STARTDATE.value)+" period="+form1.ABS_STARTPERIOD.value);
            var e = document.getElementById('ABS_STARTPERIOD');
            var valid = e.options[e.selectedIndex].value;
            document.getElementById('HID_ABS_STARTPERIOD').value= valid;
            //document.getElementById('ABS_ENDPERIOD_HIDDEN').value= valid;  
            
            /*Release 5.2.1.7 .*/
            document.getElementById('ABS_ENDPERIOD').selectedIndex=e.selectedIndex;
            document.getElementById('ABS_ENDPERIOD_HIDDEN').value=valid;
            /*Release 5.2.1.7 .*/
            
            if (!form1.ABS_STARTDATE.value) {
                alert("กรุณาระบุ ตั้งแต่วันที่");
                form1.ABS_STARTDATE.focus();
                return false;
            } else {
				
				calcDaysBetweenDateNew(1,'','NO');
                if (form1.ABS_STARTDATE.value == form1.ABS_ENDDATE.value) {
                    //				alert("ABS_START-->"+form1.ABS_STARTPERIOD.value);
                    //form1.ABS_ENDPERIOD.value = form1.ABS_STARTPERIOD.value;
                   // alert(form1.ABS_STARTPERIOD.value);
                    if (form1.ABS_ENDPERIOD.value < 3) {	// ถ้าเป็น ครึ่งวันหลัง
                       //form1.ABS_ENDPERIOD.disabled = true;
                    } else {
                       // form1.ABS_ENDPERIOD.disabled = false;
                    }
                } else 	
                    //form1.ABS_ENDPERIOD.disabled = false;
				
                return true;
            }
			
			
                
        }
	
        function e_ABS_ENDPERIOD() {
            //		alert("call_set_END_ABSDATE==>"+(!form1.ABS_STARTDATE.value));
            var e = document.getElementById('ABS_ENDPERIOD');
            var valid = e.options[e.selectedIndex].value;
            document.getElementById('ABS_ENDPERIOD_HIDDEN').value= valid;
            //document.getElementById('HID_ABS_STARTPERIOD').value= valid;

            if (!form1.ABS_ENDDATE.value) {
                alert("กรุณาระบุ ถึงวันที่");
                form1.ABS_ENDDATE.focus();
                return false;
            } else {
				calcDaysBetweenDateNew(1,'','NO');
                if (form1.ABS_STARTDATE.value == form1.ABS_ENDDATE.value) {
                    //				alert("ABS_START-->"+form1.ABS_STARTPERIOD.value);
                    form1.ABS_STARTPERIOD.value = form1.ABS_ENDPERIOD.value;
                    if (form1.ABS_ENDPERIOD.value < 3) {	// ถ้าเป็น ครึ่งวันหลัง
                        //form1.ABS_ENDPERIOD.disabled = true;
                    } else {
                        //form1.ABS_ENDPERIOD.disabled = false;
                    }
                } else 	
                    //form1.ABS_ENDPERIOD.disabled = false;
				
                return true;
            }
        }
		
		function chkOverNumDay(){
			var bgnArray = form1.ABS_STARTDATE.value.split("/");
			var endArray = form1.ABS_ENDDATE.value.split("/");
			sDate = new Date(bgnArray[2]-543,bgnArray[1]-1,bgnArray[0]); 
			eDate = new Date(endArray[2]-543,endArray[1]-1,endArray[0]); 
			var daysDiff = Math.round((eDate-sDate)/86400000) + 1;

			
			var HID_ABS_DAY = form1.HID_ABS_DAY.value;
			var ABS_DAY = form1.ABS_DAY.value;
			if(parseInt(ABS_DAY) < parseInt(HID_ABS_DAY)){
				alert("ระบุจำนวนวัน ต้องไม่น้อยกว่า จำนวนวันทำการที่เลือกลา");
				form1.ABS_DAY.value = '';
                form1.ABS_DAY.focus();
                return false;
				
			}
			
			if(parseInt(ABS_DAY) > parseInt(daysDiff)){
				alert("ระบุจำนวนวัน ต้องไม่มากกว่า จำนวนวันที่เลือกลา");
				form1.ABS_DAY.value = '';
                form1.ABS_DAY.focus();
                return false;
				
			}
			
			
			
		}

        function returnFrom(src, returnValue){
           //alert("src="+src+"("+returnValue+")");
                
            if  (src.indexOf("search_org") > -1) {
                //alert(returnValue);
                if(returnValue){
                    arrValue = returnValue.split("<::>");
                                
                    if (arrValue[7]=="search_ministry") {
                        form1.search_ministry_id.value = arrValue[0];
                        form1.search_ministry_name.value = arrValue[1];
                        form1.search_department_id.value = "";
                        form1.search_department_name.value = "";
                    } else if (arrValue[7]=="search_department") {
                        form1.search_department_id.value = arrValue[0];
                        form1.search_department_name.value = arrValue[1];
                    } else if (arrValue[7]=="search_org") {
                        form1.search_org_id.value = arrValue[0];
                        form1.search_org_name.value = arrValue[1];
                    } else if (arrValue[7]=="search_org_ass") {
                        form1.search_org_id.value = arrValue[0];
                        form1.search_org_name.value = arrValue[1];
                    }else if (arrValue[7]=="es_search_org_ass") {
                        form1.search_org_id.value = arrValue[0];
                        form1.search_org_name.value = arrValue[1];
                    }
                } // end if
            }else if  (src.indexOf("search_person") > -1) {
                if(returnValue){
                    arrValue = returnValue.split("<::>");
                    var_type = arrValue[20];
                    eval("form1."+var_type+"PER_ID.value = " + arrValue[0]);
                    eval("form1."+var_type+"PER_NAME.value = '" + arrValue[1] + "'");
                    if(var_type!="APPROVE_" && var_type!="AUDIT_" && var_type!="REVIEW1_" && var_type!="REVIEW2_"){
                        form1.ORG_ID.value = arrValue[9];
                        form1.ORG_NAME.value = arrValue[4];
                        		//alert(form1.ORG_ID.value+":"+form1.ORG_NAME.value);
                        form1.submit(); 
						//alert(form1.ORG_ID.value+":"+form1.ORG_NAME.value);
                    } // end if
                } // end if
				
			}else if  (src.indexOf("es_holiday_extra") > -1) {//วันหยุดพิเศษ
				if(returnValue){
					   arrValue = returnValue.split("<::>");
						if(arrValue[0] < parseInt(0)){//ตอบ YES เลือก ตกลง
							form1.ABS_DAY.value = form1.work_day.value;
							if(form1.ABS_DAY.value == "" || form1.ABS_DAY.value <= "0" ){
								alert("วันที่ท่านยื่นใบลา ระบบกำหนดให้เป็นวันหยุดโดยท่านไม่ต้องยื่นใบลา");
								return false;
							}
								if(!form1.ABS_ID.value)	form1.command.value = "ADD";
							else if(form1.ABS_ID.value)		form1.command.value = "UPDATE";
								 
						}else{//ตอบ NO เลือก ตกลง
								form1.holiday_extra.value = arrValue[0];
								if((form1.ABS_DAY.value == "" || form1.ABS_DAY.value <= "0") && form1.holiday_extra.value == 0){
									alert("จำนวนวันลาไม่ถูกต้อง กรุณาตรวจสอบจำนวนวันลาอีกครั้ง");
									form1.butt_calc_absent.focus();
									return false;
								}
								
									form1.ABS_DAY.value = parseInt(form1.holiday_extra.value)+parseInt(form1.work_day.value); 
							
								 if(!form1.ABS_ID.value)		form1.command.value = "ADD";
							else if(form1.ABS_ID.value)		    form1.command.value = "UPDATE";
								
						}
				}	
					form1.submit();	

			}else if  (src.indexOf("es_data_absent_nextyear") > -1) {
                if(returnValue){
                    arrValue = returnValue.split("<::>");
					form1.AB_COUNT_04_NEXTYEAR.value = arrValue[2];
					
                    
                } // end if
				
				
            } else if  (src.indexOf("search_absenttype") > -1) {
                if(returnValue){
                    arrValue = returnValue.split("<::>");
                    ab_code.value = arrValue[0];
                    ab_name.value = arrValue[1];
                    document.form1.AB_COUNT.value = arrValue[2];
                    document.form1.AB_TYPE.value = arrValue[4];
                    if(ab_code.value.trim() == "10"){
                        document.form1.ABS_STARTPERIOD.value = 3;
	
                        document.form1.ABS_STARTPERIOD[0].disabled = true;
                        document.form1.ABS_STARTPERIOD[1].disabled = true;
                        document.form1.ABS_STARTPERIOD[2].disabled = true;
	
                        document.form1.ABS_ENDDATE.disabled = true;
	
                        document.form1.ABS_ENDPERIOD.value = 3;
	
                        document.form1.ABS_ENDPERIOD[0].disabled = true;
                        document.form1.ABS_ENDPERIOD[1].disabled = true;
                        document.form1.ABS_ENDPERIOD[2].disabled = true;
	
                        //document.form1.ABS_LETTER[0].disabled = true;
                        //document.form1.ABS_LETTER[1].disabled = true;
                        //document.form1.ABS_LETTER[2].disabled = true;	
	
                        document.form1.btn_enddate.disabled = true;
                    }else{
                        document.form1.ABS_STARTPERIOD[0].disabled = false;
                        document.form1.ABS_STARTPERIOD[1].disabled = false;
                        document.form1.ABS_STARTPERIOD[2].disabled = false;
	
                        document.form1.ABS_ENDDATE.disabled = false;
	
                        document.form1.ABS_ENDPERIOD[0].disabled = false;
                        document.form1.ABS_ENDPERIOD[1].disabled = false;
                        document.form1.ABS_ENDPERIOD[2].disabled = false;
	
                        //document.form1.ABS_LETTER[0].disabled = false;
                        //document.form1.ABS_LETTER[1].disabled = false;
                        //document.form1.ABS_LETTER[2].disabled = false;
	
                        document.form1.btn_enddate.disabled = false;
                    } // end else
                    strVacationOver(document.getElementById('AB_CODE').value);
                    if(ab_code.value.trim() == "01" || ab_code.value.trim() == "02" || ab_code.value.trim() == "03"){
                        document.all.DIV_REASON.style.display = "";
                    }else{
                        document.all.DIV_REASON.style.display = "none";
                    }
                } // end if
            } else{
                form1.submit();
            } 		
            //		$( "#d_frame" )[0].src="";
            //		alert("returnValue="+tt.value);
            //tt.value = returnValue;
        } // end if
		
		
		
		function clickCanCelAll(TMP_ABS_ID,TMP_APPROVE_FLAG){
			//alert(TMP_ABS_ID+'|'+TMP_APPROVE_FLAG);
            if(confirm('คุณต้องการยกเลิกใบลานี้ ใช่หรือไม่')){
                form1.command.value = 'CANCELALL';
                form1.ABS_ID.value=TMP_ABS_ID; 
                form1.hidden_APPROVE_FLAG.value=TMP_APPROVE_FLAG;
				
                form1.submit();
            }
        }
		
		
		function clickCanCelAllShow(ABS_ID,TMP_APPROVE_FLAG,TMP_REVIEW1_FLAG,TMP_REVIEW2_FLAG,TMP_AUDIT_FLAG){
            call_openDialogCenter("es_data_absent_confirmcencelall.html?ABS_ID="+ABS_ID+'&APPROVE_FLAG='+TMP_APPROVE_FLAG+'&REVIEW1_FLAG='+TMP_REVIEW1_FLAG+'&REVIEW2_FLAG='+TMP_REVIEW2_FLAG+'&AUDIT_FLAG='+TMP_AUDIT_FLAG,650,500,'ยกเลิก/เปลี่ยนแปลงวันลา');
        }
		
		function clickUpdateData(ABS_ID, APPROVE_FLAG){
            document.form1.target = "_self";
			document.form1.ABS_ID.value=ABS_ID;
            document.form1.action = "data_absent.html?UPD=1";
            document.form1.submit();
            
        }
		
		
    </script>
    <script>
        function Inint_AJAX() {
            try { return new ActiveXObject("Msxml2.XMLHTTP");  } catch(e) {} //IE
            try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch(e) {} //IE
            try { return new XMLHttpRequest();          } catch(e) {} //Native Javascript
            alert("XMLHttpRequest not supported");
            return null;
        };
        function ChkOverLeave() {
            var req = new XMLHttpRequest();  //Inint_AJAX();
            req.onreadystatechange = function () {
                if (req.readyState==4) {
                    if (req.status==200) {
                        // alert(req.responseText);
                        if(req.responseText!=''){
                            alert('ไม่สามารถเปลี่ยนวันลาได้ เนื่องจากเกินช่วงวันลาที่ได้อนุมัตไปแล้ว');
                        }
                    }
                }
            };
            var url = 'php_scripts/chkoverleave.php';
            req.open("GET", url+'?OldBgnDay='+form1.OLD_ABS_STARTDATE.value
                +'&OldEndDay='+form1.OLD_ABS_ENDDATE.value
                +'&NewBgnDay='+form1.ABS_STARTDATE.value
                +'&NewEndDay='+form1.ABS_ENDDATE.value
                +'&ApproveFlag='+form1.HIDDEN_ABS_APPROVE_FLAG.value);
            req.setRequestHeader("Content-Type", "application/json;charset=utf8"); // set Header
            req.send(); //ส่งค่า
        }
		
    </script>     
    <?  //เช็คปุ่มที่ได้ค่าออกมา ว่าเป็นปุ่มเพิ่มหรือแก้ไข 
    if($PAGE_AUTH["edit"]=="Y" && $UPD) 
    $Submit = "Submit_edit";
    else if(!$VIEW && $PAGE_AUTH["add"]=="Y") 
    $Submit = "Submit_add";    
    ?>
    <span id="defaultTheme"></span>
    <body >

        <table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
            <tr>
                <td height="10"><?include("header_menu.html")?></td>
            </tr>
            <tr> 
                <td align="left" valign="top">
                    <?	
                    if ($UPD) $OPTIONAL_TITLE=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE=" &gt; ดูข้อมูล";
                    include("current_location.html");
                    ?>	  </td>	
            </tr>
            <tr>
                <td align="left" valign="top"><form name="form1" method="post" action="data_absent.html" enctype="multipart/form-data">
                        <input type="hidden" name="current_page" value="<?=$current_page?>">
                        <input type="hidden" name="current_url" value="<?=$current_url;?>">
                        <input type="hidden" name="total_page" value="<?=$total_page?>">
                        <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
                        <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
                        <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
                        <input type="hidden" name="command" value="">
                        <input type="hidden" name="hidden_APPROVE_FLAG" value="">
                        <input type="hidden" name="PER_ID" id="PER_ID" value="<?=$PER_ID?>">
                        <input type="hidden" name="txtPER_STARTDATE" id="txtPER_STARTDATE" value="<?=$PER_STARTDATE?>">
                        <input type="hidden" name="ABS_ID" value="<?=$ABS_ID?>">
                        <input type="hidden" name="chkconfirm_absent" value="">
                        <input type="hidden" name="hid_datenow" value="<? echo date("d/m").'/'.(date("Y")+543);?>">
                        <input type="hidden" name="EDIT_ABSENT_DAY" value="<?=$EDIT_ABSENT_DAY;?>">
                        <input type="hidden" name="ABS_DAY_OLD" value="0" style="text-align:right" class="textbox" onkeypress="return DigitOnly();" onchange="return chkOverNumDay();">
                        &nbsp;&nbsp; <!-- ($ABS_REVIEW1_FLAG=="" && $ABS_REVIEW2_FLAG=="" && $ABS_AUDIT_FLAG=="" && $ABS_APPROVE_FLAG=="")--->
						
                        <table width="95%" align="center" cellpadding="0" cellspacing="0">
                            <tr>
                                <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
                                        <tr>
                                            <td height="22" align="center" class="table_body"><?=($UPD)?"แก้ไข":"เพิ่ม"?>ข้อมูล</td>
                                        </tr>		
                                    </table></td>
                            </tr>
                        </table>
                        <table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table" 
                               onKeyPress="return keyEnter(event,document.form1.<?=$Submit?>);">
                            <tr>
                                <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
                                        <tr>
                                            <td  align="center"><table width="100%" border="0" cellpadding="0" cellspacing="0" class="label_normal">
                                                    <tr><td height="5"></td></tr>
                                                    <tr>
                                                        <td width="20%" nowrap="nowrap"align="right">&nbsp;<span class="label_alert">*</span>&nbsp;<?=$FULLNAME_TITLE;?>&nbsp;:&nbsp;</td>
                                                        <td width="30%"> <input type="text" name="PER_NAME" value="<?=$PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="PER_CODE" value="<?=$PER_CODE?>">
                                                            <? //if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW && !$SESS_PER_ID || $SESS_PER_AUDIT_FLAG == 1) : ?>
                                                            <!-- kittiphat 13/03/2562 ปิดตอนแก้ไขจะไม่ให้เลือกคนใหม่เพราะถ้าเลือกมันก็จะไปบันทึกใหม่อยู่ดี -->
                                                            <? if($PAGE_AUTH["add"]=="Y" &&  !$UPD &&  (!$SESS_PER_ID || $SESS_PER_AUDIT_FLAG == 1)) : ?>
                                                            <input type="button" class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="javascript:call_search_person('');">
                                                            <? endif; ?>
                                                        </td>			
                                                        <td width="20%" nowrap="nowrap" align="right"><?=$MINISTRY_TITLE;?>&nbsp;:&nbsp;</td>
                                                        <td width="30%">
                                                            <input type="text" name="MINISTRY_NAME" value="<?=$MINISTRY_NAME?>"  style="width:75%" class="textbox" readonly>
                                                        <input type="hidden" name="MINISTRY_ID" value="<?=$MINISTRY_ID?>">			</tr>
                                                    <tr>
                                                        <td  align="right">&nbsp;<span class="label_alert">*</span>&nbsp;ประเภทการลา&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="text" name="AB_NAME" value="<?=$AB_NAME?>"  style="width:75%" class="textbox" readonly> 
                                                            <input type="hidden" name="AB_CODE" id="AB_CODE" value="<?=$AB_CODE?>">
                                                            <input type="hidden" name="AB_TYPE" id="AB_TYPE" value="<?=$AB_TYPE?>">
                                                            <input type="hidden" name="ISOVER" id="ISOVER" value="">
                                                            <? 
                                                            $isShowBtn_Permission = true;
                                                            //echo $ABS_CANCEL_FLAG;
                                                            $isShowTime_Permission = '';
                                                            if( ($SESS_PER_ID==$REVIEW1_PER_ID || 
                                                                 $SESS_PER_ID==$REVIEW2_PER_ID || 
                                                                 $SESS_PER_ID==$APPROVE_PER_ID || 
                                                                 $SESS_PER_ID==$AUDIT_PER_ID || $UPD  ) && $SESS_PER_ID!=$PER_ID ){ /*ผู้บังคับบัญชาชั้นต้น ,ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป,ผู้อนุญาตการลา และมีสิทธิ์แก้ไข && ($PAGE_AUTH["add"]=="N" || $PAGE_AUTH["edit"]=="N") */
                                                                $isShowBtn_Permission = false;
                                                                $isShowTime_Permission = 'disabled';
                                                            }
                                                            if($ABS_CANCEL_FLAG==8 || $ABS_CANCEL_FLAG==9){
                                                                $isShowBtn_Permission = false;
                                                                $isShowTime_Permission = 'disabled';
                                                            }
                                                            if($SESS_USERGROUP==1){
                                                                $isShowBtn_Permission = true;
                                                                $isShowTime_Permission = '';
                                                            }
                                                            
                                                            /*
                                                            
                                                            if( (($SESS_PER_ID==$PER_ID && $AB_CODE=="")|| ($CAN_EDIT=="Y" || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1 )) 
                                                                    && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") 
                                                                    && !$VIEW && $isShowBtn_Permission && $ABS_CANCEL_FLAG<=1 && ($ABS_STARTDATE_CHECK > $TODATE || !$UPD || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1)) : 
                                                            
                                                            kittiphat 13/03/2562
                                                            */
                                                            
                                                             if( (($SESS_PER_ID==$PER_ID && $AB_CODE=="") || ($CAN_EDIT=="Y" || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD" )) 
                                                                           && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") 
                                                                           && !$VIEW && $isShowBtn_Permission && $ABS_CANCEL_FLAG<=1 && ($ABS_STARTDATE_CHECK > $TODATE || !$UPD || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD")) : ?>
                                                            <input type="button" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกประเภทการลา" onClick="call_search_absenttype('AB_CODE', 'AB_NAME');"> 
                                                            <? endif; ?> 
                                                            <input type="hidden" name="AB_COUNT" value="<?=$AB_COUNT?>"></td>
                                                        <td  align="right"><?=$DEPARTMENT_TITLE;?>&nbsp;:&nbsp;</td>
                                                        <td><input type="text" name="DEPARTMENT_NAME" value="<?=$DEPARTMENT_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="DEPARTMENT_ID" value="<?=$DEPARTMENT_ID?>">			</td>
                                                    </tr>
                                                    <tr>
                                                        <td  align="right"><?=$ORG_TITLE;?>
                                                            &nbsp;:&nbsp;</td>
                                                        <td>
                                                        <?
                                                        $cmd = "	select  ORG_ID AS ORG_ASS from PER_PERSONAL  where 	PER_ID=$PER_ID "; 
                                                        $db_dpis->send_cmd($cmd);
														$data = $db_dpis->get_array();
                                                        
                                                        $cmd = " select ORG_NAME from PER_ORG_ASS where ORG_ID=".$data[ORG_ASS];
                                                        $db_dpis2->send_cmd($cmd);
                                                        $data2 = $db_dpis2->get_array();
                                                        $ORG_NAME_ASS = $data2[ORG_NAME];
                                                        $ORG_CHK_ASS_ID = 0;
                                                        if($ORG_NAME_ASS){
                                                            $ORG_NAME = $ORG_NAME_ASS;
                                                            $ORG_CHK_ASS_ID = $data[ORG_ASS];
                                                        }
                                                        ?>
                                                        <input type="text" name="ORG_NAME" value="<?=$ORG_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="ORG_ID" value="<?=$ORG_ID?>">              
                                                            <input type="hidden" name="ORG_CHK_ASS_ID" value="<?=$ORG_CHK_ASS_ID;?>"> 
                                                            </td>
                                                        <td  align="right">&nbsp;</td>
                                                        <td>&nbsp;</td>
                                                    </tr>
                                                    <tr> 
                                                        <td  align="right">&nbsp;<span class="label_alert">*</span>&nbsp;<?=$FROM_DATE_TITLE;?>&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="hidden" name="OLD_ABS_STARTDATE" value="<?=$ABS_STARTDATE?>">	
                                                            <input type="text" name="ABS_STARTDATE" id="ABS_STARTDATE" value="<?=$ABS_STARTDATE?>"  
                                                                   class="textbox" onKeyPress="return DateOnly();"  onChange="changedateformat(form1.ABS_STARTDATE,this.value); strVacationOver(document.getElementById('AB_CODE').value); copydate();"
                                                                   onBlur="changedateformat(form1.ABS_STARTDATE,this.value);strVacationOver(document.getElementById('AB_CODE').value);" <?=((!$ABS_ID) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && trim($AB_CODE) != "10")?"":"readonly"?>>&nbsp;&nbsp;
                                                                   
                                                                   <? /*if( (($SESS_PER_ID==$PER_ID && $ABS_STARTDATE=="") || ($CAN_EDIT=="Y" || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1)) 
                                                                           && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") 
                                                                           && !$VIEW && $isShowBtn_Permission && $ABS_CANCEL_FLAG<=1 && ($ABS_STARTDATE_CHECK > $TODATE || !$UPD || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1)) : */ ?>
                                                                   
                                                                   <? if( (($SESS_PER_ID==$PER_ID && $ABS_STARTDATE=="") || ($CAN_EDIT=="Y" || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD" )) 
                                                                           && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") 
                                                                           && !$VIEW && $isShowBtn_Permission && $ABS_CANCEL_FLAG<=1 && ($ABS_STARTDATE_CHECK > $TODATE || !$UPD || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD")) : ?>
                                                                  
                                                                   <input type="reset" name="btn_startdate" class="button" 
                                                                   onClick="return showCalendar('ABS_STARTDATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                                                   
                                                            <? endif; ?>
                                                            		<? //=($ABS_ID && ($CAN_EDIT=="N" || ($ABS_STARTDATE_CHECK <= $TODATE || !$UPD))  && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"disabled":""?>
                                                            &nbsp;<select <?php echo $isShowTime_Permission;?> name="ABS_STARTPERIOD" id="ABS_STARTPERIOD" onChange="e_ABS_STARTPERIOD();strVacationOver(document.getElementById('AB_CODE').value);" 
                                                                          <?=($ABS_ID && ($CAN_EDIT=="N" || ($ABS_STARTDATE_CHECK <= $TODATE || !$UPD))  && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD")?"disabled":""?> >
                                                                          <option  value="1" <?=($ABS_STARTPERIOD==1)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>> ครึ่งวันเช้า</option>
                                                                <option  value="2" <?=($ABS_STARTPERIOD==2)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>> ครึ่งวันบ่าย</option>
                                                                <option  value="3" <?=($ABS_STARTPERIOD==3 || !$ABS_STARTPERIOD)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>>ทั้งวัน</option>
                                                            </select>	<input type="hidden" name="OLD_ABS_STARTPERIOD" value="<?=$ABS_STARTPERIOD; ?>">
                                                            <input type="hidden" name="HID_ABS_STARTPERIOD" id="HID_ABS_STARTPERIOD" value="<?=$ABS_STARTPERIOD?>">	
                                                            
                                                            <? //kittiphat test echo "ABS_ID=".$ABS_ID."|add=".$PAGE_AUTH["add"]."|edit=".$PAGE_AUTH["edit"]."|AB_CODE=".trim($AB_CODE);
                                                                //if(!$ABS_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && trim($AB_CODE) != "10"){ echo 'OK';}else{echo 'NO';}
                                                            ?>
                                                        </td>
                                                        <td  align="right">&nbsp;<span class="label_alert">*</span>&nbsp;
                                                            <?=$TO_DATE_TITLE;?>
                                                            &nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="hidden" name="OLD_ABS_ENDDATE" value="<?=$ABS_ENDDATE?>">	
                                                            <input type="text" name="ABS_ENDDATE" id="ABS_ENDDATE" value="<?=$ABS_ENDDATE?>" class="textbox" onKeyPress="return DateOnly();"  onBlur="changedateformat(form1.ABS_ENDDATE,this.value);" onChange="return e_ABS_ENDDATE();" <?=((!$ABS_ID) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && trim($AB_CODE) != "10")?"":"readonly"?>>
                                                                   &nbsp;&nbsp;
                                                                           
                                                                   <? if( (($SESS_PER_ID==$PER_ID && $ABS_ENDDATE=="") || ($CAN_EDIT=="Y" || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD" )) 
                                                                            && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") 
                                                                            && !$VIEW && $isShowBtn_Permission && $ABS_CANCEL_FLAG<=1 && ($ABS_STARTDATE_CHECK > $TODATE || !$UPD || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD")) : ?>
                                                                   <input type="reset" name="btn_enddate" 
                                                                   onmouseover="strVacationOver(document.getElementById('AB_CODE').value);get_age_over();"
                                                                   class="button" onClick="return showCalendar('ABS_ENDDATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');" value="<?=$SELECT_TITLE?>" <?=(trim($AB_CODE) != "10")?"":"disabled"?>>
                                                                
                                                                   <? endif; ?>
                                                                   &nbsp;
                                                                   <select <?php echo $isShowTime_Permission;?> name="ABS_ENDPERIOD" id="ABS_ENDPERIOD" onChange="e_ABS_ENDPERIOD();strVacationOver(document.getElementById('AB_CODE').value);" 
                                                                        <?=($ABS_ID && ($CAN_EDIT=="N" || ($ABS_STARTDATE_CHECK <= $TODATE || !$UPD)) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD")?"disabled":""?>>
                                                                   <option  value="1" <?=($ABS_ENDPERIOD==1)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>> ครึ่งวันเช้า</option>
                                                                <option  value="2" <?=($ABS_ENDPERIOD==2)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>> ครึ่งวันบ่าย</option>
                                                                <option  value="3" <?=($ABS_ENDPERIOD==3 || !$ABS_ENDPERIOD)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>>ทั้งวัน</option>
                                                            </select>
                                                            <input type="hidden" name="ABS_ENDPERIOD_HIDDEN" id="ABS_ENDPERIOD_HIDDEN" value="<?=$ABS_ENDPERIOD; ?>">
                                                            <input type="hidden" name="OLD_ABS_ENDPERIOD"  value="<?=$ABS_ENDPERIOD; ?>"></td>
                                                    </tr>
                                                    <?php 
                                                   
                                                    if((!empty($OABS_STARTDATE) && !empty($ORI_ABS_STARTDATE)) && (!empty($VIEW) || !empty($UPD))  ){
                                                    function convstr_period($period){
                                                        if($period==1){ return 'ครึ่งวันเช้า';}
                                                        if($period==2){ return 'ครึ่งวันบ่าย';}
                                                        if($period==3){ return 'ทั้งวัน';}
                                                        return '';
                                                    }
                                                        $coltext1 ='วันลาเดิม ตั้งแต่วันที่&nbsp;:&nbsp;';
                                                        $coltext2 ='ถึงวันที่&nbsp;:&nbsp;';
                                                        $conv_ABS_STARTPERIOD = convstr_period($ABS_STARTPERIOD);
                                                        $conv_ABS_ENDPERIOD = convstr_period($ABS_ENDPERIOD);
                                                        
                                                        if(  ($ORI_ABS_STARTDATE==$ABS_STARTDATE && $ORI_ABS_STARTPERIOD==$conv_ABS_STARTPERIOD) 
                                                             && ($ORI_ABS_ENDDATE==$ABS_ENDDATE && $ORI_ABS_ENDPERIOD==$conv_ABS_ENDPERIOD) &&
                                                             ($OABS_STARTDATE==$ABS_STARTDATE && $OABS_STARTPERIOD==$conv_ABS_STARTPERIOD) 
                                                             && ($OABS_ENDDATE==$ABS_ENDDATE && $OABS_ENDPERIOD==$conv_ABS_ENDPERIOD)
                                                             ){
                                                            $coltext1='หมายเหตุ&nbsp;:&nbsp;';
                                                            $coltext2='';
                                                            $ORI_ABS_STARTDATE='';
                                                            $ORI_ABS_STARTPERIOD='ยกเลิกทั้งหมด';
                                                            $ORI_ABS_ENDDATE='';
                                                            $ORI_ABS_ENDPERIOD='';
                                                        }
                                                        if( ($OABS_STARTDATE!=$ABS_STARTDATE || $OABS_STARTPERIOD!=$conv_ABS_STARTPERIOD) 
                                                             || ($OABS_ENDDATE!=$ABS_ENDDATE || $OABS_ENDPERIOD!=$conv_ABS_ENDPERIOD)){
                                                             $ORI_ABS_STARTDATE = $OABS_STARTDATE;
                                                             $ORI_ABS_STARTPERIOD = $OABS_STARTPERIOD;
                                                             $ORI_ABS_ENDDATE = $OABS_ENDDATE;
                                                             $ORI_ABS_ENDPERIOD = $OABS_ENDPERIOD;
                                                            // echo 'xx';
                                                        }
                                                        //echo $OABS_STARTDATE.'=='.$ABS_STARTDATE;
                                                    ?>
                                                    <tr style="color: red;">
                                                      <td  align="right" ><?php echo $coltext1;?></td>
                                                      <td><?php echo $ORI_ABS_STARTDATE.' '.$ORI_ABS_STARTPERIOD;?></td>
                                                      <td align="right" ><?php echo $coltext2;?></td>
                                                      <td><?php echo $ORI_ABS_ENDDATE.' '.$ORI_ABS_ENDPERIOD;?></td>
                                                    </tr>
                                                    <?php 
                                                    
                                                    }?>
                                                    <tr>
                                                        <td  align="right" <?=(($SESS_PER_ID==$REVIEW1_PER_ID)?"style='color:#0000FF'":"")?>>ผู้บังคับบัญชาชั้นต้น&nbsp;:&nbsp;</td>
                                                        <td><input type="text" name="REVIEW1_PER_NAME" value="<?=$REVIEW1_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="REVIEW1_PER_ID" value="<?=$REVIEW1_PER_ID?>">
                                                            <? if((($SESS_PER_ID==$PER_ID && $ABS_REVIEW1_FLAG==0) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                            <input type="button" name="btn_review1_person" class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="call_search_person('REVIEW1_');">
                                                            <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.REVIEW1_PER_ID.value=''; form1.REVIEW1_PER_NAME.value=''; return false;" align="center" alt="ล้างค่า">
                                                            <? endif; ?></td>
<!--
                                                        <td align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป&nbsp;:&nbsp;</td>
                                                        <td><input type="text" name="REVIEW2_PER_NAME" value="<?=$REVIEW2_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="REVIEW2_PER_ID" value="<?=$REVIEW2_PER_ID?>">
                                                            <? if((($SESS_PER_ID==$PER_ID && $ABS_REVIEW2_FLAG==0) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                            <input type="button" name="btn_review2_person" class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="call_search_person('REVIEW2_');">
                                                            <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.REVIEW2_PER_ID.value=''; form1.REVIEW2_PER_NAME.value=''; return false;" align="center" alt="ล้างค่า">
                                                            <? endif; ?></td>
-->
                                                    </tr>
                                                    <?  if($ABS_ID){ ?>
                                                    <tr> 
                                                        <? if($REVIEW1_PER_ID  || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                        <td  nowrap="nowrap" align="right" <?=(($SESS_PER_ID==$REVIEW1_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็นผู้บังคับบัญชาชั้นต้น&nbsp;:&nbsp;</td>
                                                        <td><input name="ABS_REVIEW1_FLAG" type="radio" value="1" <?=(($ABS_REVIEW1_FLAG==1)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$REVIEW1_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?>>&nbsp;เห็นควรอนุญาต&nbsp;&nbsp;<input name="ABS_REVIEW1_FLAG" type="radio" value="2" <?=(($ABS_REVIEW1_FLAG==2)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$REVIEW1_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?>>&nbsp;ไม่เห็นควรอนุญาต<input type="hidden" name="ABS_REVIEW1_FLAG_HIDDEN" value="<?=$ABS_REVIEW1_FLAG; ?>"><input type="hidden" name="REVIEW1_DATE" value="<?=$REVIEW1_DATE; ?>"><?  //=(($REVIEW1_DISPLAY_DATE)?"<br>(วันที่ ".$REVIEW1_DISPLAY_DATE.")":"")?></td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
<!--
                                                        <? if($REVIEW2_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                        <td align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็นผู้บังคับบัญชาชั้นต้นเหนือขึ้นไปxx&nbsp;&nbsp;:&nbsp;</td>
                                                        <td><input name="ABS_REVIEW2_FLAG" type="radio" value="1" <?=(($ABS_REVIEW2_FLAG==1)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"disabled":"")?>>&nbsp;เห็นควรอนุญาต&nbsp;&nbsp;<input name="ABS_REVIEW2_FLAG" type="radio" value="2" <?=(($ABS_REVIEW2_FLAG==2)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"disabled":"")?>>&nbsp;ไม่เห็นควรอนุญาต<input type="hidden" name="ABS_REVIEW2_FLAG_HIDDEN" value="<?=$ABS_REVIEW2_FLAG; ?>"><input type="hidden" name="REVIEW2_DATE" value="<?=$REVIEW2_DATE; ?>">
                                                            <? //=(($REVIEW2_DISPLAY_DATE)?"<br>(วันที่ ".$REVIEW2_DISPLAY_DATE.")":"")?>
                                                        </td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
-->
                                                    </tr>

                                                    <tr>
                                                        <? if($REVIEW1_PER_ID  || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                            <td  nowrap="nowrap" align="right" <?=(($SESS_PER_ID==$REVIEW1_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็น&nbsp;:&nbsp;</td>
                                                            <td ><textarea name="REVIEW1_NOTE" rows="2" class="selectbox" style="width:75%" <?=((($SESS_PER_ID!=$REVIEW1_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?> value="<?=$REVIEW1_NOTE;?>" ><?=$REVIEW1_NOTE;?></textarea></td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
<!--
                                                         <? if($REVIEW2_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                            <td  nowrap="nowrap" align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็น&nbsp;:&nbsp;</td>
                                                            <td ><textarea name="REVIEW2_NOTE" rows="2" class="selectbox" style="width:75%" <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"disabled":"")?> value="<?=$REVIEW2_NOTE;?>" ><?=$REVIEW2_NOTE;?></textarea></td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
-->
                                                    </tr>
                                                    <?php

                                                    if( ($SESS_PER_ID!=$REVIEW1_PER_ID || $ABS_CANCEL_FLAG==1) 
                                                        && $SESS_USERGROUP!=1 
                                                        && $NAME_GROUP_HRD!="HRD" 
                                                        && $SESS_PER_AUDIT_FLAG != 1 
                                                    ){
                                                     //echo "[1]";
                                                    }else{
                                                    //echo "[0]";
                                                    }
                                                    ?>
                                                    <tr>
                                                        <td align="right" <?=(($SESS_PER_ID==$REVIEW1_PER_ID)?"style='color:#0000FF'":"")?>>วันที่ลงความเห็น&nbsp;&nbsp;:&nbsp;</td>
                                                        
                                                        <?php if( ($SESS_PER_ID!=$REVIEW1_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ){
                                                        }else{
                                                        if(empty($REVIEW1_DISPLAY_DATE)){$REVIEW1_DISPLAY_DATE=date('d').'/'.date('m').'/'.(date('Y')+543);}
                                                        }?>
                                                        
                                                        <td>
                                                            <input type="text" name="REVIEW1_DISPLAY_DATE" id="REVIEW1_DISPLAY_DATE" value="<?=$REVIEW1_DISPLAY_DATE?>"  
                                                                   class="textbox" onKeyPress="return DateOnly();" 
                                                                   onBlur="changedateformat(form1.REVIEW1_DISPLAY_DATE,this.value);" 
                                                                   <?=(( ($SESS_PER_ID!=$REVIEW1_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"readonly":"")?>>&nbsp;&nbsp;
                                                                   <?php if( ($SESS_PER_ID!=$REVIEW1_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ){}else{?>
                                                                   <input type="reset" name="btn_startdate" class="button" 
                                                                   onClick="return showCalendar('REVIEW1_DISPLAY_DATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                                            <?php }?>
                                                        </td>
                                                        <?php if((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)){
                                                        }else{
                                                            if(empty($REVIEW2_DISPLAY_DATE)){$REVIEW2_DISPLAY_DATE=date('d').'/'.date('m').'/'.(date('Y')+543);}
                                                        } ?>
<!--
                                                        <td align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>วันที่ลงความเห็น&nbsp;&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="text" name="REVIEW2_DISPLAY_DATE" id="REVIEW2_DISPLAY_DATE" value="<?=$REVIEW2_DISPLAY_DATE?>"  
                                                                   class="textbox" onKeyPress="return DateOnly();" 
                                                                   onBlur="changedateformat(form1.REVIEW2_DISPLAY_DATE,this.value);" 
                                                                   <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"readonly":"")?>>&nbsp;&nbsp;
                                                                   <? if((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)){}else{ ?>
                                                                   <input type="reset" name="btn_startdate" class="button" 
                                                                   onClick="return showCalendar('REVIEW2_DISPLAY_DATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                                            <? } ?>
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
-->
                                                    </tr>
                                                    <tr>
                                                    	<td align="right">&nbsp;</td>
                                                    </tr>
                                                    <? } ?>	
                                                    <tr>
                                                    	<td align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป&nbsp;:&nbsp;</td>
                                                        <td><input type="text" name="REVIEW2_PER_NAME" value="<?=$REVIEW2_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="REVIEW2_PER_ID" value="<?=$REVIEW2_PER_ID?>">
                                                            <? if((($SESS_PER_ID==$PER_ID && $ABS_REVIEW2_FLAG==0) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                            <input type="button" name="btn_review2_person" class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="call_search_person('REVIEW2_');">
                                                            <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.REVIEW2_PER_ID.value=''; form1.REVIEW2_PER_NAME.value=''; return false;" align="center" alt="ล้างค่า">
                                                            <? endif; ?></td>
													</tr>
                                                	<? if($ABS_ID){?>
                                                 	<tr>
                                                 		<? if($REVIEW2_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                        <td align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็นผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป&nbsp;&nbsp;:&nbsp;</td>
                                                        <td>
                                                        	<? //=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"disabled":"")?>
                                                        	<input name="ABS_REVIEW2_FLAG" type="radio" value="1" <?=(($ABS_REVIEW2_FLAG==1)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD")?"disabled":"")?>>&nbsp;เห็นควรอนุญาต&nbsp;&nbsp;<input name="ABS_REVIEW2_FLAG" type="radio" value="2" <?=(($ABS_REVIEW2_FLAG==2)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD")?"disabled":"")?>>&nbsp;ไม่เห็นควรอนุญาต<input type="hidden" name="ABS_REVIEW2_FLAG_HIDDEN" value="<?=$ABS_REVIEW2_FLAG; ?>"><input type="hidden" name="REVIEW2_DATE" value="<?=$REVIEW2_DATE; ?>">
                                                            <? //=(($REVIEW2_DISPLAY_DATE)?"<br>(วันที่ ".$REVIEW2_DISPLAY_DATE.")":"")?>
                                                        </td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
													</tr>
                                                	<tr>
                                                		<? if($REVIEW2_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                            <td  nowrap="nowrap" align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็น&nbsp;:&nbsp;</td>
                                                            <td ><textarea name="REVIEW2_NOTE" rows="2" class="selectbox" style="width:75%" <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD")?"disabled":"")?> value="<?=$REVIEW2_NOTE;?>" ><?=$REVIEW2_NOTE;?></textarea></td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
													</tr>  	 	  	  	 	  	 
                                                 	<tr>
                                                 		<td align="right" <?=(($SESS_PER_ID==$REVIEW2_PER_ID)?"style='color:#0000FF'":"")?>>วันที่ลงความเห็น&nbsp;&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="text" name="REVIEW2_DISPLAY_DATE" id="REVIEW2_DISPLAY_DATE" value="<?=$REVIEW2_DISPLAY_DATE?>"  
                                                                   class="textbox" onKeyPress="return DateOnly();" 
                                                                   onBlur="changedateformat(form1.REVIEW2_DISPLAY_DATE,this.value);" 
                                                                   <?=((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"readonly":"")?>>&nbsp;&nbsp;
                                                                   <? if((($SESS_PER_ID!=$REVIEW2_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)){}else{ ?>
                                                                   <input type="reset" name="btn_startdate" class="button" 
                                                                   onClick="return showCalendar('REVIEW2_DISPLAY_DATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                                            <? } ?>
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
													</tr> 
                                                	<tr>
														<td align="right">&nbsp;</td>
													</tr> 
                                                 	<? } ?>  		  	 	  	
                                                  	  	<td  align="right" <?=(($SESS_PER_ID==$APPROVE_PER_ID)?"style='color:#0000FF'":"")?>>&nbsp;<span class="label_alert">*</span>&nbsp;ผู้อนุญาตการลา&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="text" name="APPROVE_PER_NAME" value="<?=$APPROVE_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="APPROVE_PER_ID" value="<?=$APPROVE_PER_ID?>">
                                                            <? if((($SESS_PER_ID==$PER_ID && $ABS_APPROVE_FLAG==0) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                            <input type="button" name="btn_approve_person"  class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="call_search_person('APPROVE_');">
                                                            <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.APPROVE_PER_ID.value=''; form1.APPROVE_PER_NAME.value=''; return false;" align="center" alt="ล้างค่า">
                                                            <? endif; ?>
                                                        </td>
                                                    <? if($ABS_ID ){?>    
                                                    <tr>
                                                    	<? if($APPROVE_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                        <td  align="right" <?=(($SESS_PER_ID==$APPROVE_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็นผู้อนุญาตการลา&nbsp;&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="hidden" name="HIDDEN_ABS_APPROVE_FLAG" value="<?php echo $ABS_APPROVE_FLAG;?>">
                                                            <input name="ABS_APPROVE_FLAG" id="ABS_APPROVE_FLAG1" type="radio" value="1" <?=(($ABS_APPROVE_FLAG==1)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$APPROVE_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?>>&nbsp;อนุญาต&nbsp;&nbsp;<input name="ABS_APPROVE_FLAG" id="ABS_APPROVE_FLAG2" type="radio" value="2" <?=(($ABS_APPROVE_FLAG==2)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$APPROVE_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?>>&nbsp;ไม่อนุญาต<input type="hidden" name="ABS_APPROVE_FLAG_HIDDEN" value="<?=$ABS_APPROVE_FLAG; ?>"><input type="hidden" name="APPROVE_DATE" value="<?=$APPROVE_DATE; ?>"><? //=(($APPROVE_DISPLAY_DATE)?"<br>(วันที่ ".$APPROVE_DISPLAY_DATE.")":"")?></td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
													</tr>
                                                    <tr>
                                                    	<? if($APPROVE_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ){ /*|| $SESS_PER_AUDIT_FLAG == 1*/ ?>
                                                            <td  nowrap="nowrap" align="right" <?=(($SESS_PER_ID==$APPROVE_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็น&nbsp;:&nbsp;</td>
                                                            <td ><textarea name="APPROVE_NOTE" rows="2" class="selectbox" style="width:75%" <?=((($SESS_PER_ID!=$APPROVE_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?> value="<?=$APPROVE_NOTE;?>"><?=$APPROVE_NOTE;?></textarea></td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
													</tr>
                                                    <tr>
                                                    	<td align="right" <?=(($SESS_PER_ID==$APPROVE_PER_ID)?"style='color:#0000FF'":"")?>>วันที่อนุญาต&nbsp;&nbsp;:&nbsp;</td>
                                                        <? if((($SESS_PER_ID!=$APPROVE_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)){
                                                            //echo "111";
                                                        }else{
                                                            if(empty($APPROVE_DISPLAY_DATE)){$APPROVE_DISPLAY_DATE=date('d').'/'.date('m').'/'.(date('Y')+543);}
                                                        } ?>
                                                        <td>
                                                            <input type="text" name="APPROVE_DISPLAY_DATE" id="APPROVE_DISPLAY_DATE" value="<?=$APPROVE_DISPLAY_DATE?>"  
                                                                   class="textbox" onKeyPress="return DateOnly();" 
                                                                   onBlur="changedateformat(form1.APPROVE_DISPLAY_DATE,this.value);" 
                                                                   <?=((($SESS_PER_ID!=$APPROVE_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"readonly":"")?>>&nbsp;&nbsp;
                                                                   <? if((($SESS_PER_ID!=$APPROVE_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)){}else{ ?>
                                                                   <input type="reset" name="btn_startdate" class="button" 
                                                                   onClick="return showCalendar('APPROVE_DISPLAY_DATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                                            <? } ?>
                                                        </td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
													</tr>
                                                  	<tr>
														<td align="right">&nbsp;</td>
													</tr>
                                                   <? } ?>
                                                    
<!--
                                                        <td  align="right" <?=(($SESS_PER_ID==$AUDIT_PER_ID)?"style='color:#0000FF'":"")?>>ผู้ตรวจสอบการลา&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="text" name="AUDIT_PER_NAME" value="<?=$AUDIT_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="AUDIT_PER_ID" value="<?=$AUDIT_PER_ID?>">
                                                            <? if((($SESS_PER_ID==$PER_ID && $ABS_AUDIT_FLAG==0)  || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                            <input type="button" name="btn_audit_person" class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="call_search_person('AUDIT_');">
                                                            <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.AUDIT_PER_ID.value=''; form1.AUDIT_PER_NAME.value=''; return false;" align="center" alt="ล้างค่า">
                                                            <? endif; ?>
                                                        </td>
-->
<!--
                                                        <td  align="right" <?=(($SESS_PER_ID==$APPROVE_PER_ID)?"style='color:#0000FF'":"")?>>&nbsp;<span class="label_alert">*</span>&nbsp;ผู้อนุญาตการลา&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="text" name="APPROVE_PER_NAME" value="<?=$APPROVE_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="APPROVE_PER_ID" value="<?=$APPROVE_PER_ID?>">
                                                            <? if((($SESS_PER_ID==$PER_ID && $ABS_APPROVE_FLAG==0) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                            <input type="button" name="btn_approve_person"  class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="call_search_person('APPROVE_');">
                                                            <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.APPROVE_PER_ID.value=''; form1.APPROVE_PER_NAME.value=''; return false;" align="center" alt="ล้างค่า">
                                                            <? endif; ?>
                                                        </td>
-->
                                                   
                                                    <tr>
                                                      <td  align="right">เงื่อนไขของผู้อนุญาตการลา&nbsp;&nbsp;:&nbsp;</td>
                                                      <td colspan="3">
                                                      						<input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="0"  <?php if(empty($POS_STATUS)){echo "checked";}?>>&nbsp;ตรงตามอำนาจอนุญาตการลา
                                                                           
                                                                           <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="1"  <?php if($POS_STATUS=='1'){echo "checked";}?>>&nbsp;รักษาราชการแทน
                                                                           
                                                                           <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="2"  <?php if($POS_STATUS=='2'){echo "checked";}?>>&nbsp;รักษาการในตำแหน่ง
                                                                           
                                                                           <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="3"  <?php if($POS_STATUS=='3'){echo "checked";}?>>&nbsp;ปฏิบัติราชการแทน
                                                                           </td>
                                                    </tr>
                                                    <tr>
                                                      <td></td>
                                                      <td style="color:blue">**&nbsp;<input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"readonly":""?> type="text" 
                                                                           name="POS_APPROVE0" id="POS_APPROVE0" maxlength="200" value="<?php echo $POS_APPROVE;?>" style="width:75%"></input></td>
                                                      <td>&nbsp;</td>
                                                      <td>&nbsp;</td>
                                                    </tr>
                                                    <tr>
                                                      <td  align="right"></td>
                                                      <td colspan="3" style="color:#0000FF">
                                                      			* ช่องนี้ กรอกเพื่อให้ระบบนำไปแสดงบนแบบฟอร์มในส่วนของ "เรียน"
                                                      	</td>
                                                    </tr>
                                                    <tr>
                                                      <td  align="right"></td>
                                                      <td colspan="3" style="color:#0000FF">
															&nbsp;	(หากไม่กรอก ระบบจะแสดงในส่วนของ "เรียน" เป็นชื่อตำแหน่งทางการบริหาร หรือชื่อของผู้อนุญาต(กรณีที่ผู้อนุญาตไม่มีตำแหน่งทางการบริหาร))
                                                      	</td>
                                                    </tr>
                                                    <!--<?php
                                                    $display_lbl0 ='style="display:\'\' "';
                                                    $display_lbl1 ='style="display:none"';
                                                    $display_lbl2 ='style="display:none"';
                                                    $display_lbl3 ='style="display:none"';
                                                    if($POS_STATUS=="0"){
                                                        $display_lbl0 ='style="display:\'\' "';
                                                        $display_lbl1 ='style="display:none"';
                                                        $display_lbl2 ='style="display:none"';
                                                        $display_lbl3 ='style="display:none"';
                                                    }
                                                    if($POS_STATUS=="1"){
                                                        $display_lbl0 ='style="display:none"';
                                                        $display_lbl1 ='style="display:\'\' "';
                                                        $display_lbl2 ='style="display:none"';
                                                        $display_lbl3 ='style="display:none"';
                                                    }
                                                    if($POS_STATUS=="2"){
                                                        $display_lbl0 ='style="display:none"';
                                                        $display_lbl1 ='style="display:none"';
                                                        $display_lbl2 ='style="display:\'\'"';
                                                        $display_lbl3 ='style="display:none"';
                                                    }
                                                    if($POS_STATUS=="3"){
                                                        $display_lbl0 ='style="display:none"';
                                                        $display_lbl1 ='style="display:none"';
                                                        $display_lbl2 ='style="display:none"';
                                                        $display_lbl3 ='style="display:\'\'"';
                                                    }
                                                    ?>
                                                    
                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td align="right" style="vertical-align: top">เงื่อนไขของผู้อนุญาตการลา&nbsp;&nbsp;:&nbsp;</td>
                                                        <td>
                                                        	<div class="EScontainer">
                                                                <div class="ESright">
                                                                	<lable id="trstatus0" <?php echo $display_lbl0;?>>
                                                                        <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"readonly":""?> type="text" 
                                                                           name="POS_APPROVE0" id="POS_APPROVE0" maxlength="200" value="<?php echo $POS_APPROVE;?>" style="width:75%"></input>
                                                                    </lable>
                                                                </div>
                                                                <div class="ESleft">
                                                                    <lable>
                                                                        <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="0" onclick="chk_status();" <?php if(empty($POS_STATUS)){echo "checked";}?>>&nbsp;ตรงตามอำนาจอนุญาตการลา
                                                                    </lable>
                                                                </div>
                                                           </div>
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <div class="EScontainer">
                                                                <div class="ESright">
                                                                    <lable id="trstatus1" <?php echo $display_lbl1;?>>
                                                                        <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"readonly":""?> type="text" 
                                                                           name="POS_APPROVE1" id="POS_APPROVE1" maxlength="200" value="<?php echo $POS_APPROVE;?>" style="width:75%"></input>
                                                                    </lable>
                                                                </div>
                                                                <div class="ESleft">
                                                                    <lable>
                                                                        <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="1" onclick="chk_status();" <?php if($POS_STATUS=='1'){echo "checked";}?>>&nbsp;รักษาราชการแทน
                                                                    </lable>
                                                                </div>
                                                            </div>
                                                            
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td>
                                                            <div class="EScontainer">
                                                                <div class="ESright">
                                                                    <lable id="trstatus2" <?php echo $display_lbl2;?>>
                                                                           <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"readonly":""?> type="text" 
                                                                           name="POS_APPROVE2" id="POS_APPROVE2" maxlength="200" value="<?php echo $POS_APPROVE;?>" style="width:75%"></input>
                                                                    </lable>
                                                                </div>
                                                                <div class="ESleft">
                                                                    <lable>
                                                                        <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="2" onclick="chk_status();" <?php if($POS_STATUS=='2'){echo "checked";}?>>&nbsp;รักษาการในตำแหน่ง
                                                                    </lable>
                                                                </div>
                                                            </div>
                                                            
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td></td>
                                                        <td></td>
                                                        <td></td>
                                                        <td >
                                                            <div class="EScontainer">
                                                                <div class="ESright">
                                                                    <lable id="trstatus3" <?php echo $display_lbl3;?>>
                                                                <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"readonly":""?> type="text" 
                                                                           name="POS_APPROVE3" id="POS_APPROVE3" maxlength="200" value="<?php echo $POS_APPROVE;?>" style="width:75%"></input>
                                                                    </lable>
                                                                </div>
                                                                <div class="ESleft">
                                                                    <lable>
                                                                        <input <?=((($VIEW || $CAN_EDIT=="N") 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                           || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                           && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                           && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"disabled":""?> name="POS_STATUS" id="POS_STATUS" type="radio" value="3" onclick="chk_status();" <?php if($POS_STATUS=='3'){echo "checked";}?>>&nbsp;ปฏิบัติราชการแทน
                                                                    </lable>
                                                                </div>
                                                            </div>
                                                            
                                                        </td>
                                                    </tr>-->
                                                    <tr id="trstatus" <?php //if($POS_STATUS=='0' || empty($POS_STATUS)){echo 'style="display:none"';}?>>
                                                        <td></td>
                                                        <td></td>
                                                        <td align="right">&nbsp;&nbsp;&nbsp;</td>
                                                        <td>
                                                            
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr id="DIV_REASON" style="display:<?=in_array(trim($AB_CODE), array("01","02","03"))?"":"none"?>;">
                                                        <td nowrap="nowrap" align="right">&nbsp;<span class="label_alert">*</span>&nbsp;เนื่องจาก&nbsp;:&nbsp;
                                                        </td>
                                                        <td colspan="3">
                                                            <input type="text" name="ABS_REASON" value="<?=$ABS_REASON?>"  style="width:50%" class="textbox"  
                                                                   <?=((($VIEW || $CAN_EDIT=="N") 
                                                                   && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) 
                                                                   || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" 
                                                                   && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) 
                                                                   && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 ))?"readonly":""?>><!-- && $PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y"-->
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                    	<td  align="right" <?=(($SESS_PER_ID==$AUDIT_PER_ID)?"style='color:#0000FF'":"")?>>ผู้ตรวจสอบการลา&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input type="text" name="AUDIT_PER_NAME" value="<?=$AUDIT_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                                            <input type="hidden" name="AUDIT_PER_ID" value="<?=$AUDIT_PER_ID?>">
                                                            <? if((($SESS_PER_ID==$PER_ID && $ABS_AUDIT_FLAG==0)  || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                            <input type="button" name="btn_audit_person" class="button" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" onClick="call_search_person('AUDIT_');">
                                                            <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.AUDIT_PER_ID.value=''; form1.AUDIT_PER_NAME.value=''; return false;" align="center" alt="ล้างค่า">
                                                            <? endif; ?>
                                                        </td>
													</tr>
                                                  <? if($ABS_ID){?>
                                                   <tr>
                                                   		<? if($AUDIT_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){ ?>
                                                        <td  align="right" <?=(($SESS_PER_ID==$AUDIT_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็นผู้ตรวจสอบการลา&nbsp;:&nbsp;</td>
                                                        <td>
                                                            <input name="ABS_AUDIT_FLAG" type="radio" value="1" <?=(($ABS_AUDIT_FLAG==1)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$AUDIT_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?>>&nbsp;ตรวจสอบแล้ว&nbsp;&nbsp;<input name="ABS_AUDIT_FLAG" type="radio" value="2" <?=(($ABS_AUDIT_FLAG==2)?"checked":"")?> 
                                                                   <?=((($SESS_PER_ID!=$AUDIT_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?>>&nbsp;ยังไม่ตรวจสอบ<input type="hidden" name="ABS_AUDIT_FLAG_HIDDEN" value="<?=$ABS_AUDIT_FLAG; ?>"><input type="hidden" name="AUDIT_DATE" value="<?=$AUDIT_DATE; ?>"><? //=(($AUDIT_DISPLAY_DATE)?"<br>(วันที่ ".$AUDIT_DISPLAY_DATE.")":"")?>
                                                        </td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
												   </tr>
                                                   <tr>
                                                   		<? if($AUDIT_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){ ?>
                                                            <td  nowrap="nowrap" align="right" <?=(($SESS_PER_ID==$AUDIT_PER_ID)?"style='color:#0000FF'":"")?>>ความเห็น&nbsp;:&nbsp;</td>
                                                            <td ><textarea name="AUDIT_NOTE" rows="2" class="selectbox" style="width:75%" <?=((($SESS_PER_ID!=$AUDIT_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" )?"disabled":"")?> value="<?=$AUDIT_NOTE;?>"><?=$AUDIT_NOTE;?></textarea></td>
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
												   </tr>
                                                   <tr>
                                                   		<? if($AUDIT_PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){ ?>
                                                        <td align="right" <?=(($SESS_PER_ID==$AUDIT_PER_ID)?"style='color:#0000FF'":"")?>>วันที่ตรวจสอบ&nbsp;&nbsp;:&nbsp;</td>
                                                     <? if((($SESS_PER_ID!=$AUDIT_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)){
                                                     }else{
                                                     if(empty($AUDIT_DISPLAY_DATE)){$AUDIT_DISPLAY_DATE=date('d').'/'.date('m').'/'.(date('Y')+543);}
                                                     } ?>
                                                        <td>
                                                            <input type="text" name="AUDIT_DISPLAY_DATE" id="AUDIT_DISPLAY_DATE" value="<?=$AUDIT_DISPLAY_DATE?>"  
                                                                   class="textbox" onKeyPress="return DateOnly();" 
                                                                   onBlur="changedateformat(form1.AUDIT_DISPLAY_DATE,this.value);" 
                                                                   <?=((($SESS_PER_ID!=$AUDIT_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)?"readonly":"")?>>&nbsp;&nbsp;
                                                                   <? if((($SESS_PER_ID!=$AUDIT_PER_ID || $ABS_CANCEL_FLAG==1) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1)){}else{ ?>						
                                                                   <input type="reset" name="btn_startdate" class="button" 
                                                                   onClick="return showCalendar('AUDIT_DISPLAY_DATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                                            <? } ?>
                                                        </td>
                                                        
                                                        <? }else{ ?>
                                                        <td></td>
                                                        <td></td>
                                                        <? } ?>
                                                   </tr>
                                                    <tr>
														<td align="right">&nbsp;</td>
													</tr>
                                                  <? } ?> 
                                                    <tr>
                                                        <td  nowrap="nowrap" align="right">ที่อยู่ที่ติดต่อได้ระหว่างลา&nbsp;:&nbsp;</td>
                                                        <td colspan="3"><textarea name="ABS_ADDRESS" rows="3" class="selectbox" style="width:50%" <?=((($VIEW || $CAN_EDIT=="N") && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) || ($SESS_PER_ID!=$PER_ID && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1) || (($ABS_APPROVE_FLAG==1 || $ABS_APPROVE_FLAG==2) && $SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1))?"readonly":""?>><?=$ABS_ADDRESS?></textarea></td>
                                                    </tr><!-- && $PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y"-->
                                                    <tr>
                                                        <td  align="right">จำนวนวันลา&nbsp;:&nbsp;</td>
                                                        <td>
                                                        <? 
                                                        	$ABS_DAYReadonly = "";
                                                            if($ABS_ID && $EDIT_ABSENT_DAY=="Y"){
                                                            	$ABS_DAYReadonly = "readonly";
                                                                if(( $SESS_PER_ID==$PER_ID && $ABS_REVIEW1_FLAG==0 && $ABS_REVIEW2_FLAG==0  && $ABS_APPROVE_FLAG==0 && $ABS_AUDIT_FLAG==0 && ($ABS_ENDDATE_CHECK >= $TODATE || $SESS_PER_AUDIT_FLAG == 1 )) || $SESS_USERGROUP==1 || ($SESS_PER_AUDIT_FLAG == 1 && $SESS_PER_ID==$AUDIT_PER_ID )){
                                                                    $ABS_DAYReadonly = "";
                                                                }
                                                            }
                                                        ?>
                                                            <input type="text" name="ABS_DAY" value="<?=$ABS_DAY;?>" style="text-align:right" class="textbox" onKeyPress="return DigitOnly();" onChange="return chkOverNumDay();" <?=($EDIT_ABSENT_DAY!="Y")?"readonly":"" ?> <?=$ABS_DAYReadonly;?>>
                                                                   &nbsp;
                                                                   <? if((($SESS_PER_ID==$PER_ID || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1) || $CAN_EDIT=="Y") && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                                                   <input type="button" class="button" name="butt_calc_absent" value="คำนวณวัน" 
                                                                   onmouseover="strVacationOver(document.getElementById('AB_CODE').value);get_age_over();"
                                                                   onClick="calcDaysBetweenDateNew(1,'','YES');">
                                                            <? endif; ?>  
                                                            	<input type="hidden" name="HID_ABS_DAY" value="<?=$HID_ABS_DAY;?>">
                                                                <input type="hidden" name="HID_count_duplicate_date" value="0">
                                                            </td>
                                                        <td>&nbsp;</td>
                                                        <td><!--<select name="ABS_LETTER">
                                                                                                                 <option  value="1" <?=($ABS_LETTER==1 || !$ABS_LETTER)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>>ยังไม่ได้ส่งใบลา</option>
                                                                                                                      <option  value="2"  <?=($ABS_LETTER==2)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>>ส่งใบลาถูกต้อง</option>
                                                                                                                      <option  value="3" <?=($ABS_LETTER==3)? "selected":"";?> <?=(trim($AB_CODE) != "10")?"":"disabled"?>>ล่งใบลาไม่ถูกต้อง</option>
                                                                                                      </select>-->
                                                            <input type="hidden" name="ABS_LETTER" value="<?=$ABS_LETTER; ?>"></td> 
                                                    </tr>
                                                    <? if($ABS_ID){ ?>
                                                    <tr> 
                                                        <td  align="right">วันที่ส่งใบลา&nbsp;:&nbsp;</td>
                                                        <td><?=(($ABS_CREATE_DATE)?$ABS_CREATE_DATE:"-")?></td>
                                                        <td colspan="2" <?=(($ABS_CANCEL_FLAG==1)?"style='color:#FF0000'":"")?>>
                                                            <!--<?="$TODATE>=$ABS_STARTDATE_CHECK"; ?>-->

                                                            <?php
                                                            /*เดิม*/
                                                            /*=( ($SESS_USERGROUP!=1) || 
                                                            ($SESS_PER_ID!=$PER_ID || (($SESS_PER_ID==$PER_ID && $TODATE>=$ABS_STARTDATE_CHECK) 
                                                            || ($SESS_PER_ID==$PER_ID && $ABS_CANCEL_FLAG==1)
                                                            )
                                                            )?'disabled':'')*/
                                                            /*Release 5.1.0.5 Begin*/
                                                            /*echo $ABS_CANCEL_FLAG."<br>";
                                                            echo $TODATE."<=".$ABS_STARTDATE_CHECK."<br>";
                                                            echo $SESS_PER_ID."==".$PER_ID."<br>";
                                                            echo ">>".$PAGE_AUTH["edit"];*/

                                                            /*if($ABS_CANCEL_FLAG!=1 || $SESS_USERGROUP==1 
                                                            || ($SESS_PER_ID==$PER_ID  && $TODATE <= $ABS_STARTDATE_CHECK) 
                                                            || ($SESS_PER_ID==$PER_ID && $ABS_CANCEL_FLAG==1) 
                                                            || $PAGE_AUTH["edit"]=="Y" ){
                                                            $txtDisabled = "";
                                                            }*/

                                                            //echo "ABS_APPROVE_FLAG->".$TODATE.",".$ABS_STARTDATE_CHECK."<br>";
                                                            $txtDisabled = "disabled";
                                                            if(($TODATE>=$TMP_ABS_STARTDATE_CHECK) && ($SESS_PER_ID==$PER_ID && $ABS_CANCEL_FLAG==1) ){
                                                            $txtDisabled = "disabled";
                                                            }elseif( $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1  || ($ABS_APPROVE_FLAG==1 && ($SESS_PER_ID==$PER_ID  && $TODATE <= $ABS_STARTDATE_CHECK)) 
                                                            || ($SESS_PER_ID!=$PER_ID && $ABS_APPROVE_FLAG==1 && $PAGE_AUTH["edit"]=="Y" && $TODATE <= $ABS_STARTDATE_CHECK ) 
                                                            ){ /*|| ($SESS_PER_ID==$PER_ID && $ABS_CANCEL_FLAG==0)*/
                                                            $txtDisabled = "";
                                                            }
                                                            //$ABS_CANCEL_FLAG==1
                                                            //echo $txtDisabled.'<<<'.$ABS_CANCEL_FLAG;
                                                            /*Release 5.1.0.5 End*/
                                                            ?>
                                                            
                                                            
                                                            <input type="checkbox" name="ABS_CANCEL_FLAG" value="<?=($ABS_CANCEL_FLAG)?($ABS_CANCEL_FLAG):1;?>" 
                                                                 disabled="" <?=(($ABS_CANCEL_FLAG==1)?"checked":"")?>>
                                                                 <? if($ABS_CANCEL_FLAG!=1 && $ABS_CANCEL_FLAG!=8 && $ABS_CANCEL_FLAG!=9 && empty($NEW_OAPPROVE_PER_ID)){ ?>
                                                                 			ใบลานี้ขอยกเลิก/เปลี่ยนแปลงวันลา 
                                                                 <? } ?>


                                                                    <? if(!empty($NEW_OAPPROVE_PER_ID)){?>
                                                                        <? if(($ABS_APPROVE_FLAG=='' && $ABS_CANCEL_FLAG=='9') || ($ABS_APPROVE_FLAG=='1' && $ABS_CANCEL_FLAG=='1') || ($ABS_APPROVE_FLAG=='2' && $ABS_CANCEL_FLAG=='0' && $NEW_ORI_ABS_DAY==$NEW_OABS_DAY && $NEW_ORI_ABS_DAY==$NEW_ABS_DAY) ){ ?>
                                                                                <? if($SHOWCANCEL_DATE){echo "<span style='color: red;'>ขอยกเลิกใบลาหลังอนุญาต โดย : ".$SHOWCANCEL_BY." วันที่ : ".$SHOWCANCEL_DATE."</span>";}?>
                                                                        <? }else{?>
                                                                                <? if($SHOWCANCEL_DATE){echo "<span style='color: red;'>ขอเปลี่ยนแปลงวันลา โดย : ".$SHOWCANCEL_BY." วันที่ : ".$SHOWCANCEL_DATE."</span>";}?>
                                                                       <? }?>
                                                                
                                                                    <? }else{?>
                                                                            <? if($SHOWCANCEL_DATE){echo "<span style='color: red;'>ขอยกเลิกใบลาก่อนอนุญาต โดย : ".$SHOWCANCEL_BY." วันที่ : ".$SHOWCANCEL_DATE."</span>";}?>
                                                                    <? }?>

                                                               
                                                               
                                                               <input type="hidden" name="ABS_CANCEL_FLAG_HIDDEN" value="<?=$ABS_CANCEL_FLAG; ?>">
                                                                <? 
                                                                     $ShowBeforAfter="";
                                                                	 if($ABS_CANCEL_FLAG==9 || $ABS_CANCEL_FLAG==8){ 
                                                                 			$ShowBeforAfter=" (อนุญาต/ไม่อนุญาตครั้งก่อน)";	
                                                                     }
                                                                ?>
                                                                
                                                                
                                                                <? if($SHOWORI_APPROVE_DATE){echo "<br>&nbsp;&nbsp;<span style='color: red;'>ผู้อนุญาต : ".$SHOWORI_APPROVE_PER." วันที่ : ".$SHOWORI_APPROVE_DATE."</span><span style='color:blue;'> ".$ShowBeforAfter."</span>";}?>
                                                                
                                                                
                                                               	<? if($SHOWUPDATE_DATE){echo "<br>&nbsp;&nbsp;<span style='color: red;'>ผู้ทำรายการล่าสุด : ".$SHOWUPDATE_USER." วันที่ : ".$SHOWUPDATE_DATE."</span>";}?>

                                                               
                                                               
                                                        </td>
                                                    </tr><? } ?>
                                                    <tr>
                                                        <td align="right" bgcolor="#FBFBEF" ></td>
                                                        <td colspan="3" bgcolor="#FBFBEF">
                                                            <label id="LblBetween"></label>
                                                        </td>
														
                                                    </tr>
                                                    <tr>
														<input type="hidden" name="holiday_extra" id="holiday_extra" value="0">
														<input type="hidden" name="work_day" id="work_day" value="0">
                                                        <td colspan="4"><hr style="width: 98%"></td>
                                                    </tr>
                                                    <tr bgcolor="#FFC993">
                                                        <td>&nbsp;</td>
                                                        <td colspan="5">
                                                            <table width="67%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                                                                <tr>
                                                                    <td height="22" align="right">ปีงบประมาณ&nbsp;:&nbsp;</td>
                                                                    <td><input type="text" name="AS_YEAR" value="<?=$AS_YEAR?>" size="10" readonly></td>
                                                                </tr>
                                                                <tr>						  
                                                                    <td align="right" height="22">รอบการลา&nbsp;:&nbsp;</td>
                                                                    <td nowrap="nowrap">
                                                                        <input type="radio" name="AS_CYCLE" value="1"  disabled <?=($AS_CYCLE==1)?"checked":""?>> ครั้งที่ 1
                                                                               <input type="text" name="START_DATE_1" value="<?=$START_DATE_1?>" class="textbox" readonly>						  
                                                                        &nbsp;ถึง&nbsp;
                                                                        <input type="text" name="END_DATE_1" value="<?=$END_DATE_1?>" class="textbox" readonly>						</td>
                                                                </tr>
                                                                <tr>						  
                                                                    <td align="right" height="22"></td>
                                                                    <td nowrap="nowrap"><input type="radio" name="AS_CYCLE" value="2"  disabled <?=($AS_CYCLE==2)?"checked":""?>> ครั้งที่ 2
                                                                                               <input type="text" name="START_DATE_2" value="<?=$START_DATE_2?>" class="textbox" readonly>
                                                                        &nbsp;ถึง&nbsp;
                                                                        <input type="text" name="END_DATE_2" value="<?=$END_DATE_2?>" class="textbox" readonly></td>
                                                                </tr>
                                                            </table>			
                                                            <table width="67%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                                                                <tr>
                                                                    <td width="16%" align="right"  nowrap="nowrap">ประเภทการลา&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                                                    <td width="16%" align="center" nowrap="nowrap">ใช้สิทธิ์ลามาแล้ว (วัน)</td>
                                                                    <td width="16%" align="center" nowrap="nowrap">ใช้สิทธิ์ลามาแล้ว (ครั้ง)</td>
                                                                    <td width="16%" align="center" nowrap="nowrap">วันที่ใช้สิทธิ์ลาล่าสุด</td>
                                                                </tr>
                                                                <tr>
                                                                    <td  align="right">ป่วย&nbsp;:&nbsp;</td>
                                                                    <td><input type="text" name="AB_CODE_01" value="<?=$AB_CODE_01?>" style="text-align:right" class="textbox" readonly></td>
                                                                    <td><input type="text" name="AB_COUNT_01" value="<?=$AB_COUNT_01?>" style="text-align:right" class="textbox" readonly></td>
                                                                    <td><input type="text" name="ABS_DATE_01" value="<?=$ABS_DATE_01?>" class="textbox" readonly></td>
                                                                </tr>
                                                                <tr>
                                                                    <td  align="right">กิจส่วนตัว&nbsp;:&nbsp;</td>
                                                                    <td><input type="text" name="AB_CODE_03" value="<?=$AB_CODE_03?>" style="text-align:right" class="textbox" readonly></td>
                                                                    <td><input type="text" name="AB_COUNT_03" value="<?=$AB_COUNT_03?>" style="text-align:right" class="textbox" readonly></td>
                                                                    <td><input type="text" name="ABS_DATE_03" value="<?=$ABS_DATE_03?>" class="textbox" readonly></td>
                                                                </tr>
                                                                <tr>
                                                                    <td  align="right">คลอดบุตร&nbsp;:&nbsp;</td>
                                                                    <td><input type="text" name="AB_CODE_02" value="<?=$AB_CODE_02?>" style="text-align:right" class="textbox" readonly></td>
                                                                    <td></td>
                                                                    <td><input type="text" name="ABS_DATE_02" value="<?=$ABS_DATE_02?>" class="textbox" readonly></td>
                                                                </tr>
                                                                <tr>
                                                                    <td  align="right">พักผ่อน&nbsp;:&nbsp;</td>
                                                                    <td><input type="text" name="AB_CODE_04" value="<?=$AB_CODE_04?>" style="text-align:right" class="textbox" readonly></td>
                                                                    <td></td>
                                                                    <td><input type="text" name="ABS_DATE_4" value="<?=$ABS_DATE_04?>" class="textbox" readonly></td>
                                                                </tr>
                                                                <tr>
                                                                    <td  align="right">สิทธิลาพักผ่อนประจำปี</td>
                                                                    <td><input type="text" name="AB_COUNT_TOTAL_04" value="<?=$AB_COUNT_TOTAL_04?>" style="text-align:right" class="textbox" readonly></td>
                                                                    <td>จำนวนวันลาพักผ่อนคงเหลือ</td>
                                                                    <td><input type="text" name="AB_COUNT_04" value="<?=$AB_COUNT_04?>" style="text-align:right" class="textbox" readonly>
                                                                      <input type="hidden" name="CHK_NEXTYEAR" value="0">
                                                                      <input type="hidden" name="AB_COUNT_04_NEXTYEAR" value="0">
																	  
                                                                    </td>
																 </tr>
																<tr>
																<td colspan="4" height="10"></td>
																</tr>	
																
																<tr>
																<td align="right"><font color="blue">จำนวนที่สามารถลาได้โดยยังได้รับการพิจารณาเลื่อนเงินเดือน</font>&nbsp;:&nbsp;</td>
																<td>
																
															  	<fieldset style="text-align:right; width:200px">
																	
																	<font color="blue">ลาป่วย/ลากิจ จำนวนวัน       :   </font><label type="text" style="width:150px;" /><font color="blue"><?=$NUMBER_OF_DAY?></font></label><br />
																	<font color="blue">ลาป่วย/ลากิจ จำนวนครั้ง      :   </font><label type="text" style="width:150px;" /><font color="blue"><?=$NUMBER_OF_TIME?></font><br />
																	<font color="blue">จำนวนวันสาย  :   </font><label type="text" style="width:150px;" /><font color="blue"><?=$NUMBER_OF_LATE?></font><br />
									
																	</fieldset>
															
																</td>
															 
                                                                  <!--  <td align="right">จำนวน/ครั้ง ที่มีสิทธิ์ต่อรอบการประเมิน&nbsp;:&nbsp;</td>
                                                                    <td><input type="text" name="NUMBER_OF_DAY" value="<?=$NUMBER_OF_DAY?>" style="text-align:right" class="readonly" readonly=""></td>
                                                                    <td><input type="text" name="NUMBER_OF_TIME" value="<?=$NUMBER_OF_TIME?>" style="text-align:right" class="readonly" readonly=""></td>
                                                                    <td><input type="text" name="NUMBER_OF_LATE" value="<?=$NUMBER_OF_LATE?>" style="text-align:right" class="readonly" readonly=""></td>-->
                                                                </tr>
                                                                </tr>
                                                            </table>			
                                                        </td>
                                                    </tr>            
                                                </table></td>
                                        </tr>
                                        <tr>
                                            <td height="5" align="center"><iframe src="javascript:;" id="PROCESS_IFRAME" frameborder="0" height="5" scrolling="no"></iframe></td>
                                        </tr>
                                        <? if($PER_ID) : ?>		
                                        <tr align="center">
                                            <td height="25">
                                                <? if(($VIEW || $UPD) || (!$UPD && !$SESS_PER_ID)){ ?><? if ($BUTTON_DISPLAY==1) { ?>
                                                <input type="button" name="Reset2" value="<?=$CANCEL_TITLE?>" onClick="clear_form();" class="button" ><?  } else { ?>
                                                <input name="image2" type="image" onClick="clear_form();" src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>">
                                                <? } echo "&nbsp; &nbsp;";?>
                                                <? } // end if ?>
                                                <? if ($UPD || $VIEW) { ?>
                                                <?if($PAGE_AUTH["edit"]=="Y" && $UPD){?><? if ($BUTTON_DISPLAY==1) { ?>
                                                <input name="Submit_edit" type="button" class="button" 
                                                       onClick="calcDaysBetweenDate(1,'UPDATE');" 
                                                       <?php /*if($SESS_USERGROUP!=1){echo 'onmouseover="ChkOverLeave();"';}*/?>
                                                       value="<?=$EDIT_TITLE?>"><?  } else { ?>
                                                       <input name="image2" type="image" onClick="calcDaysBetweenDate(1,'UPDATE');"  src="images/save.png" alt="<?=$EDIT_TITLE?>">
                                                <? } echo "&nbsp; &nbsp;";?>
                                                <?}?> <? if ($BUTTON_DISPLAY==1) { ?>
                                                <input type="button" name="Reset2" value="พิมพ์ใบลา" onClick="call_export_rtf(<?=$ABS_ID?>, '<?=$AB_CODE?>');" class="button" > <?  } else { ?>
                                                <img src="images/print02.gif" alt="พิมพ์ใบลา" width="32" height="32" border="0" onClick="call_export_rtf(<?=$ABS_ID?>, '<?=$AB_CODE?>');">&nbsp;
                                                <? } echo "&nbsp; &nbsp;";?>
                                                <? } else { ?><? if ($BUTTON_DISPLAY==1) { ?>
                                                <input name="Reset2" type="reset" class="button" value="<?=$CLEAR_TITLE?>">  <?  } else { ?>
                                                <img src="images/default.jpg" alt="<?=$CLEAR_TITLE?>" width="32" height="32" border="0" onClick="form1.reset();">&nbsp;
                                                <? } echo "&nbsp; &nbsp;";?>
                                                <?if($PAGE_AUTH["add"]=="Y"){?><? if ($BUTTON_DISPLAY==1) { ?>
                                                <input name="Submit_add" id="Submit_add2" type="button" 
                                                       onmouseover="strVacationOver(document.getElementById('AB_CODE').value);get_age_over();"
                                                       class="button" onClick="calcDaysBetweenDate(1,'ADD');" value="บันทึก">
                                                <?  } else { ?>
                                                <input name="image2" type="image" onClick="calcDaysBetweenDate(1,'ADD');" src="images/save.png" alt="บันทึก">
                                                <? } echo "&nbsp; &nbsp;";?>
                                                <?}?>
                                                <?}?>
                                                <?php 
                                                if($DisableTimeAtt=="CLOSE"){
                                                echo "<br><font color=red>มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว<br>หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน</font>";
                                                }
                                                ?></td>
                                        </tr>
                                        <? endif; ?>	
                                        <tr><td height="5"></td></tr>	
                                    </table></td>
                            </tr>
                        </table>
                        <table width="95%" align="center" cellpadding="0" cellspacing="0">
                            <tr>
                                <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
                                        <tr>
                                            <td  align="center" class="table_body"><?=$SEARCH_TITLE?></td>
                                        </tr>		
                                    </table></td>
                            </tr>
                        </table>
                        <table width="95%" border="0" align="center" cellpadding="0" cellspacing="0"> 
                            <tr>
                                <td align="center" class="input_table"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                                        <tr>
                                            <td width="7%" height="2"></td>
                                        </tr>
                                        <tr>
                                        <tr> 
                                            <td width="15%" height="22" align="right"><?=$MINISTRY_TITLE?>&nbsp;:&nbsp;</td>
                                            <td width="35%">
                                                <input type="text" name="search_ministry_name" value="<?=$search_ministry_name?>" style="width:80%" class="textbox" readonly>
                                                <input type="hidden" name="search_ministry_id" value="<?=$search_ministry_id?>">
                                                <? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
                                                <input type="button" name="btn_search_ministry" class="button" value="<?=$SELECT_TITLE?>" title="<?=$MINISTRY_SELECT?>" onClick="call_search_ministry();">
                                                <input name="image" type="image" onClick="form1.search_ministry_id.value=''; form1.search_ministry_name.value=''; form1.search_department_id.value=''; form1.search_department_name.value=''; form1.search_org_id.value=''; form1.search_org_name.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
                                                <? } // end if ?>			   </td>
                                            <td width="15%" align="right"><?=$DEPARTMENT_TITLE?>&nbsp;:&nbsp;</td>
                                            <td>
                                                <input type="text" name="search_department_name" value="<?=$search_department_name?>" style="width:80%" class="textbox" readonly>
                                                <input type="hidden" name="search_department_id" value="<?=$search_department_id?>">
                                                <? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
                                                <input type="button" name="btn_search_department" class="button" value="<?=$SELECT_TITLE?>" title="<?=$DEPARTMENT_SELECT?>" onClick="call_search_department();">
                                                <input name="image" type="image" onClick="form1.search_department_id.value=''; form1.search_department_name.value=''; form1.search_org_id.value=''; form1.search_org_name.value=''; return false;" src="images/icon_clear.gif" alt="ล้างค่า" align="center" width="22" height="22">                  
                                                <? } // end if ?>			   </td>
                                        </tr>
                                        <tr>
                                            <td height="22" align="right"><?=$ORG_TITLE?>&nbsp;:&nbsp;</td>
                                            <?php 
                                            /*$hidden='';
                                            $disabled ='';
                                            if($SESS_PER_AUDIT_FLAG == 1){
                                                //$search_org_name=$ORG_NAME;
                                                //$search_org_id=$ORG_ID;
                                                $hidden='hidden';
                                                $disabled ='disabled';
                                            }*/
                                            ?>
                                            <td>
                                                <input  type="text" name="search_org_name" value="<?=$search_org_name?>" style="width:80%" class="textbox"  readonly="true">
                                                <input type="hidden" name="search_org_id" value="<?=$search_org_id?>">
                                                <? if($SESS_USERGROUP_LEVEL < 5){ ?>
                                                <input  type="button" name="btn_org" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org()" >
                                                <input  type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name.value=''; form1.search_org_id.value=''; return false;" align="center" alt="ล้างค่า">
                                                <? } // end if ?></td>
                                            <td align="right">&nbsp;</td>
                                            <td>
                                                <input   name="select_org_structure" type="radio" value="0" <?=($select_org_structure==0)?"checked":""?>  onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';"><?=$LAW_STRUCTURE_TITLE?>&nbsp;
                                                <input    name="select_org_structure" type="radio" value="1" <?=($select_org_structure==1)?"checked":""?>  onClick="form1.search_org_id.value='';form1.search_org_name.value='';form1.search_org_id_1.value='';form1.search_org_name_1.value='';"><?=$ASSIGN_STRUCTURE_TITLE?></td>
                                        </tr>
                                        <tr> 
                                            <td height="22" align="right"><?=$NAME_TITLE?>&nbsp;:&nbsp;</td>
                                            <td><input name="search_per_name" type="text" class="textbox" style="width:80%" value="<?=$search_per_name?>" 
                                                       onKeyPress="return keyEnter(event,document.form1.Submit3);"></td>
                                            <td align="right"><?=$SURNAME_TITLE?>
                                                &nbsp;:&nbsp;</td>
                                            <td><input name="search_per_surname" type="text" class="textbox" style="width:80%" value="<?=$search_per_surname?>" 
                                                       onKeyPress="return keyEnter(event,document.form1.Submit3);"></td>
                                        </tr>
                                        <td align="right"><?=$PER_TYPE_TITLE?>&nbsp;:&nbsp;</td>
                                        <td width="18%"><select name="search_per_type" onKeyPress="return keyEnter(event,document.form1.Submit3);">
                                                <?  foreach($PERSON_TYPE as $key=>$value){  
                                                $disinput[$key] = "";		$disinput[0]="";		$chinput[$key] = "";		
                                                if($SESS_PER_TYPE==0){	//ทั้งหมด
                                                if(trim($search_per_type)){
                                                $chinput[$SESS_PER_TYPE] = "";		$chinput[$search_per_type] = " selected";
                                                }else{
                                                $chinput[$SESS_PER_TYPE] = " selected";
                                                }
                                                }else{	//ประเภทอื่น
                                                $chinput[$key]=" selected";		 $chinput[0]="";		$disinput[$key]="";		$styleline[$key]="display:block";
                                                }
                                                ?><option value="<?=$key; ?>" <?=$chinput[$key]." ".$disinput[$key]; ?>><?=$value; ?></option><?  } ?>
                                                <? if($SESS_PER_TYPE==0 && $BKK_FLAG!=1){ ?><option value="0" <?=$chinput[0]." ".$disinput[0]; ?>>ทั้งหมด</option><? } ?>
                                            </select></td>
                                        <td colspan="2">&nbsp;&nbsp;<input type="checkbox" name="search_onlyme_flag" value="<?=($search_onlyme_flag)?($search_onlyme_flag):1; ?>" <?=(($search_onlyme_flag==1)?"checked":"")?>>&nbsp;เฉพาะการลาของตนเอง</td>
                                        <!--<td width="8%"  align="right"><?=$FULLNAME_TITLE;?>ผู้ลา&nbsp;:&nbsp;</td>
                                         <td width="22%"><input type="text" name="SEARCHABS_PER_NAME" value="<?=$SEARCHABS_PER_NAME?>"  style="width:75%" class="textbox" readonly>
                                             <input type="hidden" name="SEARCHABS_PER_ID" value="<?=$SEARCHABS_PER_ID?>">
                                             <? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                                             <input name="btn16" type="button" class="button" onClick="javascript:call_search_person('SEARCHABS_');" value="<?=$SELECT_TITLE?>" alt="เลือก<?=$PERSON_TITLE?>" title="หากมีข้อมูลการลาของคนที่ค้นหาจะแสดงเมื่อผู้ล็อกอินเป็นผู้ลาเอง/ผู้ตรวจสอบ/ผู้บังคับบัญชาชั้นต้น/ผู้บังคับบัญชาเหนือขึ้นไป/ผู้อนุญาตการลา/แอดมินเท่านั้น">
                                             <? endif; ?></td>--->
                            </tr>
                            <tr>
                                <td width="9%"  align="right">&nbsp;อนุญาต&nbsp;:&nbsp;</td>
                                <td width="36%">
                                    <select name="search_abs_approve" id="search_abs_approve" onKeyPress="return keyEnter(event,document.form1.Submit3);">
                                        <option  value="4" <?=($search_abs_approve==4 )? "selected":"";?>>ทั้งหมด</option>
                                        <option  value="3" <?=($search_abs_approve==3 || !$search_abs_approve )? "selected":"";?>>รออนุญาต</option>
                                        <option  value="1" <?=($search_abs_approve==1)? "selected":"";?>>อนุญาต</option>
                                        <option  value="2" <?=($search_abs_approve==2)? "selected":"";?>>ไม่อนุญาต</option>
                                    </select>
                                </td>
                                <td colspan="2">
                                    &nbsp;&nbsp;<input type="checkbox" name="search_cancel_flag" id="search_cancel_flag"
                                                       onclick="if(document.getElementById('search_cancel_flag').checked==true){document.getElementById('search_abs_approve').value = '4';}"
                                                       value="<?=($search_cancel_flag)?($search_cancel_flag):1; ?>" <?=(($search_cancel_flag==1)?"checked":"")?>>&nbsp;ยกเลิกการลา/เปลี่ยนแปลงวันลา</td>
                            </tr>
                            <tr>
                                <td height="2"></td>
                            </tr>
                            <tr>
                                <td  align="right"><?=$FROM_DATE_TITLE;?>&nbsp;:&nbsp;</td>
                                <td><input type="text" name="search_abs_startdate" id="search_abs_startdate" value="<?=$search_abs_startdate?>"  class="textbox" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_abs_startdate,this.value);" <?=(($SESS_PER_ID!=$PER_ID) && $PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y")?"":"readonly"?>>
                                           &nbsp;&nbsp;
                                           <input type="reset" name="btn_startdate2" class="button" onClick="return showCalendar('search_abs_startdate', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                </td>
                                <td  align="right"><?=$TO_DATE_TITLE;?>
                                    &nbsp;:&nbsp;</td>
                                <td><input type="text" name="search_abs_enddate" id="search_abs_enddate" value="<?=$search_abs_enddate?>"  class="textbox" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_abs_enddate,this.value);" <?=(($SESS_PER_ID!=$PER_ID) && $PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y")?"":"readonly"?>>
                                           &nbsp;&nbsp;
                                           <input type="reset" name="btn_enddate2" class="button" onClick="return showCalendar('search_abs_enddate', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                                </td>
                            </tr>
                            <tr>
                                <td  align="right">ประเภทการลา&nbsp;:&nbsp;</td>
                                <td><input type="text" name="search_ab_name" value="<?=$search_ab_name?>"  style="width:75%" class="textbox" readonly>
                                    <input type="hidden" name="search_ab_code" value="<?=$search_ab_code?>">&nbsp;<input type="button" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกประเภทการลา" onClick="call_search_absenttype('search_ab_code', 'search_ab_name');">&nbsp;<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_ab_code.value=''; form1.search_ab_name.value=''; return false;" align="center" alt="ล้างค่า"> </td><? //เดิมมีการล็อกปุ่มด้วยเงื่อนไข if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?><? //endif; ?>
                            </tr>
                            <tr>
                                <td colspan="6" align="center"><? if ($BUTTON_DISPLAY==1) { ?>
                                    <input name="Submit3" type="submit" class="button" value="<?=$SEARCH_TITLE?>" title="ค้นหาการลา ของ<?=$PER_NAME?>" onClick="form1.current_page.value=0;">
                                    <input name="btn4" type="button" class="button" value="<?=$SHOW_ALL_TITLE?>" title="แสดงการลาทั้งหมด ของ<?=$PER_NAME?>" onClick="show_all_absent();">
                                    <? } else { ?>
                                    <input name="image22" type="image" onClick="form1.current_page.value=0;" src="images/search.png" alt="<?=$SEARCH_TITLE?>">
                                    <input name="image23" type="image" onClick="show_all_absent();" src="images/showall.png" alt="<?=$SHOW_ALL_TITLE?>">
                                    <?}?></td>
                            </tr>

                            <tr>
                                <td height="2"></td>
                            </tr>
                        </table></td>
            </tr>
            <tr><td height="15"></td></tr>
            <tr>
                <td>
                    <table width="100%" border="0" align="center" cellpadding="0" cellspacing="0">
                        <tr><td>
                                <input type="hidden" name="order_by" value="<?=$order_by?>">
                                <input type="hidden" name="order_byOLD" value="<?=$sort_by?>">
                                <input type="hidden" name="sort_by" value="<?=$sort_by;?>">
                                <input type="hidden" name="sort_type" value="<?=$sort_type?>">
                                <?=$SORT_TITLE?>
                                <br>
                                <table border="0">
                                    <tr>
                                        <td>
                                            <input name="AB01" type="textbox" size="1" style="background-color:#FAB569; size:1px;" value="">&nbsp;ลาป่วย
                                        </td>
                                        <!--<td><input name="AB02" type="textbox" size="1" style="background-color:#81C0E2">&nbsp;ลาคลอดบุตร</td>-->
                                        <td>
                                            <input name="AB03" type="textbox" size="1" style="background-color:#F898CD">&nbsp;ลากิจส่วนตัว
                                        </td>
                                        <td>
                                            <input name="AB04" type="textbox" size="1" style="background-color:#81DCB5">&nbsp;ลาพักผ่อน
                                        </td>
                                        <td>
                                            <font color="red">[*]</font> ขอยกเลิกใบลาหลังจากได้รับอนุญาตแล้ว , <font color="red">[**]</font> ขอเปลี่ยนแปลงวันลาหลังจากได้รับอนุญาตแล้ว
                                        </td>
                                        <td>
                                            &nbsp;<img src="images/note_P0601.png" width="20" height="20" border="0" >ให้ความเห็น
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                    </table>
                    <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
                        <tr height="22">
                            <? if ($count_data) { ?>
                            <td width="15%"><!---< if($PAGE_AUTH["print"]=="Y" && $PER_ID){ >--->
                                <!---
                                <? if ($BUTTON_DISPLAY==1) { ?>
                            <input name="btn_report" type="button" class="button" value="<?=$PDF_TITLE?>" onClick="call_pdf_report();">
                            <?  } else { ?>
                            <img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE?>" onClick="call_pdf_report();">
                            <? } ?>--->      <!---< }else{ echo "&nbsp;"; } >---></td> 
                            <td align="center">พบ<?=$MENU_TITLE_LV2?>ทั้งสิ้น <?=($count_data + 0)?> รายการ</td>
                            <td width="15%" align="right"><!---< if($PAGE_AUTH["print"]=="Y" && $PER_ID){ >--->
                                <? if ($BUTTON_DISPLAY==1) { ?>
                                <input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
                                <?  } else { ?>
                                <img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
                                <? } ?>      <!---< }else{ echo "&nbsp;"; } >---></td> 
                            <? } ?>			  
                        </tr>
                    </table></td>
            </tr>
        </table>
        <?
        if($current_page > 1){
        if($DPISDB=="odbc"){
        $limit_data = " and ABS_ID not in (select top $start_record ABS_ID from PER_ABSENT where PER_ID=$PER_ID order by ABS_STARTDATE desc) ";
        }elseif($DPISDB=="mysql"){
        $limit_data = " limit " . (($current_page - 1) * $data_per_page) . ", " . $data_per_page;
        }
        } // end if 

        if($DPISDB=="odbc"){	
        $cmd = "	select			top $data_per_page 
        ABS_ID, b.PER_TYPE, a.PER_ID, a.AB_CODE, AB_NAME, ABS_STARTDATE, ABS_ENDDATE, ABS_DAY, ABS_LETTER,
        a.APPROVE_FLAG, a.APPROVE_PER_ID,a.AUDIT_FLAG, a.AUDIT_PER_ID, a.CANCEL_FLAG,
        a.REVIEW1_FLAG, a.REVIEW1_PER_ID,a.REVIEW2_FLAG, a.REVIEW2_PER_ID, a.CREATE_DATE, b.PER_CARDNO
        from 			PER_ABSENT a, PER_PERSONAL b, PER_ABSENTTYPE c 
        where 		a.AB_CODE=c.AB_CODE
        and a.PER_ID=b.PER_ID 
        $search_condition 
        $limit_data
        group by ABS_ID, b.PER_TYPE,b.PER_NAME,b.PER_SURNAME, a.PER_ID, a.AB_CODE, AB_NAME, ABS_STARTDATE, ABS_ENDDATE, ABS_DAY, ABS_LETTER,
        a.APPROVE_FLAG, a.APPROVE_PER_ID,a.AUDIT_FLAG, a.AUDIT_PER_ID, a.CANCEL_FLAG,
        a.REVIEW1_FLAG, a.REVIEW1_PER_ID,a.REVIEW2_FLAG, a.REVIEW2_PER_ID, a.CREATE_DATE, b.PER_CARDNO
        $having_str
        order by $order_str ";
        }elseif($DPISDB=="oci8"){			//????????	 
            //$per_id_join = " and (a.PER_ID = b.PER_ID or a.REVIEW1_PER_ID=b.PER_ID or a.REVIEW2_PER_ID=b.PER_ID or a.AUDIT_PER_ID=b.PER_ID or a.APPROVE_PER_ID=b.PER_ID)";
            $rec_start = (($current_page-1) * $data_per_page) + 1;
            $rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
            $cmd = "select * from (
                select rownum rnum, q1.* from (
                    select ABS_ID, b.PER_TYPE, a.PER_ID, a.AB_CODE, AB_NAME, ABS_STARTDATE, ABS_ENDDATE, ABS_DAY, ABS_LETTER,
                        a.APPROVE_FLAG, a.APPROVE_PER_ID,a.AUDIT_FLAG, a.AUDIT_PER_ID, a.CANCEL_FLAG,
                        a.REVIEW1_FLAG, a.REVIEW1_PER_ID,a.REVIEW2_FLAG, a.REVIEW2_PER_ID, a.CREATE_DATE, b.PER_CARDNO,a.ABS_STARTPERIOD,
                        CASE WHEN (to_char(sysdate,'yyyy-mm-dd') BETWEEN trim(ABS_STARTDATE) AND trim(ABS_ENDDATE) 
                        OR to_char(sysdate,'yyyy-mm-dd') < trim(ABS_STARTDATE) )
                        AND a.approve_flag=1 and a.CANCEL_FLAG=0 AND a.ABS_STARTPERIOD = 3
                        THEN 1 ELSE 0 END CHKCHANGE,ap.per_name  AS APPROVENAME,a.UPDATE_USER,a.OAPPROVE_PER_ID,
                        a.OABS_STARTDATE,a.OABS_STARTPERIOD,a.OABS_ENDDATE,a.OABS_ENDPERIOD,a.ABS_ENDPERIOD ,
                        a.ORI_ABS_STARTDATE,a.ORI_ABS_STARTPERIOD,a.ORI_ABS_ENDDATE,a.ORI_ABS_ENDPERIOD,
                        b.ORG_ID,a.ORI_ABS_DAY,a.OABS_DAY, a.REVIEW1_NOTE,a.REVIEW2_NOTE,a.APPROVE_NOTE,a.AUDIT_NOTE
                    from PER_ABSENT a, PER_PERSONAL b, PER_ABSENTTYPE c, PER_POSITION d, PER_POS_EMP e, PER_POS_EMPSER f, PER_POS_TEMP g ,
                        PER_PERSONAL ap
                    where a.AB_CODE=c.AB_CODE and a.PER_ID=b.PER_ID and b.POS_ID=d.POS_ID(+) and b.POEM_ID=e.POEM_ID(+) and 
                        b.POEMS_ID=f.POEMS_ID(+) and b.POT_ID=g.POT_ID(+) and a.approve_per_id=ap.PER_ID(+) 
                        $search_condition 
                        group by ABS_ID, b.PER_TYPE,b.PER_NAME,b.PER_SURNAME, a.PER_ID, a.AB_CODE, AB_NAME, ABS_STARTDATE, ABS_ENDDATE, ABS_DAY, ABS_LETTER,
                        a.APPROVE_FLAG, a.APPROVE_PER_ID,a.AUDIT_FLAG, a.AUDIT_PER_ID, a.CANCEL_FLAG,
                        a.REVIEW1_FLAG, a.REVIEW1_PER_ID,a.REVIEW2_FLAG, a.REVIEW2_PER_ID, a.CREATE_DATE, b.PER_CARDNO,a.ABS_STARTPERIOD ,ap.per_name,a.UPDATE_USER
                        ,a.OAPPROVE_PER_ID,a.OABS_STARTDATE,a.OABS_STARTPERIOD,a.OABS_ENDDATE,a.OABS_ENDPERIOD,a.ABS_ENDPERIOD,
                        a.ORI_ABS_STARTDATE,a.ORI_ABS_STARTPERIOD,a.ORI_ABS_ENDDATE,a.ORI_ABS_ENDPERIOD,
                        b.ORG_ID,a.ORI_ABS_DAY,a.OABS_DAY, a.REVIEW1_NOTE,a.REVIEW2_NOTE,a.APPROVE_NOTE,a.AUDIT_NOTE
                    $having_str
                    order by $order_str 	
                )  q1
            ) where rnum between $rec_start and $rec_end  ";
        }elseif($DPISDB=="mysql"){
            $cmd = "	select			ABS_ID, b.PER_TYPE, a.PER_ID, a.AB_CODE, AB_NAME, ABS_STARTDATE, ABS_ENDDATE, ABS_DAY, ABS_LETTER,
            a.APPROVE_FLAG, a.APPROVE_PER_ID,a.AUDIT_FLAG, a.AUDIT_PER_ID, a.CANCEL_FLAG,
            a.REVIEW1_FLAG, a.REVIEW1_PER_ID,a.REVIEW2_FLAG, a.REVIEW2_PER_ID, a.CREATE_DATE, b.PER_CARDNO
            from 			PER_ABSENT a, PER_PERSONAL b, PER_ABSENTTYPE c 
            where 		a.AB_CODE=c.AB_CODE
            and a.PER_ID=b.PER_ID 
            $search_condition 
            group by ABS_ID, b.PER_TYPE,b.PER_NAME,b.PER_SURNAME, a.PER_ID, a.AB_CODE, AB_NAME, ABS_STARTDATE, ABS_ENDDATE, ABS_DAY, ABS_LETTER,
            a.APPROVE_FLAG, a.APPROVE_PER_ID,a.AUDIT_FLAG, a.AUDIT_PER_ID, a.CANCEL_FLAG,
            a.REVIEW1_FLAG, a.REVIEW1_PER_ID,a.REVIEW2_FLAG, a.REVIEW2_PER_ID, a.CREATE_DATE, b.PER_CARDNO
            $having_str
            order by $order_str 	
            $limit_data ";	
        } // end if

        $count_page_data = $db_dpis->send_cmd($cmd);
       //echo "<font color=red> กำลังทดสอบ นะจ๊ะ...<pre>>>> ".$cmd."<hr></font>";
        if ($count_page_data) {
        ?>
        <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
            <tr align="center" class="table_head">
                <td width="3%" height="21"><span class="style1"><?=$SEQ_NO_TITLE;?></span></td>
                <td onClick="call_sort(8,'<?php echo $SortType[$order_by];?>');"><span class="style1">
                        <? if($order_by==8&&$sort_by==8){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
                        ประเภทบุคลากร</span></td>
                <td height="25" onClick="call_sort(1,'<?php echo $SortType[$order_by];?>');"><span class="style1">
                        <? if($order_by==1&&$sort_by==1){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
                        <?=$FULLNAME_TITLE;?>
                    </span></td>
                <td height="15" onClick="call_sort(2,'<?php echo $SortType[$order_by];?>');"><span class="style1">
                        <? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
                        ประเภทการลา</span></td>
                <td width="4%" onClick="call_sort(9,'<?php echo $SortType[$order_by];?>');">
                    <span class="style2"><? if($order_by==9&&$sort_by==9){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>วันที่ส่งใบลา</span></td>
                <td width="8%" onClick="call_sort(3,'<?php echo $SortType[$order_by];?>');"><span class="style1">
                        <? if($order_by==3&&$sort_by==3){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
                        <?=$FROM_DATE_TITLE;?>
                    </span></td>
                <td width="8%" onClick="call_sort(4,'<?php echo $SortType[$order_by];?>');"><span class="style1">
                        <? if($order_by==4&&$sort_by==4){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
                        <?=$TO_DATE_TITLE;?>
                    </span></td>
                <td width="6%" onClick="call_sort(5,'<?php echo $SortType[$order_by];?>');"><span class="style2"><strong>
                            <? if($order_by==5&&$sort_by==5){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
                        </strong>จำนวนวัน</span></td>
                <!--<td width="8%" onClick="call_sort(6);"><span class="style2"><strong>
                  <? if($order_by==6&&$sort_by==6){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
                </strong>การส่งใบลา</span></td> -->
                <td width="4%" ><span class="style2">ตรวจสอบ</span></td> 
                <td width="7%"><span class="style2">ความเห็น<br>
                        (ชั้นต้น)</span></td>
                <td width="7%"><span class="style2">ความเห็น<br>
                        (เหนือขึ้นไป)</span></td>
                <td width="4%" onClick="call_sort(7,'<?php echo $SortType[$order_by];?>');"><span class="style2"><strong><? if($order_by==7&&$sort_by==7){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>อนุญาต</strong></span></td>
                <td width="4%">ชื่อผู้อนุญาต</td>	
                <td width="4%"><span class="style2">ยกเลิก</span></td>
                <? if($SESS_USERGROUP!=1 || $NAME_GROUP_HRD!="HRD" || $SESS_PER_AUDIT_FLAG != 1){ ?><td width="4%"><span class="style2">ยกเลิก/เปลี่ยนแปลงวันลา</span></td><? } ?>
                <!--ยังไม่ถึงวันลาจริง-->
                <td width="4%"><span class="style2">
                        <?=$INQ_TITLE;?>
                    </span></td>
                <?if($PAGE_AUTH["edit"]=="Y"){?>
                <td width="4%"><span class="style2">
                        <?=$EDIT_TITLE;?>
                    </span></td>
                <?}?>
                <?if($PAGE_AUTH["del"]=="Y"){?>
                <td width="4%"><span class="style2">
                        <?=$DEL_TITLE;?>
                    </span></td>
                <?}?>
                <?if($PAGE_AUTH["print"]=="Y"){?>
                <td width="4%"><span class="style2"><?=$PRINT_TITLE?></span></td>
                <?}?>
                <td width="4%">จำนวนไฟล์</td>
                <? if($PAGE_AUTH["attach"]=="Y"){?>
                <td width="4%"><span class="style2"><?=$LOAD_TITLE?> </span></td>
                <?}?>
            </tr>
            <?
            $current_list = "";
            $SEARCH_REVIEW1_NOTE ="";
            $SEARCH_REVIEW2_NOTE ="";
            $SEARCH_APPROVE_NOTE ="";
            $SEARCH_AUDIT_NOTE ="";
            $data_count = 0;
            $data_num = $data_per_page * ($current_page - 1);
            while ($data = $db_dpis->get_array()) {
            $data_count++;
            $data_num++;
            if($data_count > $data_per_page) break;
            $TMP_ABS_ID = $data[ABS_ID];
            $current_list .= ((trim($current_list))?",":"") . $TMP_ABS_ID;

            $dbORG_ID = $data[ORG_ID];
            $TMP_PER_TYPE = $data[PER_TYPE];
            $TMP_APPROVENAME = $data[APPROVENAME];
            
            $TMP_UPDATE_USER = $data[UPDATE_USER];
            
            

            $TMP_PER_ID = $data[PER_ID];
            $TMP_PER_CARDNO = $data[PER_CARDNO];
            $TMP_ABS_STARTPERIOD = $data[ABS_STARTPERIOD];
            $STR_ABS_STARTPERIOD ="";
            if($TMP_ABS_STARTPERIOD=="1"){
            $STR_ABS_STARTPERIOD =" (ครึ่งวันเช้า)";
            }elseif($TMP_ABS_STARTPERIOD=="2"){
            $STR_ABS_STARTPERIOD =" (ครึ่งวันบ่าย)";
            }
            if($data[ABS_DAY]!="0.5"){
            $STR_ABS_STARTPERIOD ="";
            }



            $cmd = " select b.PN_CODE, b.PER_NAME, b.PER_SURNAME from PER_PERSONAL b 
            where  b.PER_ID = $TMP_PER_ID";
            $db_dpis2->send_cmd($cmd);
            $data2 = $db_dpis2->get_array();
            $TMP_PN_CODE = $data2[PN_CODE];
            $TMP_PER_NAME = $data2[PER_NAME];
            $TMP_PER_SURNAME = $data2[PER_SURNAME];

            $cmd = " select PN_NAME from PER_PRENAME where PN_CODE='$TMP_PN_CODE' ";
            $db_dpis2->send_cmd($cmd);
            $data2 = $db_dpis2->get_array();
            $TMP_PN_NAME = $data2[PN_NAME];

            $TMP_PER_NAME = $TMP_PN_NAME.$TMP_PER_NAME." ".$TMP_PER_SURNAME;

            $TMP_CREATE_DATE = $TMP_CREATE_TIME= $TMP_ABS_STARTDATE = $TMP_ABS_ENDDATE ="";
            $temp_date = explode("-", trim($data[ABS_STARTDATE]));
            $TMP_ABS_STARTDATE = substr($temp_date[2],0,2) ."/". $temp_date[1] ."/". ($temp_date[0] + 543);
            $TMP_ABS_STARTDATE_CHECK = ($temp_date[0])."-".$temp_date[1]."-".substr($temp_date[2],0,2);
            
            $temp_date = explode("-", trim($data[ABS_ENDDATE]));
            $TMP_ABS_ENDDATE = substr($temp_date[2],0,2) ."/". $temp_date[1] ."/". ($temp_date[0] + 543);
            $TMP_ABS_ENDDATE_CHECK = ($temp_date[0])."-".$temp_date[1]."-".substr($temp_date[2],0,2);
            
            $ABS_CONF_YEAR = $temp_date[0];
            $ABS_CONF_MONTH = $temp_date[1];
            $TMP_CANCEL_FLAG = $data[CANCEL_FLAG];
            
            
            $OABS_STARTDATE = trim($data[OABS_STARTDATE]);
            $OABS_STARTPERIOD = trim($data[OABS_STARTPERIOD]);
            $OABS_ENDDATE = trim($data[OABS_ENDDATE]);
            $OABS_ENDPERIOD = trim($data[OABS_ENDPERIOD]);
            
            $ORI_ABS_STARTDATE = trim($data[ORI_ABS_STARTDATE]);
            $ORI_ABS_STARTPERIOD = trim($data[ORI_ABS_STARTPERIOD]);
            $ORI_ABS_ENDDATE = trim($data[ORI_ABS_ENDDATE]);
            $ORI_ABS_ENDPERIOD = trim($data[ORI_ABS_ENDPERIOD]);
            
            $NABS_STARTDATE = trim($data[ABS_STARTDATE]);
            $NABS_STARTPERIOD = trim($data[ABS_STARTPERIOD]);
            $NABS_ENDDATE = trim($data[ABS_ENDDATE]);
            $NABS_ENDPERIOD = trim($data[ABS_ENDPERIOD]);

            $SEARCH_REVIEW1_NOTE = trim($data[REVIEW1_NOTE]);//ความเห็นผู้บังคับบัญชาชั้นต้น
            $SEARCH_REVIEW2_NOTE = trim($data[REVIEW2_NOTE]);//ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป
            $SEARCH_APPROVE_NOTE = trim($data[APPROVE_NOTE]);//ความเห็นผู้อนุญาตการลา
            $SEARCH_AUDIT_NOTE = trim($data[AUDIT_NOTE]);//ความเห็นผู้ตรวจสอบการลา

            $chkAround='images/false.gif';
            $chkAroundTitle='';
            $DisableIconCalcel =FALSE;
            /*if( $TMP_CANCEL_FLAG==1 && (($OABS_STARTDATE==$NABS_STARTDATE) && ($OABS_STARTPERIOD==$NABS_STARTPERIOD) 
                && ($OABS_ENDDATE==$NABS_ENDDATE) && ($OABS_ENDPERIOD==$NABS_ENDPERIOD))){
                $chkAround='images/false.gif';
                $chkAroundTitle=' ยกเลิกวันลาทุกวันของรายการนี้';
                $DisableIconCalcel =TRUE;
            }*/
            //echo '>>'.$TMP_CANCEL_FLAG.'<br>';
            /*if( $TMP_CANCEL_FLAG==1 && (($OABS_STARTDATE!=$NABS_STARTDATE) || ($OABS_STARTPERIOD!=$NABS_STARTPERIOD) 
                || ($OABS_ENDDATE!=$NABS_ENDDATE) || ($OABS_ENDPERIOD!=$NABS_ENDPERIOD))){
                $chkAround='images/Some.gif';
                $chkAroundTitle=' ยกเลิกวันลาเฉพาะวันของรายการนี้';
            }*/
            
            
            
            

            if($data[CREATE_DATE]!="" && $data[CREATE_DATE]!="NULL"){	
            $TMP_CREATE_DATE  = substr($data[CREATE_DATE],0,10);
            if($TMP_CREATE_DATE){
            if(substr($data[CREATE_DATE],12,strlen($data[CREATE_DATE]))){
            $TMP_CREATE_TIME  = substr($data[CREATE_DATE],11,strlen($data[CREATE_DATE]));
            }
            $temp_date = explode("-", trim($TMP_CREATE_DATE));
            $TMP_CREATE_DATE = substr($temp_date[2],0,2) ."/". $temp_date[1] ."/". ($temp_date[0] + 543);
            if($TMP_CREATE_TIME)	$TMP_CREATE_DATE = 	$TMP_CREATE_DATE."<br><center><font size='-1' style='font-style:italic; color: #006600'>(".$TMP_CREATE_TIME.")</font></center>";
            }
            }

            $TMP_ABS_DAY = trim(round($data[ABS_DAY],2)).$STR_ABS_STARTPERIOD;
            $TMP_AB_CODE = trim($data[AB_CODE]);
            $TMP_AB_NAME = trim($data[AB_NAME]);		
            $TMP_ABS_LETTER = trim($data[ABS_LETTER]);
            if ($TMP_ABS_LETTER == 1) 				$ABS_LETTER_STR = "ยังไม่ได้ส่ง";
            elseif ($TMP_ABS_LETTER == 2) 		$ABS_LETTER_STR = "ถูกต้อง";
            elseif ($TMP_ABS_LETTER == 3) 		$ABS_LETTER_STR = "ไม่ถูกต้อง";
            if(trim($TMP_AB_CODE=="10")) $ABS_LETTER_STR = "-";

            $TMP_REVIEW1_FLAG = trim($data[REVIEW1_FLAG]);
            $TMP_REVIEW1_PER_ID = trim($data[REVIEW1_PER_ID]);

            $TMP_REVIEW2_FLAG = trim($data[REVIEW2_FLAG]);
            $TMP_REVIEW2_PER_ID = trim($data[REVIEW2_PER_ID]);

            $TMP_AUDIT_FLAG = trim($data[AUDIT_FLAG]);
            $TMP_AUDIT_PER_ID = trim($data[AUDIT_PER_ID]);

            $TMP_APPROVE_FLAG = trim($data[APPROVE_FLAG]);
            $TMP_APPROVE_PER_ID = trim($data[APPROVE_PER_ID]);
            
            $TMP_OAPPROVE_PER_ID= trim($data[OAPPROVE_PER_ID]);

            $TMP_CHKCHANGE= trim($data[CHKCHANGE]);
            $CHKCHANGE=FALSE;
            if(($TMP_CHKCHANGE==1 && $TMP_APPROVE_FLAG==1 ) && $SESS_PER_ID==$TMP_PER_ID ){
            $CHKCHANGE=TRUE;
            }
            //if()


            
            //Chk Print Out  ($TMP_APPROVE_FLAG=='0' or $TMP_APPROVE_FLAG=='1') and ($TMP_CANCEL_FLAG=='0' or $TMP_CANCEL_FLAG=='1')
            $ChkPrintOut = '';
            
            
            if (!empty($TMP_OAPPROVE_PER_ID) ){ 
                $ChkPrintOut = 'PRINT_CANCEL';
            }
            
            if($TMP_APPROVE_FLAG==2 
                && ($OABS_STARTDATE==$ORI_ABS_STARTDATE && $OABS_STARTPERIOD==$ORI_ABS_STARTPERIOD 
                && $OABS_ENDDATE==$ORI_ABS_ENDDATE && $OABS_ENDPERIOD==$ORI_ABS_ENDPERIOD) ){
                $ChkPrintOut = '';
            }
            
            /*if (!empty($TMP_OAPPROVE_PER_ID) ){ 
                $ChkPrintOut = 'PRINT_CANCEL';
            }*/
            
            

            $TMP_REVIEW1_PER_NAME = "";
            if ($TMP_REVIEW1_PER_ID) {
            $cmd = " select b.PN_NAME, a.PER_NAME, a.PER_SURNAME from PER_PERSONAL a, PER_PRENAME b where a.PER_ID=$TMP_REVIEW1_PER_ID and a.PN_CODE=b.PN_CODE ";
            $db_dpis2->send_cmd($cmd);
            $data2 = $db_dpis2->get_array();
            $TMP_REVIEW1_PER_NAME = $data2[PN_NAME].$data2[PER_NAME]." ".$data2[PER_SURNAME];
            }

            $TMP_REVIEW2_PER_NAME = "";
            if ($TMP_REVIEW2_PER_ID) {
            $cmd = " select b.PN_NAME, a.PER_NAME, a.PER_SURNAME from PER_PERSONAL a, PER_PRENAME b where a.PER_ID=$TMP_REVIEW2_PER_ID and a.PN_CODE=b.PN_CODE ";
            $db_dpis2->send_cmd($cmd);
            $data2 = $db_dpis2->get_array();
            $TMP_REVIEW2_PER_NAME = $data2[PN_NAME].$data2[PER_NAME]." ".$data2[PER_SURNAME];
            }

            $TMP_AUDIT_PER_NAME = "";
            if ($TMP_AUDIT_PER_ID) {
            $cmd = " select b.PN_NAME, a.PER_NAME, a.PER_SURNAME from PER_PERSONAL a, PER_PRENAME b where a.PER_ID=$TMP_AUDIT_PER_ID and a.PN_CODE=b.PN_CODE ";
            $db_dpis2->send_cmd($cmd);
            $data2 = $db_dpis2->get_array();
            $TMP_AUDIT_PER_NAME = $data2[PN_NAME].$data2[PER_NAME]." ".$data2[PER_SURNAME];
            }

            $TMP_APPROVE_PER_NAME = "";
            if ($TMP_APPROVE_PER_ID) {
            $cmd = " select b.PN_NAME, a.PER_NAME, a.PER_SURNAME from PER_PERSONAL a, PER_PRENAME b where a.PER_ID=$TMP_APPROVE_PER_ID and a.PN_CODE=b.PN_CODE ";
            $db_dpis2->send_cmd($cmd);
            $data2 = $db_dpis2->get_array();
            $TMP_APPROVE_PER_NAME = $data2[PN_NAME].$data2[PER_NAME]." ".$data2[PER_SURNAME];
            }

            if($SESS_PER_ID==$TMP_AUDIT_PER_ID)			$count_audit++;
            if($SESS_PER_ID==$TMP_REVIEW1_PER_ID)		$count_review1++;
            if($SESS_PER_ID==$TMP_REVIEW2_PER_ID)		$count_review2++;
            if($SESS_PER_ID==$TMP_APPROVE_PER_ID)		$count_approve++;		

            $class = "table_body";
            $onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
            if($ABS_ID==$TMP_ABS_ID){ 
              $class = "table_body_over";
              $onmouse_event = "";
            } // end if	

            if($TMP_AB_CODE=='01')				$onbgcolor_event="style='background-color:#FAB569'";
            else if($TMP_AB_CODE=='02')		$onbgcolor_event="style='background-color:#81C0E2'";
            else if($TMP_AB_CODE=='03')		$onbgcolor_event="style='background-color:#F898CD'";
            else if($TMP_AB_CODE=='04')		$onbgcolor_event="style='background-color:#81DCB5'";

            if($TODATE>$TMP_ABS_STARTDATE_CHECK){ $class = "table_body_5";	$onmouse_event = " onMouseOver=\"this.className='table_body_5_over';\" onMouseOut=\"this.className='table_body_5';\" ";}

            $setstyle_approve="";
            //if($TMP_APPROVE_FLAG==1 && ($SESS_PER_ID!=$TMP_APPROVE_PER_ID))	$setstyle_approve='bgcolor="#66CC33"';
            //if($TMP_APPROVE_FLAG==2 && ($SESS_PER_ID!=$TMP_APPROVE_PER_ID))	$setstyle_approve='bgcolor="#FF3333"';


            /*Release 5.1.0.7 Begin*/
            $DisableTimeAtt='OPEN';
            if($IS_OPEN_TIMEATT_ES=="OPEN"){
            //หาหน่วยงานตามมอบหมาย...
            $cmdOrgAss = " SELECT ORG.ORG_ID,ORG.ORG_ID_REF FROM PER_PERSONAL PNL
            LEFT JOIN PER_ORG_ASS ORG ON(ORG.ORG_ID=PNL.ORG_ID)
            WHERE PNL.PER_ID=$TMP_PER_ID";
            $db_dpis2->send_cmd($cmdOrgAss);
            $dataOrgAss = $db_dpis2->get_array();   
            $ORG_ID_ASS = $dataOrgAss[ORG_ID];

            $ArrSTARTDATE = explode("/", trim($TMP_ABS_STARTDATE));
            $ArrENDDATE = explode("/", trim($TMP_ABS_ENDDATE));

            $ValSTARTDATE = $ArrSTARTDATE[2].$ArrSTARTDATE[1];
            $ValENDDATE = $ArrENDDATE[2].$ArrENDDATE[1];
            $cmdClose = " SELECT CLOSE_YEAR,CLOSE_MONTH 
            FROM PER_WORK_TIME_CONTROL 
            WHERE CLOSE_DATE IS NOT NULL AND DEPARTMENT_ID = ".$ORG_ID_ASS."
            AND (CLOSE_YEAR||CASE WHEN length(CLOSE_MONTH)=1 THEN '0'||CLOSE_MONTH ELSE ''||CLOSE_MONTH END)
            BETWEEN $ValSTARTDATE AND $ValENDDATE ";
            $db_dpis2->send_cmd($cmdClose);
            $dataATT = $db_dpis2->get_array();
            if($dataATT){
            $DisableTimeAtt='CLOSE';
            }
            }
            /*Release 5.1.0.7 End*/ 
            $Star ='';
            $FontWeight ='';
            $isProcess_cancel_flag = true;
            
            // by kittiphat  12/02/2561
            // ถ้า OAPPROVE_PER_ID ไม่ว่าง แสดงว่า มีการขอยกเลิกหรือขอเปลี่ยนแปลงวันลา
            if(!empty($TMP_OAPPROVE_PER_ID)){
                if(($TMP_APPROVE_FLAG=='' && $TMP_CANCEL_FLAG=='9') || ($TMP_APPROVE_FLAG=='1' && $TMP_CANCEL_FLAG=='1') || ($TMP_APPROVE_FLAG=='2' && $TMP_CANCEL_FLAG=='0' && trim($data[ORI_ABS_DAY])==trim($data[OABS_DAY]) && trim($data[ORI_ABS_DAY])==trim($data[ABS_DAY])) ){
                   $Star =' <font color="red">[*]</font>';
                }else{
                   $Star =' <font color="red">[**]</font>';
                }
            
            }
            
            // ของเดิม
            /*if($TMP_CANCEL_FLAG=='8' || $TMP_CANCEL_FLAG=='9' || !empty($TMP_OAPPROVE_PER_ID)){
                $isProcess_cancel_flag = false;
                $Star =' <font color="red">[*]</font>';
                $FontWeight =' style="font-weight:bold" ';
            }*/
            
            
            /*เชคสิทธิ์ผู้ตรวจสอบการลา ให้เห็นข้อมูลภายในหน่วยงานที่ได้รับมอบ และแก้ไขได้เฉพาะรายการตัวเองสร้าง*/
            //echo $SESS_PER_AUDIT_FLAG.'<br>';
            
            $hidden= '';
            
            if($SESS_PER_AUDIT_FLAG==1 ){
                if($TMP_UPDATE_USER!=$SESS_PER_ID){
                    $hidden= 'hidden=""';
                }
            }

            /**/
            ?>
            <tr <?php echo $FontWeight;?> class="<?=$class?>" <?=$onmouse_event?> <?=($SESS_PER_ID==$TMP_PER_ID)?"style='font-weight:200;color:#0000FF;'":"";?>>
                <td height="25" align="center"><?=$data_num?></td>
                <td nowrap="nowrap">&nbsp;<? if($TMP_PER_TYPE ==1) echo "ข้าราชการ";
                    else  if($TMP_PER_TYPE ==2) echo "ลูกจ้างประจำ";
                    else  if($TMP_PER_TYPE ==3) echo "พนักงานราชการ";
                    else  if($TMP_PER_TYPE ==4) echo "ลูกจ้างชั่วคราว"; ?></td>
                <td nowrap="nowrap">&nbsp;<?php echo $TMP_PER_NAME.$Star;?></td>
                <td nowrap="nowrap" <?=$onbgcolor_event; ?>>&nbsp;<?=$TMP_AB_NAME?></td>  
                <td>&nbsp;<?=$TMP_CREATE_DATE?></td>
                <td align="center"><?=$TMP_ABS_STARTDATE?></td>
                <td align="center">
                    <?=((trim($TMP_AB_CODE) != "10")?$TMP_ABS_ENDDATE:"-")?>
                    <?php 
                    //echo ">".$CHKCHANGE.'||'.$TMP_ABS_STARTPERIOD;
                   // if($CHKCHANGE==TRUE  ){ /*$IS_OPEN_TIMEATT_ES=="OPEN"*/
                    //    echo '<br><input type="button" name="btnChange" id="btnChange" value="ลดวันลา" onclick="BtnChangeDate('.$TMP_ABS_ID.','.$data[ABS_DAY].');"> ';
                  //  }
                    ?>
                </td>
                <td align="center"><?=$TMP_ABS_DAY?></td>
                <!--<td>&nbsp;<?=$ABS_LETTER_STR?></td>-->
                <td align="center" <?=(($SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 && $SESS_PER_ID==$TMP_AUDIT_PER_ID)?"bgcolor='#FFCC33'":"")?>>
                    <input type="hidden" name="list_audit_allabs[<?=$TMP_ABS_ID; ?>]" value="<?=$TMP_AUDIT_FLAG; ?>">
                    <? 
                    
                    if($SESS_PER_ID==$TMP_AUDIT_PER_ID){  ?><?	if($TMP_AUDIT_FLAG==1){ ?>
                    <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้ตรวจสอบ : <?=$TMP_AUDIT_PER_NAME;?> (ตรวจสอบ)">
                    <? if($SEARCH_AUDIT_NOTE){?>
                           <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้ตรวจสอบ : <?=$TMP_AUDIT_PER_NAME;?> (ให้ความเห็น)">
                    <?}?>
                    <? }else if($TMP_AUDIT_FLAG==2){  ?>
                    <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้ตรวจสอบ : <?=$TMP_AUDIT_PER_NAME;?> (ไม่ตรวจสอบ)">
                    <? if($SEARCH_AUDIT_NOTE){?>
                           <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้ตรวจสอบ : <?=$TMP_AUDIT_PER_NAME;?> (ให้ความเห็น)">
                    <?}?>
                    <? }else{ 
                           
                    if ($DisableTimeAtt=='OPEN' || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){

                    ?>
                    	<? if($TMP_AUDIT_PER_ID){ ?>
                                <? if($DisableTimeAtt=='OPEN'){ ?>
                                        <input type="checkbox"  id="list_audit_id<?=$data_num; ?>" name="list_audit_id[]" 
                                       onClick="set_uncheck_all(this.checked,form1.list_audit_all,this.id)"  
                                       value="<?=$TMP_ABS_ID; ?>" 
                                       title="ผู้ตรวจสอบ : <?=$TMP_AUDIT_PER_NAME; echo' ('; if($TMP_AUDIT_FLAG!=1 && $TMP_AUDIT_FLAG!=2){ echo 'รอตรวจสอบ/ไม่ตรวจสอบ'; }else if($TMP_AUDIT_FLAG==1){ echo 'ตรวจสอบ'; }else if($TMP_AUDIT_FLAG==2){ echo 'ไม่ตรวจสอบ'; } echo')'; ?>" <?=(($TMP_AUDIT_FLAG==1)?"checked":"")?>>
                                       
                                <? }else{ ?>
                                        <span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                                <? } ?>
                            
                            <? }else{ ?>
                            		<? if($DisableTimeAtt=='OPEN'){ ?>
                                   				<? echo "-";?>
                                     <? }else{ ?>
                                        <span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                                	<? } ?>
                    		<? } ?>
                    		
                           <? 
                           }else{echo"-";}
                           }
                           }else{  // login เจ้าตัว
                        if($TMP_AUDIT_FLAG==1){ ?>
                           <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้ตรวจสอบ : <?=$TMP_AUDIT_PER_NAME?> (ตรวจสอบ)"><!--ตรวจสอบแล้ว-->
                           <? if($SEARCH_AUDIT_NOTE){?>
                           <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้ตรวจสอบ (ให้ความเห็น)">
                           <?}?>
                         <? }elseif($TMP_AUDIT_FLAG==2){ ?>
                    <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้ตรวจสอบ : <?=$TMP_AUDIT_PER_NAME?> (ไม่ตรวจสอบ)"><!--ไม่ตรวจสอบ-->
                        <? if($SEARCH_AUDIT_NOTE){?>
                            <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้ตรวจสอบ (ให้ความเห็น)">
                        <?}?>
                    <? }else{ echo "&nbsp;"; } ?>
                    <? } ?>
                </td>	    
                <td align="center" <?=(($SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 && $SESS_PER_ID==$TMP_REVIEW1_PER_ID)?"bgcolor='#FFCC33'":"")?>>
                    <input type="hidden" name="list_review1_allabs[<?=$TMP_ABS_ID; ?>]" value="<?=$TMP_REVIEW1_FLAG; ?>">
                    <? if($SESS_PER_ID==$TMP_REVIEW1_PER_ID){ ?>
                    <? 
                    if ($DisableTimeAtt=='OPEN' || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){
                    if($TMP_REVIEW1_FLAG==1){ 
                    ?>
                    <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้น : <?=$TMP_REVIEW1_PER_NAME;?> (เห็นควร)">
                    <? if($SEARCH_REVIEW1_NOTE){?>
                            <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้น  (ให้ความเห็น)">
                    <?}?>
                    <? }else if($TMP_REVIEW1_FLAG==2){ ?>
                    <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้น : <?=$TMP_REVIEW1_PER_NAME;?> (ไม่เห็นควร)">
                    <? if($SEARCH_REVIEW1_NOTE){?>
                            <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้น  (ให้ความเห็น)">
                    <?}?>
                    <? }else{?>
                    		<? if($TMP_REVIEW1_PER_ID){ ?>
                                <? if($DisableTimeAtt=='OPEN'){ ?>
                                       <input type="checkbox"  id="list_review1_id<?=$data_num; ?>" 
                                       name="list_review1_id[]" onClick="set_uncheck_all(this.checked,form1.list_review1_all,this.id)"  
                                       value="<?=$TMP_ABS_ID; ?>" title="ผู้บังคับบัญชาชั้นต้น : <?=$TMP_REVIEW1_PER_NAME; echo' ('; if($TMP_REVIEW1_FLAG!=1 && $TMP_REVIEW1_FLAG!=2){ echo 'รอเห็นควร/ไม่เห็นควร'; }else if($TMP_REVIEW1_FLAG==1){ echo 'เห็นควร'; }else if($TMP_REVIEW1_FLAG==2){ echo 'ไม่เห็นควร'; } echo')'; ?>" <?=(($TMP_REVIEW1_FLAG==1)?"checked":"")?>>
                                <? }else{ ?>
                                        <span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                                <? } ?>
                            <? }else{ ?>
                            		<? if($DisableTimeAtt=='OPEN'){ ?>
                                   				<? echo "-";?>
                                     <? }else{ ?>
                                        <span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                                	<? } ?>
                    		<? } ?>
                    		
                     <? }
                           }else{echo "-";}
                           }else{  // login เจ้าตัว
                           if($TMP_REVIEW1_FLAG==1){ ?>
                           <img src="images/true.gif" width="16" height="16" border="0" 
                           accesskey=""alt="ผู้บังคับบัญชาชั้นต้น : <?=$TMP_REVIEW1_PER_NAME;?> (เห็นควร)"><!--ผู้บังคับบัญชาชั้นต้นเห็นควร-->
                           <? if($SEARCH_REVIEW1_NOTE){?>
                            <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้น (ให้ความเห็น)">
                         <?}?>
                    <? }elseif($TMP_REVIEW1_FLAG==2){ ?>
                    <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้น : <?=$TMP_REVIEW1_PER_NAME;?> (ไม่เห็นควร)"><!--ผู้บังคับบัญชาชั้นต้นไม่เห็นควร-->
                    <? if($SEARCH_REVIEW1_NOTE){?>
                            <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้น (ให้ความเห็น)">
                    <?}?>
                    <? }else{ echo "&nbsp;"; } ?>
                    <? } ?></td>   

                <td align="center" <?=(($SESS_USERGROUP!=1 && $NAME_GROUP_HRD!="HRD" && $SESS_PER_AUDIT_FLAG != 1 && $SESS_PER_ID==$TMP_REVIEW2_PER_ID)?"bgcolor='#FFCC33'":"")?>>
                    <input type="hidden" name="list_review2_allabs[<?=$TMP_ABS_ID; ?>]" value="<?=$TMP_REVIEW2_FLAG; ?>">
                    <? if($SESS_PER_ID==$TMP_REVIEW2_PER_ID){ ?>
                    <? if($TMP_REVIEW2_FLAG==1){ ?>
                    <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป : <?=$TMP_REVIEW2_PER_NAME;?> (เห็นควร)">
                    <? if($SEARCH_REVIEW2_NOTE){?>
                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป (ให้ความเห็น)">
                    <?}?>
                    <? }else if($TMP_REVIEW2_FLAG==2){ ?>
                    <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป : <?=$TMP_REVIEW2_PER_NAME;?> (ไม่เห็นควร)">
                    <? if($SEARCH_REVIEW2_NOTE){?>
                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป (ให้ความเห็น)">
                    <?}?>
                    <? }else{
                    	if ($DisableTimeAtt=='OPEN' || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){
   
                    ?>
                    	<? if($TMP_REVIEW2_PER_ID){ ?>
                                <? if($DisableTimeAtt=='OPEN'){ ?>
                                       <input type="checkbox"  id="list_review2_id<?=$data_num; ?>" name="list_review2_id[]" 
                                        onClick="set_uncheck_all(this.checked,form1.list_review2_all,this.id)"  
                                        value="<?=$TMP_ABS_ID; ?>" title="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป : <?=$TMP_REVIEW2_PER_NAME; echo' ('; if($TMP_REVIEW2_FLAG!=1 && $TMP_REVIEW2_FLAG!=2){ echo 'รอเห็นควร/ไม่เห็นควร'; }else if($TMP_REVIEW2_FLAG==1){ echo 'เห็นควร'; }else if($TMP_REVIEW2_FLAG==2){ echo 'ไม่เห็นควร'; } echo')'; ?>" <?=(($TMP_REVIEW2_FLAG==1)?"checked":"")?>>
                                        
                                <? }else{ ?>
                                        <span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                                <? } ?>
                         <? }else{ ?>
                            		<? if($DisableTimeAtt=='OPEN'){ ?>
                                   				<? echo "-";?>
                                     <? }else{ ?>
                                        <span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                                	<? } ?>
                    		<? } ?>

                           <? 
                           }else{echo "-";}
                           }
                           }else{  // login เจ้าตัว
                           if($TMP_REVIEW2_FLAG==1){ ?>
                           <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป : <?=$TMP_REVIEW2_PER_NAME;?> (เห็นควร)"><!--ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไปเห็นควร-->
                           <? if($SEARCH_REVIEW2_NOTE){?>
                            <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป (ให้ความเห็น)">
                            <?}?>
                    <? }elseif($TMP_REVIEW2_FLAG==2){ ?>
                    <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป : <?=$TMP_REVIEW2_PER_NAME;?> (ไม่เห็นควร)"><!--ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไปไม่เห็นควร-->
                    <? if($SEARCH_REVIEW2_NOTE){?>
                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป (ให้ความเห็น)">
                    <?}?>
                    <? }else{ echo "&nbsp;"; } ?>
                    <? } ?>		</td>
                <td align="center" <?=$setstyle_approve?>>
                    <input type="hidden" name="list_approve_allabs[<?=$TMP_ABS_ID; ?>]" value="<?=$TMP_APPROVE_FLAG; ?>">
                    <input type="hidden" name="list_cancel_allabs[<?=$TMP_ABS_ID; ?>]" value="<?=$TMP_CANCEL_FLAG; ?>"><!--ทั้งหมด-->
                    <? if($SESS_PER_ID==$TMP_APPROVE_PER_ID || $SESS_USERGROUP==1){ ?>
                        <? if($TMP_CANCEL_FLAG==1){ ?>
                                <? if($TMP_APPROVE_FLAG==1){ ?>
                                        <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (อนุญาต)">
                                        <? if($SEARCH_APPROVE_NOTE){?>
                                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้อนุญาต (ให้ความเห็น)">
                                        <?}?>
                                <? }else if($TMP_APPROVE_FLAG==2){ ?>
                                        <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (ไม่อนุญาต)">
                                        <? if($SEARCH_APPROVE_NOTE){?>
                                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้อนุญาต (ให้ความเห็น)">
                                        <?}?>
                                <? }else{ ?>
                                        <span title='ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (รออนุญาต/ไม่อนุญาต)'>-</span>
                                <? } 
                           }else{ ?>
                                <? if($TMP_APPROVE_FLAG==1){ ?>
                                        <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (อนุญาต)">
                                        <? if($SEARCH_APPROVE_NOTE){?>
                                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้อนุญาต (ให้ความเห็น)">
                                        <?}?>
                                <? }else if($TMP_APPROVE_FLAG==2){ ?>
                                        <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (ไม่อนุญาต)">
                                        <? if($SEARCH_APPROVE_NOTE){?>
                                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้อนุญาต (ให้ความเห็น)">
                                        <?}?>
                                <? }else{
                                //echo $DisableTimeAtt.','.$SESS_USERGROUP.','.$NAME_GROUP_HRD.','.$SESS_PER_AUDIT_FLAG.','. $SESS_PER_ID.'-'.$TMP_APPROVE_PER_ID ;
                                      if ($DisableTimeAtt=='OPEN' || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1 || ($SESS_PER_ID==$TMP_APPROVE_PER_ID) ){

                                        	 
                                ?>
                                     <? if($DisableTimeAtt=='OPEN'){ ?>
                                            <input type="checkbox"  id="list_approve_id<?=$data_num; ?>" name="list_approve_id[]" onClick="set_uncheck_all(this.checked,form1.list_approve_all,this.id)"  value="<?=$TMP_ABS_ID; ?>" title="ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME; echo' ('; if($TMP_APPROVE_FLAG!=1 && $TMP_APPROVE_FLAG!=2){ echo 'รออนุญาต/ไม่อนุญาต'; }else if($TMP_APPROVE_FLAG==1){ echo 'อนุญาต'; }else if($TMP_APPROVE_FLAG==2){ echo 'ไม่อนุญาต'; } echo')'; ?>" <?=(($TMP_APPROVE_FLAG==1)?"checked":"")?>>
                                
                                	<? }else{ ?>
                                    		<span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                                    <? } ?>
                                    
                                <?      }else{
                                            echo "-";
                                         }
                                   }
                           } 
                           
                        }else{  // login เจ้าตัว
                           if($TMP_APPROVE_FLAG==1){ ?>
                           <img src="images/true.gif" width="16" height="16" border="0" alt="ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (อนุญาต)">
                           <? if($SEARCH_APPROVE_NOTE){?>
                                <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้อนุญาต (ให้ความเห็น)">
                            <?}?>
                    <? }else if($TMP_APPROVE_FLAG==2){ ?>
                    <img src="images/false.gif" width="16" height="16" border="0" alt="ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (ไม่อนุญาต)">
                    <? if($SEARCH_APPROVE_NOTE){?>
                        <img src="images/note_P0601.png" width="16" height="16" border="0" alt="ผู้อนุญาต (ให้ความเห็น)">
                    <?}?>
                    <? }else{ ?>
                    <span title='ผู้อนุญาต : <?=$TMP_APPROVE_PER_NAME;?> (รออนุญาต/ไม่อนุญาต)'>-</span>
                    <? } 
                    } ?>
                </td>
                <td align="left"><?php echo $TMP_APPROVENAME;?></td>
                <td align="center">&nbsp;
                    <?  if($TMP_CANCEL_FLAG==1){ ?>
                    <input type="hidden" name="list_cancel_flag[]" value="<?=$TMP_ABS_ID; ?>">
                    <img src='<?php echo $chkAround;?>' title="ผู้ลา : <?=$TMP_PER_NAME; ?> (ยกเลิกการลา <?php echo $chkAroundTitle;?>)" border='0' alt='ผู้ลา : <?=$TMP_PER_NAME; ?> (ยกเลิกการลา <?php echo $chkAroundTitle;?>)'>
                    <? } ?>
                </td>
                <? if($DisableTimeAtt=='OPEN' || $SESS_USERGROUP!=1 || $NAME_GROUP_HRD!="HRD" || $SESS_PER_AUDIT_FLAG != 1){ ?><!--ยกเว้น ADMIN-->
                <td align="center">
                    <?php
                    $is_show_icon_change = false;
                    if( $IS_OPEN_TIMEATT_ES=='OPEN'){ //สำหรับ กพ. มีระบบลงเวลา
                        if($DisableTimeAtt=='OPEN' && $TMP_CANCEL_FLAG!=1){ // เปิดให้คลิกปุ่มเพื่อทำการยกเลิกได้
                            $is_show_icon_change = true;
                            if($SESS_PER_ID!=$TMP_PER_ID){
                                $is_show_icon_change = false;
                            }
                        }else{ //
                            if($NAME_GROUP_HRD=="HRD" && $SESS_USERGROUP==1){
                                $is_show_icon_change = true;
                            }
                        }
                    }else{
                        //หน่วยงานอื่นๆ ที่ไม่มีระบบลงเวลา /*เปิดให้ทำได้ตลอด จะปิดก็ต่อเมื่อสถานะเป็นยกเลิกใบลาแล้ว*/
                        $is_show_icon_change = true;
                        if($TMP_CANCEL_FLAG==1){
                            $is_show_icon_change = false;
                        }
                        
                        if($SESS_PER_ID!=$TMP_PER_ID){
                            $is_show_icon_change = false;
                        }
                    }
                    
                    if($is_show_icon_change==true){
                        if(($TMP_APPROVE_FLAG=='0' && empty($TMP_OAPPROVE_PER_ID)) || $TMP_APPROVE_FLAG=='2'){
                            /*$onclickFunc ="javascript:if(confirm('คุณต้องการยกเลิกใบลานี้ ใช่หรือไม่')){form1.command.value = 'CANCELALL';form1.ABS_ID.value=$TMP_ABS_ID; form1.submit();}{return false;};return false;";*/
                           /* เดิม $onclickFunc ="clickCanCelAll('".$TMP_ABS_ID."','".$TMP_APPROVE_FLAG."')";*/
                            $onclickFunc ="clickCanCelAllShow('".$TMP_ABS_ID."','".$TMP_APPROVE_FLAG."','".$TMP_REVIEW1_FLAG."','".$TMP_REVIEW2_FLAG."','".$TMP_AUDIT_FLAG."')";
                            
                        }else{
                            $onclickFunc ="BtnCencleAbsent('".$TMP_ABS_ID."','".$data[ABS_DAY]."');";
                        }
                    ?>
                    <a href='#'>
                        <img src='images/cancella-icon.png' border='0' title="ยกเลิก/เปลี่ยนแปลงวันลา" onClick="<?php echo $onclickFunc;?>">
                    </a>
                    <?php    
                    }else{
                        echo "<img src='images/cancella-icon-disable.png' border='0' title=''>";
                    }
                    ?>
                    <?php
                    if(1==0){
                    //if($SESS_PER_ID==$TMP_PER_ID){ /*เดิม*/
                    if($SESS_PER_ID==$TMP_PER_ID && $TMP_APPROVE_FLAG==1){
                    if ($DisableTimeAtt=='OPEN' || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){
                    ?>
                    <?php //echo $TODATE.'>='.$TMP_ABS_STARTDATE_CHECK;?>
                    <input type="checkbox" name="list_cancel_id[]" value="<?=$TMP_ABS_ID; ?>" 
                           title="ยกเลิกการลาได้ครั้งเดียวก่อนวันที่ <?=$TMP_ABS_STARTDATE; ?>" 
                           <?=(($TMP_CANCEL_FLAG==1)?"checked":"")?> 
                           <?=((($TODATE>$TMP_ABS_STARTDATE_CHECK) || ($TMP_CANCEL_FLAG==1))?"disabled":"")?>>
                           <!--<?="$TODATE>=$TMP_ABS_STARTDATE_CHECK"; ?><?=(($SESS_PER_ID==$TMP_PER_ID)?"bgcolor='#FFCC33'":"")?>-->
                           <? }else{ echo "-";}
                           } 
                   }
                    ?>
                </td>
                <? } ?>
                <td align="center">&nbsp;<a href="<?="javascript:form1.action+='?VIEW=1';form1.ABS_ID.value=$TMP_ABS_ID; form1.submit();"?>""><img src="images/icon_eye.gif" alt="ดูข้อมูลการลา" width="16" height="16" border="0"></a></td>
                <td align="center">
                    <!-- ($SESS_PER_ID==$TMP_REVIEW1_PER_ID || $SESS_PER_ID==$TMP_REVIEW2_PER_ID || $SESS_PER_ID==$TMP_AUDIT_PER_ID || $SESS_PER_ID==$TMP_APPROVE_PER_ID)  $TMP_AB_CODE!='01' // ลาป่วย -->
                    <? 
                    /*&& $TMP_UPDATE_USER==$SESS_PER_ID*/
                    $isChkAudit = false;
                       if( $SESS_PER_AUDIT_FLAG == 1 && $TMP_UPDATE_USER==$SESS_PER_ID){
                            $isChkAudit = true;    
                        }
                        /*ผู้ตรวจสอบการลา */
                        if($SESS_PER_ID==$TMP_AUDIT_PER_ID && (empty($TMP_AUDIT_FLAG) || $TMP_AUDIT_FLAG=='0') ){
                            $hidden= '';   
                        }
                        if( $SESS_PER_AUDIT_FLAG == 1 && $TMP_APPROVE_FLAG && $isChkAudit==false){ //เไม่ใช่รายการของผู้ตรวจสอบ และอนุญาติแล้ว
                            $hidden= 'hidden=""';
                        }
                        
                        /*ผู้บังคับบัญชาชั้นต้น*/
                        if($SESS_PER_ID==$TMP_REVIEW1_PER_ID && (empty($TMP_REVIEW1_FLAG) || $TMP_REVIEW1_FLAG=='0') ){
                            $hidden= '';   
                        }
                        /*ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป*/
                        if($SESS_PER_ID==$TMP_REVIEW2_PER_ID && (empty($TMP_REVIEW2_FLAG) || $TMP_REVIEW2_FLAG=='0') ){
                            $hidden= '';   
                        }
                        /*ผู้อนุญาตการลา*/
                        if($SESS_PER_ID==$TMP_APPROVE_PER_ID && (empty($TMP_APPROVE_FLAG) || $TMP_APPROVE_FLAG=='0') ){
                            $hidden= '';   
                        }

                        if( $TMP_CANCEL_FLAG==1 ||$TMP_CANCEL_FLAG==2 ){
                            $hidden= 'hidden=""';
                        }
                         /*admin*/
                        if($SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD" ){
                            $hidden= '';   
                        }
                        /*เจ้าของรายการ*/
                        /*ถ้าบางท่านใน 4 ท่านนั้นยังไม่ได้แสดงความคิดเห็น จะยังแก้ไขได้*/
                        if($SESS_PER_ID==$TMP_PER_ID && (!$TMP_AUDIT_FLAG || !$TMP_REVIEW1_FLAG || !$TMP_REVIEW2_FLAG || !$TMP_APPROVE_FLAG) ){
                            $hidden= ''; 
                        }
                        
                        
                    //echo $TMP_APPROVE_FLAG.':'.$TMP_UPDATE_USER.'='.$SESS_PER_ID;
                    //echo $NAME_GROUP_HRD;
                    if ($DisableTimeAtt=='OPEN' || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){
                        if($TMP_CANCEL_FLAG!=1 || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  ||  
                            ($SESS_PER_ID==$TMP_PER_ID  && $TODATE <= $TMP_ABS_STARTDATE_CHECK) || 
                            ($SESS_PER_ID==$TMP_REVIEW1_PER_ID || $SESS_PER_ID==$TMP_REVIEW2_PER_ID || 
                             $SESS_PER_ID==$TMP_AUDIT_PER_ID || $SESS_PER_ID==$TMP_APPROVE_PER_ID) ||
                            ($SESS_PER_ID==$TMP_PER_ID && (!$TMP_AUDIT_FLAG && !$TMP_REVIEW1_FLAG && !$TMP_REVIEW2_FLAG && !$TMP_APPROVE_FLAG) )
                             && $PAGE_AUTH["edit"]=="Y"  && $isProcess_cancel_flag==true && $isChkAudit==true){
                    ?>
                    
                    	<? if($DisableTimeAtt=='OPEN'){ ?>
                                <a href="<?="javascript:form1.action+='?UPD=1';form1.ABS_ID.value=$TMP_ABS_ID; form1.submit();"?>"">
                                  <img <?php echo $hidden;?>  src="images/b_edit.png" border="0" 
                                     alt="<? if($SESS_PER_ID==$TMP_AUDIT_PER_ID){ echo "ตรวจสอบ/ไม่ตรวจสอบ"; } if($SESS_PER_ID==$TMP_REVIEW1_PER_ID || $SESS_PER_ID==$TMP_REVIEW2_PER_ID){	echo "เห็นควร/ไม่เห็นควร"; } if($SESS_PER_ID==$TMP_APPROVE_PER_ID){	echo "อนุญาต/ไม่อนุญาต"; } if($SESS_PER_ID==$TMP_PER_ID){ echo "แก้ไขข้อมูล"; }?>การ ลา/สาย/ขาด">
                                </a>
                        <? }else{ ?>
                                <span title='มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน'><font color="red">-</font></span>
                        <? } ?>
                    
                    
                    <? } else { ?>
                    <span class='label_alert' title="<? if($TODATE > $TMP_ABS_STARTDATE_CHECK){	echo "ไม่สามารถแก้ไขการลาย้อนหลังได้"; } ?>">-</span>
                    <? } 
                    }else{echo "-";}
                    ?>		
                </td>
                <td align="center">
                    <? 
                    /*เป้นผู้ตรวจสอบการลา และได้รับเลือกให้เป็น ผู้บังคับบัญชาชั้นต้น หรือ ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป หรือ ผู้อนุญาตการลา
                    * จะไม่ให้ทำการลบรายการนั้นๆ
                    */
                    if($SESS_PER_AUDIT_FLAG == 1 && 
                        ($SESS_PER_ID==$TMP_APPROVE_PER_ID || $SESS_PER_ID==$TMP_REVIEW1_PER_ID || 
                         $SESS_PER_ID==$TMP_REVIEW2_PER_ID || $SESS_PER_ID==$TMP_AUDIT_PER_ID) && $isChkAudit==false){
                        $hidden= 'hidden=""'; 
                    }
                    /*----------------------------------------*/
                    if ($DisableTimeAtt=='OPEN' || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){
                    
                        // เดิมผู้ตรวจสอบการลา ลบข้อมูลได้ แม้ ผู้อนุญาต จะอนุมัติแล้ว by kittiphat 12/02/2561
                       /*if( $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1 
                            || ($SESS_PER_ID==$TMP_PER_ID && $TMP_CANCEL_FLAG!=1) 
                            && ($SESS_PER_ID==$TMP_PER_ID && !$TMP_APPROVE_FLAG) 
                            && $PAGE_AUTH["del"]=="Y" && $isProcess_cancel_flag==true   ){*/
                    
                        // ใหม่ ผู้ตรวจสอบการลาไม่สามารถลบได้ ถ้าผู้อนุญาต อนุมัติแล้ว
                        /* if( $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || ($SESS_PER_AUDIT_FLAG == 1 && $TMP_APPROVE_FLAG!=1)
                            || ($SESS_PER_ID==$TMP_PER_ID && $TMP_CANCEL_FLAG!=1  && $TMP_CANCEL_FLAG!=8  && $TMP_CANCEL_FLAG!=9) 
                            && ($SESS_PER_ID==$TMP_PER_ID && !$TMP_APPROVE_FLAG) 
                            && $PAGE_AUTH["del"]=="Y" && $isProcess_cancel_flag==true   ){ */

                                                                    
                        /*http://dpis.ocsc.go.th/Service/node/2095*/
                        //แก้ไขใหม่กว่า เพิ่มเงื่อนไข หาก ผู้บังคับบัญชาชั้นต้น หรือ ผู้บังคับบัญชาชั้นต้นเหนือขึ้นไป หรือ ผู้ตรวจสอบการลา แสดงความคิดเห็นแล้ว จะไม่สามารถลบได้ 
                        /* แก้ไขเงื่อนไข ผู้ตรวจสอบการลา ไม่มีสิทธิ์ลบรายการ *//* โค้ดเดิม || ($SESS_PER_AUDIT_FLAG == 1 && $TMP_APPROVE_FLAG!=1)*/
                        if( $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || ($SESS_PER_ID==$TMP_PER_ID && $TMP_CANCEL_FLAG!=1  && $TMP_CANCEL_FLAG!=8  && $TMP_CANCEL_FLAG!=9) 
                            && ($SESS_PER_ID==$TMP_PER_ID && (!$TMP_AUDIT_FLAG && !$TMP_REVIEW1_FLAG && !$TMP_REVIEW2_FLAG && !$TMP_APPROVE_FLAG)) 
                            && $PAGE_AUTH["del"]=="Y" && $isProcess_cancel_flag==true && ($TMP_ABS_STARTDATE_CHECK > $TODATE && $TMP_ABS_ENDDATE_CHECK > $TODATE)){

                            ?>
                                <a href="<?="javascript:confirm_delete($TMP_ABS_ID,'$TMP_AB_NAME')"?>"><img <?php echo $hidden;?>  src="images/b_drop.png" border="0" alt="ลบข้อมูลการ ลา/สาย/ขาด"></a>

                                    
                        <? } else{ ?>
                        <span class='label_alert' title="<? if($SESS_PER_ID==$TMP_PER_ID && ($TMP_APPROVE_FLAG==1 || $TMP_APPROVE_FLAG==2)){ echo "ไม่สามารถลบการลาที่อนุญาต/ไม่อนุญาตแล้วได้"; }else if($TODATE > $TMP_ABS_STARTDATE_CHECK){	echo "ไม่สามารถลบการลาย้อนหลังได้"; } ?>">-</span>
                        <? } 
                        }else{echo "-";}
                        ?>	  
                </td>
                <?if($PAGE_AUTH["print"]=="Y"){?>
                <td align="center">&nbsp;
                    <?php 
                    //$DisableIconCalcel =TRUE;
                    $func = 'call_export_rtf';
                    if($ChkPrintOut == 'PRINT_CANCEL'){
                        $func = 'call_export_rtf_cancel';
                    }
                    $chkChoicePrint = true;
                    if($TMP_APPROVE_FLAG==2 && $TMP_CANCEL_FLAG==1){
                        $chkChoicePrint = false;
                    }
                    if(($TMP_CANCEL_FLAG>=1 && $DisableIconCalcel==FALSE && $chkChoicePrint) || $OABS_STARTDATE ){
                    ?>
                    <a href="javascript:BtnChoicePrint('<?php echo $TMP_ABS_ID;?>','<?php echo $TMP_AB_CODE;?>','<?php echo $TMP_CANCEL_FLAG;?>','<?php echo $TMP_APPROVE_FLAG?>');">
                       <img src="images/detail.gif" border="0" alt="พิมพ์ใบลา" width="24" height="24">
                    </a>
                    <?php }else{
                    ?>
                    <a href="javascript:<?php echo $func;?>('<?php echo $TMP_ABS_ID;?>', '<?php echo $TMP_AB_CODE;?>');">
                       <img src="images/detail.gif" border="0" alt="พิมพ์ใบลา" width="24" height="24">
                    </a>
                    <?php
                    }?>
                </td>
                <?}?>
                
                <!--เพิ่มเติมนับจำนวน-->
                <? 
                    $parameter1=$parameter2=$parameter3=$parameter4="";

                    if($ATTACH_FILE==1){
                        $parameter1="PER_ATTACHMENT";	
                        $parameter2="66";	
                        $parameter3="การลาออนไลน์";	
                        $parameter4=$TMP_PER_ID;
                    }else{
                        $parameter1="PER_ABSENTS";	
                        $parameter2=$TMP_ABS_ID;	
                        $parameter3="$TMP_AB_NAME : $TMP_ABS_STARTDATE - $TMP_ABS_ENDDATE";	
                        $parameter4=$TMP_PER_ID;
                    }
                 ?>
                <td align="center">&nbsp;<? 
                    $FILE_PATH = '../attachments/'.str_replace("'" ,"",$TMP_PER_CARDNO).'/'.$parameter1.'/'.$parameter2;
                    $numfiles=0;
                    //echo $FILE_PATH.'<br><hr>';
                    if(is_dir($FILE_PATH)){	
                        if ($dh = opendir($FILE_PATH)) {		//นับจำนวนไฟล์ทั้งหมดใน folder
                            while (($file = readdir($dh)) !== false) {	//---อ่านไฟล์ทั้งหมดมาจาก folder ($FILE_PATH) นั้น
                                if ($file != "." && $file != "..") {
                                        $numfiles++;
                                } // end if
                            } // while loop readdir
                            closedir($dh);
                        } // end if
                    ?>		
                    <a href="<?="javascript:call_menu_desc('$parameter1','$parameter2','$parameter3','$parameter4')"?>"><?=$numfiles; ?></a> 
                    <?	 
                    }else{	 echo "-";	} 
                    ?>
                </td>
                <!-- End เพิ่มเติมนับจำนวน-->  
                <? if($PAGE_AUTH["attach"]=="Y"){?>
                    <?if($ATTACH_FILE==1){ $FILE_PATH = ".../attachments/".$TMP_PER_CARDNO."/PER_ATTACHMENT/66"; ?>
                    <td align="center">&nbsp; <a href="<?="javascript:call_menu_desc('PER_ATTACHMENT','66','การลาออนไลน์','$TMP_PER_ID')"?>"><img src="images/file.jpg" border="0" alt="<?=$ALT_LOAD_TITLE?>"></a></td>
                    <?}else{ $FILE_PATH = ".../attachments/".$TMP_PER_CARDNO."/PER_ABSENTS/".$TMP_ABS_ID; ?>
                    <td align="center">&nbsp; <a href="<?="javascript:call_menu_desc('PER_ABSENTS','$TMP_ABS_ID','$TMP_AB_NAME : $TMP_ABS_STARTDATE - $TMP_ABS_ENDDATE','$TMP_PER_ID')"?>"><img src="images/file.jpg" border="0" alt="<?=$ALT_LOAD_TITLE?>"></a></td>
                    <? } ?>
                <? } ?>   
            </tr>
            <? } ?>
            <?if($PAGE_AUTH["edit"]=="Y"){?>
            <tr class="table_footer" height="21">
                <td><span class="style3"></span></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <td align="center"><!---$count_audit; --><? if(($SESS_PER_ID==$TMP_AUDIT_PER_ID || $count_audit) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){ ?><input type="checkbox" name="list_audit_all" value="1" title="ตรวจสอบการลาทั้งหมด"  onClick="set_check_all(this.checked,'list_audit_id',<?=$count_data; ?>);" <?=(($list_audit_all==1)?"checked":"")?> <?=((($SESS_PER_ID==$TMP_AUDIT_PER_ID || $count_audit) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1 )?"":"disabled")?>><br>
                    <? if ($BUTTON_DISPLAY==1) { ?>
                    <input type="submit" name="Submit44" value="<?=$SETFLAG_TITLE?>" onClick="form1.command.value='SETFLAG_AUDIT'" class="button" style="width:98%" title="บันทึกผลการตรวจสอบ">
                    <?  } else { ?>
                    <input name="image34" type="image" onClick="form1.command.value='SETFLAG_AUDIT'" src="images/save.png" alt="<?=$SETFLAG_TITLE?>" border="0"  title="บันทึกผลการตรวจสอบ">
                    <? } ?><? } ?></td>
                <td align="center"><!--$count_review1--><? if(($SESS_PER_ID==$TMP_REVIEW1_PER_ID || $count_review1) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1){ ?><input type="checkbox" name="list_review1_all" value="1" title="เห็นควรอนุญาตการลา(ขั้นต้น)ทั้งหมด"  onClick="set_check_all(this.checked,'list_review1_id',<?=$count_data; ?>);" <?=(($list_review1_all==1)?"checked":"")?> <?=((($SESS_PER_ID==$TMP_REVIEW1_PER_ID || $count_review1) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1)?"":"disabled")?>><br>
                    <? if ($BUTTON_DISPLAY==1) { ?>
                    <input type="submit" name="Submit43" value="<?=$SETFLAG_TITLE?>" onClick="form1.command.value='SETFLAG_REVIEW1'" class="button" style="width:98%" title="บันทึกผลการเห็นควรอนุญาต(ขั้นต้น)">
                    <?  } else { ?>
                    <input name="image33" type="image" onClick="form1.command.value='SETFLAG_REVIEW1'" src="images/save.png" alt="<?=$SETFLAG_TITLE?>" border="0" title="บันทึกผลการเห็นควรอนุญาต(ขั้นต้น)">
                    <? } ?><? } ?></td>
                <td align="center"><!--$count_review2;--><? if(($SESS_PER_ID==$TMP_REVIEW2_PER_ID || $count_review2) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1 ){ ?><input type="checkbox" name="list_review2_all" value="1" title="เห็นควรอนุญาตการลา(เหนือขึ้นไป)ทั้งหมด"  onClick="set_check_all(this.checked,'list_review2_id',<?=$count_data; ?>);" <?=(($list_review2_all==1)?"checked":"")?> <?=((($SESS_PER_ID==$TMP_REVIEW2_PER_ID || $count_review2) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1)?"":"disabled")?>><br>
                    <? if ($BUTTON_DISPLAY==1) { ?>
                    <input type="submit" name="Submit42" value="<?=$SETFLAG_TITLE?>" onClick="form1.command.value='SETFLAG_REVIEW2'" class="button" style="width:98%" title="บันทึกผลการเห็นควรอนุญาต(เหนือขึ้นไป)">
                    <?  } else { ?>
                    <input name="image32" type="image" onClick="form1.command.value='SETFLAG_REVIEW2'" src="images/save.png" alt="<?=$SETFLAG_TITLE?>" border="0" title="บันทึกผลการเห็นควรอนุญาต(เหนือขึ้นไป)">
                    <? } ?><? } ?></td>
                <td align="center"><!--$count_approve;--><? if(($SESS_PER_ID==$TMP_APPROVE_PER_ID || $count_approve) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1 ){ ?><input type="checkbox" name="list_approve_all" value="1" title="อนุญาตการลาทั้งหมด"  onClick="set_check_all(this.checked,'list_approve_id',<?=$count_data; ?>);" <?=(($list_approve_all==1)?"checked":"")?> <?=((($SESS_PER_ID==$TMP_APPROVE_PER_ID || $count_approve) || $SESS_USERGROUP==1 || $NAME_GROUP_HRD=="HRD"  || $SESS_PER_AUDIT_FLAG == 1)?"":"disabled")?>><br>
                    <? if ($BUTTON_DISPLAY==1) { ?>
                    <input type="submit" name="Submit41" value="<?=$SETFLAG_TITLE?>" onClick="form1.command.value='SETFLAG_APPROVE'" class="button" style="width:98%" title="บันทึกผลการอนุญาต">
                    <?  } else { ?>
                    <input name="image31" type="image" onClick="form1.command.value='SETFLAG_APPROVE'" src="images/save.png" alt="<?=$SETFLAG_TITLE?>" border="0" title="บันทึกผลการอนุญาต">
                    <? } ?><? } ?></td>
                <td>&nbsp;</td>
                <td>&nbsp;</td>
                <? if($SESS_USERGROUP!=1 || $NAME_GROUP_HRD!="HRD" || $SESS_PER_AUDIT_FLAG != 1){ ?>
                <td align="center" valign="bottom"><? if ($BUTTON_DISPLAY==1) { ?>
                  <!--  <input type="submit" name="Submit4" value="<?=$SETFLAG_TITLE?>" onClick="form1.command.value='SETFLAG_CANCEL'" class="button" style="width:98%" title="บันทึกยกเลิกการลาของตนเอง"> -->
                    <?  } else { ?>
                    <!--<input name="image3" type="image" onClick="form1.command.value='SETFLAG_CANCEL'" src="images/save.png" alt="<?=$SETFLAG_TITLE?>" border="0" title="บันทึกยกเลิกการลาของตนเอง">-->
                    <? } ?>
                </td>
                <? } ?><!--ผู้ลายกเลิก--->
                
                <?if($PAGE_AUTH["edit"]=="Y"){?><td>&nbsp;</td><?}?>
                <?if($PAGE_AUTH["del"]=="Y"){?><td>&nbsp;</td>
                <td>&nbsp;</td>
                <?}?>
                <?if($PAGE_AUTH["print"]=="Y"){?><td>&nbsp;</td><?}?>
                <td>&nbsp;</td>
                <? if($PAGE_AUTH["attach"]=="Y"){?><td>&nbsp;</td> <? } ?>
            </tr>
            <?}?>
        </table>
        <? if($total_page > 1) : ?>
        <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
            <tr>
                <td align="center"><?=$page_link?></td>
            </tr>
        </table>
        <? endif; ?>&nbsp;
        <? }else{ ?>
        <? } // if  count show ?>
        <input type="hidden" name="current_list" value="<?=$current_list?>">
    </form>		</td>
</tr>
</table>
<?
include("jqModalDialog.html");
?>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<script type="text/javascript">
        <?=$alert_confirm_absent?>
        setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
    <!--<? if($command=="ADD"){ ?>call_export_rtf(<?=$RPT_ABS_ID?>, "<?=$RPT_AB_CODE?>");<? }?>-->
</script>
<!-- Layer for uploading -->
<div style="position:absolute;width:160;height:160; visibility:hidden; display:none;" id="obj_uploading">
  <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="160" height="160">
    <param name="movie" value="images/uploading.swf">
    <param name="quality" value="high">
    <embed src="images/uploading.swf" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="160" height="160"></embed>
  </object>
</div>
<!-- Layer for uploading -->
<?php if(!empty($UPD) || !empty($VIEW)){?>
<script>
    ProcessUploading();
    calcDaysBetweenDateV2();
	
</script>
<?php }?>
</html>
<script>
    function chk_status(){
        var radios = document.getElementsByName('POS_STATUS');
        var db_pos_status = '<?php echo $POS_STATUS;?>';
        for (var i = 0, length = radios.length; i < length; i++) {
			document.getElementById('trstatus0').style.display='none';
            document.getElementById('trstatus1').style.display='none';
            document.getElementById('trstatus2').style.display='none';
            document.getElementById('trstatus3').style.display='none';
            if (radios[i].checked) {
                //alert(radios[i].value);
                if(radios[i].value>=0){
                    //alert(radios[i].value);
                   /* kittiphat 07062561
				   // if(db_pos_status!=radios[i].value){
                       // document.getElementById('POS_APPROVE'+radios[i].value).value='';
                   // }*/
                    document.getElementById('trstatus'+radios[i].value).style.display='';
                    document.getElementById('POS_APPROVE'+radios[i].value).focus();
                }else{
                    document.getElementById('trstatus'+radios[i].value).style.display='none';
                }
                break;
            }
        }
    }
	
	function clear_form() {
		window.location = 'data_absent.html?'+form1.current_url.value.replace("&UPD=1","");    
	}
	
</script>

