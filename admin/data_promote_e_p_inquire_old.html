<? 
	include("../php_scripts/connect_database.php");

	// กรณีที่เป็นการค้นหาข้อมูลที่ส่งมาจาก tab1 หรือ data_promote_e_p_quality (p0309 เดิม)
	if ($firstfrom=="data_promote_e_p_quality" && $POS_POEM_ID && $PRO_DATE && $table_select && $command && $PER_TYPE) {
			echo "<script language='JavaScript'>ProcessUploading();</script>";
	}
    	
	include("php_scripts/data_promote_e_p_inquire.php");

//	echo ">>>POS_POEM_NO=$POS_POEM_NO, POS_POEM_NAME=$POS_POEM_NAME, PRO_DATE=$PRO_DATE, table_select=$table_select, command=$command, PER_TYPE=$PER_TYPE, firstfrom=$firstfrom, DEPARTMENT_ID=$DEPARTMENT_ID<br>";
	// ==================== select จากเงื่อนไขสำหรับผู้ที่มีคุณสมบัติได้เลื่อนระดับ ======================		
	if ($command == "SEARCH") { 
		include("php_scripts/data_promote_e_p_inquire_query_search.php");
	}
	
	// ==================== select จากข้อมูลที่บันทึกไว้ใน PER_PROMOTE..... =====================
	if ($command == "SELECT") {
		include("php_scripts/data_promote_e_p_inquire_query_select.php");
	}
	if(!$PER_TYPE){ $PER_TYPE=1; }		//กำหนด default เป็น ข้าราชการ
//	echo "data_promote_e_p_inquire.html :: command=$command || table=$table || PER_TYPE=$PER_TYPE || UPD=$UPD<br> cmd_save=$cmd_save<br>";	
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
</head>
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">
	function change_current_page( page ){
		form1.current_page.value = page;
		form1.command.value='SEARCH';
		form1.submit();
	}
	
	function changedateformat(name,str) {
		var arr = str.split('/');
		if((str) && (str != arr[0]+'/'+arr[1]+'/'+arr[2])){
			name.value = str.substr(0,2) + "/" + str.substr(2,2) + "/"  + str.substr(4,4) ;
		}
		chk_date(name, "BDH");
	}

	function MM_openBrWindow(theURL,winName,features) { //v2.0
	  window.open(theURL,winName,features);
	}
	
	function call_more_editor (fieldname) {
		var getdate = new Date();
		MM_openBrWindow("maximize_editor.html?fieldname="+fieldname+"&gatedate="+getdate,'moreeditor','toolbar=no,location=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=550,height=590')
	}
	
	function call_search_position () {	
		if(form1.ORG_ID_M2.value.trim()==""){ 
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
		return false;
		}else{
			parameter = "&isLock=1&LOCK_MINISTRY_ID=" + form1.ORG_ID_M1.value + "&LOCK_DEPARTMENT_ID=" + form1.ORG_ID_M2.value;
			if (form1.PER_TYPE.value == 1)
				childReturn = window.showModalDialog("search_position_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");		
			else if (form1.PER_TYPE.value == 2)
				childReturn = window.showModalDialog("search_pos_emp_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");				
			else if (form1.PER_TYPE.value == 3)
				childReturn = window.showModalDialog("search_pos_empser_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");
				else if (form1.PER_TYPE.value == 4)
				childReturn = window.showModalDialog("search_pos_temp_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");				
			if(childReturn){
				arrValue = childReturn.split("<::>");
				form1.POS_POEM_ID.value = arrValue[0];
				form1.POS_POEM_NO.value = arrValue[1];
				form1.POS_POEM_NAME.value = arrValue[2];
				<? if ($POSITION_NO_CHAR=="Y") { ?>
					if (form1.PER_TYPE.value == 1)		form1.POS_POEM_NO_NAME.value = arrValue[6]; 
					if (form1.PER_TYPE.value == 2)		form1.POS_POEM_NO_NAME.value = arrValue[6]; 
					if (form1.PER_TYPE.value == 3)		form1.POS_POEM_NO_NAME.value = arrValue[4]; 
					if (form1.PER_TYPE.value == 4)		form1.POS_POEM_NO_NAME.value = arrValue[5]; 
				<? } ?>
			} // end if	
		} //end else
	}
	
	function call_search_perline_perposname () {	
		if(form1.ORG_ID_M2.value.trim()==""){ 
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
		} // end if
		parameter = "&isLock=1&LOCK_MINISTRY_ID=" + form1.ORG_ID_M1.value + "&LOCK_DEPARTMENT_ID=" + form1.ORG_ID_M2.value;
		if (form1.PER_TYPE[0].selected == true)
			childReturn = window.showModalDialog("search_perline_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");		
		else if (form1.PER_TYPE[1].selected == true)
			childReturn = window.showModalDialog("search_pos_name_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");
		if(childReturn){
			arrValue = childReturn.split("<::>");
			form1.PL_PN_CODE.value = arrValue[0];
			form1.PL_PN_NAME.value = arrValue[1];
		} // end if
	}

	function call_search_education () {	
		parameter = "";
		childReturn = window.showModalDialog("search_education_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");		
		if(childReturn){
			arrValue = childReturn.split("<::>");
			form1.EN_CODE.value = arrValue[0];
			form1.EN_NAME.value = arrValue[1];
		} // end if
	}
	
	function call_search_ministry () {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		parameter = "&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
		childReturn = window.showModalDialog("search_org_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");
		if(childReturn){
			arrValue = childReturn.split("<::>");
			form1.ORG_ID_M1.value = arrValue[0];
			form1.ORG_NAME_M1.value = arrValue[1];
			form1.ORG_ID_M2.value = "";
			form1.ORG_NAME_2.value = "";
			form1.ORG_ID_M3.value = "";
			form1.ORG_NAME_3.value = "";
		} // end if
	}

	function call_search_department () {	
		var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$MINISTRY_ID":"form1.ORG_ID_M1.value")?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(MINISTRY_ID != ""){
			parameter = "&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
			childReturn = window.showModalDialog("search_org_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");
			if(childReturn){
				arrValue = childReturn.split("<::>");
				form1.ORG_ID_M2.value = arrValue[0];
				form1.ORG_NAME_2.value = arrValue[1];
				form1.ORG_ID_M3.value = "";
				form1.ORG_NAME_3.value = "";
			} // end if
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT?>');
			form1.btn_ministry.focus();
			<? } ?>
		} // end if
	}

	function call_search_org () {	
		var DEPARTMENT_ID = <?=(($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4)?"$DEPARTMENT_ID":"form1.ORG_ID_02.value")?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":""?>";
		if(DEPARTMENT_ID != ""){
			parameter = "&OL_CODE=03&ORG_ID_REF=" + DEPARTMENT_ID + "&PV_CODE=" + PROVINCE_CODE;
			childReturn = window.showModalDialog("search_org_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");		
			if(childReturn){
				arrValue = childReturn.split("<::>");
				form1.ORG_ID_M3.value = arrValue[0];
				form1.ORG_NAME_3.value = arrValue[1];
			} // end if
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$DEPARTMENT_ALERT?>ม (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
			<? } ?>
		} // end if
	}

	function call_data_promote_e_p() {	
		if(form1.ORG_ID_M2.value.trim()==""){ 
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
		} // end if
		parameter = "&isLock=1&LOCK_MINISTRY_ID=" + form1.ORG_ID_M1.value + "&LOCK_DEPARTMENT_ID=" + form1.ORG_ID_M2.value;
		childReturn = window.showModalDialog("data_promote_e_p_quality_search_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 600px; dialogWidth: 1100px; status: No; resizable: No; help: No; statusbar: No;");		
		if(childReturn){
			arrValue = childReturn.split("<::>");
			form1.POS_POEM_ID.value = arrValue[0];
			form1.POS_POEM_NO.value = arrValue[1];	
			form1.POS_POEM_NAME.value = arrValue[2];
			form1.PRO_DATE.value = arrValue[3];
			<? if ($POSITION_NO_CHAR=="Y") { ?>form1.POS_POEM_NO_NAME.value = arrValue[6]; <? } ?>
			form1.submit();
		} // end if 
	}	

	function call_search_promote_e_p() {	
		if(form1.ORG_ID_M2.value.trim()==""){ 
			alert('<?=$DEPARTMENT_ALERT?>');
			form1.btn_department.focus();
		} // end if
		parameter = "&isLock=1&LOCK_MINISTRY_ID=" + form1.ORG_ID_M1.value + "&LOCK_DEPARTMENT_ID=" + form1.ORG_ID_M2.value;
		childReturn = window.showModalDialog("data_promote_e_p_inquire_search_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 600px; dialogWidth: 1100px; status: No; resizable: No; help: No; statusbar: No;");		
		if(childReturn){
			arrValue = childReturn.split("<::>");
			form1.POS_POEM_ID.value = arrValue[0];
			form1.POS_POEM_NO.value = arrValue[1];	
			form1.POS_POEM_NAME.value = arrValue[2];
			form1.PRO_DATE.value = arrValue[3];
			form1.table_select.value = arrValue[4];
			<? if ($POSITION_NO_CHAR=="Y") { ?>form1.POS_POEM_NO_NAME.value = arrValue[6]; <? } ?>
			form1.command.value = "SELECT";
			returnValue = "1<::>"+form1.POS_POEM_ID.value+"<::>"+form1.POS_POEM_NO.value+"<::>"+form1.POS_POEM_NAME.value+"<::>"+form1.PRO_DATE.value+"<::>"+form1.ORG_NAME_2.value+"<::>"+form1.table_select.value+"<::>SELECT";
			ProcessUploading();
			form1.submit();
		} // end if 
	}	

	function clear_form () {
		form1.LEVEL_START.value = "";
		form1.LEVEL_END.value = "";
		form1.PL_PN_CODE.value = "";
		form1.PL_PN_NAME.value = "";
		form1.EN_CODE.value = "";
		form1.EN_NAME.value = "";
		<? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
		form1.ORG_ID_M1.value = "";
		form1.ORG_NAME_M1.value = "";
		<? } // end if ?>
		<? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
		form1.ORG_ID_M2.value = "";
		form1.ORG_NAME_2.value = "";
		<? } // end if ?>
		form1.ORG_ID_M3.value = "";
		form1.ORG_NAME_3.value = "";
		form1.YEAR_START.value = "";
		form1.YEAR_END.value = "";
		form1.SAL_START.value = "";
		form1.SAL_END.value = "";
		form1.SELECTED_LIST.value = "";
	}

	function check_save_promote (val1) {	
		parameter = "";
		form1.SELECTED_LIST.value = "";
		if (form1.PRO_DATE.value == "")
			alert ("กรุณาใส่วันที่ประมวลผล");
		else if (form1.POS_POEM_ID.value == "") 
			alert ("กรุณาใส่เลขที่ตำแหน่ง");
		else {
			document.all.PROCESS_IFRAME.src = "find_promote_e_p_inquire.html?PRO_DATE=" + form1.PRO_DATE.value + "&POS_POEM_ID=" + form1.POS_POEM_ID.value + "&DEPARTMENT_ID=" + form1.ORG_ID_M2.value + "&table=" + val1;
//			ProcessUploading();			
//			alert(document.all.PROCESS_IFRAME.src);
//			childReturn = window.showModalDialog("search_promote_e_p_inquire_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 0px; dialogWidth: 0px; status: No; resizable: No; help: No; statusbar: No;");		
		}		// end if
	}			// end if

	function update_list(isChecked, PER_ID){
		var countChecked = 0;
		var SELECTED_LIST = form1.SELECTED_LIST.value;
		
		if(SELECTED_LIST != ""){ 
			var arrTemp = SELECTED_LIST.split(",");
//			alert(arrTemp.length);
			var countChecked = arrTemp.length;
			SELECTED_LIST = "," + SELECTED_LIST + ",";
		} // end if

		if(isChecked){
			if(countChecked < 3){
				if(SELECTED_LIST=="") SELECTED_LIST = "," + PER_ID + ",";
				else SELECTED_LIST += (PER_ID + ",");	
			}else{
				alert("สามารถเลือกจำนวนคนที่ต้องการนำเสนอได้มากที่สุด 3 คนเท่านั้น");
				eval("form1.SELECT_PER_" + PER_ID + ".checked = false;");
			} // end if
		}else{
			SELECTED_LIST = SELECTED_LIST.replace(("," + PER_ID + ","), ",");
			if(SELECTED_LIST==",") SELECTED_LIST = "";
//			if(form1.CHECKALL.checked) form1.CHECKALL.checked = false;
		} // end if
//		alert(SELECTED_LIST);
		form1.SELECTED_LIST.value = SELECTED_LIST.substr(1, (SELECTED_LIST.lastIndexOf(",") - 1));
		
//__	alert(countChecked+' :: '+SELECTED_LIST+' = '+form1.SELECTED_LIST.value);
	}
	
	function del_personal_promote_e_p(per_id, name, per_type) {
		if (confirm("คุณต้องการลบผู้ที่มีคุณสมบัติได้เลื่อนตำแหน่ง [ " + name + " ] หรือไม่ ?")) {
			form1.action += "?DEL_PERSON=1&DEL_PER_ID=" + per_id + "&DEL_PER_TYPE=" + per_type;
			form1.submit();
		}
	}
	
	function call_personal_promote_e_p() {	
		parameter = "";
		childReturn = window.showModalDialog("search_person_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");		
		if(childReturn){
			arrValue = childReturn.split("<::>");
			var per_id = arrValue[0];
			var name = arrValue[1];
			var per_cardno = arrValue[2];
			var per_type = arrValue[5];
			
			if ( arrValue[0] && arrValue[1] ) {
				if (confirm("กรุณายืนยันการเพิ่มผู้ที่มีคุณสมบัติได้เลื่อนตำแหน่ง [ " + name + " ]")) {			
					form1.action += "?ADD_PERSON=1&ADD_PER_ID=" + per_id + "&ADD_PER_TYPE=" + per_type + "&ADD_PER_CARDNO=" + per_cardno;
					form1.submit();
				}
			}

		} // end if
	}	
	
	function call_presentation(){
		if(form1.chksave_promote.value>0 && form1.command.value.trim() != "SELECT"){
			alert("บันทึกผลการค้นหาก่อน");
			return;
		} // end if
		
		if(form1.SELECTED_LIST.value.trim() != "" ){
			//__alert(form1.SELECTED_LIST.value.trim());
			var PRO_DATE = form1.PRO_DATE.value.trim();
			var arrTemp = PRO_DATE.split("/");
			PRO_DATE = (parseInt(arrTemp[2], 10) - 543) + "-" + arrTemp[1] + "-" + arrTemp[0];
			parameter = "&PRO_DATE=" + PRO_DATE + "&POS_POEM_ID=" + form1.POS_POEM_ID.value + "&SELECTED_LIST=" + form1.SELECTED_LIST.value.trim();
			childReturn = window.showModalDialog("data_promote_e_p_presentation_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 800px; dialogWidth: 1200px; status: No; resizable: No; help: No; statusbar: No;");
		}else{
			alert("เลือกบุคคลที่ต้องการนำเสนอ (ไม่เกิน 3 คน)");
		} // end if
	} // end if

	function ProcessUploading() {
	//	alert(document.getElementById("obj_uploading"));
		document.getElementById("obj_uploading").style.display = "block";
		document.getElementById("obj_uploading").style.top = document.body.scrollTop + ((document.body.clientHeight / 2) + 5);
		document.getElementById("obj_uploading").style.left = document.body.scrollLeft  + ((document.body.clientWidth / 2) - 80);
		document.getElementById("obj_uploading").style.visibility = "visible";
		return true;
	}

	function call_pdf_report() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "ข้าราชการ/ลูกจ้างที่มีคุณสมบัติได้เลื่อนตำแหน่ง<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form1.target = "_blank";
		document.form1.action = "report/rpt_data_promote_e_p_inquire.php?report_title=" + report_title + "&UTC" + rptDate;
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "data_promote_e_p_inquire.html";
	} 
	
	function call_export_file() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "ข้าราชการ/ลูกจ้างที่มีคุณสมบัติได้เลื่อนตำแหน่ง<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")))?>";
		document.form1.target = "_blank";
		document.form1.action = "report/rpt_data_promote_e_p_inquire_xls.php?report_title=" + report_title + "&UTC" + rptDate;
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "data_promote_e_p_inquire.html";
	}	
	
	function check_salary_type( VAR_TYPE, VALUE ){
		if(VAR_TYPE==1){
			var LEVEL_START = VALUE;
			var objPerType = document.getElementsByName("PER_TYPE");
			for(var i=0; i<objPerType.length; i++)	if(form1.PER_TYPE[i].selected) PER_TYPE = form1.PER_TYPE[i].value;
		}else{
			var PER_TYPE = VALUE;
			var LEVEL_START = form1.LEVEL_START.value;
			form1.submit();
		} 

		if(PER_TYPE==2){
			form1.PER_SALARY.readOnly = true;
			document.all.btn_salary.disabled = false;
		}else{
			if(LEVEL_START == ""){
				form1.PER_SALARY.readOnly = true;
				document.all.btn_salary.disabled = true;
			}else{			
				document.all.PROCESS_IFRAME.src = "find_salary_type.html?PER_TYPE=" + PER_TYPE + "&LEVEL_START=" + LEVEL_START;
			} 
		} // end if
	} 
		
</script>
<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
  	<tr>
    	<td align="left" valign="top"><form name="form1" method="post" action="data_promote_e_p_inquire.html" enctype="multipart/form-data">
         
		 <?
		 //$SELECTED_LIST=""; 
		 //echo $SELECTED_LIST; ?>
		  <input type="hidden" name="current_page" value="<?=$current_page?>">
          <input type="hidden" name="total_page" value="<?=$total_page?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
          <input type="hidden" name="command" value="<?=$command?>">
          <input type="hidden" name="table_select" value="<?=$table_select?>">
		  <input type="hidden" name="chksave_promote" value="">
  		  <input type="hidden" name="SELECTED_LIST" value="<?=$SELECTED_LIST?>">
        &nbsp;&nbsp; 
		<table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
		  <tr>
		  	<td height="22" align="center" class="table_body"><?=$SEARCH_TITLE?></td>
		  </tr>		
	  </table></td>
	</tr>
  </table>
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
   
        <tr>
          <td height="22" align="center"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                      <tr> 
                        <td width="23%" height="22" align="right"><?=$PER_TYPE_TITLE?>&nbsp;:&nbsp;</td>
                        <td width="33%">
					<select name="PER_TYPE" onChange="check_salary_type(2, this.value);">
					<?  foreach($PERSON_TYPE as $key=>$value){  ?><option value="<?=$key; ?>"<?=($PER_TYPE==$key)?"selected":""?>><?=$value; ?></option><?  } ?>
					</select>
					</td>
                        <td width="11%" align="right"><span class="label_alert">*</span>&nbsp;วันที่ประมวลผล&nbsp;:&nbsp;</td>
                        <td><input type="text" name="PRO_DATE" id="PRO_DATE" value="<?=$PRO_DATE?>"  class="textbox" onKeyPress="DateOnly();" onBlur="changedateformat(form1.PRO_DATE,this.value)" <?=($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y")?"":"readonly"?>>&nbsp;&nbsp; 
							<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>						
						  	<input name="btnPRO_DATE" type="reset" class="button" onClick="return showCalendar('PRO_DATE', 'dd/mm/y');" value="<?=$SELECT_TITLE?>"> 
							<? endif; ?>                        </td>
                      </tr>
                      <tr> 
                        <td align="right"><?=$POS_NO_TITLE;?>&nbsp;:&nbsp;</td>
                        <td><? if ($POSITION_NO_CHAR=="Y") { ?><input type="text" name="POS_POEM_NO_NAME" value="<?=$POS_POEM_NO_NAME?>" class="textbox" style="width=40%" readonly><? } ?>&nbsp;<input type="text" name="POS_POEM_NO" value="<?=$POS_POEM_NO?>" class="textbox"  style="width=30%" readonly>&nbsp;&nbsp; 
								<input type="hidden" name="POS_POEM_ID" value="<?=$POS_POEM_ID?>">
								<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
			   					<input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกเลขที่ตำแหน่ง" onClick="call_search_position();">
								<? endif; ?>						</td>
                        <td align="right"><?=$CMD_POSITION_TITLE;?>&nbsp;:&nbsp;</td>
                        <td><input type="text" name="POS_POEM_NAME" value="<?=$POS_POEM_NAME?>" style="width=80%" class="textbox" readonly></td>
                      </tr>
		      </table></td>
	 </tr>
        <tr>
          <td height="5" align="center"><iframe src="javascript:;" id="PROCESS_IFRAME" frameborder="0" height="5" scrolling="no">ตรวจสอบการบันทึกข้อมูลลง per_promote... </iframe></td>
          </tr>	 
        <tr align="center">
          <td height="25">	  
<!--			<? if ($BUTTON_DISPLAY==1) { ?>
		  	  <input name="Submit3" type="button" class="button" value="<?=$INQUIRE_TITLE?>" onClick="clear_form(); call_search_promote_e_p();">
			<?  } else { ?>              
			  <img src="images/query.png" alt="<?=$INQUIRE_TITLE?>" width="32" height="32" border="0" onClick="clear_form(); call_search_promote_e_p();">
			<? } echo "&nbsp; &nbsp;"; ?>-->
<? if ($count_data && $command == "SEARCH") : ?>
		<? if ($BUTTON_DISPLAY==1) { ?>
		  	<input name="button5" type="button" class="button" value="<?=$CANCEL_TITLE?>แก้ไข" onClick="form1.command.value='';form1.current_page.value=1;parent.refresh_opener('2<::><::><::><::><::>!<::>!<::>!<::>');">
		<? } else { ?>
               <img src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>แก้ไข" width="32" height="32" border="0" onClick="form1.command.value='';form1.current_page.value=1;form1.submit();">
		<?}  echo "&nbsp; &nbsp;"; ?> 
		<? if ($BUTTON_DISPLAY==1) { ?>
			  <input name="Submit2" type="button" class="button" onClick="check_save_promote('<?=$table_select?>');" value="<?=$SAVE_SEARCH_TITLE?>">
		<?  } else { ?>      
			  <img src="images/save.png" alt="<?=$SAVE_SEARCH_TITLE?>" width="32" height="32" border="0" onClick="check_save_promote('<?=$table_select?>');" >
		<? } echo "&nbsp; &nbsp;"; ?>
<? endif; ?>		
          </td>
        </tr>
      </table></td>
    </tr>
  </table>
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
   
        <tr>
          <td height="22" align="center"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
			 <tr><td width="23%" height="3"></td></tr>
			 <tr><td align="center"><b>&reg;&nbsp;เงื่อนไขการค้นหา</b></td><td colspan="3"></td></tr>
			 <tr>
				<td width="23%" align="right"><span class="label_alert">*</span>&nbsp;<?=$MINISTRY_TITLE;?>&nbsp;:&nbsp;</td>
               	<td width="32%"><input type="text" name="ORG_NAME_M1" value="<?=$ORG_NAME_M1?>" style="width=80%" class="textbox" readonly>&nbsp;&nbsp;
					<input type="hidden" name="ORG_ID_M1"  value="<?=$ORG_ID_M1?>">
					<? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?><input type="button" name="btn_ministry" class="button" value="<?=$SELECT_TITLE?>" title="<?=$MINISTRY_SELECT?>" onClick="call_search_ministry();"><? } // end if ?>			   </td>
			   <td width="18%" align="right"><span class="label_alert">*</span>&nbsp;<?=$DEPARTMENT_TITLE;?>&nbsp;:&nbsp;</td>
			   <td width="32%"><input type="text" name="ORG_NAME_2" value="<?=$ORG_NAME_2?>" style="width=80%" class="textbox" readonly>			     &nbsp;&nbsp;
			     <input type="hidden" name="ORG_ID_M2"  value="<?=$ORG_ID_M2?>">
			     <? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?><input type="button" name="btn_department" class="button" value="<?=$SELECT_TITLE?>" title="<?=$DEPARTMENT_SELECT?>" onClick="call_search_department();"><? } // end if ?>			   </td></tr>
			 <tr>
			   <td align="right"><?=$PL_TITLE?>&nbsp;:&nbsp;</td>
			   <td><input type="text" name="PL_PN_NAME" value="<?=$PL_PN_NAME?>" style="width=80%" class="textbox" readonly>&nbsp;&nbsp; 
					  <input type="hidden" name="PL_PN_CODE" value="<?=$PL_PN_CODE?>">
					  <? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
					  <input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกตำแหน่งในสายงาน" onClick="call_search_perline_perposname();">
					  <? endif; ?>				</td>
				<td align="right"><?=$ORG_TITLE;?>&nbsp;:&nbsp;</td>
                <td><input type="text" name="ORG_NAME_3" value="<?=$ORG_NAME_3?>" style="width=80%" class="textbox" readonly>&nbsp;&nbsp;
					<input type="hidden" name="ORG_ID_M3" value="<?=$ORG_ID_M3?>">
					<? if($SESS_USERGROUP_LEVEL < 5) : ?>
					<input type="button" name="btn_org" class="button" value="<?=$SELECT_TITLE?>" onClick="call_search_org();">
					<? endif; ?>				</td>
			   </tr>
			 <tr>
				<td align="right">&nbsp;</td>
				<td>&nbsp;</td>
				<td align="right">&nbsp;</td>
				<td><input name="select_org_structure" type="radio" value="0" <?=($select_org_structure==0 || $SESS_ORG_STRUCTURE==0)?"checked":""?> <?=($SESS_ORG_STRUCTURE==1)?"disabled":"" ?> onClick="form1.ORG_ID_M3.value='';form1.ORG_NAME_3.value='';"><?=$LAW_STRUCTURE_TITLE?>&nbsp;
                    <input name="select_org_structure" type="radio" value="1" <?=($select_org_structure==1 || $SESS_ORG_STRUCTURE==1)?"checked":""?> <?=($SESS_ORG_STRUCTURE==0)?"disabled":"" ?> onClick="form1.ORG_ID_M3.value='';form1.ORG_NAME_3.value='';"><?=$ASSIGN_STRUCTURE_TITLE?></td>
			 </tr>
			 <tr>
               <td align="right"><?=$LEVEL_TITLE?>
                 &nbsp;:&nbsp;</td>
			   <td><!--? list_per_level('LEVEL_START', $LEVEL_START); ?-->
			     <select class="selectbox" name="LEVEL_START" onChange="<?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW)?"check_salary_type(1, this.value);":""?>">
                   <option value="0" <?=($LEVEL_START==0)?"selected":""?>>==<?=$LEVEL_TITLE?>==</option>
                   <?
				  	$cmd = " select LEVEL_NO, LEVEL_NAME from PER_LEVEL where PER_TYPE = $PER_TYPE and LEVEL_ACTIVE = 1 order by LEVEL_SEQ_NO ";
					$db_dpis1->send_cmd($cmd);
					while($data1 = $db_dpis1->get_array()){					
						$TMP_LEVEL_NO = $data1[LEVEL_NO];
						$TMP_LEVEL_NAME = $data1[LEVEL_NAME];
				  ?>
                   <option value="<?=$TMP_LEVEL_NO?>" <?=(trim($LEVEL_START)==trim($TMP_LEVEL_NO))?"selected":""?>>
                   <?=$TMP_LEVEL_NAME?>
                   </option>
                   <?
				  	} // end while
				  ?>
                 </select></td>
			   <td align="right">ถึง&nbsp;:&nbsp;</td>
			   <td><!--? list_per_level('LEVEL_END', $LEVEL_END); ?-->
                   <select class="selectbox" name="LEVEL_END" onChange="<?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW)?"check_salary_type(1, this.value);":""?>">
                     <option value="0" <?=($LEVEL_END==0)?"selected":""?>>==
                       <?=$LEVEL_TITLE?>
                       ==</option>
                     <?
				  	$cmd = " select LEVEL_NO, LEVEL_NAME from PER_LEVEL where PER_TYPE = $PER_TYPE and LEVEL_ACTIVE = 1 order by LEVEL_SEQ_NO ";
					$db_dpis1->send_cmd($cmd);
					while($data1 = $db_dpis1->get_array()){					
						$TMP_LEVEL_NO = $data1[LEVEL_NO];
						$TMP_LEVEL_NAME = $data1[LEVEL_NAME];
				  ?>
                     <option value="<?=$TMP_LEVEL_NO?>" <?=(trim($LEVEL_END)==trim($TMP_LEVEL_NO))?"selected":""?>>
                       <?=$TMP_LEVEL_NAME?>
                       </option>
                     <?
				  	} // end while
				  ?>
                   </select>               </td>
			   </tr>
			 <tr>
				<td align="right"><?=$EN_TITLE; ?>&nbsp;:&nbsp;</td>
               	<td><input type="text" name="EN_NAME" value="<?=$EN_NAME?>" style="width=80%" class="textbox" readonly>&nbsp;&nbsp;
					<input type="hidden" name="EN_CODE" value="<?=$EN_CODE?>">
					<? if(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
					<input type="button" name="Submit3" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกวุฒิการศึกษา" onClick="call_search_education();">
					<? endif; ?>				</td>
					<td></td>
					<td></td>
			 </tr>
			 <tr>
				<td align="right">ระยะเวลาในการดำรงตำแหน่งปัจจุบัน(ปี)&nbsp;:&nbsp;</td>
				<td><input type="text" name="YEAR_START" value="<?=$YEAR_START?>" class="textbox" size="12" onKeyPress="DigitOnly();"></td>
				<td align="right">ถึง&nbsp;:&nbsp;</td>
				<td><input type="text" name="YEAR_END" value="<?=$YEAR_END?>" class="textbox" size="12" onKeyPress="DigitOnly();"></td>
			 </tr>	
			 <tr>
				<td align="right"><?=$SALARY_TITLE;?>&nbsp;:&nbsp;</td>
				<td><input type="text" name="SAL_START" value="<?=$SAL_START?>" class="textbox" size="12" onKeyPress="NumOnly();"></td>
				<td align="right">ถึง&nbsp;:&nbsp;</td>
				<td><input type="text" name="SAL_END" value="<?=$SAL_END?>" class="textbox" size="12" onKeyPress="NumOnly();"></td>
			 </tr>				  			 			 
		      </table></td>
	 </tr>
        <tr>
          <td height="5" align="center"></td>
        </tr>	 
        <tr align="center">
          <td height="25"><? if ($BUTTON_DISPLAY==1) { ?>
		  	<input name="button5" type="button" class="button" value="<?=$CANCEL_TITLE?>" onClick="form1.command.value='CANCEL';form1.current_page.value=1;form1.submit();"><? } else { ?>
               <img src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>" width="32" height="32" border="0" onClick="form1.command.value='CANCEL';form1.current_page.value=1;form1.submit();">
      		  <?}  echo "&nbsp; &nbsp;"; ?>  <? if ($BUTTON_DISPLAY==1) { ?>
      		  	<input name="Reset1" type="button" class="button" value="<?=$CLEAR_TITLE?>" onClick="clear_form();"> <? } else { ?>
            <img src="images/default.jpg" alt="<?=$CLEAR_TITLE?>" width="32" height="32" border="0" onClick="clear_form();">&nbsp;
<?} echo "&nbsp; &nbsp;"; ?><? if ($BUTTON_DISPLAY==1) { ?>
			<input name="Submit2" type="submit" class="button" onClick="if(form1.PRO_DATE.value==''){	 alert('กรุณาเลือกวันที่ประมวลผล'); form1.btnPRO_DATE.focus();	return false;	}	if(form1.ORG_ID_M2.value.trim()!=''){ 		
				form1.command.value='SEARCH';form1.current_page.value=1; ProcessUploading(); }else{ alert('<?=$DEPARTMENT_ALERT?>');  return false; }" value="<?=$SEARCH_TITLE?>"><?  } else { ?>
              <input name="image2" type="image" onClick="if(form1.PRO_DATE.value==''){	 alert('กรุณาเลือกวันที่ประมวลผล');	form1.btnPRO_DATE.focus();	return false; }	if(form1.ORG_ID_M2.value.trim()!=''){ 		
				form1.command.value='SEARCH';form1.current_page.value=1; ProcessUploading(); }else{ alert('<?=$DEPARTMENT_ALERT?>');  return false; }" src="images/search.png" alt="<?=$SEARCH_TITLE?>">
              <? } echo "&nbsp; &nbsp;"; ?>
			<? if ($command == "SELECT") { ?><? if ($BUTTON_DISPLAY==1) { ?>
			<input name="Submit4" type="button" class="button" onClick="call_personal_promote_e_p();" value="<?=$ADD_PERSON_TITLE?>" style="width:125"><? } else { ?>
            <img src="images/select_person.png" alt="<?=$ADD_PERSON_TITLE?>" width="32" height="32" border="0" onClick="call_personal_promote_e_p();">&nbsp;
<?}?>
			<? } // if ?>
          </td>
        </tr>
      </table></td>
    </tr>
  </table>
  
    <table width="95%" align="center"  border="0" cellspacing="0" cellpadding="0">
	<tr><td height="21">&nbsp;</td></tr>	
    <tr><td>
	<table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
            <tr height="22">
<? if (trim($PRO_DATE) && $POS_POEM_ID) : ?>
              <td width="15%"><? if($PAGE_AUTH["print"]=="Y" && $command=="SELECT"){ ?><? if ($BUTTON_DISPLAY==1) { ?>
	<input name="btn_report" type="button" class="button" value="<?=$PDF_TITLE?>" onClick="call_pdf_report();"><?  } else { ?>
	<img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE?>" onClick="call_pdf_report();"><? } ?>
              <? }else{ echo "&nbsp;"; } ?></td> 
<? endif; ?>
              <td align="center">พบข้อมูล<?=$MENU_TITLE_LV2?>ทั้งสิ้น <?=($count_data + 0)?> รายการ</td>
<? if (trim($PRO_DATE) && $POS_POEM_ID) : ?>						  
              <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y" && $command=="SELECT"){ ?><? if ($BUTTON_DISPLAY==1) { ?>
	<input name="btn_export" type="button" class="button" value="<?=$EXCEL_TITLE?>" onClick="call_export_file();"><?  } else { ?>
	<img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE?>" onClick="call_export_file();"><? } ?>
              <? }else{ echo "&nbsp;"; } ?></td> 
<? endif; ?>			  
            </tr>
          </table>  
	</td></tr>
</table>
<?
	if($cmd_search){
		$count_page_data = $db_dpis->send_cmd($cmd_search);
	}else if($cmd_show){
		$count_page_data = $db_dpis->send_cmd($cmd_show);
	}
	//$db_dpis->show_error();		echo "<hr>";	//ถ้าเยอะๆเป็น 3-4 พัน error
//	echo "$command : $cmd_search - $cmd_show";
	if ($count_page_data) {
?>
        <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
          <tr align="center" class="table_head"> 
            <td width="3%"><input name="Reset1" type="button" class="button" value="<?=$SELECT_TITLE?>" onClick="call_presentation();" alt="นำเสนอ" title="นำเสนอ"> </td>
			<td width="5%" height="21"><strong><?=$SEQ_NO_TITLE;?></strong></td>
			<td ><strong><?=$FULLNAME_TITLE;?></strong></td>
			<td width="17%"><strong><?=$CMD_POSITION_TITLE;?></strong></td>
			<td width="8%"><strong>สังกัด</strong></td>
			<td width="9%"><strong><?=$POS_NO_TITLE;?></strong></td>
			<td width="11%"><strong><?=$SALARY_TITLE;?></strong></td>
			<td width="10%">วันเข้าสู่ระดับ</td>
			<td width="11%">ระยะเวลาที่ดำรงตำแหน่ง<br>(ปี/เดือน/วัน)</td>			
			<td width="11%">อายุราชการ<br>(ปี/เดือน/วัน)</td>
			<? //if ($command=="SELECT") : ?>
			<td width="4%"><?=$DEL_TITLE;?></td>
			<? //endif; ?>
          </tr>
          <?
	$current_list = "";
	$data_count = 0;
	$data_num = $data_per_page * ($current_page - 1);
	while ($data = $db_dpis->get_array()) {
		$data_count++;
		$data_num++;
		if($data_count > $data_per_page) break;
		$TMP_PER_ID = $data[PER_ID];
		$TMP_PER_TYPE = $data[PER_TYPE];		
		$current_list .= ((trim($current_list))?",":"") . $TMP_PER_ID;
		$TMP_PN_CODE = trim($data[PRENAME_CODE]);
		if($TMP_PN_CODE){
			$cmd = " select PN_NAME from PER_PRENAME where trim(PN_CODE)='$TMP_PN_CODE' ";
			$db_dpis2->send_cmd($cmd);
			$data2 = $db_dpis2->get_array();
			$TMP_PN_NAME = trim($data2[PN_NAME]);
		} // end if		
		$TMP_PER_NAME = trim($TMP_PN_NAME) . trim($data[PER_NAME]) ." ". trim($data[PER_SURNAME]);
		$TMP_SALARY = number_format(trim($data[PER_SALARY]), 2, '.', ',');
		$TMP_POS_CHANGE_DATE = show_date_format($data[POS_CHANGE_DATE], $DATE_DISPLAY);
		$TMP_EFFECTIVEDATE = show_date_format($data[EFFECTIVEDATE], $DATE_DISPLAY);
		$TMP_PER_STARTDATE = show_date_format($data[PER_STARTDATE], 1);
		$TMP_PER_STARTDATE = date_difference(date("Y-m-d"), trim($data[PER_STARTDATE]), "full");

		$TMP_LEVEL_NO = trim($data[LEVEL_NO]);

		$TMP_POH_EFFECTIVEDATE = "";
		if($PER_TYPE == 1){
			$cmd = " select			POH_EFFECTIVEDATE
							 from			PER_POSITIONHIS
							 where		PER_ID=$TMP_PER_ID and LEVEL_NO='$TMP_LEVEL_NO'
							 order by		POH_EFFECTIVEDATE ";
		}elseif($PER_TYPE == 2){
			$cmd = " select			POH_EFFECTIVEDATE
							 from			PER_POSITIONHIS
							 where		PER_ID=$TMP_PER_ID and LEVEL_NO='$TMP_LEVEL_NO'
							 order by		POH_EFFECTIVEDATE ";
		}elseif($PER_TYPE == 3){
			$cmd = " select			POH_EFFECTIVEDATE
							 from			PER_POSITIONHIS
							 where		PER_ID=$TMP_PER_ID and LEVEL_NO='$TMP_LEVEL_NO' 
							 order by		POH_EFFECTIVEDATE ";
		} // end if
		$db_dpis1->send_cmd($cmd);
//		$db_dpis1->show_error();
		$data1 = $db_dpis1->get_array();
		$TMP_POH_EFFECTIVEDATE = substr(trim($data1[POH_EFFECTIVEDATE]), 0, 10);
		$TMP_POS_STARTDATE = "";
		if($TMP_POH_EFFECTIVEDATE && $TMP_POH_EFFECTIVEDATE!="-") $TMP_POS_STARTDATE = date_difference(date("Y-m-d"), $TMP_POH_EFFECTIVEDATE, "full");

		if($PER_TYPE==1){
			$TMP_POS_NO = trim($data[POS_NO_NAME]).trim($data[POS_NO]);
			$TMP_PL_CODE = trim($data[PL_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select PL_NAME from PER_LINE where trim(PL_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[PL_NAME]);
			} // end if		
		}elseif($PER_TYPE==2){
			$TMP_POS_NO = trim($data[POEM_NO_NAME]).trim($data[POEM_NO]);
			$TMP_PL_CODE = trim($data[PN_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select PN_NAME from PER_POS_NAME where trim(PN_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[PN_NAME]);
			} // end if		
		}elseif($PER_TYPE==3){
			$TMP_POS_NO = trim($data[POEMS_NO_NAME]).trim($data[POEMS_NO]);
			$TMP_PL_CODE = trim($data[EP_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select EP_NAME from PER_EMPSER_POS_NAME where trim(EP_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[EP_NAME]);
			} // end if		
		}elseif($PER_TYPE==4){
			$TMP_POS_NO = trim($data[POT_NO_NAME]).trim($data[POT_NO]);
			$TMP_PL_CODE = trim($data[TP_CODE]);
			if($TMP_PL_CODE){
				$cmd = " select TP_NAME from PER_TEMP_POS_NAME where trim(TP_CODE)='$TMP_PL_CODE' ";
				$db_dpis2->send_cmd($cmd);
				$data2 = $db_dpis2->get_array();
				$TMP_PL_NAME = trim($data2[TP_NAME]);
			} // end if		
		} // end if

		$TMP_PT_CODE = trim($data[PT_CODE]);
		if($TMP_PT_CODE){
			$cmd = " select PT_NAME from PER_TYPE where trim(PT_CODE)='$TMP_PT_CODE' ";
			$db_dpis2->send_cmd($cmd);
			$data2 = $db_dpis2->get_array();
			$TMP_PT_NAME = trim($data2[PT_NAME]);
		} // end if		

		$TMP_PM_CODE = trim($data[PM_CODE]);
		if($TMP_PM_CODE){
			$cmd = " select PM_NAME from PER_MGT where trim(PM_CODE)='$TMP_PM_CODE' ";
			$db_dpis2->send_cmd($cmd);
			$data2 = $db_dpis2->get_array();
			$TMP_PM_NAME = $data2[PM_NAME];
		} // end if
		
		$cmd = " select LEVEL_NAME, POSITION_LEVEL from PER_LEVEL where LEVEL_NO='$TMP_LEVEL_NO' ";
		$db_dpis2->send_cmd($cmd);
		$data2 = $db_dpis2->get_array();
		$LEVEL_NAME = $data2[LEVEL_NAME];
		$POSITION_LEVEL = $data2[POSITION_LEVEL];
		if (!$POSITION_LEVEL) $POSITION_LEVEL = $LEVEL_NAME;
		
		if ($RPT_N)
		    $TMP_POSITION = (trim($TMP_PM_NAME) ?"$TMP_PM_NAME (":"") . (trim($TMP_PL_NAME)? "$TMP_PL_NAME$POSITION_LEVEL" : "") . (trim($TMP_PM_NAME) ?")":"");
		else
		    $TMP_POSITION = (trim($TMP_PM_NAME) ?"$TMP_PM_NAME (":"") . (trim($TMP_PL_NAME)?($TMP_PL_NAME ." ". level_no_format($TMP_LEVEL_NO) . (($TMP_PT_NAME != "ทั่วไป" && $TMP_LEVEL_NO >= 6)?"$TMP_PT_NAME":"")):"") . (trim($TMP_PM_NAME) ?")":"");
		
		$TMP_ORG_ID = trim($data[ORG_ID]);
		if($TMP_ORG_ID){
			$cmd = " select ORG_NAME,ORG_SHORT from PER_ORG where ORG_ID=$TMP_ORG_ID ";
			$db_dpis2->send_cmd($cmd);
			//$db_dpis2->show_error();
			$data2 = $db_dpis2->get_array();
			if($data2[ORG_SHORT]){
				$TMP_ORG = $data2[ORG_SHORT];
			}else{
				$TMP_ORG = $data2[ORG_NAME];
			}
		} // end if
	
		$class = "table_body";
		$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
		if($PER_ID==$TMP_PER_ID){ 
			$class = "table_body_over";
			$onmouse_event = "";
		} // end if		
?>
          <tr class="<?=$class?>" <?=$onmouse_event?>> 
		    <td align="center"><input type="checkbox" name="SELECT_PER_<?=$TMP_PER_ID?>" value="<?=$TMP_PER_ID?>" onClick="update_list(this.checked, <?=$TMP_PER_ID?>);"></td>
		    <td height="25" align="center"><?=$data_num?></td>
		<td>&nbsp;<?=$TMP_PER_NAME?></td>
		<td>&nbsp;<?=$TMP_POSITION?></td>
		<td nowrap="nowrap">&nbsp;<?=$TMP_ORG?></td>
		<td align="center"><?=$TMP_POS_NO?></td>
		<td align="right"><?=$TMP_SALARY?>&nbsp;</td>
		<td align="center"><?=$TMP_EFFECTIVEDATE?></td>
		<td>&nbsp;<?=$TMP_POS_STARTDATE?></td>
		<td>&nbsp;<?=$TMP_PER_STARTDATE?></td>
		<td align="center">
			<? if ($command == "SELECT") { ?>
				<img src="images/b_drop.png" alt="ลบข้อมูล" width="15" height="15" border="0" style="cursor:hand" onClick="del_personal_promote_e_p('<?=$TMP_PER_ID?>','<?=$TMP_PER_NAME?>','<?=$TMP_PER_TYPE?>')">
			<? } else { echo "<font color='red'>-</font>"; } // if ?></td>
          </tr>
          <? } ?>
          <?if($PAGE_AUTH["edit"]=="Y"){?>
          <tr class="table_footer" height="21"> 
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
            <td>&nbsp;</td>
	     <td>&nbsp;</td>
          </tr>
          <?}?>
        </table>
  <? if($total_page > 1) : ?>
  <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td align="center"><?=$page_link?></td>
    </tr>
  </table>
        <? endif; ?>
        &nbsp; 
        <? } // if ($count_page_data) ?>
        <input type="hidden" name="current_list" value="<?=$current_list?>">
        </form>	
		</td>
	</tr>
</table>
<br>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
</script>
<script><?=$alert_save_success?></script>
<!-- Layer for uploading -->
<div style="position:absolute;width:160;height:160; visibility:hidden; display:none;" id="obj_uploading">
  <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="160" height="160">
    <param name="movie" value="images/uploading.swf">
    <param name="quality" value="high">
    <embed src="images/uploading.swf" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="160" height="160"></embed>
  </object>
</div>
<!-- Layer for uploading -->
</html>
