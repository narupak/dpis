<?
	include("../php_scripts/connect_database.php");
	include("php_scripts/load_per_control.php");
    include("php_scripts/es_del_chkabsent_holiday.php");  
    
    /* echo $CTRL_TYPE."||".$SESS_USERGROUP_LEVEL;*/
    switch($CTRL_TYPE){
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
	} // end switch case

	switch($SESS_USERGROUP_LEVEL){								
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
		case 5 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
		case 6 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$search_org_id_1 = $ORG_ID_1;
			$search_org_name_1 = $ORG_NAME_1;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
	} // end switch case
    
    


?>
<html>
<head>
<title><?=$page_title;?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected;?>" type="text/css">
</head>
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script type="text/javascript" >

</script>
<body>
<form action="es_del_chkabsent_holiday.html" method="post" enctype="multipart/form-data" name="form1">
  <input type="hidden" name="current_page" value="<?=$current_page;?>">
  <input type="hidden" name="total_page" value="<?=$total_page;?>">
  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0;?>">
  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1;?>">
  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2;?>">
  <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3;?>">
  <input type="hidden" name="CntEncode" id="CntEncode" value="<?=$Olddata_count;?>">
  <input type="hidden" name="command">
  <input type="hidden" name="isLock" value="<?=$isLock;?>">
  <input type="hidden" name="LOCK_MINISTRY_ID" value="<?=$LOCK_MINISTRY_ID;?>">
  <input type="hidden" name="LOCK_DEPARTMENT_ID" value="<?=$LOCK_DEPARTMENT_ID;?>">
  <input type="hidden" name="HidHOL_DATE" value="<?=$HOL_DATE;?>">
  <input type="hidden" name="HidHOL_NAME" value="<?=trim(iconv("utf-8","tis620",urldecode($HOL_NAME)));?>">
  
  



   <table width="100%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td>
  <table width="100%"  border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
  <tr valign="top">
      <td align="right">&nbsp;</td>
      <td align="left">&nbsp;</td>
    </tr>
  	<tr valign="top">
      <td width="26%" align="right">วันที่&nbsp;:&nbsp;</td>
      <td width="74%" align="left"><?=show_date_format($HOL_DATE,1);?></td>
    </tr>
    
    <tr valign="top">
      <td width="26%" align="right">ชื่อวันหยุด&nbsp;:&nbsp;</td>
      <td width="74%" align="left"><?=trim(iconv("utf-8","tis620",urldecode($HOL_NAME)));?></td>
    </tr>
    
    <tr>
      <td colspan="2" align="right"><hr></td>
      </tr>
    
    <?
        
		$DATA_FULLNAME_SHOW= "";

		   $cmd = " select 	a.PER_ID,ex.ABS_STARTDATE ,ex.ABS_ENDDATE,
                        g.PN_SHORTNAME||a.PER_NAME||' '||a.PER_SURNAME  AS FULLNAME_SHOW,ex.ABS_DAY,at.AB_NAME,
                       CASE WHEN  ex.ABS_STARTPERIOD=1 THEN 'เช้า' WHEN ex.ABS_STARTPERIOD=2 THEN 'บ่าย' ELSE 'ทั้งวัน' END AS  STARTPERIOD_NAME,
                       CASE WHEN  ex.ABS_ENDPERIOD=1 THEN 'เช้า' WHEN ex.ABS_ENDPERIOD=2 THEN 'บ่าย' ELSE 'ทั้งวัน' END AS  ENDPERIOD_NAME
                        from  PER_ABSENT ex
                        left join PER_PERSONAL a on(a.PER_ID=ex.PER_ID) 
                        left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                        left join PER_ABSENTTYPE at on(at.AB_CODE=ex.AB_CODE)
                        WHERE '$HOL_DATE'  BETWEEN ex.ABS_STARTDATE and ex.ABS_ENDDATE AND at.AB_COUNT=2 AND ex.CANCEL_FLAG=0
                        order by  ex.ABS_STARTDATE ASC,a.PER_NAME ASC,a.PER_SURNAME ASC ";

		
			$count_page_data = $db_dpis->send_cmd($cmd);
            //echo "<pre>".$cmd."<br>";
        
        ?>
        
    <? if($count_page_data>0){ ?>
    
        <tr valign="top">
          <td width="26%" align="right">รายชื่อบุคลากร (<font color="0000FF">ลาออนไลน์</font>)&nbsp;:&nbsp;</td>
          <td width="74%" align="left">
          
         			<table width="99%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
                    <tr align="center" class="table_head">
                    <td nowrap width="6%" height="21">ลำดับ</td>
                    <td nowrap width="20%">ชื่อ-สกุล</td>
                     <td nowrap width="23%">ประเภทการลา</td>
                      <td nowrap width="13%">ตั้งแต่วันที่</td>
                      <td nowrap width="9%">ประเภท</td>
                      <td nowrap width="13%">ถึงวันที่</td>
                      <td nowrap width="9%">ประเภท</td>
                      <td nowrap width="7%">จำนวนวัน</td>
                    </tr>
                    <?
                    $data_count= 0;
                    while ($data = $db_dpis->get_array()) {
                        $data_count++;
                        if($data_count > $data_per_page) break;
                        
                        $FULLNAME_SHOW = $data[FULLNAME_SHOW];
                        $AB_NAME = $data[AB_NAME];
                        $ABS_STARTDATE = show_date_format($data[ABS_STARTDATE], $DATE_DISPLAY);
                        $STARTPERIOD_NAME = $data[STARTPERIOD_NAME];
                        $ABS_ENDDATE = show_date_format($data[ABS_ENDDATE], $DATE_DISPLAY);
                        $ENDPERIOD_NAME = $data[ENDPERIOD_NAME];
                        $ABS_DAY = $data[ABS_DAY];
                
                        $class = "table_body";
                        $onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
                
                ?>
                    <tr class="<?=$class?>" <?=$onmouse_event?>>
                      <td align="center"><?=$data_count;?></td>
                      <td>&nbsp;<?=$FULLNAME_SHOW;?></td>
                      <td>&nbsp;<?=$AB_NAME;?></td>
                      <td align="center"><?=$ABS_STARTDATE;?></td>
                      <td align="center"><?=$STARTPERIOD_NAME;?></td>
                	   <td align="center"><?=$ABS_ENDDATE;?></td>
                      <td align="center"><?=$ENDPERIOD_NAME;?></td>
                      <td align="center"><?=$ABS_DAY;?></td>
                    </tr>
                    
                <? }?>
                  </table>
          
          
          </td>
        </tr>
        
        <tr>
          <td colspan="2" align="right"><hr></td>
        </tr>
    
    <? } ?>
    
    <?
        
		$DATA_FULLNAME_SHOWHis= "";

		  $cmd = " select 	a.PER_ID,ex.ABS_STARTDATE ,ex.ABS_ENDDATE,
                        g.PN_SHORTNAME||a.PER_NAME||' '||a.PER_SURNAME  AS FULLNAME_SHOW,ex.ABS_DAY,at.AB_NAME,
                        CASE WHEN  ex.ABS_STARTPERIOD=1 THEN 'เช้า' WHEN ex.ABS_STARTPERIOD=2 THEN 'บ่าย' ELSE 'ทั้งวัน' END AS  STARTPERIOD_NAME,
                       CASE WHEN  ex.ABS_ENDPERIOD=1 THEN 'เช้า' WHEN ex.ABS_ENDPERIOD=2 THEN 'บ่าย' ELSE 'ทั้งวัน' END AS  ENDPERIOD_NAME
                        from  PER_ABSENTHIS ex
                        left join PER_PERSONAL a on(a.PER_ID=ex.PER_ID) 
                        left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                        left join PER_ABSENTTYPE at on(at.AB_CODE=ex.AB_CODE)
                        WHERE '$HOL_DATE'  BETWEEN ex.ABS_STARTDATE and ex.ABS_ENDDATE AND at.AB_COUNT=2
                        order by  ex.ABS_STARTDATE ASC,a.PER_NAME ASC,a.PER_SURNAME ASC ";

		
			$count_page_data = $db_dpis->send_cmd($cmd);
            //echo "<pre>".$cmd."<br>";
        
        ?>
    
    <? if($count_page_data>0){ ?>
            <tr valign="top">
              <td width="26%" align="right">รายชื่อบุคลากร (<font color="0000FF">ข้อมูลประวัติการลา</font>)&nbsp;:&nbsp;</td>
              <td width="74%" align="left">
              		<table width="99%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
                    <tr align="center" class="table_head">
                    <td nowrap width="6%" height="21">ลำดับ</td>
                    <td nowrap width="20%">ชื่อ-สกุล</td>
                     <td nowrap width="23%">ประเภทการลา</td>
                      <td nowrap width="13%">ตั้งแต่วันที่</td>
                      <td nowrap width="9%">ประเภท</td>
                      <td nowrap width="13%">ถึงวันที่</td>
                      <td nowrap width="9%">ประเภท</td>
                      <td nowrap width="7%">จำนวนวัน</td>
                    </tr>
                    <?
                    $data_count= 0;
                    while ($data = $db_dpis->get_array()) {
                        $data_count++;
                        if($data_count > $data_per_page) break;
                        
                        $FULLNAME_SHOW = $data[FULLNAME_SHOW];
                        $AB_NAME = $data[AB_NAME];
                        $ABS_STARTDATE = show_date_format($data[ABS_STARTDATE], $DATE_DISPLAY);
                        $STARTPERIOD_NAME = $data[STARTPERIOD_NAME];
                        $ABS_ENDDATE = show_date_format($data[ABS_ENDDATE], $DATE_DISPLAY);
                        $ENDPERIOD_NAME = $data[ENDPERIOD_NAME];
                        $ABS_DAY = $data[ABS_DAY];
                
                        $class = "table_body";
                        $onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
                
                ?>
                    <tr class="<?=$class?>" <?=$onmouse_event?>>
                      <td align="center"><?=$data_count;?></td>
                      <td>&nbsp;<?=$FULLNAME_SHOW;?></td>
                      <td>&nbsp;<?=$AB_NAME;?></td>
                      <td align="center"><?=$ABS_STARTDATE;?></td>
                      <td align="center"><?=$STARTPERIOD_NAME;?></td>
                	   <td align="center"><?=$ABS_ENDDATE;?></td>
                      <td align="center"><?=$ENDPERIOD_NAME;?></td>
                      <td align="center"><?=$ABS_DAY;?></td>
                    </tr>
                    
                <? }?>
                  </table>
              
              </td>
            </tr>
            
          <tr>
          <td colspan="2" align="right"><hr></td>
        </tr>
    
    <? } ?>

    <tr>
      <td align="right">&nbsp;</td>
      <td align="left">&nbsp;</td>
    </tr>
    <tr>
      <td align="right">&nbsp;</td>
      <td align="left"><input type="radio" name="chk_confirm" id="chk_confirm1" value="1" checked> ยืนยันการเพิ่มวันและลบปฏิทินวันหยุด
        <br>
        <input type="radio" name="chk_confirm" id="chk_confirm2" value=2"> ไม่ปรับเพิ่มวัน ลบเฉพาะปฏิทินวันหยุด
        </td>
    </tr>
    <tr>
      <td align="right">&nbsp;</td>
      <td align="left">&nbsp;</td>
    </tr>
    <tr>
      <td align="right">&nbsp;</td>
      <td align="left"><input name="Submit_ok" type="submit" class="button" onClick="form1.command.value='NEW';" value=" ยืนยันบันทึกข้อมูล "></td>
    </tr>
    <tr>
      <td align="right">&nbsp;</td>
      <td align="left">&nbsp;</td>
    </tr>
    <tr>
      <td align="right">&nbsp;</td>
      <td align="left"><font color="0000FF">&nbsp;* หมายเหตุ ทำรายการเฉพาะประเภทการลาที่ไม่นับวันหยุดเท่านั้น </font>
       </td>
    </tr>
    
  </table>
  
  </td>
    </tr>
    
  </table>

</form>
<?
	include("jqModalDialog.html");
?>
</body>
</html>