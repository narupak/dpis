<? 
	include("../php_scripts/connect_database.php");
	include("../php_scripts/calendar_data.php");
	include("php_scripts/personal_absenthis.php");
	include("php_scripts/load_per_control.php");

	if (!$UPD && !$VIEW) get_ABSENT_SUM($PER_ID,$TODAY);		// ดึงวันลาสะสมของผู้ที่ล็อกอินมาลา
	$cmd =" select 		count(ABS_ID) as count_data 
					from 		PER_ABSENTHIS
					where		PER_ID=$PER_ID ";
	$db_dpis->send_cmd($cmd);
//	$db_dpis->show_error();
	$data = $db_dpis->get_array();
	$data = array_change_key_case($data, CASE_LOWER);
	$count_data = $data[count_data];
//	echo "count-list-absenthis-$cmd ($count_data)<br>";

	$total_page = ceil( $count_data / $data_per_page );
	$page_link = create_link_page($total_page, $current_page);
	$limit_data = "";	
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
</head>
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">
	function change_current_page( page ){
		form1.current_page.value = page;
		form1.submit();
	}
	
	function changedateformat(name,str) {
		var arr = str.split('/');
		if((str) && (str != arr[0]+'/'+arr[1]+'/'+arr[2])){
			name.value = str.substr(0,2) + "/" + str.substr(2,2) + "/"  + str.substr(4,4) ;
		}
		chk_date(name, "BDH");
	}
	
	function confirm_delete(abs_id , ab_name){
		if(confirm("ต้องการลบข้อมูลประวัติการลานี้ ใช่หรือไม่ [ " + ab_name + " ]?")){
			form1.command.value = "DELETE";
			form1.ABS_ID.value = abs_id;
			form1.submit();
		} // end if
	}
	
	function MM_openBrWindow(theURL,winName,features) { //v2.0
	  window.open(theURL,winName,features);
	}
	
	function compare_diff_date(startdate,enddate) {
               
		 var StartDateArr  =  startdate.split("/");
		//  var StartDateF = new Date(parseInt(StartDateArr[2])-543,parseInt(StartDateArr[1])-1,parseInt(StartDateArr[0]));
                var StartDateF = StartDateArr[2]+StartDateArr[1]+StartDateArr[0];
		 
                var StopDateArr  =  enddate.split("/");
		//  var StopDateF = new Date(parseInt(StopDateArr[2])-543,parseInt(StopDateArr[1])-1,parseInt(StopDateArr[0]));
                var StopDateF = StopDateArr[2]+StopDateArr[1]+StopDateArr[0];
		if (StopDateF < StartDateF){
		   return false;
		}else{
			return true;
		}
	}
        function Inint_AJAX() {
            try { return new ActiveXObject("Msxml2.XMLHTTP");  } catch(e) {} //IE
            try { return new ActiveXObject("Microsoft.XMLHTTP"); } catch(e) {} //IE
            try { return new XMLHttpRequest();          } catch(e) {} //Native Javascript
            alert("XMLHttpRequest not supported");
            return null;
        };
        function ProcessUploading() {
		document.getElementById("obj_uploading").style.display = "block";
		document.getElementById("obj_uploading").style.top = document.body.scrollTop + ((document.body.clientHeight / 2) + 5);
		document.getElementById("obj_uploading").style.left = document.body.scrollLeft  + ((document.body.clientWidth / 2) - 80);
		document.getElementById("obj_uploading").style.visibility = "visible";
		return true;
	}
	function calcDaysBetweenDateV2(){
           
            var req = new XMLHttpRequest();  //Inint_AJAX();
            req.onreadystatechange = function () {
                if (req.readyState==4) {
                    if (req.status==200) {
                        
                         document.getElementById('LblBetween').innerHTML  = req.responseText;
                         document.getElementById("obj_uploading").style.display = "none";
                         //return ProcessUploading();
                         //alert(req.responseText);
                         /*if(req.responseText=='1'){
                             alert('วันเดียวกัน เริ่มครึ่งเช้า สิ้นสุดครึ่งบ่าย ถือเป็น 1 วัน\nโปรดแก้ไขเป็น "ทั้งวัน" ');
                         }else if(req.responseText=='2'){
                             alert('วันเดียวกัน เริ่มครึ่งบ่าย สิ้นสุดครึ่งเช้า ไม่ถูกต้อง\nโปรดแก้ไข');
                         }else if(req.responseText=='3'){
                             alert('วันเดียวกัน เริ่มทั้งวัน สิ้นสุดครึ่งบ่าย ถือเป็น 1 วัน\nโปรดแก้ไขสิ้นสุดเป็น "ทั้งวัน" ');
                         }else if(req.responseText=='4'){
                             alert('วันเดียวกัน เริ่มครึ่งเช้า สิ้นสุดทั้งวัน ถือเป็น 1 วัน\nโปรดแก้ไขเริ่มเป็น "ทั้งวัน" ');
                         }else if(req.responseText=='5'){
                             alert('เริ่มวันแรกเป็นครึ่งเช้า เว้นบ่าย ไม่ถูกต้อง\nโปรดทำแยกเป็นลาอีก 1 รายการ');
                         }else if(req.responseText=='6'){    
                             alert('สิ้นสุดจบที่ครึ่งบ่าย เว้นเช้า ไม่ถูกต้อง\nโปรดทำแยกเป็นลาอีก 1 รายการ');
                         }else{
                             document.getElementById('LblBetween').innerHTML  = req.responseText;
                         }*/
                        /*if(req.responseText!=''){
                            alert('ไม่สามารถเปลี่ยนวันลาได้ เนื่องจากเกินช่วงวันลาที่ได้อนุมัตไปแล้ว');
                        }*/
                    }
                }
            };
            var url = 'php_scripts/genlistdateutf8.php';
            /*req.open("GET", url+'?OldBgnDay='+form1.OLD_ABS_STARTDATE.value
                +'&OldEndDay='+form1.OLD_ABS_ENDDATE.value
                +'&NewBgnDay='+form1.ABS_STARTDATE.value
                +'&NewEndDay='+form1.ABS_ENDDATE.value
                +'&ApproveFlag='+form1.HIDDEN_ABS_APPROVE_FLAG.value);*/
                var STARTPERIOD = 0;
		var objRadio = form1.ABS_STARTPERIOD;
		STARTPERIOD = objRadio.options[objRadio.selectedIndex].value;

		var ENDPERIOD = 0;
		var objRadio = form1.ABS_ENDPERIOD;
		ENDPERIOD = objRadio.options[objRadio.selectedIndex].value;
               
            req.open("GET", url+'?abs_startdate='+form1.ABS_STARTDATE.value
                +'&startperiod='+STARTPERIOD
                +'&abs_enddate='+form1.ABS_ENDDATE.value
                +'&endperiod='+ENDPERIOD
                +'&ab_code='+form1.AB_CODE.value
                +'&per_id='+form1.PER_ID.value);
            req.setRequestHeader("Content-Type", "application/json;charset=utf-8"); // set Header
            req.send(); //ส่งค่า
			get_holiday_();
        }
	function get_holiday_(){//หาวันหยุดพิเศษ
		PER_STARTDATE = $('#ABS_STARTDATE').val();
		PER_ENDDATE = $('#ABS_ENDDATE').val();
			$.ajax({
				   type: "POST",
				   url: "php_scripts/get_holiday.php",
				   cache: false,
				   data: {'PER_STARTDATE':PER_STARTDATE, 'PER_ENDDATE':PER_ENDDATE},
				   success: function(msg){
					msg = msg.split("|");
					intPublicHoliday = $.trim(msg[0]);
					intWorkDay = $.trim(msg[1]);
					$("#holiday_extra").val(intPublicHoliday);
					$("#work_day").val(intWorkDay);
					form1.ABS_DAY_OLD.value = form1.ABS_DAY.value;	
					$('#cnt_dayx').val($('#ABS_DAY').val());
				   },error : function(jqXHR,textStatus,errorTrow){
				   alert("error");
					console.log(jqXHR.restponseText);
				   }
				 });
	}
	//คำนวณจำนวนวันที่ลา chkSave??????????? 
	function calcDaysBetweenDate(chkSave){
		var str_start_date = form1.ABS_STARTDATE.value;
		var str_end_date = form1.ABS_ENDDATE.value;
		var str_ab_code = form1.AB_CODE.value;

		 if(compare_diff_date(str_start_date, str_end_date)==false){
				alert('กรุณาระบุ ถึงวันที่ ใหม่ ต้องมีค่ามากกว่า ตั้งแต่วันที่');
				form1.ABS_ENDDATE.focus();
				return false;
		}else{ 		
				if(str_start_date){
					var arrTmp = str_start_date.split("/");
					var start_year = parseInt(arrTmp[2], 10) - 543;
					var start_month = arrTmp[1];
					var start_date = arrTmp[0];
					
					str_start_date = start_month + "/" + start_date + "/" + start_year;
				}else{
					//alert("กรุณาระบุ ตั้งแต่วันที่");
					form1.ABS_DAY.value = "";
					form1.ABS_STARTDATE.focus();
					return false;
				} // end if
		
				if(str_end_date){
					var arrTmp = str_end_date.split("/");
					var end_year = parseInt(arrTmp[2], 10) - 543;
					var end_month = arrTmp[1];
					var end_date = arrTmp[0];
					
					str_end_date = end_month + "/" + end_date + "/" + end_year;
				}else{
					//alert("กรุณาระบุ ถึงวันที่");
					form1.ABS_DAY.value = "";
					form1.ABS_ENDDATE.focus();
					return false;
				} // end if
				if(str_ab_code==""){
					//alert("กรุณาเลือกประเภทการลา");
					form1.ABS_DAY.value = "";
					form1.ab_name_btt.focus();
					return false;
					}
				var STARTPERIOD = 0;
				var objRadio = form1.ABS_STARTPERIOD;
				STARTPERIOD = objRadio.options[objRadio.selectedIndex].value;
		
				var ENDPERIOD = 0;
				var objRadio = form1.ABS_ENDPERIOD;
				ENDPERIOD = objRadio.options[objRadio.selectedIndex].value;
				alert(form1.holiday_extra.value);
				if((form1.ABS_DAY.value == "" || form1.ABS_DAY.value == "0") && form1.holiday_extra.value == 0){
						alert("จำนวนวันลาไม่ถูกต้อง กรุณาตรวจสอบจำนวนวันลาอีกครั้ง");
						form1.butt_calc_absent.focus();
						return false;
					}
					var hol_exday = form1.holiday_extra.value;
					var abs_day_ = form1.ABS_DAY.value;
					var abs_day_old = form1.ABS_DAY_OLD.value;
					
					if(form1.EDIT_ABSENT_DAY.value == "Y" && abs_day_!= abs_day_old){
						if(confirm('จำนวนวันลาทั้งหมด ' +form1.ABS_DAY.value+' วัน ท่านยืนยันจำนวนวันลาดังกล่าวใช่หรือไม่?\nคลิกปุ่ม [OK] เพื่อยืนยันบันทึกข้อมูล\nคลิกปุ่ม [Cancel] เพื่อกลับไปตรวจสอบข้อมูลอีกครั้ง')){
							form1.command.value = "ADD";

							form1.submit();	
						}else{
						
							if(hol_exday > 0 ){
							 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+1,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
							return false;	
							}
						}
					}else{
						if(hol_exday > 0 ){//ถ้ามีวันหยุดราชการ และ เป็นเจ้าตัว
							 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+0,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
						return false;	
						}
						form1.command.value = "ADD";
						form1.submit();	
					}
				
				
				//alert(STARTPERIOD+'+++'+ENDPERIOD);	
				//document.all.PROCESS_IFRAME.src = "find_absent_day.html?linkfrom=personal_absenthis&chkSave=" + chkSave + "&PER_ID=" + form1.PER_ID.value + "&ABS_ID=" + form1.ABS_ID.value + "&AB_CODE=" + form1.AB_CODE.value + "&AB_COUNT=" + form1.AB_COUNT.value + "&STARTDATE=" + form1.ABS_STARTDATE.value + "&STARTPERIOD=" + STARTPERIOD + "&ENDDATE=" + form1.ABS_ENDDATE.value + "&ENDPERIOD=" + ENDPERIOD + "&VAR_DAY=ABS_DAY&command=" + form1.command.value;
						/*if(document.getElementById('ABS_DAY').value!=''){
							alert(document.getElementById('ABS_DAY').value);
						}*/
						
		/*
		//		alert(str_start_date + " vs " + str_end_date);
				var dayNum = calcDBD(str_start_date, str_end_date);
		//		var dayNum = myDBD(str_start_date, str_end_date);
				if(dayNum == false || dayNum == "false"){ 
					return false;
				}else{ 
					for (var i=0; i<3; i++) {
						if ((i == 0 || i == 1) && (form1.ABS_STARTPERIOD[i].checked == true))
							dayNum -= 0.5;
						if ((i == 0 || i == 1) && (form1.ABS_ENDPERIOD[i].checked == true))
							dayNum -= 0.5;				
					}
					form1.ABS_DAY.value = dayNum;
					return true;
				} // end if
		*/
			} //end if
	}	
	
	
	function calcDaysBetweenDateNew(chkSave){
		var str_start_date = form1.ABS_STARTDATE.value;
		var str_end_date = form1.ABS_ENDDATE.value;
		var str_ab_code = form1.AB_CODE.value;

		 if(compare_diff_date(str_start_date, str_end_date)==false){
				alert('กรุณาระบุ ถึงวันที่ ใหม่ ต้องมีค่ามากกว่า ตั้งแต่วันที่');
				form1.ABS_ENDDATE.focus();
				return false;
		}else{ 		
				if(str_start_date){
					var arrTmp = str_start_date.split("/");
					var start_year = parseInt(arrTmp[2], 10) - 543;
					var start_month = arrTmp[1];
					var start_date = arrTmp[0];
					
					str_start_date = start_month + "/" + start_date + "/" + start_year;
				}else{
					//alert("กรุณาระบุ ตั้งแต่วันที่");
					form1.ABS_DAY.value = "";
					form1.ABS_STARTDATE.focus();
					return false;
				} // end if
		
				if(str_end_date){
					var arrTmp = str_end_date.split("/");
					var end_year = parseInt(arrTmp[2], 10) - 543;
					var end_month = arrTmp[1];
					var end_date = arrTmp[0];
					
					str_end_date = end_month + "/" + end_date + "/" + end_year;
				}else{
					//alert("กรุณาระบุ ถึงวันที่");
					form1.ABS_DAY.value = "";
					form1.ABS_ENDDATE.focus();
					return false;
				} // end if
				if(str_ab_code==""){
					//alert("กรุณาเลือกประเภทการลา");
					form1.ABS_DAY.value = "";
					form1.ab_name_btt.focus();
					return false;
					}
				var STARTPERIOD = 0;
				var objRadio = form1.ABS_STARTPERIOD;
				STARTPERIOD = objRadio.options[objRadio.selectedIndex].value;
		
				var ENDPERIOD = 0;
				var objRadio = form1.ABS_ENDPERIOD;
				ENDPERIOD = objRadio.options[objRadio.selectedIndex].value;
				//alert(STARTPERIOD+'+++'+ENDPERIOD);	
				if(form1.ABS_STARTDATE.value!='' && form1.ABS_ENDDATE.value!=''){
					document.all.PROCESS_IFRAME.src = "find_absent_day.html?linkfrom=personal_absenthis&chkSave=" + chkSave + "&PER_ID=" + form1.PER_ID.value + "&ABS_ID=" + form1.ABS_ID.value + "&AB_CODE=" + form1.AB_CODE.value + "&AB_COUNT=" + form1.AB_COUNT.value + "&STARTDATE=" + form1.ABS_STARTDATE.value + "&STARTPERIOD=" + STARTPERIOD + "&ENDDATE=" + form1.ABS_ENDDATE.value + "&ENDPERIOD=" + ENDPERIOD + "&VAR_DAY=ABS_DAY&command=" + form1.command.value;
				}
			} //end if
	}		
	
	function call_search_absenttype (code, name) {	
		parameter = "&PER_GENDER=<?=$PER_GENDER; ?>";
		ab_code = eval("form1." + code);
		ab_name = eval("form1." + name);
	    call_openDialog("search_absenttype.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"ประเภทการลา");		
	}
	
	function checkadd() {
		if(form1.ABS_STARTDATE.value=="") {
			alert("กรุณาระบุ ตั้งแต่วันที่");
			form1.ABS_STARTDATE.focus();
			return false;
		} else if(form1.ABS_ENDDATE.value=="") {
			alert("กรุณาระบุ ถึงวันที่");
			form1.ABS_ENDDATE.focus();
			return false;
		} else if(compare_diff_date(form1.ABS_STARTDATE.value, form1.ABS_ENDDATE.value)==false){
			alert('กรุณาระบุ ถึงวันที่ ใหม่ ต้องมีค่ามากกว่า ตั้งแต่วันที่');
			form1.ABS_ENDDATE.focus();
			return false;
		} else if(form1.AB_NAME.value=="") {
			alert("กรุณาระบุ ประเภทการลา");
			form1.AB_NAME.focus();
			return false;
		} 
		
		if(form1.HID_count_duplicate_date.value == "1"){
			alert("พบข้อมูลการลาในวันที่ต้องการลาแล้ว กรุณาเลือกวันที่ใหม่อีกครั้ง\nกรณีที่ได้มีการยกเลิกวันลาไปแล้ว ต้องได้รับการอนุมัติการยกเลิกวันลาก่อน จึงจะทำการลาในวันดังกล่าวได้");
			return false;
		}
			
		if((form1.ABS_DAY.value == "" || form1.ABS_DAY.value == "0") && form1.holiday_extra.value == 0){
			alert("จำนวนวันลาไม่ถูกต้อง กรุณาตรวจสอบจำนวนวันลาอีกครั้ง");
			form1.butt_calc_absent.focus();
			return false;
		}
		
					var hol_exday = form1.holiday_extra.value;
					var abs_day_ = form1.ABS_DAY.value;
					var abs_day_old = form1.ABS_DAY_OLD.value;
					
					if(form1.EDIT_ABSENT_DAY.value == "Y" && abs_day_!= abs_day_old){
						if(confirm('จำนวนวันลาทั้งหมด ' +form1.ABS_DAY.value+' วัน ท่านยืนยันจำนวนวันลาดังกล่าวใช่หรือไม่?\nคลิกปุ่ม [OK] เพื่อยืนยันบันทึกข้อมูล\nคลิกปุ่ม [Cancel] เพื่อกลับไปตรวจสอบข้อมูลอีกครั้ง')){
							form1.command.value = "ADD";

							form1.submit();	
						}else{
						
							if(hol_exday > 0 ){
							 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+1,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
							return false;	
							}
						}
					}else{
						if(hol_exday > 0 ){//ถ้ามีวันหยุดราชการ และ เป็นเจ้าตัว
							 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+0,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
						return false;	
						}
						form1.command.value = "ADD";
						form1.submit();	
					}
			

		
	}
	
	function chkOverNumDay(){
		var bgnArray = form1.ABS_STARTDATE.value.split("/");
		var endArray = form1.ABS_ENDDATE.value.split("/");
		sDate = new Date(bgnArray[2]-543,bgnArray[1]-1,bgnArray[0]); 
		eDate = new Date(endArray[2]-543,endArray[1]-1,endArray[0]); 
		var daysDiff = Math.round((eDate-sDate)/86400000) + 1;

		
		var HID_ABS_DAY = form1.HID_ABS_DAY.value;
		var ABS_DAY = form1.ABS_DAY.value;
		if(parseInt(ABS_DAY) < parseInt(HID_ABS_DAY)){
			alert("ระบุจำนวนวัน ต้องไม่น้อยกว่า จำนวนวันทำการที่เลือกลา");
			form1.ABS_DAY.value = '';
			form1.ABS_DAY.focus();
			return false;
			
		}
		
		if(parseInt(ABS_DAY) > parseInt(daysDiff)){
			alert("ระบุจำนวนวัน ต้องไม่มากกว่า จำนวนวันที่เลือกลา");
			form1.ABS_DAY.value = '';
			form1.ABS_DAY.focus();
			return false;
			
		}
		
		
		
	}

	function checkupdate() {
		if(form1.ABS_STARTDATE.value=="") {
			alert("กรุณาระบุ ตั้งแต่วันที่");
			form1.ABS_STARTDATE.focus();
			return false;
		} else if(form1.ABS_ENDDATE.value=="") {
			alert("กรุณาระบุ ถึงวันที่");
			form1.ABS_ENDDATE.focus();
			return false;
		} else if(compare_diff_date(form1.ABS_STARTDATE.value, form1.ABS_ENDDATE.value)==false){
			alert('กรุณาระบุ ถึงวันที่ ใหม่ ต้องมีค่ามากกว่า ตั้งแต่วันที่');
			form1.ABS_ENDDATE.focus();
			return false;
		} else if(form1.AB_NAME.value=="") {
			alert("กรุณาระบุ ประเภทการลา");
			form1.AB_NAME.focus();
			return false;
		} 
		
		if(form1.HID_count_duplicate_date.value == "1"){
			alert("พบข้อมูลการลาในวันที่ต้องการลาแล้ว กรุณาเลือกวันที่ใหม่อีกครั้ง\nกรณีที่ได้มีการยกเลิกวันลาไปแล้ว ต้องได้รับการอนุมัติการยกเลิกวันลาก่อน จึงจะทำการลาในวันดังกล่าวได้");
			return false;
		}
			
		if(form1.ABS_DAY.value == "" || form1.ABS_DAY.value == "0"){
			alert("จำนวนวันลาไม่ถูกต้อง กรุณาตรวจสอบจำนวนวันลาอีกครั้ง");
			form1.butt_calc_absent.focus();
			return false;
		}
		
		var hol_exday = form1.holiday_extra.value;
		var abs_day_ = form1.ABS_DAY.value;
		var abs_day_old = form1.ABS_DAY_OLD.value;
		
		if(form1.EDIT_ABSENT_DAY.value == "Y" && abs_day_!= abs_day_old){
			if(confirm('จำนวนวันลาทั้งหมด ' +form1.ABS_DAY.value+' วัน ท่านยืนยันจำนวนวันลาดังกล่าวใช่หรือไม่?\nคลิกปุ่ม [OK] เพื่อยืนยันบันทึกข้อมูล\nคลิกปุ่ม [Cancel] เพื่อกลับไปตรวจสอบข้อมูลอีกครั้ง')){
				form1.command.value = "UPDATE";

				form1.submit();	
			}else{
			
				if(hol_exday > 0 ){
				 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+1,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
				return false;	
				}
			}
		}else{
			if(hol_exday > 0 ){//ถ้ามีวันหยุดราชการ และ เป็นเจ้าตัว
				 call_openDialogCenter("es_holiday_extra.html?PER_STARTDATE="+form1.ABS_STARTDATE.value+"&PER_ENDDATE="+form1.ABS_ENDDATE.value+"&TYPE="+0,800,600,'กรณีลาตรงกับวันหยุดพิเศษ');
			return false;	
			}
		form1.command.value = "UPDATE";
		form1.submit();	
		}
		
	}

	function checkCalDay(){
			alert('กรุณากดปุ่มคำนวณวัน หลังเลือกวันเริ่มต้น และสิ้นสุดวันลาด้วย');
			form1.ABS_DAY.focus();
			form1.butt_calc_absent.focus(); 
	return false;
	}
		
	function call_menu_desc (cate, id, name, per_id) {	
		var ulink = cfile+'?CATEGORY='+cate+'&PER_ID='+ per_id+'&UPFOR='+name+'&LAST_SUBDIR='+id;		
		parameter = "";
		MM_openBrWindow(ulink+"&MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>&HIDE_HEADER=1<?=($MAIN_VIEW?"&MAIN_VIEW=1":"")?>&getdate=<?=date('YmdHis')?>" + parameter,'moreeditor','toolbar=no,location=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=950,height=1200');
	}

	function setLayer(layerID){
		if(document.getElementById(layerID)){
			if(document.getElementById(layerID).style.display=='none'){
				document.getElementById(layerID).style.display='block';	
			}else{
				document.getElementById(layerID).style.display='none';
			}
			if(document.getElementById(layerID).style.visibility=='hidden'){
				document.getElementById(layerID).style.visibility='visible';
			}else{
				document.getElementById(layerID).style.visibility='hidden';
			}
		}
	}
	
	function call_sort(flag) {
		form1.order_by.value=flag;		form1.sort_by.value=flag;
		if(form1.sort_type.value==flag+":asc"){
			form1.sort_type.value=flag+":desc";
		}else{ //desc
			form1.sort_type.value=flag+":asc";
		}		
		form1.command.value='SEARCH';
		form1.submit();
	} // end function call_sort
	
	function set_check_all(ischecked,name,count_data){
		for(var i=1; i <= count_data; i++){	
			if(ischecked==true){
				if(eval(document.getElementById(name+i)))	eval(document.getElementById(name+i)).checked=true;
			}else{
				if(eval(document.getElementById(name+i)))	eval(document.getElementById(name+i)).checked=false;
			}
		}
	}
	
	function set_uncheck_all(ischecked,name,id){
		if(ischecked==false && name.checked==true)		name.checked=false;
	}

	function returnFrom(src, returnValue){
//		alert("src="+src+"("+returnValue+")");
		 if  (src.indexOf("search_absenttype") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				ab_code.value = arrValue[0];
				ab_name.value = arrValue[1];
				document.form1.AB_COUNT.value = arrValue[2];
				if(ab_code.value.trim() == "10"){
					document.form1.ABS_STARTPERIOD[2].checked = true;
					document.form1.ABS_ENDDATE.value = document.form1.ABS_STARTDATE.value;
					document.form1.ABS_ENDPERIOD[2].checked = true;
				}else{
					document.form1.ABS_STARTPERIOD[0].disabled = false;
					document.form1.ABS_STARTPERIOD[1].disabled = false;
					document.form1.ABS_STARTPERIOD[2].disabled = false;
					document.form1.ABS_ENDDATE.disabled = false;
					document.form1.ABS_ENDPERIOD[0].disabled = false;
					document.form1.ABS_ENDPERIOD[1].disabled = false;
					document.form1.ABS_ENDPERIOD[2].disabled = false;
					document.form1.btn_enddate.disabled = false;
				} // end if
				calcDaysBetweenDateNew(0);
			} // end if
		}else if  (src.indexOf("es_holiday_extra") > -1) {//วันหยุดพิเศษ
				if(returnValue){
					   arrValue = returnValue.split("<::>");
						if(arrValue[0] < parseInt(0)){//ตอบ YES เลือก ตกลง
							form1.ABS_DAY.value = form1.work_day.value;
							if(form1.ABS_DAY.value == "" || form1.ABS_DAY.value <= "0" ){
								alert("วันที่ท่านยื่นใบลา ระบบกำหนดให้เป็นวันหยุดโดยท่านไม่ต้องยื่นใบลา");
								return false;
							}
								if(!form1.ABS_ID.value)	form1.command.value = "ADD";
							else if(form1.ABS_ID.value)		form1.command.value = "UPDATE";
								 
						}else{//ตอบ NO เลือก ตกลง
								form1.holiday_extra.value = arrValue[0];
								if((form1.ABS_DAY.value == "" || form1.ABS_DAY.value <= "0") && form1.holiday_extra.value == 0){
									alert("จำนวนวันลาไม่ถูกต้อง กรุณาตรวจสอบจำนวนวันลาอีกครั้ง");
									form1.butt_calc_absent.focus();
									return false;
								}
								
									form1.ABS_DAY.value = parseInt(form1.holiday_extra.value)+parseInt(form1.work_day.value); 
							
								 if(!form1.ABS_ID.value)		form1.command.value = "ADD";
							else if(form1.ABS_ID.value)		    form1.command.value = "UPDATE";
								
						}
				}	
					form1.submit();	
			} 		
//		$( "#d_frame" )[0].src="";
//		alert("returnValue="+tt.value);
//		tt.value = returnValue;
	} // end if
	
        
        
        function call_export_file() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = 'ประวัติการลา ';
		document.form1.target = "_blank";
		document.form1.action = "report/rpt_personal_absenthis_xls.php?report_title=" + report_title + "&UTC" + rptDate;
                document.form1.PER_NAME.value = document.form1.PER_NAME.value;
                document.form1.PER_ID.value = document.form1.PER_ID.value;
                
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "personal_absenthis.html";
	}
</script>
<?  //เช็คปุ่มที่ได้ค่าออกมา ว่าเป็นปุ่มเพิ่มหรือแก้ไข 
	if($PAGE_AUTH["edit"]=="Y" && $UPD) 
	$Submit = "Submit_edit";
	else if(!$VIEW && $PAGE_AUTH["add"]=="Y") 
	$Submit = "Submit_add";    
?>
<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<? if (!$HIDE_HEADER) { ?>
	<tr>
    	<td height="10"><?include("header_menu.html")?></td>
  	</tr>
	<? } ?>
    	<tr> 
	  <td align="left" valign="top">
<?	
		$OPTIONAL_TITLE="".(($HIDE_HEADER)?"ข้อมูลการลา":"") ;
		if ($UPD) $OPTIONAL_TITLE.=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE.=" &gt; ดูข้อมูล";
		$setPerStyle="display:none; visibility:hidden";
                if($DisableTimeAtt=="CLOSE"){
                    $setPerStyle="display:block; visibility:visible";
                }

		if($UPD||$VIEW||($BKK_FLAG==1&&$ADD_NEXT==1)){ $setPerStyle="display:block; visibility:visible"; }
		include("current_location.html");
?>
	  </td>	</tr>
  	<tr>
    	<td align="left" valign="top"><form name="form1" method="post" action="personal_absenthis.html" enctype="multipart/form-data">
          <input type="hidden" name="current_page" value="<?=$current_page?>">
          <input type="hidden" name="total_page" value="<?=$total_page?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
		  <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3?>">
          <input type="hidden" name="command" value="">
          <input type="hidden" name="PER_ID" value="<?=$PER_ID?>">
          <input type="hidden" name="ABS_ID" value="<?=$ABS_ID?>">
          <input type="hidden" name="HIDE_HEADER" value="<?=$HIDE_HEADER?>">	   
          <input type="hidden" name="EDIT_ABSENT_DAY" value="<?=$EDIT_ABSENT_DAY;?>">
		  <input type="hidden" name="ABS_DAY_OLD" value="0" style="text-align:right" class="textbox" onkeypress="return DigitOnly();" onchange="return chkOverNumDay();">
&nbsp;<table width="90%"  border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
  <tr>
    <td align="center"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
      <tr>
        <td width="15%" height="22" align="right"><?=$FULLNAME_TITLE?>&nbsp;:&nbsp;</td>
        <td align="center"><input type="text" name="PER_NAME" value="<?=$PER_NAME?>" style="width:98%" class="textbox" readonly></td>
        <td width="20%" height="22" align="right"><?=$CARDNO_TITLE?>&nbsp;:&nbsp;</td>
        <td align="center"><input type="text" name="PER_CARDNO" value="<?=$PER_CARDNO?>" style="width:98%" class="textbox" readonly></td>
        <td width="25%">	<? if (!$HIDE_HEADER) { ?>
          &nbsp;<? if ($BUTTON_DISPLAY==1) { ?>
		  <input name="BackBtn" type="button" class="button" value="<?=$SELECT_PERSON_TITLE?>" onClick="javascript:window.location='personal_master.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>&SEARCHHIS=personal_absenthis'"><!--history.back(); --><?  } else {  echo "&nbsp; &nbsp;"; ?>
              <img src="images/select_person.png" alt="<?=$SELECT_PERSON_TITLE?>" width="32" height="32" border="0" onClick="javascript:window.location='personal_master.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>&SEARCHHIS=personal_absenthis'">
              <? } echo "&nbsp; &nbsp;"; ?>
		  <? } ?></td>
      </tr>
    </table></td>
  </tr>
</table>
&nbsp;
<table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td>
              <?php
              if($show_btn_add){
              ?>
              <table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
		  <tr>
		  	<td height="22" align="center" class="table_body" onClick="javascript:setLayer('id_absenthis');">
                            <?=($UPD)?"แก้ไข":$ADDTAB_TITLE?>ข้อมูล
                        </td>
		  </tr>		
	  </table>
               <?php }?>
          </td>
	</tr>
  </table>

  <table id="id_absenthis" width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table" style="<?=$setPerStyle; ?>"
  onKeyPress="return keyEnter(event,document.form1.<?=$Submit?>);"
>
    <tr>
      <td><table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
        <tr>
          <td height="5"></td>
          </tr>
        <tr>
          <td height="22" align="center"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
            <tr>
              <td align="right" height="22">&nbsp;<span class="label_alert">*</span>&nbsp;<?=$FROM_DATE_TITLE;?>&nbsp;:&nbsp;</td>
              <td><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                <tr>
                  <td width="50%" height="22"><input type="text" name="ABS_STARTDATE" id="ABS_STARTDATE" value="<?=$ABS_STARTDATE?>" style="width:100%" class="textbox" onChange="return calcDaysBetweenDateNew(0);" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.ABS_STARTDATE,this.value)" <?=($PER_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y"))?"":"readonly"?>></td>
                  <td>&nbsp;<? if($PER_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                    <input type="button" name="btn_startdate" class="button" onClick="return showCalendar('ABS_STARTDATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');" value="<?=$SELECT_TITLE?>">
                    <? endif; ?>
			&nbsp;<select name="ABS_STARTPERIOD" class="selectbox" onChange="return calcDaysBetweenDateNew(0);">
			  <option value="1" <?=($ABS_STARTPERIOD==1)?"selected":""?>>&nbsp;ครึ่งวันเช้า</option>
			  <option value="2" <?=($ABS_STARTPERIOD==2)?"selected":""?>>&nbsp;ครึ่งวันบ่าย</option>
			  <option value="3" <?=($ABS_STARTPERIOD==3)?"selected":""?>>&nbsp;ทั้งวัน</option>
			</select>
			</td>
                </tr>
              </table>		</td>
		<td align="right">&nbsp;</td>
		<td>&nbsp;</td>
              </tr>
            <tr>
              <td align="right" height="22">&nbsp;<span class="label_alert">*</span>&nbsp;<?=$TO_DATE_TITLE; ?>&nbsp;:&nbsp;</td>
              <td><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                <tr>
                  <td width="50%" height="22"><input type="text" name="ABS_ENDDATE" id="ABS_ENDDATE" onChange="return calcDaysBetweenDateNew(0);" value="<?=$ABS_ENDDATE?>" style="width:100%" class="textbox" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.ABS_ENDDATE,this.value);" <?=($PER_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y"))?"":"readonly"?>></td> <!-- check วันที่สิ้นสุดๆไม่ให้ < วันที่เริ่มต้น-->
                  <td>&nbsp;<? if($PER_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
                    <input type="button" name="btn_enddate" class="button" onClick="return showCalendar('ABS_ENDDATE', 'dd/mm/y', '<?=$SESS_HOLIDAY?>', 'confirm');"  value="<?=$SELECT_TITLE?>">
                    <? endif; ?>
			&nbsp;<select name="ABS_ENDPERIOD" class="selectbox" onChange="return calcDaysBetweenDateNew(0);">
			  <option value="1" <?=($ABS_ENDPERIOD==1)?"selected":""?>>&nbsp;ครึ่งวันเช้า</option>
			  <option value="2" <?=($ABS_ENDPERIOD==2)?"selected":""?>>&nbsp;ครึ่งวันบ่าย</option>
			  <option value="3" <?=($ABS_ENDPERIOD==3)?"selected":""?>>&nbsp;ทั้งวัน</option>
			</select>
			</td>
                </tr>
              </table>		</td>
		<td align="right">&nbsp;</td>
		<td>&nbsp;	</td>
              </tr>
            <tr>
              <td width="17%" height="22" align="right">&nbsp;<span class="label_alert">*</span>&nbsp;ประเภทการลา&nbsp;:&nbsp;</td>
              <td width="33%"><table width="100%"  border="0" cellpadding="0" cellspacing="0" class="label_normal">
                <tr>
                  <td width="70%" height="22"><input type="text" name="AB_NAME" value="<?=$AB_NAME?>" style="width:100%" class="textbox" readonly>
		    		<input type="hidden" name="AB_CODE" value="<?=$AB_CODE?>"></td>
                  <td width="30%">&nbsp;
				  	<? if($PER_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
				  	<input type="button" name="ab_name_btt" class="button" value="<?=$SELECT_TITLE?>" alt="เลือกประเภทการลา" onClick="call_search_absenttype('AB_CODE', 'AB_NAME');">
				<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.AB_NAME.value=''; form1.AB_CODE.value=''; return false;" align="center" alt="ล้างค่า">
				  	<? endif; ?>
					<input type="hidden" name="AB_COUNT" value="<?=$AB_COUNT?>">				  </td>
                </tr>
              </table></td>
              <td width="10%" align="right">&nbsp;<span class="label_alert">*</span>&nbsp;จำนวนวัน&nbsp;:&nbsp;</td>
              <td width="40%"><input type="text" name="ABS_DAY" id="ABS_DAY" value="<?=$ABS_DAY?>" maxlength="6" style="width:50%" class="textbox" onChange="return chkOverNumDay();" onKeyPress="return NumOnly();" <?=($EDIT_ABSENT_DAY!="Y")?"readonly":"" ?>>&nbsp;
   				<? if($PER_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW) : ?>
   				<input type="button" class="button" name="butt_calc_absent" value="คำนวณวัน" onClick="return calcDaysBetweenDateNew(0);">
   				<? endif; ?>
                <input type="hidden" name="HID_ABS_DAY" value="<?=$HID_ABS_DAY;?>">
                <input type="hidden" name="HID_count_duplicate_date" value="0">
                                <!--
                                <input type="button" class="button" name="butt_calc_absentV2" value="คำนวณวัน[Test..]" onClick="calcDaysBetweenDateV2()">
                                -->
              </td>
            </tr>		
			<tr>
              <td height="22" align="right"><?=$REMARK_TITLE;?>&nbsp;:&nbsp;</td>
              <td colspan=3>
			<input type="text" name="ABS_REMARK" value="<?=$ABS_REMARK?>" style="width:92%" class="textbox" <?=($PER_ID && ($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y"))?"":"readonly"?>>
			</td>
			</tr>
            <tr>
              <td align="right"><?=$UPDATE_USER_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input name="SHOW_UPDATE_USER" type="text" style="width:80%" class="textbox" value="<?=$SHOW_UPDATE_USER?>" readonly></td>
              <td align="right"><?=$UPDATE_DATE_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input name="SHOW_UPDATE_DATE" type="text" style="width:80%" class="textbox" value="<?=$SHOW_UPDATE_DATE?>" readonly></td>
            </tr>
            <tr>
              <td align="right">หมายเหตุ&nbsp;:&nbsp;</td>
              <td align="justify" colspan="3">&nbsp;<span class="label_alert">1. ถ้าต้องลาครึ่งเช้า (วันที่ 1) และครึ่งเช้า (วันที่ 2) ต้องทำรายการการลา 2 รายการ<br>
			  &nbsp;2. ถ้าต้องลาครึ่งเช้า (วันที่ 1) และครึ่งบ่าย (วันที่ 2) ต้องทำรายการการลา 2 รายการ </span>
			  </td>
            </tr>
            <tr>
                <td align="right" bgcolor="#FBFBEF" ></td>
                <td colspan="3" bgcolor="#FBFBEF">
                    <label id="LblBetween"></label>
                </td>
            </tr>
			<tr>
				<input type="hidden" name="holiday_extra" id="holiday_extra" value="0">
				<input type="hidden" name="work_day" id="work_day" value="0">
				<td colspan="4"><hr style="width: 98%"></td>
            </tr>
            <tr>
                <td colspan="4"><hr style="width: 98%"></td>
            </tr>
						 <tr>
						  <td height="22" align="right"><?=$YEAR_TITLE?>&nbsp;:&nbsp;</td>
						  <td><input type="text" name="AS_YEAR" value="<?=$AS_YEAR?>" size="10" readonly></td>
   				<? if($MFA_FLAG==1) { ?> 
              <td width="10%" align="right">จำนวนวันลาพักผ่อนพิเศษ&nbsp;:&nbsp;</td>
              <td width="40%"><input type="text" name="ABS_DAY_MFA" value="<?=$ABS_DAY_MFA?>" maxlength="6" style="width:50%" class="textbox" onKeyPress="return NumOnly();"></td>
   				<? } ?>				  
					</tr>
                                       
					<tr>						  
                        <td align="right" height="22">รอบการลา&nbsp;:&nbsp;</td>
                        <td nowrap="nowrap" colpan="4">
						  <input type="radio" name="AS_CYCLE" value="1"  disabled <?=($AS_CYCLE==1)?"checked":""?>> ครั้งที่ 1
                          <input type="text" name="START_DATE_1" value="<?=$START_DATE_1?>" class="textbox" readonly>						  
                          &nbsp;ถึง&nbsp;
						  <input type="text" name="END_DATE_1" value="<?=$END_DATE_1?>" class="textbox" readonly>						</td>
                          <td ></td>
                          <td ></td>
                      </tr>
					<tr>						  
                        <td align="right" height="22"></td>
                        <td nowrap="nowrap"><input type="radio" name="AS_CYCLE" value="2"  disabled <?=($AS_CYCLE==2)?"checked":""?>> ครั้งที่ 2
						  <input type="text" name="START_DATE_2" value="<?=$START_DATE_2?>" class="textbox" readonly>
						  &nbsp;ถึง&nbsp;
						  <input type="text" name="END_DATE_2" value="<?=$END_DATE_2?>" class="textbox" readonly></td>
                          <td ></td>
                          <td ></td>
                      </tr>
                      
                        
					<tr>
					  <td width="16%" align="right"  nowrap="nowrap">ประเภทการลา&nbsp;&nbsp;&nbsp;&nbsp;</td>
					  <td width="16%" align="left" nowrap="nowrap">&nbsp;&nbsp;&nbsp;&nbsp;รอบนี้ (วัน)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;รวม (วัน)&nbsp;&nbsp;&nbsp;รอบนี้ (ครั้ง)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;รวม (ครั้ง)</td>
					  <td width="16%" align="left" nowrap="nowrap">วันที่ลาล่าสุด</td>
					  <td width="16%" align="left" nowrap="nowrap">วันที่ลาล่าสุด (ล่วงหน้า)</td>
					</tr>
					<tr>
					  <td  align="right">ป่วย&nbsp;:&nbsp;</td>
					  <td><input type="text" name="AB_CODE_01" value="<?=$AB_CODE_01?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="SUM_CODE_01" value="<?=$SUM_CODE_01?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="AB_COUNT_01" value="<?=$AB_COUNT_01?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="SUM_COUNT_01" value="<?=$SUM_COUNT_01?>" style="text-align:right" class="textbox" size="10" readonly>
					  </td>
					  <td><input type="text" name="ABS_DATE_01" value="<?=$ABS_DATE_01?>" class="textbox" size="10" readonly></td>
					  <td><input type="text" name="LAST_DATE_01" value="<?=$LAST_DATE_01?>" class="textbox" size="10" readonly></td>
					</tr>
					<tr>
					  <td  align="right">กิจส่วนตัว&nbsp;:&nbsp;</td>
					  <td><input type="text" name="AB_CODE_03" value="<?=$AB_CODE_03?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="SUM_CODE_03" value="<?=$SUM_CODE_03?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="AB_COUNT_03" value="<?=$AB_COUNT_03?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="SUM_COUNT_03" value="<?=$SUM_COUNT_03?>" style="text-align:right" class="textbox" size="10" readonly>
					  </td>
					  <td><input type="text" name="ABS_DATE_03" value="<?=$ABS_DATE_03?>" class="textbox" size="10" readonly></td>
					  <td><input type="text" name="LAST_DATE_03" value="<?=$LAST_DATE_03?>" class="textbox" size="10" readonly></td>
					</tr>
					<tr>
					  <td  align="right">คลอดบุตร&nbsp;:&nbsp;</td>
					  <td><input type="text" name="AB_CODE_02" value="<?=$AB_CODE_02?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="SUM_CODE_02" value="<?=$SUM_CODE_02?>" style="text-align:right" class="textbox" size="10" readonly>
					  </td>
					  <td><input type="text" name="ABS_DATE_02" value="<?=$ABS_DATE_02?>" class="textbox" size="10" readonly></td>
					  <td><input type="text" name="LAST_DATE_02" value="<?=$LAST_DATE_02?>" class="textbox" size="10" readonly></td>
					</tr>
					<tr>
					  <td  align="right">พักผ่อน&nbsp;:&nbsp;</td>
					  <td><input type="text" name="AB_CODE_04" value="<?=$AB_CODE_04?>" style="text-align:right" class="textbox" size="10" readonly>
					  <input type="text" name="SUM_CODE_04" value="<?=$SUM_CODE_04?>" style="text-align:right" class="textbox" size="10" readonly>
					  </td>
					  <td><input type="text" name="ABS_DATE_4" value="<?=$ABS_DATE_04?>" class="textbox" size="10" readonly></td>
					  <td><input type="text" name="LAST_DATE_4" value="<?=$LAST_DATE_04?>" class="textbox" size="10" readonly></td>
					</tr>
					<tr>
					  <td  align="right">จำนวนวันที่ลาพักผ่อนได้&nbsp;:&nbsp;<!--ใน<?=$YEAR_TITLE?>--></td>
					  <td><input type="text" name="AB_COUNT_TOTAL_04" value="<?=$AB_COUNT_TOTAL_04?>" style="text-align:right" class="textbox" readonly></td>
					  <td>จำนวนวันลาพักผ่อนคงเหลือ&nbsp;:&nbsp;</td>
					  <td><input type="text" name="AB_COUNT_04" value="<?=$AB_COUNT_04?>" style="text-align:right" class="textbox" readonly></td>
					   <input type="hidden" name="CHK_NEXTYEAR" value="0">
                       <input type="hidden" name="AB_COUNT_04_NEXTYEAR" value="0">
					</tr>
          </table></td>
        </tr>
        <tr>
          <td height="5" align="center"><iframe src="javascript:;" id="PROCESS_IFRAME" frameborder="0" height="5" scrolling="no"></iframe></td>
        </tr>
		<? if($PER_ID) : ?>
        <tr align="center">
          <td height="25">
		  		<? if ($UPD || $VIEW) { ?>
      		  <?if($PAGE_AUTH["edit"]=="Y" && $UPD){?>
			  <? if ($BUTTON_DISPLAY==1) { ?>
				  <? if ($MFA_FLAG==1) { ?>
				  <input name="Submit_edit" type="submit" class="button" onClick="return checkupdate();"  value="<?=$EDIT_TITLE?>">
				  <?  } else { /*onMouseOver="calcDaysBetweenDate(1)"*/ ?>
				  <input name="Submit_edit" type="submit" class="button"  onClick="return checkupdate();"  value="<?=$EDIT_TITLE?>">
				  <?}?> 
			  <?  } else { ?>
				  <? if ($MFA_FLAG==1) { ?>
	              <input name="image2" type="image" onClick="return checkupdate();"  src="images/save.png" alt="<?=$EDIT_TITLE?>">
				  <?  } else { ?>
	              <input name="image2" type="image"  onClick="return checkupdate();"  src="images/save.png" alt="<?=$EDIT_TITLE?>">
				  <?}?> 
              <? } echo "&nbsp; &nbsp;";?>
      		  <?}?> 
				<? if ($BUTTON_DISPLAY==1) { ?>
              <input type="submit" name="Reset2" value="<?=$CANCEL_TITLE?>" onClick="form1.command.value='CANCEL'; form1.ABS_ID.value='';" class="button" >
              <?  } else { ?>
              <input name="image2" type="image" onClick="form1.command.value='CANCEL'; form1.ABS_ID.value='';" src="images/cancel.gif" alt="<?=$CANCEL_TITLE?>">
              <? } echo "&nbsp; &nbsp;";?>
      		  <? } else { ?>
	  		  <?if($PAGE_AUTH["add"]=="Y"){?>
			  <? if ($BUTTON_DISPLAY==1) { ?>
				  <? if ($MFA_FLAG==1) { ?>
				  <input name="Submit_add" type="submit" class="button" onClick="return checkadd();"  value="<?=$ADD_TITLE?>">
				  <?  } else { ?>
				  <input name="Submit_add" type="submit" class="button"  onClick="return checkadd();"  value="<?=$ADD_TITLE?>">
				  <?}?> 
			  <?  } else { ?>
				  <? if ($MFA_FLAG==1) { ?>
	              <input name="image2" type="image" onClick="return checkadd();" src="images/save.png" alt="<?=$ADD_TITLE?>">
				  <?  } else { ?>
	              <input name="image2" type="image" onClick="return checkadd();" src="images/save.png" alt="<?=$ADD_TITLE?>">
				  <?}?> 
              <? } echo "&nbsp; &nbsp;";?>
	  		  <?}?> 
			  <? if ($BUTTON_DISPLAY==1) { ?>
      		  <input name="Reset" type="reset" class="button" value="<?=$CLEAR_TITLE?>"> 
      		  <?  } else { ?>
                  <img src="images/default.jpg" alt="<?=$CLEAR_TITLE?>" width="32" height="32" border="0" onClick="form1.reset();">
                  <? } echo "&nbsp; &nbsp;";?>
              <?}?>
              <?php 
          if($DisableTimeAtt=="CLOSE"){
            echo "<br><font color=red>มีการยืนยัน/ปิดรอบข้อมูลการลงเวลาของเดือนนี้ ไปแล้ว<br>หากต้องการทำรายการ กรุณาติดต่อ กจ. หรือผู้ดูแลข้อมูลประจำหน่วยงาน</font>";
          }
          ?>
          </td>
        </tr>
		<? endif; ?>
        <tr>
          <td height="5"></td></tr>
      </table></td>
    </tr>
  </table>
  <table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
<tr><td><input type="hidden" name="order_by" value="<?=$order_by?>">
    <input type="hidden" name="sort_by" value="<?=$sort_by;?>">
    <input type="hidden" name="sort_type" value="<?=$sort_type?>">
<?=$SORT_TITLE?></td>
</tr>
</table>
<table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
	<tr>
	  <td><table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
     <tr height="22">
         <td width="20%" > </td>
	<td width="60%" align="center">พบข้อมูลการลาทั้งสิ้น <?=($count_data + 0)?> รายการ </td>
        <td width="20%" align="right">
      <? $disable='';
      if(empty($count_data)){
        $disable='disabled';
      }
      
      if ($BUTTON_DISPLAY==1) { ?>
      <input <?php echo $disable;?> name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
      <?  } else { ?>
      <img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE?>" onClick="call_export_file();">
      <? } ?>
        </td>
     </tr>
   </table></td>
	</tr>
</table> 
  
<?
	if(!$sort_by) $sort_by=1;
	if(!$sort_type){	if ($PER_ORDER_BY==1) { $sort_type = "1:asc"; } else {  $sort_type = "1:desc"; }	}
	$arrSort=explode(":",$sort_type);
	$SortType[$arrSort[0]]	=$arrSort[1];
	if(!$order_by) $order_by=1;

	if($order_by==1){	//(ค่าเริ่มต้น) ตั้งแต่วันที่
		$order_str = "ORDER BY ABS_STARTDATE ".$SortType[$order_by];
  	}elseif($order_by==2) {	//ประเภทการลา
		$order_str = "ORDER BY AB_NAME $SortType[$order_by], ABS_STARTDATE $SortType[$order_by], ABS_ENDDATE $SortType[$order_by] ";
  	} elseif($order_by==3) {	//
		$order_str =  "ORDER BY ABS_ENDDATE  ".$SortType[$order_by];
	}elseif($order_by==4) {	//จำนวนวัน
		$order_str = "ORDER BY ABS_DAY ".$SortType[$order_by];
	}
	
	if($current_page > 1){
		if($DPISDB=="odbc"){
			$cmd = " select top $start_record trim(ABS_ID) as concat_pk from PER_ABSENTHIS pah, PER_ABSENTTYPE pat 
							where	PER_ID=$PER_ID and pah.AB_CODE=pat.AB_CODE $search_condition order by $order_by ";
			$db_dpis->send_cmd($cmd);
			while($data = $db_dpis->get_array()) $arr_exclude[] = "'".$data[concat_pk]."'";
			$limit_data = (trim($search_condition)?" and ":" where ")." trim(ABS_ID) not in (". implode(", ", $arr_exclude) .")";
		}elseif($DPISDB=="mysql"){
		  $limit_data = " limit " . (($current_page - 1) * $data_per_page) . ", " . $data_per_page;
		}
	}

	if($DPISDB=="odbc"){
		$cmd = " SELECT 		top  $data_per_page 
												ABS_ID, pah.AB_CODE, pat.AB_NAME, ABS_STARTDATE, ABS_STARTPERIOD, 
												ABS_ENDDATE, ABS_ENDPERIOD, ABS_DAY, AUDIT_FLAG, ABS_REMARK 
						 FROM			PER_ABSENTHIS pah, PER_ABSENTTYPE pat
						 WHERE		PER_ID=$PER_ID and pah.AB_CODE=pat.AB_CODE 
												$limit_data
							$order_str ";
	}elseif($DPISDB=="oci8"){	
		$rec_start = (($current_page-1) * $data_per_page) + 1;
		$rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
		$cmd = "select * from (
						   select rownum rnum, q1.* from ( 
								  select 		ABS_ID, pah.AB_CODE, pat.AB_NAME, ABS_STARTDATE, ABS_STARTPERIOD, 
								  					ABS_ENDDATE, ABS_ENDPERIOD, ABS_DAY, AUDIT_FLAG, ABS_REMARK   
								  from 		PER_ABSENTHIS pah, PER_ABSENTTYPE pat
								  where 		PER_ID=$PER_ID and pah.AB_CODE=pat.AB_CODE 
								  	$order_str  
						   )  q1
					) where rnum between $rec_start and $rec_end  ";	
	}elseif($DPISDB=="mysql"){
		$cmd = " SELECT 	ABS_ID, pah.AB_CODE, pat.AB_NAME, ABS_STARTDATE, ABS_STARTPERIOD, 
											ABS_ENDDATE, ABS_ENDPERIOD, ABS_DAY, AUDIT_FLAG, ABS_REMARK 
						 FROM		PER_ABSENTHIS pah, PER_ABSENTTYPE pat
						 WHERE		PER_ID=$PER_ID and pah.AB_CODE=pat.AB_CODE 
							$order_str  
					  		$limit_data ";
	} // end if
//echo '<pre>'.$cmd;
	$count_page_data = $db_dpis->send_cmd($cmd);
	//$db_dpis->show_error();
//	echo "page-list-absenthis-$cmd ($count_page_date)<br>";
	if ($count_page_data) {
?>
  <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
    <tr align="center" class="table_head">
	  <td width="7%" height="21"><strong><?=$SEQ_NO_TITLE;?></strong></td>
      <td height="25" onClick="call_sort(2);"><strong><? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?></strong>ประเภทการลา</td>
      <td width="13%" onClick="call_sort(1);"><strong><? if($order_by==1&&$sort_by==1){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?><?=$FROM_DATE_TITLE;?></strong></td>
      <td width="12%" onClick="call_sort(3);"><strong><? if($order_by==3&&$sort_by==3){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?></strong><?=$TO_DATE_TITLE; ?></td>
	<td width="8%" onClick="call_sort(4);"><strong><? if($order_by==4&&$sort_by==4){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?></strong>จำนวนวัน</td>
      <td width="13%" onClick="call_sort(5);"><strong><? if($order_by==5&&$sort_by==5){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?></strong><?=$REMARK_TITLE?></td>      
	<td width="4%"><?=$INQ_TITLE?></td>
      <?if($PAGE_AUTH["edit"]=="Y"){?><td width="4%"><?=$EDIT_TITLE?></td><?}?>
      <?if($PAGE_AUTH["del"]=="Y"){?><td width="4%"><?=$DEL_TITLE?></td><?}?>
	  <td width="4%">จำนวนไฟล์</td>
	   <?if($PAGE_AUTH["attach"]=="Y"){ ?><td width="4%"><?=$LOAD_TITLE?></td><? } ?>
      <?if(($PAGE_AUTH["edit"]=="Y" || $PAGE_AUTH["del"]=="Y") && $PAGE_AUTH["audit"]=="Y"){?><td width="4%"><?=$AUDIT_TITLE?><br><input type="checkbox" name="list_audit_all" value="1" onClick="set_check_all(this.checked,'list_audit_id',<?=$count_data; ?>);" <?=(($list_audit_all==1)?"checked":"")?>></td><?}?>
    </tr>
    <?
	$current_list = "";
	$data_count = $num_order = 0;
	if ($PER_ORDER_BY==1) $num_order = ($current_page - 1) * $data_per_page;
	else $num_order = $count_data - (($current_page - 1) * $data_per_page) + 1;	
	while ($data = $db_dpis->get_array()) {
		$data_count++;
		if ($PER_ORDER_BY==1) $num_order++;
		else $num_order--;
		if($data_count > $data_per_page) break;
		$TMP_ABS_ID = $data[ABS_ID];
		$current_list .= ((trim($current_list))?",":"") . $TMP_ABS_ID;
		$TMP_ABS_NAME = $data[ABS_NAME];
		$TMP_ABS_STARTDATE = show_date_format($data[ABS_STARTDATE], $DATE_DISPLAY);
		$TMP_ABS_ENDDATE = show_date_format($data[ABS_ENDDATE], $DATE_DISPLAY);
		//$TMP_ABS_DAY = $data[ABS_DAY]; /*เดิม*/
		$TMP_ABS_REMARK = $data[ABS_REMARK];
		$TMP_AB_CODE = $data[AB_CODE];
		$TMP_AB_NAME = $data[AB_NAME];	
		$TMP_ABS_STARTPERIOD = $data[ABS_STARTPERIOD];
		$TMP_ABS_ENDPERIOD = $data[ABS_ENDPERIOD];
		$TMP_AUDIT_FLAG = $data[AUDIT_FLAG];
                
                /*Release 5.1.0.7 Begin*/
                $STR_ABS_STARTPERIOD ="";
                if($TMP_ABS_STARTPERIOD=="1"){
                    $STR_ABS_STARTPERIOD =" (ครึ่งวันเช้า)";
                }elseif($TMP_ABS_STARTPERIOD=="2"){
                    $STR_ABS_STARTPERIOD =" (ครึ่งวันบ่าย)";
                }
                if($data[ABS_DAY]!="0.5"){
                    $STR_ABS_STARTPERIOD ="";
                }
                $TMP_ABS_DAY = trim(round($data[ABS_DAY],2)).$STR_ABS_STARTPERIOD;
                /*Release 5.1.0.7 End*/
		
		if ($TMP_ABS_STARTPERIOD == 1)			$SHOW_ABS_STARTPERIOD = "ครึ่งวันเช้า";
		elseif ($TMP_ABS_STARTPERIOD == 2)		$SHOW_ABS_STARTPERIOD = "ครึ่งวันบ่าย";
		elseif ($TMP_ABS_STARTPERIOD == 3)		$SHOW_ABS_STARTPERIOD = "ทั้งวัน";
		if ($TMP_ABS_ENDPERIOD == 1)				$SHOW_ABS_ENDPERIOD = "ครึ่งวันเช้า";
		elseif ($TMP_ABS_ENDPERIOD == 2)			$SHOW_ABS_ENDPERIOD = "ครึ่งวันบ่าย";
		elseif ($TMP_ABS_ENDPERIOD == 3)			$SHOW_ABS_ENDPERIOD = "ทั้งวัน";
	
		$class = "table_body";
		$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";
		if($ABS_ID==$TMP_ABS_ID){ 
			$class = "table_body_over";
			$onmouse_event = "";
		} // end if		
?>
    <tr align="center" class="<?=$class?>" <?=$onmouse_event?>>
      <td height="25"><?=$num_order?></td>
      <td align="left">&nbsp;<?=$TMP_AB_NAME?></td>
      <td><?=$TMP_ABS_STARTDATE?></td>
      <td><?=$TMP_ABS_ENDDATE?></td>
      <td><?=$TMP_ABS_DAY?></td>
      <td><?=$TMP_ABS_REMARK?></td>
      <td><a href="<?="javascript:form1.action+='?VIEW=1';form1.ABS_ID.value=$TMP_ABS_ID; form1.submit();"?>""><img src="images/icon_eye.gif" alt="ดูประวัติการลา" width="16" height="16" border="0"></a></td>
	  <?if($PAGE_AUTH["edit"]=="Y"){?>
	  	<?if($TMP_AUDIT_FLAG=="Y"){?>
			  <td><?=$AUDITED_TITLE?></td>
	  	<? } else { ?>
		      <td><a href="<?="javascript:form1.action+='?UPD=1';form1.ABS_ID.value=$TMP_ABS_ID; form1.submit();"?>""><img src="images/b_edit.png" border="0" alt="แก้ไขประวัติการลา"></a></td>
	  	<?}?>
	  <?}?>
	  <?if($PAGE_AUTH["del"]=="Y"){?>
	  	<?if($TMP_AUDIT_FLAG=="Y"){?>
			  <td>&nbsp;</td>
	  	<? } else { ?>
		      <td><a href="<?="javascript:confirm_delete($TMP_ABS_ID,'$TMP_AB_NAME')"?>"><img src="images/b_drop.png" border="0" alt="ลบประวัติการลา"></a></td>
	  	<?}?>
	  <?}?>
    <? $parameter1=$parameter2=$parameter3=$parameter4=""; ?>
	 <? if($ATTACH_FILE==1){
				$parameter1="PER_ATTACHMENT";	$parameter2="62";	$parameter3="วันลาต่าง ๆ";	$parameter4=$PER_ID;
			}else{
				$parameter1="PER_ABSENTHIS";	$parameter2=$TMP_ABS_ID;	$parameter3="$TMP_AB_NAME $TMP_ABS_STARTDATE";	$parameter4=$PER_ID;
			}
	  ?>
	  <td align="center">&nbsp;<? 
	  $FILE_PATH = '../attachments/'.str_replace("'" ,"",$PER_CARDNO).'/'.$parameter1.'/'.$parameter2;
	  $numfiles=0;
	  if(is_dir($FILE_PATH)){	
		if ($dh = opendir($FILE_PATH)) {		//นับจำนวนไฟล์ทั้งหมดใน folder
			while (($file = readdir($dh)) !== false) {	//---อ่านไฟล์ทั้งหมดมาจาก folder ($FILE_PATH) นั้น
				if ($file != "." && $file != "..") {
					$numfiles++;
				} // end if
			} // while loop readdir
		closedir($dh);
		} // end if
?>		
<a href="<?="javascript:call_menu_desc('$parameter1','$parameter2','$parameter3','$parameter4')"?>"><?=$numfiles; ?></a> 
<?	 
	  }else{	 echo "-";	} 
	  ?></td>
	   <?if($PAGE_AUTH["attach"]=="Y"){ ?><td align="center">&nbsp; <a href="<?="javascript:call_menu_desc('$parameter1','$parameter2','$parameter3','$parameter4')"?>"><img src="images/file.jpg" border="0" alt="<?=$ALT_LOAD_TITLE?>"></a></td><? } ?>
      <?if(($PAGE_AUTH["edit"]=="Y" || $PAGE_AUTH["del"]=="Y") && $PAGE_AUTH["audit"]=="Y"){?><td align="center"><input type="checkbox" id="list_audit_id<?=$data_count; ?>" name="list_audit_id[]" onClick="set_uncheck_all(this.checked,form1.list_audit_all,this.id)" value="<?=$TMP_ABS_ID?>" <?=(($TMP_AUDIT_FLAG=="Y")?"checked":"")?>></td><? } ?>
	</tr>
    <? } ?>
	<?if($PAGE_AUTH["edit"]=="Y"){?>
    <tr class="table_footer" height="24">
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>
      <td>&nbsp;</td>      
      <td>&nbsp;</td>
      <?if($PAGE_AUTH["edit"]=="Y"){?><td>&nbsp;</td><?}?>
      <?if($PAGE_AUTH["del"]=="Y"){?><td>&nbsp;</td><?}?>
      <td>&nbsp;</td>
	    <?if($PAGE_AUTH["attach"]=="Y"){ ?><td>&nbsp;</td><? } ?>
      <?if(($PAGE_AUTH["edit"]=="Y" || $PAGE_AUTH["del"]=="Y") && $PAGE_AUTH["audit"]=="Y"){?>
      <td align="center"><? if ($BUTTON_DISPLAY==1) { ?>
        <input type="submit" name="Submit4" value="<?=$SETFLAG_TITLE?>" onClick="form1.command.value='SETFLAG'" class="button" style="width:98%">
        <?  } else { ?>
        <input name="image3" type="image" onClick="form1.command.value='SETFLAG'" src="images/save.png" alt="<?=$SETFLAG_TITLE?>" border="0">
        <? } ?></td>
	  <?}?>
	</tr>
	<?}?>
  </table>
  <? if($total_page > 1) : ?>
  <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td align="center"><?=$page_link?></td>
    </tr>
  </table>
  <? endif; ?>&nbsp;
	  <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
		<tr><td colspan="10">&nbsp;</td></tr>
		<tr><td colspan="10"><iframe style="visibility:hidden" width="100%" height="100%" frameborder="0" scrolling="yes" id="PER_FILE_IFRAME" name="">รายละเอียดไฟล์ข้อมูลข้าราชการ/ลูกจ้างประจำ</iframe></td></tr>
	  </table>
  <? } // if  count show ?>
  		  <input type="hidden" name="current_list" value="<?=$current_list?>">
        </form>
		</td>
	</tr>
</table>
<?
	include("jqModalDialog.html");
?>
</body>
<? if (!$HIDE_HEADER) { ?>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<? } ?>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
</script>
<!-- Layer for uploading -->
<div style="position:absolute;width:160;height:160; visibility:hidden; display:none;" id="obj_uploading">
  <object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,29,0" width="160" height="160">
    <param name="movie" value="images/uploading.swf">
    <param name="quality" value="high">
    <embed src="images/uploading.swf" quality="high" pluginspage="http://www.macromedia.com/go/getflashplayer" type="application/x-shockwave-flash" width="160" height="160"></embed>
  </object>
</div>
<!-- Layer for uploading -->
<?php if(!empty($UPD) || !empty($VIEW)){?>
<script>
    ProcessUploading();
    calcDaysBetweenDateV2();
</script>
<?php }?>
</html>
