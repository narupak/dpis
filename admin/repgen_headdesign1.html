<?
	include("../php_scripts/connect_database.php");

	if ($command=="DELETE") {
		$cmd = " select * FROM REPGEN_HEADTEMP where HEAD_TEMP_ID=$HEAD_TEMP_ID ";
		
		$db_dpis->send_cmd($cmd);
		if ($data = $db_dpis->get_array()) {
        	$cmd = "  delete from REPGEN_HEADTEMP where HEAD_TEMP_ID=$HEAD_TEMP_ID ";
//			echo "$cmd<br>";
			$db_dpis->send_cmd($cmd);	// ส่ง command delete
	        $text1="";	// Clear ค่า text1 เพื่อให้อ่านข้อมูลใหม่
            $field_data="";
            $fld_type="";
            $HEAD_TEMP_ID=0;
    		$command = "UPDATE";	// เปลี่ยนค่า command จาก DELETE เพื่อให้เป็น mode UPDATE ปกติ
    	}
	}
    
	if ($command=="SAVE") {
		$UPDATE_DATE = date("Y-m-d H:i:s");
        
		$cmd = " select * FROM REPGEN_HEADTEMP where HEAD_TEMP_ID=$HEAD_TEMP_ID ";
		
		$db_dpis->send_cmd($cmd);
		if ($data = $db_dpis->get_array()) {
        	$cmd = "  update REPGEN_HEADTEMP set
									HEAD_TEMP_TEXT = '$text1',
									HEAD_NAME_CODE = '$HEAD_NAME_CODE',
									UPDATE_USER=$SESS_USERID,
        		                    UPDATE_DATE='$UPDATE_DATE'
                            where HEAD_TEMP_ID = $HEAD_TEMP_ID 
						";
    	} else {
        	$cmd = "  insert into REPGEN_HEADTEMP 
            						(HEAD_TEMP_ID, HEAD_TEMP_TEXT, HEAD_NAME_CODE, UPDATE_USER, UPDATE_DATE)
								values
                                    ($HEAD_TEMP_ID, '$text1', '$HEAD_NAME_CODE', $SESS_USERID, '$UPDATE_DATE')
						";
        }
//		echo "$cmd<br>";
		$db_dpis->send_cmd($cmd);	// ส่ง command insert หรือ update
        $text1="";	// Clear ค่า text1 เพื่อให้อ่านข้อมูลใหม่
    	$command = "UPDATE";	// เปลี่ยนค่า command จาก ADD เพื่อให้เป็น mode UPDATE ปกติ
    }
    
	if ($command=="COPY" && $NC_ID) {
		$UPDATE_DATE = date("Y-m-d H:i:s");
        
		$cmd = " select max(HEAD_TEMP_ID) as max_id FROM REPGEN_HEADTEMP ";
		
		$db_dpis->send_cmd($cmd);
		$data = $db_dpis->get_array();
		$data = array_change_key_case($data, CASE_LOWER);
		$new_ID=$data[max_id]+1;

		$cmd = " select max(HEAD_NAME_CODE) as max_form FROM REPGEN_HEADTEMP where HEAD_NAME_CODE like 'HEAD%' ";
		
		$db_dpis->send_cmd($cmd);
		$data = $db_dpis->get_array();
		$data = array_change_key_case($data, CASE_LOWER);
		$namebuff = $data[max_form];
//		echo "new $new_ID, $namebuff<br>";
		$nextid = (int)substr($namebuff,4);
		$nextid++;	// เพิ่มค่าต่อไป
		$new_NAME="HEAD$nextid";

		$cmd = " select * FROM REPGEN_HEADTEMP where HEAD_TEMP_ID=$HEAD_TEMP_ID ";
		
		$db_dpis->send_cmd($cmd);
		if ($data = $db_dpis->get_array()) {
			$text1 = $data["HEAD_TEMP_TEXT"];
        	$cmd = "insert into REPGEN_HEADTEMP (HEAD_TEMP_ID, HEAD_TEMP_TEXT, HEAD_NAME_CODE, UPDATE_USER, UPDATE_DATE) values ($new_ID, '$text1', '$new_NAME', $SESS_USERID, '$UPDATE_DATE') 	";
//			echo "$cmd<br>";
			$db_dpis->send_cmd($cmd);	// ส่ง command insert หรือ update
            $NC_ID = $new_NC_ID;
    	    $text1="";	// Clear ค่า text1 เพื่อให้อ่านข้อมูลใหม่
    		$command = "UPDATE";	// เปลี่ยนค่า command จาก ADD เพื่อให้เป็น mode UPDATE ปกติ
		} // end if ($data = $db_dpis->get_array())
	} // end if ($command=="COPY" && $PER_ID)

	$var_name = array("New Variable"=>"New Variable", "pername1"=>"คำนำ ชื่อ นามสกุล", "pername2"=>"ชื่อ นามสกุล", "perposline"=>"ตำแหน่งในสายงาน", "perposmng"=>"ตำแหน่งทางบริหาร", "poslevel"=>"ระดับตำแหน่ง", "org"=>"สังกัด/กอง", "address1"=>"ที่อยู่ ตามทะเบียนบ้าน", "address2"=>"ที่อยู่ ที่ติดต่อได้", "allphone"=>"โทรศัพท์ ทั้งหมด", "homephone"=>"โทรศัพท์บ้าน", "mobilephone"=>"โทรศัพท์เคลื่อนที่", "officephone"=>"โทรศัพท์ที่ทำงาน", "faxno"=>"โทรสาร", "email"=>"E-Mail");

	$var_name1 = array("New Variable"=>"New Variable", "pername1"=>"คำนำ ชื่อ นามสกุล", "pername2"=>"ชื่อ นามสกุล", "perposline"=>"ตำแหน่งในสายงาน", "perposmng"=>"ตำแหน่งทางบริหาร", "poslevel"=>"ระดับตำแหน่ง", "org"=>"สังกัด หรือ กอง", "address1"=>"123 ที่อยู่ ตามทะเบียนบ้าน ตำบลทดสอบ อำเภอลองดู จังหวัดต้องลอง  99999", "address2"=>"456 ที่อยู่ ที่ติดต่อได้ ตำบลติดต่อได้ อำเภอติดต่อ จังหวัดติดต่อได้  99999", "allphone"=>"08-9111-1112 02-9111-1111 02-9111-1113", "homephone"=>"02-9111-1111", "mobilephone"=>"08-9111-1112", "officephone"=>"02-9111-1113", "faxno"=>"02-9111-1114", "email"=>"E-Mail@mail.com");

	$var_name_e1 = array("New Variable"=>"New Variable", "pername1"=>"pName Name Surname", "pername2"=>"Name Surname", "perposline"=>"Pos In Line", "perposmng"=>"Pos In Management", "poslevel"=>"Pos Level", "org"=>"Department", "address1"=>"123 Home No. Tumbol test  Amphur test  Province test  99999", "address2"=>"456 Contact No  Tumbol Contact  Amphur Contact  Province Contact  99999", "allphone"=>"08-9111-1112 02-9111-1111 02-9111-1113", "homephone"=>"02-9111-1111", "mobilephone"=>"08-9111-1112", "officephone"=>"02-9111-1113", "faxno"=>"02-9111-1114", "email"=>"E-Mail@mail.com");

    if (!$HEAD_TEMP_ID) { $HEAD_TEMP_ID=1; $ruler = 0; }

	if (!$text1) {	// ถ้าไม่มีค่า รายละเอียดรูปแบบ ($text1) อยู่ ก็อ่านข้อมูลตาม $HEAD_TEMP_ID
    					// เมื่อจะมีการ อ่านข้อมูลใหม่ ก็จะกำหนดให้ $text1 = "";
		$cmd = " select * FROM REPGEN_HEADTEMP where HEAD_TEMP_ID=$HEAD_TEMP_ID ";
		
		$db_dpis->send_cmd($cmd);
		if ($data = $db_dpis->get_array()) {
			$text1 = $data[HEAD_TEMP_TEXT];
    		$HEAD_NAME_CODE = $data[HEAD_NAME_CODE];
		} else {	// กรณี ข้อมูลใหม่	// ถ้า กำหนดให้ $text="" และ $NC_ID="" เมื่ออ่านข้อมูลไม่ได้ จะถือว่าเป็นการสร้างใหม่
			$cmd = " select max(HEAD_TEMP_ID) as max_id FROM REPGEN_HEADTEMP ";
		
			$db_dpis->send_cmd($cmd);
			$data = $db_dpis->get_array();
			$data = array_change_key_case($data, CASE_LOWER);
			$HEAD_TEMP_ID=$data[max_id]+1;

			$cmd = " select max(HEAD_NAME_CODE) as max_form FROM REPGEN_HEADTEMP where HEAD_NAME_CODE like 'HEAD%' ";
		
			$db_dpis->send_cmd($cmd);
			$data = $db_dpis->get_array();
			$data = array_change_key_case($data, CASE_LOWER);
            $namebuff = $data[max_form];
//			echo "new $HEAD_TEMP_ID, $namebuff<br>";
            $nextid = (int)substr($namebuff,4);
            $nextid++;	// เพิ่มค่าต่อไป
			$HEAD_NAME_CODE="HEAD$nextid";
			$text1 = "title,title001,0,0,30,angsa,,16,L,00,00,00,";
		}	// if ($data = $db_dpis->get_array())
        $command = "UPDATE";
    }
//	echo "text1=$text1<br>";

	if (!$btn_adddet_val)  $btn_adddet_val = "เลือกประเภทเพื่อเพิ่มข้อมูล";	// กำหนดค่าเริ่มต้น ปุ่มกด การเพิ่มรายละเอียด

	if (!trim($field_data)) $field_data=0;
	$last_field_index = $field_data;	// ข้อมูลที่เลือกไว้ รายการก่อนหน้า

//	echo "last_field_index=$last_field_index<BR>";
	// จัดข้อมูลใหม่เพื่อการแสดง ใน viewer โดยการเปลี่ยนค่าตัวแปรเป็น text ตัวอย่าง
	$arr_obj = explode("|", $text1);
   	$text2 = "";
	for($i = 0; $i < count($arr_obj); $i++) {
		$arr_part = explode(",", $arr_obj[$i]);
		if ($arr_part[0]=="variable") {
    	    $fldname=$arr_part[1];
            $rep_text = $var_name1[$fldname].",".$var_name_e1[$fldname];
			$new_text = str_replace($fldname, $rep_text, $arr_obj[$i]);
			$new_text = str_replace("variable", "text", $new_text);
           	$text2 = ($text2)?"$text2|$new_text":$new_text;
			$arr_select[] = $var_name[$fldname];
		} else {
        	$text2 = ($text2)?"$text2|".$arr_obj[$i]:$arr_obj[$i];
			$arr_select[] = $arr_part[1];
		}
		$arr_select1[] = $fldname;
	} // end loop for $i
//	echo "text2=$text2<br>";
	// จบการ จัดข้อมูลใหม่เพื่อการแสดง ใน viewer

    // form ใช้เฉพาะในโปรแกรมนี้
	$tformat = array('paper-size'=>'wh(300,35)',	'metric'=>'mm', 'marginLeft'=>6, 'marginTop'=>6, 'width'=>89, 'height'=>55);

	// สร้าง PDF file นามบัตร เพื่อมาแสดงใน EMBED PDF tag เพื่อเป็น viewer
	define('FPDF_FONTPATH','../PDF/font/');
	include ("../PDF/fpdf.php");
	include ("../PDF/pdf_extends_DPIS.php");
	include ("../PDF/PDF_REPGEN.php");

	$pdf = new PDF_REPGEN($tformat);

	if ($ruler == 1) $f_ruler = true; else $f_ruler = false;
	$pdf->Print_REPGEN($text2,1,$f_ruler);

	$pdf->Output("../PDF/tmp_head.pdf", "F");
	// จบการ สร้าง PDF file นามบัตร เพื่อมาแสดงใน EMBED PDF tag

	// กระจายข้อมูลรายละเอียดใน text1 เพื่อแสดงในจอภาพ
//	echo "$command,$field_data,$fld_type<br>";
    $arr_part = explode(",",$arr_obj[$field_data]);
//	if (!$fld_type)	$fld_type=$arr_part[0];
    $fld_type=$arr_part[0];
//	echo "fld_type=$fld_type<br>";
	if ($fld_type=="text") {
		$fixtext=$arr_part[1];
		$fixetext=$arr_part[2];
		$fld_x=$arr_part[3];
		$fld_y=$arr_part[4];
		$fld_w=$arr_part[5];
		$font_name="".$arr_part[6].",".$arr_part[7].",".$arr_part[8];
        $text_align = $arr_part[9];
		$font_color="".$arr_part[10].",".$arr_part[11].",".$arr_part[12];
//		echo "text 1.$fixtext,2.$fixetext,x.$fld_x,y.$fld_y,w.$fld_w,font.$font_name,$text_align,color.$font_color<br>";
	} else if ($fld_type=="variable") {
		$fldname=$arr_part[1];
		$fld_x=$arr_part[2];
		$fld_y=$arr_part[3];
		$fld_w=$arr_part[4];
		$font_name="".$arr_part[5].",".$arr_part[6].",".$arr_part[7];
        $text_align = $arr_part[8];
		$font_color="".$arr_part[9].",".$arr_part[10].",".$arr_part[11];
		$multiline=$arr_part[12];
//		echo "font=$font_name,color=$font_color<br>";
	} else if ($fld_type=="image" || $fld_type=="background") {
		$imagename=$arr_part[1];
		$fld_x=$arr_part[2];
		$fld_y=$arr_part[3];
		$fld_w=$arr_part[4];
		$fld_h=$arr_part[5];
	} else if ($fld_type=="line") {
		$linename=$arr_part[1];
		$fld_x1=$arr_part[2];
		$fld_y1=$arr_part[3];
		$fld_x2=$arr_part[4];
		$fld_y2=$arr_part[5];
		$line_color="".$arr_part[6].",".$arr_part[7].",".$arr_part[8];
		$line_w=$arr_part[9];
	} else if ($fld_type=="rect") {
		$boxname=$arr_part[1];
		$fld_x1=$arr_part[2];
		$fld_y1=$arr_part[3];
		$fld_x2=$arr_part[4];
		$fld_y2=$arr_part[5];
		$line_color="".$arr_part[6].",".$arr_part[7].",".$arr_part[8];
		$line_w=$arr_part[9];
		$box_style=$arr_part[10];
	}
	// จบการ กระจายข้อมูลรายละเอียดใน text1
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<!-- <link rel="stylesheet" href="stylesheets/style<?=$RPT_N?>.css" type="text/css">-->
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
</head>
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">

function refresh_viewer() {
//	alert(document.getElementById('nc_viewer').innerHTML);
	var d = document;

	// update รายการรายละเอียดที่ทำรายการสุดท้ายลงใน text1 ก่อน ทำ viewer
	var lfld=d.form1.last_field_index.value;
	if (lfld) 	mixtext();
	// จบการ update รายการรายละเอียด

	d.form1.command.value="UPDATE";
	d.form1.submit();
}

function getdata() {
	// เมื่อเลือกรายละเอียดใหม่ ก็จะดึงข้อมูลรายการที่เลือกใหม่ จาก text1 มาแสดง
	var d = document;

	// update รายการรายละเอียดที่ทำรายการสุดท้ายลงใน text1 ก่อน ทำ viewer
	var lfld=d.form1.last_field_index.value;
	if (lfld) 	mixtext();
	// จบการ update รายการรายละเอียด

	// กำหนด index ของรายละเอียดล่าสุด ให้เท่ากับ รายการปัจจุบัน
	var fld_idx = d.getElementById("field_data").value;
	lfld = fld_idx;
	
//	alert("this_fld_idx="+lfld);
	d.form1.command.value="UPDATE";
	d.form1.submit();
}

function call_deldetail() {
	var d = document;
	var l_fld_idx = d.form1.last_field_index;	// last_firld_index คือรายการที่ถูกเลือกล่าสุด
	var text_data = d.getElementById("text1");
	arr_data = text_data.value.split("|");
	arr_part = arr_data[l_fld_idx.value].split(",");
	if (confirm("ต้องการลบรายการข้อมูล "+arr_part[0]+"-"+arr_part[1]+" นี้ แน่นอน?")) {
		var ret_data="";
		for(i=0; i<arr_data.length; i++)
			if (i!=l_fld_idx.value)
				ret_data = ret_data?ret_data+"|"+arr_data[i]:arr_data[i];
		text_data.value = ret_data;
		d.form1.field_data.value="";	// เมื่อลบรายการที่ต้องการ ก็กำหนด index ให้ไปชี้ที่รายการแรก
		d.form1.command.value="UPDATE";
		d.form1.submit();	
	}
}

function call_cancel() {
	if (confirm("ยกเลิกการแก้ไขนามบัตร และดึงนามบัตรเก่า แน่นอน?")) {
		var d = document;
		var text_data = d.getElementById("text1");
		text_data.value = "";	// กำหนด text1 เป็น "" เพื่อให้อ่านข้อมูลจากฐานข้อมูล
		d.form1.field_data.value="";	// Clear ค่า field_data เพื่อให้โปรแกรม กำหนด field index ให้เริ่มต้อนที่รายการแรก
		d.form1.fld_type.value="";		// Clear ค่า fld_type เพื่อให้โปรแกรม อ่านค่า ประเภท จาก รายการตาม field index
		d.form1.command.value="UPDATE";
		d.form1.submit();
	}
}

function call_det_cancel() {
	var d = document;
	if (confirm("ยกเลิกการแก้ไขรายการข้อมูล และดึงข้อมูลเก่า แน่นอน?")) {
		d.form1.command.value="UPDATE";
		d.form1.submit();
	}
}

function call_add_namecard() {
	var d = document;
	var text_data = d.getElementById("text1");
	text_data.value = "";	// กำหนด text1 เป็น "" เพื่อให้อ่านข้อมูลจากฐานข้อมูล
	d.form1.NC_ID.value="999999999";	// กำหนดค่า NC_ID เพื่อให้โปรแกรมอ่านข้อมูลนามบัตรไม่ได้ 
															// จะได้เข้าสู่การสร้างนามบัตรใหม่
	d.form1.field_data.value="";	// Clear ค่า field_data เพื่อให้โปรแกรม กำหนด field index ให้เริ่มต้อนที่รายการแรก
	d.form1.fld_type.value="";		// Clear ค่า fld_type เพื่อให้โปรแกรม อ่านค่า ประเภท จาก รายการตาม field index
	d.form1.command.value="UPDATE";
	d.form1.submit();
}

function call_del_namecard() {
	if (confirm("ต้องการลบรูปแบบนามบัตรนี้ แน่นอน?")) {
		var d = document;
		d.form1.command.value="DELETE";
		d.form1.submit();
	}
}

function call_det_add() {
	var d = document;
//	alert(d.form1.btn_adddet.value);
	if (d.form1.btn_adddet.value=="เลือกประเภทเพื่อเพิ่มข้อมูล") {

		// update รายการรายละเอียดที่ทำรายการสุดท้ายลงใน text1 ก่อน ทำ viewer
		var lfld=d.form1.last_field_index.value;
		if (lfld) 	mixtext();
		// จบการ update รายการรายละเอียด
		
		d.form1.btn_adddet_val.value="เลือกประเภทแล้วกดปุ่มนี้";
		d.form1.command.value="ADD";
	} else {
		add_detail_first();	// กำหนดค่าเริ่มต้นในการเพิ่มข้อมูลเบื่องต้น เพื่อให้มีใน text1 เพื่อจะการ แก้ไข ต่อไป
		d.form1.btn_adddet_val.value="เลือกประเภทเพื่อเพิ่มข้อมูล";
		d.form1.command.value="UPDATE";
	}
	d.form1.submit();
}

function add_detail_first() {
	// กำหนดค่าเริ่มต้นในการเพิ่มข้อมูลเบื่องต้น เพื่อให้มีใน text1 เพื่อจะการ แก้ไข ต่อไป
	var d = document;
	var fldtype = d.getElementById("fld_type");
//	alert("fldtype="+fldtype.value);
	if (fldtype.value=="text") {
		var thistext = "text,new text,new eng text,0,0,30,angsa,,12,L,00,00,00";
	} else if (fldtype.value=="variable") {
		var thistext = "variable,New Variable,0,0,30,angsa,,12,L,00,00,00,";	// default pername1
	} else if (fldtype.value=="image" || fldtype.value=="background") {
		var thistext = fldtype.value+",images/no_picture.jpg,0,0,20,28";	// imagename = blank
	} else if (fldtype.value=="line") {
		var nidx = gennextid("line");
		var lname = "line"+nidx;
		var thistext = "line,"+lname+",10,10,30,10,00,00,00,0";	// imagename = blank
	} else if (fldtype.value=="rect") {
		var nidx = gennextid("box");
		var bname = "box"+nidx;
		var thistext = "rect,"+bname+",10,10,30,30,00,00,00,0,";	// style = blank
	}
	var text_data = d.getElementById("text1");
	text_data.value = (text_data.value) ? text_data.value + "|" + thistext : thistext;
	arr_data = text_data.value.split("|");
//	d.form1.field_data.disabled = false;	// ทำให้เป็น enabled
	d.form1.field_data.value = "";
	fldtype.value = "";
}

function gennextid(tname) {
	// หาลำดับที่ หลังชื่อ tname ตัวต่อไปเพื่อการสร้างข้อมูลใหม่
	var d = document;
	var text_data = d.getElementById("text1");
	arr_data = text_data.value.split("|");
	maxidx = 0;
	for(i=0; i<arr_data.length; i++) {
		arr_part = arr_data[i].split(",");
		c = arr_part[1].indexOf(tname);
		if (c > -1)	{
			idx = Number(arr_part[1].substr(c+tname.length))+1;
			if (idx > maxidx)  maxidx = idx;
		}
	}
	if (maxidx==0)  maxidx = 1;

	return maxidx;
}

function call_save() {
	// บันทึก นามบัตร
	var d = document;

	// update รายการรายละเอียดที่ทำรายการสุดท้ายลงใน text1 ก่อน ทำการบันทึก
	var lfld=d.form1.last_field_index.value;
	if (lfld) 	mixtext();
	// จบการ update รายการรายละเอียด
	
	d.form1.command.value = "SAVE";
	d.form1.submit();
}

function call_saveas() {
	// บันทึก บัตรพนง.
	var d = document;

	// update รายการรายละเอียดที่ทำรายการสุดท้ายลงใน text1 ก่อน ทำการบันทึก
	var lfld=d.form1.last_field_index.value;
	if (lfld) 	mixtext();
	// จบการ update รายการรายละเอียด
	
	d.form1.command.value = "COPY";
	d.form1.submit();
}

function call_font(font) {
		parameter = "";
		parameter = "&get_font=" + font;
		childReturn = window.showModalDialog("pick_pdf_font_frame.html?VIEW=1&MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 350px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");
		if(childReturn) {
//			alert(childReturn);
			arrValue = childReturn.split("<::>");
			if (arrValue[0]=="0") {
				arrDetail = arrValue[1].split(",");
				document.form1.font_name.value = arrDetail[0]+","+arrDetail[1]+","+arrDetail[2];
				document.form1.text_align.value = arrDetail[3];
				mixtext();
				document.form1.submit();
			}
		}
}

function d2h(d) {return d.toString(16);}
function h2d(h) {return parseInt(h,16);} 

function call_color(typ) {
	if (typ==1) {
		co = document.form1.font_color.value;
	} else {
		co = document.form1.line_color.value;
	}
	arr_color = co.split(",");
	rr = h2d(arr_color[0]);
	gg = h2d(arr_color[1]);
	bb = h2d(arr_color[2]);
	parameter = "&r=" + rr + "&g=" + gg + "&b=" + bb;
  	returnVal = window.showModalDialog("colorpickup_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 420px; dialogWidth: 590px; status: No; resizable: No; help: No; statusbar: No;");
	if (returnVal) {
		arrValue = returnVal.split("<::>");
		if (arrValue[1]) {
			if (typ == 1)
				document.form1.font_color.value = arrValue[1].substr(0,2)+","+arrValue[1].substr(2,2)+","+arrValue[1].substr(4,2);
			else
				document.form1.line_color.value = arrValue[1].substr(0,2)+","+arrValue[1].substr(2,2)+","+arrValue[1].substr(4,2);
			mixtext();
			document.form1.submit();
		} // end if (arrValue[1])
	}
}

function get_imagename(full_url) {
		c = full_url.lastIndexOf("/");
		c1 = full_url.lastIndexOf(")");
		if (c1 > -1)
			img = full_url.substr(c+1, c1-c-1);
		else
			img = full_url.substr(c+1);
//		alert("name="+img+" --"+full_url+"["+c1+"]");
		return img;
}

function get_imagepath(full_url) {
		c = full_url.lastIndexOf("/");
		c1 = full_url.indexOf("(");
		if (c1 > -1)
			imgpath = full_url.substr(c1+1, c-c1);
		else
			imgpath = full_url.substr(0, c+1);
//		alert("path="+imgpath+" --"+full_url+"["+c1+"]");
		return imgpath;
}

function call_ruler() {
	mixtext();
	document.form1.submit();
}

function call_upload() {
	var imgname="";
	var imgpath="";
//	alert("form1.imagename.value="+form1.imagename.value);
	if (form1.imagename.value) {
		imgname = get_imagename(form1.imagename.value);
		imgpath = get_imagepath(form1.imagename.value);
		parameter="&imgpath="+imgpath+"&imgname="+imgname;
	} else {
		parameter="&imgname=&imgpath";
	}
	returnVal = window.showModalDialog("upload_bg_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,"","dialogHeight: 300px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");
	if (returnVal) {
		arrValue = returnVal.split("<::>");
		stat = arrValue[0];
		if (stat=="0") {
			imagename = arrValue[1];
			if (!form1.fld_w.value)	form1.fld_w.value = arrValue[2];
			if (!form1.fld_h.value)		form1.fld_h.value = arrValue[3];
//			alert(imgpath+"::"+imagename);
			form1.imagename.value = imgpath+imagename;
			mixtext();
			form1.submit();
		}
	}
}

function mixtext() {
	// แก้ไข text1 จากข้อมูลบนจอที่แก้ไข ตาม last_field_index
	var d = document;
	var fldtype = d.getElementById("fld_type");
//	alert("fldtype="+fldtype.value);
	if (fldtype.value=="text") {
		var fixtext = d.form1.fixtext.value;
		var fixetext = d.form1.fixetext.value;
		var fld_x = d.form1.fld_x.value;
		var fld_y = d.form1.fld_y.value;
		var fld_w = d.form1.fld_w.value;
		var font_name = d.form1.font_name.value;
		a = d.form1.text_align;
		for(k=0; k < a.length; k++)
			if (a[k].checked) { talign = a[k].value; break; }
		var font_color = d.form1.font_color.value;
		var thistext = "text,"+fixtext+","+fixetext+","+fld_x+","+fld_y+","+fld_w+","+font_name+","+talign+","+font_color;
	} else if (fldtype.value=="variable") {
		var fldname = d.form1.fldname.value;
		var fld_x = d.form1.fld_x.value;
		var fld_y = d.form1.fld_y.value;
		var fld_w = d.form1.fld_w.value;
		var font_name = d.form1.font_name.value;
		var talign = "";
		a = d.form1.text_align;
		for(k=0; k < a.length; k++)
			if (a[k].checked) { talign = a[k].value; break; }
		var font_color = d.form1.font_color.value;
		var multiline = d.form1.multiline;
		if (multiline.checked) ln=multiline.value; else ln="";
		var thistext = "variable,"+fldname+","+fld_x+","+fld_y+","+fld_w+","+font_name+","+talign+","+font_color+","+ln;
	} else if (fldtype.value=="image" || fldtype.value=="background") {
		var imagename = d.form1.imagename.value;
		var fld_x = d.form1.fld_x.value;
		var fld_y = d.form1.fld_y.value;
		var fld_w = d.form1.fld_w.value;
		var fld_h = d.form1.fld_h.value;
		var thistext = fldtype.value+","+imagename+","+fld_x+","+fld_y+","+fld_w+","+fld_h;
	} else if (fldtype.value=="line") {
		var linename = d.form1.linename.value;
		var fld_x1 = d.form1.fld_x1.value;
		var fld_y1 = d.form1.fld_y1.value;
		var fld_x2 = d.form1.fld_x2.value;
		var fld_y2 = d.form1.fld_y2.value;
		var line_color = d.form1.line_color.value;
		var line_w = d.form1.line_w.value;
		var thistext = "line,"+linename+","+fld_x1+","+fld_y1+","+fld_x2+","+fld_y2+","+line_color+","+line_w;
	} else if (fldtype.value=="rect") {
		var boxname = d.form1.boxname.value;
		var fld_x1 = d.form1.fld_x1.value;
		var fld_y1 = d.form1.fld_y1.value;
		var fld_x2 = d.form1.fld_x2.value;
		var fld_y2 = d.form1.fld_y2.value;
		var line_color = d.form1.line_color.value;
		var line_w = d.form1.line_w.value;
		var box_style = d.form1.box_style.value;
		var thistext = "rect,"+boxname+","+fld_x1+","+fld_y1+","+fld_x2+","+fld_y2+","+line_color+","+line_w+","+box_style;
	}
	var l_fld_idx = d.form1.last_field_index;
	var text_data = d.getElementById("text1");
	arr_data = text_data.value.split("|");
//	alert("arr_data.length="+arr_data.length);
	var ret_data="";
	for(i=0; i<arr_data.length; i++)
		if (i==l_fld_idx.value)
			ret_data = ret_data?ret_data+"|"+thistext:thistext;
		else
			ret_data = ret_data?ret_data+"|"+arr_data[i]:arr_data[i];
	text_data.value = ret_data;
//	alert(text_data.value);
}

function call_search_namecard() {
		parameter = "";
		childReturn = window.showModalDialog("search_namecard_frame.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>" + parameter,"","dialogHeight: 600px; dialogWidth: 800px; status: No; resizable: No; help: No; statusbar: No;");
		if(childReturn){
			arrValue = childReturn.split("<::>");
			form1.NC_ID.value = arrValue[0];
			form1.NC_NAME.value = arrValue[1];
			form1.text1.value = "";
			form1.field_data.value = "";
			form1.fld_type.value = "";
			form1.submit();
		} // end if
}

</script>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<tr>
    	<td height="10"><?include("header_menu.html")?></td>
  	</tr>
    <tr> 
	  <td align="left" valign="top">
<?	
		if ($UPD) $OPTIONAL_TITLE=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE=" &gt; ดูข้อมูล";
		include("current_location.html");
?>
	  </td>
	</tr>
  	<tr>
    	<td align="left" valign="top"><form name="form1" method="post" action="per_namecard_design.html" enctype="multipart/form-data">
          <input type="hidden" name="current_page" value="<?=$current_page?>">
          <input type="hidden" name="total_page" value="<?=$total_page?>">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
		  <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3?>">
          <input type="hidden" name="command" value="">
          <input type="hidden" id="text1" name="text1" value="<?=$text1?>">
&nbsp;
  <table width="98%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
		<td>
<!--      	<fieldset style="float:left;width:<?=($ncW+12).$metric?>;height:<?=($ncH+12).$metric?>;">-->
      	<fieldset style="float:left;width:1200;height:170;">
        	<legend id="nc"><label for="tmp_namecard">รูปแบบหัวรายงาน</label></legend>
<!--			<embed src="../PDF/tmp_namecard.pdf#toolbar=0&navpanes=0&scrollbar=0" width="<?=($ncW).$metric?>" height="<?=($ncH).$metric?>">-->
			<div id="tmp_viewer">
	        <embed src="../PDF/tmp_head.pdf#toolbar=0&navpanes=0&scrollbar=0&zoom=100" width="1200" height="150"/>
            </div>
        </fieldset>
		<fieldset style="float:left;"><legend><label for="tmp_part">ข้อมูลหัวรายงาน</label></legend>
			<input type="text" name="TMP_NAME" value="<?=$TMP_NAME?>" size="80" class="textbox">
			<input type="hidden" name="TMP_ID" value="<?=$TMP_ID?>">
        	&nbsp;
	        <input name="btnsearch" type="button" class="button" value="ค้นหา" onClick="call_search_tmp();">
			<?if($PAGE_AUTH["add"]=="Y"){ ?>
				&nbsp;
    	    	<input name="btnadd" type="button" class="button" value="เพิ่ม" onClick="call_add_tmp();">
			<? }
            	if($PAGE_AUTH["edit"]=="Y"){ ?>
	        	&nbsp;
				<input name="btn_save" type="button" value="บันทึก" class="button" onClick="call_save();">
	        	&nbsp;
				<input name="btn_saveas" type="button" value="บันทึกเป็นตัวใหม่" class="button" onClick="call_saveas();">
			<? } 
            	if($PAGE_AUTH["del"]=="Y"){ ?>
				&nbsp;&nbsp;
		        <input name="btndel" type="button" class="button" value="..ลบ.." onClick="call_del_tmp();">
			<? } ?>
	        &nbsp;&nbsp;
			<input name="btn_cancel" type="button" value="ดึงข้อมูลเดิม" class="button" onClick="call_cancel();">
		</fieldset>
		</td>
	</tr>
    <tr>
    	<td>
		<input type="hidden" name="last_field_index" value="<?=$last_field_index?>">
		<fieldset style="float:left;"><legend><label for="field_data">รายละเอียดข้อมูล</label></legend>
			<select class="selectbox" id="field_data" name="field_data" onkeydown="if(window.event.keyCode===46) { var a = this.options, i = a.length; while(i--) { if(a[i].selected) { a[i] = null; } }; }" onChange="getdata();" size="9" multiple="multiple" <?=$command=="ADD"?"disabled":""?>>
            <? for($i=0; $i < count($arr_select); $i++) { ?>
				<option value="<?=$i?>" <?=($field_data)==$i ? "selected":""?>><?=$arr_select[$i]?></option>
				<? 
                   	if ($i==$field_data)	$showfixtext = $var_name1[$arr_select1[$i]]; 
				?>
			<? } ?>
			</select>&nbsp;&nbsp;
		</fieldset>
		<select class="selectbox" id="fld_type" name="fld_type" onChange="" <?=($command=="UPDATE")?"disabled":""?>>
			<option value="text" <?=($fld_type)=="text"?"selected":""?>>ข้อความ</option>
			<option value="variable" <?=($fld_type)=="variable"?"selected":""?>>ตัวแปรข้อมูล</option>
			<option value="image" <?=($fld_type)=="image"?"selected":""?>>รูปภาพ</option>
			<option value="background" <?=($fld_type)=="background"?"selected":""?>>ภาพพื้นหลัง</option>
			<option value="line" <?=($fld_type)=="line"?"selected":""?>>เส้นตรง</option>
			<option value="rect" <?=($fld_type)=="rect"?"selected":""?>>กล่อง</option>
		</select>&nbsp;&nbsp;
		<input name="btn_upd" type="button" value="เก็บรูปแบบและแสดงผล" class="button" onClick="refresh_viewer();">
		<fieldset style="float:left;"><legend><label for="detail_frame"><?=$fld_type?></label></legend>
        <? if ($command!="ADD") {
           		if ($fld_type=="text") { ?>
            		ข้อความ&nbsp;:&nbsp;
					<input type="text" name="fixtext" value="<?=$fixtext?>" style="width=80%" class="textbox">ห้ามใช้ ,<br>
            		English&nbsp;:&nbsp;
					<input type="text" name="fixetext" value="<?=$fixetext?>" style="width=80%" class="textbox">ห้ามใช้ ,<br>
					ตำแหน่ง  X&nbsp;:&nbsp;
					<input type="text" name="fld_x" value="<?=$fld_x?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y" value="<?=$fld_y?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;ข้อความยาว&nbsp;:&nbsp;
					<input type="text" name="fld_w" value="<?=$fld_w?>" style="width=10%" class="textbox"><br>
					จัดตำแหน่ง&nbsp;:&nbsp;
					<input type="radio" name="text_align" value="L" <?=($text_align=="L")?"checked":""?>>&nbsp;ชิดซ้าย&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="text_align" value="C" <?=($text_align=="C")?"checked":""?>>&nbsp;กลาง&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="text_align" value="R" <?=($text_align=="R")?"checked":""?>>&nbsp;ชิดขวา<br>
					ตัวอักษร&nbsp;:&nbsp;
					<input type="text" name="font_name" value="<?=$font_name?>" style="width=40%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_font1" value="ตัวอักษร" class="button" onClick="call_font('<?=$font_name?>,<?=$text_align?>');"><br>
					สีตัวอักษร&nbsp;:&nbsp;
					<input type="text" name="font_color" value="<?=$font_color?>" style="width=25%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_fcol1" value="สีตัวอักษร" class="button" onClick="call_color(1);"><br>
					<input type="button" name="btn_remove" value="ลบรายการ" class="button" onClick="call_deldetail();" <?=$command=="ADD"?"disabled":""?>>
					&nbsp;&nbsp;
					<input type="button" name="btn_det_cancel" value="ยกเลิกแก้ไข" class="button" onClick="call_det_cancel();">
        	<? } elseif ($fld_type=="variable") { ?>
					ชื่อ&nbsp;:&nbsp;
					<select class="selectbox" name="fldname" onChange="" <?=($command=="UPDATE" && $fldname!="New Variable")?"disabled":""?>>
                    <? $k=0; 
                    	 foreach($var_name as $key => $value) { ?>
						<option value="<?=$key?>" <?=($fldname)=="$key"?"selected":""?>>
                        	<?=$value?>
						</option>
					<? } ?>
					</select>&nbsp;&nbsp;<br>
            		ข้อความ&nbsp;:&nbsp;
					<input type="text" name="fixtext1" value="<?=$showfixtext?>" style="width=80%" class="textbox" disabled>
                    <br>
                    ตำแหน่ง  X&nbsp;:&nbsp;
					<input type="text" name="fld_x" value="<?=$fld_x?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y" value="<?=$fld_y?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;ข้อความยาว&nbsp;:&nbsp;
					<input type="text" name="fld_w" value="<?=$fld_w?>" style="width=10%" class="textbox"><br>
					จัดตำแหน่ง&nbsp;:&nbsp;
					<input type="radio" name="text_align" value="L" <?=($text_align=="L")?"checked":""?>>&nbsp;ชิดซ้าย&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="text_align" value="C" <?=($text_align=="C")?"checked":""?>>&nbsp;กลาง&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="text_align" value="R" <?=($text_align=="R")?"checked":""?>>&nbsp;ชิดขวา<br>
					ตัวอักษร&nbsp;:&nbsp;
					<input type="text" name="font_name" value="<?=$font_name?>" style="width=40%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_font2" value="ตัวอักษร" class="button" onClick="call_font('<?=$font_name?>,<?=$text_align?>');"><br>
					สีตัวอักษร&nbsp;:&nbsp;
					<input type="text" name="font_color" value="<?=$font_color?>" style="width=25%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_fcol2" value="สีตัวอักษร" class="button" onClick="call_color(1);">
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <input name="multiline" type="checkbox" value="lines" <?=($multiline=="lines")?"checked":""?>>หลายบรรทัด<br>
					<input type="button" name="btn_remove" value="ลบข้อมูล" class="button" onClick="call_deldetail();" <?=$command=="ADD"?"disabled":""?>>
					&nbsp;&nbsp;
					<input type="button" name="btn_det_cancel" value="ยกเลิกแก้ไข" class="button" onClick="call_det_cancel();">
        	<? } elseif ($fld_type=="image") { ?>
					ชื่อแฟ้มภาพ&nbsp;:&nbsp;
					<input type="text" name="imagename" value="<?=$imagename?>" style="width=70%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_upload" value="Upload" class="button" onClick="call_upload();"><br>
					ตำแหน่ง  X&nbsp;:&nbsp;
					<input type="text" name="fld_x" value="<?=$fld_x?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y" value="<?=$fld_y?>" style="width=10%" class="textbox"><br>
					ขนาด  กว้าง&nbsp;:&nbsp;
					<input type="text" name="fld_w" value="<?=$fld_w?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;สูง&nbsp;:&nbsp;
					<input type="text" name="fld_h" value="<?=$fld_h?>" style="width=10%" class="textbox"><br>
					<input type="button" name="btn_remove" value="ลบข้อมูล" class="button" onClick="call_deldetail();" <?=$command=="ADD"?"disabled":""?>>
					&nbsp;&nbsp;
					<input type="button" name="btn_det_cancel" value="ยกเลิกแก้ไข" class="button" onClick="call_det_cancel();">
        	<? } elseif ($fld_type=="background") { ?>
					ชื่อแฟ้มพื้นหลัง&nbsp;:&nbsp;
					<input type="text" name="imagename" value="<?=$imagename?>" style="width=70%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_upload" value="Upload" class="button" onClick="call_upload();"><br>
					ตำแหน่ง  X&nbsp;:&nbsp;
					<input type="text" name="fld_x" value="<?=$fld_x?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y" value="<?=$fld_y?>" style="width=10%" class="textbox"><br>
					ขนาด  กว้าง&nbsp;:&nbsp;
					<input type="text" name="fld_w" value="<?=$fld_w?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;สูง&nbsp;:&nbsp;
					<input type="text" name="fld_h" value="<?=$fld_h?>" style="width=10%" class="textbox"><br>
					<input type="button" name="btn_remove" value="ลบข้อมูล" class="button" onClick="call_deldetail();" <?=$command=="ADD"?"disabled":""?>>
					&nbsp;&nbsp;
					<input type="button" name="btn_det_cancel" value="ยกเลิกแก้ไข" class="button" onClick="call_det_cancel();">
        	<? } elseif ($fld_type=="line") { ?>
<!--					ชื่อเส้น&nbsp;:&nbsp;
					<input type="hidden" name="linename" value="<?=$linename?>" style="width=80%" class="textbox"><br>-->
					<input type="hidden" name="linename" value="<?=$linename?>">
					ตำแหน่ง 1 X&nbsp;:&nbsp;
					<input type="text" name="fld_x1" value="<?=$fld_x1?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y1" value="<?=$fld_y1?>" style="width=10%" class="textbox"><br>
					ตำแหน่ง 2 X&nbsp;:&nbsp;
					<input type="text" name="fld_x2" value="<?=$fld_x2?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y2" value="<?=$fld_y2?>" style="width=10%" class="textbox"><br>
					สีเส้น&nbsp;:&nbsp;
					<input type="text" name="line_color" value="<?=$line_color?>" style="width=35%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_fcol3" value="..สีเส้น.." class="button" onClick="call_color(2);"><br>
					เส้นหนา&nbsp;:&nbsp;
					<input type="text" name="line_w" value="<?=$line_w?>" style="width=10%" class="textbox"><br>
					<input type="button" name="btn_remove" value="ลบข้อมูล" class="button" onClick="call_deldetail();" <?=$command=="ADD"?"disabled":""?>>
					&nbsp;&nbsp;
					<input type="button" name="btn_det_cancel" value="ยกเลิกแก้ไข" class="button" onClick="call_det_cancel();">
        	<? } elseif ($fld_type=="rect") { ?>
<!--				ชื่อกล่อง&nbsp;:&nbsp;
					<input type="hidden" name="boxname" value="<?=$boxname?>" style="width=80%" class="textbox"><br>-->
					<input type="hidden" name="boxname" value="<?=$boxname?>">
					ตำแหน่ง 1 X&nbsp;:&nbsp;
					<input type="text" name="fld_x1" value="<?=$fld_x1?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y1" value="<?=$fld_y1?>" style="width=10%" class="textbox"><br>
					ตำแหน่ง 2 X&nbsp;:&nbsp;
					<input type="text" name="fld_x2" value="<?=$fld_x2?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;Y&nbsp;:&nbsp;
					<input type="text" name="fld_y2" value="<?=$fld_y2?>" style="width=10%" class="textbox"><br>
					สีเส้น&nbsp;:&nbsp;
					<input type="text" name="line_color" value="<?=$line_color?>" style="width=35%" class="textbox" readonly>
					&nbsp;&nbsp;
					<input type="button" name="btn_fcol4" value="..สีเส้น.." class="button" onClick="call_color(2);"><br>
					เส้นหนา&nbsp;:&nbsp;
					<input type="text" name="line_w" value="<?=$line_w?>" style="width=10%" class="textbox">
					&nbsp;&nbsp;&nbsp;&nbsp;แบบเส้น&nbsp;:&nbsp;
					<input type="text" name="box_style" value="<?=$box_style?>" style="width=10%" class="textbox"><br>
					<input type="button" name="btn_remove" value="ลบข้อมูล" class="button" onClick="call_deldetail();" <?=$command=="ADD"?"disabled":""?>>
					&nbsp;&nbsp;
					<input type="button" name="btn_det_cancel" value="ยกเลิกแก้ไข" class="button" onClick="call_det_cancel();">
        <? 	 } // end if check $fld_type
        	 } //	end if ($command!="ADD")
		?>
        </fieldset>
    </tr>
  </table>
  </form>	
		</td>
	</tr>
</table>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
</html>
