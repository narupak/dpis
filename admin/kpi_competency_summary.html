<? 
	include("../php_scripts/connect_database.php");
	include("php_scripts/kpi_competency_summary.php"); 
?>
<html>
<head>
<title><?=$webpage_title?> - <?=$MENU_TITLE_LV0?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<link rel="stylesheet" href="<?=$cssfileselected?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/>
</head>
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">

	function call_salf_sum( ) {
		form1.S_KF_ID.value="";
	}

	function call_sub_sum( s_kf_id ) {
		form1.S_KF_ID.value=s_kf_id;
		form1.submit();
	}

	function call_develop_plan( kf_id, cp_code, nextlevel) {
		parameter = "&KF_ID="+kf_id+"&CP_CODE="+cp_code+"&GONEXT_LEVEL="+nextlevel;
//		alert(parameter);
	    call_openDialog("per_develop_plan.html?MENU_ID_LV0=<?=$MENU_ID_LV0?>&MENU_ID_LV1=<?=$MENU_ID_LV1?>&MENU_ID_LV2=<?=$MENU_ID_LV2?>&MENU_ID_LV3=<?=$MENU_ID_LV3?>" + parameter,800,600,"แผนการพัฒนาสมรรถนะรายบุคคล");		
	}

	function call_develop_sum_report( KF_ID ) {
//		alert( KF_ID );
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 

		rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
//		document.form1.target = "_blank";
//		document.form1.action = "report/rpt_kpi_competency_xls.php?KF_ID=" + KF_ID + "&UTC" + rptDate;
//		document.form1.submit();
		
//		document.form1.target = "_salf";
//		document.form1.action = "kpi_competency_summary.html";
		newwin = window.open("report/rpt_kpi_competency_xls.php?KF_ID=" + KF_ID + "&UTC" + rptDate);
	}

	function call_per_competency_report( KF_ID ) {
//		alert( KF_ID );
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
		
		rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
//		document.form1.target = "_blank";
//		document.form1.action = "report/rpt_per_competency_metowho_xls.php?KF_ID=" + KF_ID + "&UTC" + rptDate;
//		document.form1.submit();
		
//		document.form1.target = "_salf";
//		document.form1.action = "kpi_competency_summary.html";
		newwin = window.open("report/rpt_per_competency_metowho_xls.php?KF_ID=" + KF_ID + "&UTC" + rptDate);
	}

	function call_pd_plan_report( KF_ID, r_type ) {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 

		rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
//		document.form1.target = "_blank";
		if (r_type == 1) {
//			document.form1.action = "report/rpt_per_develop_plan_xls.php?KF_ID=" + KF_ID + "&UTC" + rptDate;
			run_rep = "report/rpt_per_develop_plan_xls.php?KF_ID=" + KF_ID + "&UTC" + rptDate;
		} else {
//			document.form1.action = "report/rpt_per_develop_plan.php?KF_ID=" + KF_ID + "&UTC" + rptDate;
			run_rep = "report/rpt_per_develop_plan.php?KF_ID=" + KF_ID + "&UTC" + rptDate;
		}
//		document.form1.submit();
		
//		document.form1.target = "_salf";
//		document.form1.action = "kpi_competency_summary.html";
		newwin = window.open(run_rep);
	}
	
	function call_graph ( graph_id ) {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();

		kf_para = "KF_ID="+document.form1.KF_ID.value+"&S_KF_ID="+document.form1.S_KF_ID.value;
		
		if(graph_id==1){run_graph = "../graph/types/Bar.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==2){run_graph = "../graph/types/Bar.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC=" + rptDate;}
			else if(graph_id==3){run_graph = "../graph/types/BarGrp2.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC=" + rptDate;}
			else if(graph_id==4){run_graph = "../graph/types/BarGrp2.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==5){run_graph = "../graph/types/Bar.php?gid=rpt_kpi_competency_graph3.php&"+kf_para+"&UTC=" + rptDate;}
			else if(graph_id==6){run_graph = "../graph/types/BarGrp2.php?gid=rpt_kpi_competency_graph3.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==7){run_graph = "../graph/types/Line.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==8){run_graph = "../graph/types/Line.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==9){run_graph = "../graph/types/LineGrp2.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==10){run_graph = "../graph/types/LineGrp2.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==11){run_graph = "../graph/types/Pie2One.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==12){run_graph = "../graph/types/Pie2One.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==13){run_graph = "../graph/types/PieGrp2.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==14){run_graph = "../graph/types/PieGrp2.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==15){run_graph = "../graph/types/BarStack.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==16){run_graph = "../graph/types/BarStack.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==17){run_graph = "../graph/types/BarStackGrp2.php?gid=rpt_kpi_competency_graph1.php&"+kf_para+"&UTC" + rptDate;}
			else if(graph_id==18){run_graph = "../graph/types/BarStackGrp2.php?gid=rpt_kpi_competency_graph2.php&"+kf_para+"&UTC" + rptDate;}

		newwin = window.open(run_graph);
	} 

	function call_kpi_re_compute( ) {
		document.form1.command.value = "RECOMPUTE";
		document.form1.submit();
	}

</script>
<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
  	<tr>
    	<td align="left" valign="top">
		<form name="form1" method="post" action="kpi_competency_summary.html" enctype="multipart/form-data">
		  <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0?>">
		  <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1?>">
		  <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2?>">
		  <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3?>">
          <input type="hidden" name="command" value="">
          <input type="hidden" name="KF_ID" value="<?=$KF_ID?>">
          <input type="hidden" name="S_KF_ID" value="<?=$S_KF_ID?>">
  			<table width="100%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    			<tr>
      				<td>
						<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
        					<tr class="table_head">
         						<td height="25" class="table_head">&nbsp;&nbsp;สรุปผลการประเมินสมรรถนะของข้าราชการ <B><?=$DEPARTMENT_NAME?></B></td><td></td>
        					</tr>
        					<tr class="table_head">
         						<td height="25" class="table_head">&nbsp;&nbsp;ประจำรอบการประเมินครั้งที่ <B><?=$KF_CYCLE?></B> พ.ศ. <B><?=$KF_YEAR?></B>  <?=$ORG_TITLE?> <B><?=$ORG_NAME?></B></td>
								<td><input type="button" name="btn_per_competency_report" class="button" value="รายงานรายการการประเมิน" onClick="call_per_competency_report(<? echo ($S_KF_ID ? $S_KF_ID : $KF_ID); ?>);"></td>
        					</tr>
        					<tr class="table_head">
								<? $label1=($S_KF_ID ? "ผู้ตรวจผล" : "ผลประเมินของ"); ?>
         						<td height="25" class="table_head">&nbsp;&nbsp;<?=$label1?>&nbsp;&nbsp;<B><U><?=$PER_ID?></U>&nbsp;&nbsp;<U><?=$PER_NAME?></U></B>&nbsp;&nbsp;ชื่อตำแหน่งงาน <B><?=$PL_NAME?></B>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
								<input type="submit" name="submit1" class="button" value="แสดงผลประเมิน" onClick="call_salf_sum();">
								</td>
								<td>	<input type="button" name="btn_develop_report" class="button" value="รายงานสรุปผลการประเมิน" onClick="call_develop_sum_report(<? echo ($S_KF_ID ? $S_KF_ID : $KF_ID); ?>);"></td>
							</tr>
        					<tr class="table_head">
								<td height="25" class="table_head">&nbsp;</td>
								<td>
										<select name="Graph" size="1" >
										  <option selected value="JavaScript:call_graph(1);">กราฟแท่งผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(2);">กราฟแท่งสรุปผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(3);">กราฟแท่งผลการประเมินสลับแกน</option>
										  <option selected value="JavaScript:call_graph(4);">กราฟแท่งสรุปผลการประเมินสลับแกน</option>
										  <option selected value="JavaScript:call_graph(5);">กราฟแท่งสรุปผลต่างที่ต้องพัฒนา</option>
										  <option selected value="JavaScript:call_graph(6);">กราฟแท่งสรุปผลต่างที่ต้องพัฒนาสลับแกน</option>
										  <option selected value="JavaScript:call_graph(7);">กราฟเส้นผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(8);">กราฟเส้นสรุปผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(9);">กราฟเส้นผลการประเมินสลับแกน</option>
										  <option selected value="JavaScript:call_graph(10);">กราฟเส้นสรุปผลการประเมินสลับแกน</option>
										  <option selected value="JavaScript:call_graph(11);">กราฟวงกลมผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(12);">กราฟวงกลมสรุปผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(13);">กราฟวงกลมผลการประเมินสลับแกน</option>
										  <option selected value="JavaScript:call_graph(14);">กราฟวงกลมสรุปผลการประเมินสลับแกน</option>
										  <option selected value="JavaScript:call_graph(15);">กราฟชั้นผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(16);">กราฟชั้นสรุปผลการประเมิน</option>
										  <option selected value="JavaScript:call_graph(17);">กราฟชั้นผลการประเมินสลับแกน</option>
										  <option selected value="JavaScript:call_graph(18);">กราฟชั้นสรุปผลการประเมินสลับแกน</option>
									    </select>
	  									<input type="button" value="แสดงผล" onClick="location=document.form1.Graph.options[document.form1.Graph.selectedIndex].value">
								</td>
        					</tr>
          				</table>
          			</td>
        		</tr>
				<tr> <td height="15"></td> </tr>
				<? if ($S_KF_ID) { ?>
					<tr>
   						<td height="25" class="table_head">&nbsp;ผลประเมินของ&nbsp;:&nbsp;<B><U><?=$CF_PER_ID?></U>&nbsp;&nbsp;<U><?=$CF_PER_NAME?></U></B>&nbsp;&nbsp;ผู้ใต้บังคับบัญชา ตำแหน่งงาน <B><?=$CF_PL_NAME?></B></td>
					</tr>					
					<tr> <td height="15"></td> </tr>
				<? } ?>
				<table width="100%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
        			<tr  align="center" class="table_head">
						<td height="25" align="center" width="6%"><?=$SEQ_NO_TITLE?></td>
						<td height="25" align="center" width="30%">สมรรถนะ</td>
						<td height="25" align="center" width="16%">ประเภท</td>
						<td height="25" align="center" width="6%">เป้าหมาย</td>
						<td height="25" align="center" width="6%">ตนเอง (<?=$arr_percent[1]?>%)</td>
						<td height="25" align="center" width="6%">ผู้บังคับบัญชา (<?=$arr_percent[2]?>%)</td>
						<td height="25" align="center" width="6%">เพื่อนร่วมงาน (<?=$arr_percent[3]?>%)</td>
						<td height="25" align="center" width="6%">ผู้ใต้บังคับบัญชา (<?=$arr_percent[4]?>%)</td>
						<td height="25" align="center" width="6%">สรุปคะแนน</td>
						<td height="25" align="center" width="6%">ส่วนต่าง (Gap)</td>
						<td height="25" align="center" width="6%">การพัฒนา</td>
					</tr>
					<?
					$class = "table_body";
					$onmouse_event = " onMouseOver=\"this.className='table_body_over';\" onMouseOut=\"this.className='table_body';\" ";

					for($data_count=0; $data_count<count($arr_content); $data_count++) {
						// อ่านข้อมูลลูกน้อง
						$cmd = "  select PC_TARGET_LEVEL, KC_EVALUATE, KC_WEIGHT from PER_KPI_COMPETENCE 
										where KF_ID=$THIS_KF_ID and trim(CP_CODE)='".$arr_content[$data_count][code]."'  ";
						$db_dpis->send_cmd($cmd);
//						$db_dpis->show_error();
						$data = $db_dpis->get_array();
						$GET_TARGET = $data[PC_TARGET_LEVEL];
						$GET_EVALUATE = $data[KC_EVALUATE];

						for($sumcolcnt=1; $sumcolcnt < 5; $sumcolcnt++) { 
					 		$arr_content[$data_count][$sumcolcnt] = $arr_content[$data_count][$sumcolcnt] / $arr_n[$data_count][$sumcolcnt];
					 		$arr_content[$data_count][5] = $arr_content[$data_count][5] + ($arr_content[$data_count][$sumcolcnt] * $arr_percent[$sumcolcnt] / 100);
						}
						$KC_EVALUATE = round($arr_content[$data_count][5],2);
						$TARGET_LEVEL = $arr_content[$data_count][0];
//						if ($arr_content[$data_count][5] > 0) {
						?>
 					<tr  class="<?=$class?>" <?=$onmouse_event?>>
						<td height="25" align="center">
							<? echo $data_count+1; ?>
						</td>
						<td>
							<?=$arr_content[$data_count][name]?>
						</td>
						<td>
							<?=$arr_content[$data_count][type]?>
						</td>
						<td height="25" align="center">
							<? echo ($arr_content[$data_count][0]==0 ? "-" : ($TARGET_LEVEL==$GET_TARGET ? "" : "*").$arr_content[$data_count][0].""); ?>
						</td>
						<? for($sumcolcnt=1; $sumcolcnt < 5; $sumcolcnt++) { ?>
							<td height="25" align="center">
								<? echo ($arr_content[$data_count][$sumcolcnt]==0 ? "-" : "".$arr_content[$data_count][$sumcolcnt].""); ?>
							</td>
						<? } ?>
						<td height="25" align="center">
							<? 
								echo ($arr_content[$data_count][5]==0 ? "-" : ($KC_EVALUATE==$GET_EVALUATE ? "" : "*").$KC_EVALUATE); 
							?>
						</td>
						<td height="25" align="center">
							<? 
								$arr_content[$data_count][gap] = $arr_content[$data_count][5] - $arr_content[$data_count][0];
								echo ($arr_content[$data_count][gap]==0 ? "-" : "".$arr_content[$data_count][gap].""); 
							?>
						</td>
						<td height="25" align="center">
							<? 
								if ($arr_content[$data_count][gap] < 0) {
									$gap_level = -ceil(abs($arr_content[$data_count][gap])); // ระดับต่าง gap ทำเป็น + ปัดเศษ 
									$evaluate_level = floor($KC_EVALUATE)+1;
							?>
									<input type="button" name="btn_develop_plan" class="button" value=" .<?=$evaluate_level?>. " onClick="call_develop_plan(<?=$KF_ID?>, <?=$arr_content[$data_count][code]?>, <?=$evaluate_level?>);">
							<? 
								}
							?>
						</td>
					</tr>
					<?
//						} // end if ($COUNT_TOTAL > 0)
					} // end loop for $data_count
					?>
				</table>
				<table width="100%">
					<tr>
				<table width="100%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
        			<tr  align="center" >
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="30%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="16%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" width "18%" align="right">&nbsp;ถ้าผลคะแนนที่ได้น้อยกว่าเป้าหมาย ให้ถือว่าเกิด Gap	</td>
        			</tr>
        			<tr  align="center" >
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="30%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="16%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" width "18%" align="right">	
							<input type="button" name="btn_kpi_re_compute" class="button" value="คำนวนผลคะแนนใหม่" onClick="call_kpi_re_compute(<?=($S_KF_ID?$S_KF_ID:$KF_ID)?>,1);">
						</td>
        			</tr>
        			<tr  align="center" >
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="30%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="16%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" align="center" width="6%">&nbsp;&nbsp;</td>
						<td height="25" width "18%" align="left">	
							<input type="button" name="btn_pdplan_report1" class="button" value="รายงานสรุปแผนการพัฒนา(Excel)" onClick="call_pd_plan_report(<?=($S_KF_ID?$S_KF_ID:$KF_ID)?>,1);">&nbsp;&nbsp;<input type="button" name="btn_pdplan_report2" class="button" value="รายงานสรุปแผนการพัฒนา(PDF)" onClick="call_pd_plan_report(<?=($S_KF_ID?$S_KF_ID:$KF_ID)?>,2);">
						</td>
        			</tr>
				</table>
      		</table>
		</form>
		</td>
    </tr>
</table>
<!-- แสดงรายการผู้ใต้บังคับบัญชา -->
<table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table">
    <tr>
      <td>
	  	<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="label_normal">
        	<tr>
          		<td height="5"></td>
        	</tr>
        	<tr>
          		<td>
					<table width="100%" border="0" cellpadding="0" cellspacing="0" class="label_normal">
            			<tr>
              				<td height="22" colspan="2" class="black_bold">&nbsp;&nbsp;ผู้ใต้บังคับบัญชา&nbsp;:&nbsp;</td>
              			</tr>
            			<tr>
              				<td height="22" colspan="2" align="left">
						<? // อ่านข้อมูลลูกน้อง
							$db_dpis2 = new connect_dpis($dpisdb_host, $dpisdb_name, $dpisdb_user, $dpisdb_pwd, $dpisdb_port);

							$cmd = " select PER_ID, KF_ID from PER_KPI_FORM where CHIEF_PER_ID=$PER_ID ";
							$db_dpis2->send_cmd($cmd);
//							$db_dpis2->show_error();
							while ($data2 = $db_dpis2->get_array()) {
								$SUB_KF_ID=$data2[KF_ID];
								$cmd = " select 	PN_CODE, PER_NAME, PER_SURNAME, LEVEL_NO, PER_TYPE, POS_ID, POEM_ID, POEMS_ID, POT_ID
						 						from		PER_PERSONAL
						 						where	PER_ID=$data2[PER_ID] ";
								$db_dpis->send_cmd($cmd);
//								$db_dpis->show_error();
								$data = $db_dpis->get_array();
								$CF_PER_ID = $ARR_ASS_PER_ID[$i];
								$ASS_PN_CODE = trim($data[PN_CODE]);
								$ASS_PER_NAME = trim($data[PER_NAME]);
								$ASS_PER_SURNAME = trim($data[PER_SURNAME]);
								$ASS_LEVEL_NO = trim($data[LEVEL_NO]);
								$ASS_PER_TYPE = trim($data[PER_TYPE]);
								$ASS_POS_ID = trim($data[POS_ID]);
								$ASS_POEM_ID = trim($data[POEM_ID]);
								$ASS_POEMS_ID = trim($data[POEMS_ID]);
								$ASS_POT_ID = trim($data[POT_ID]);

								// หา status ของรายการประเมิน (=1 ประเมินเสร็จแล้ว) ของแต่ละตน		
//								$cmd = " select KF_ID, CF_PER_ID, CF_STATUS from PER_COMPETENCY_FORM where KF_ID = $KF_ID And CF_PER_ID = $CF_PER_ID ";
//								$db_dpis->send_cmd($cmd);
//								$data = $db_dpis->get_array();
//								$C_STATUS = $data[CF_STATUS];

								$cmd = " select PN_NAME from PER_PRENAME where trim(PN_CODE)='$ASS_PN_CODE' ";
								$db_dpis->send_cmd($cmd);
								$data = $db_dpis->get_array();
								$ASS_PN_NAME = trim($data[PN_NAME]);
		
								$ASS_PER_NAME = $ASS_PN_NAME . $ASS_PER_NAME . " " . $ASS_PER_SURNAME;

								$cmd = " select LEVEL_NAME, POSITION_LEVEL from PER_LEVEL where trim(LEVEL_NO)='$ASS_LEVEL_NO' ";
								$db_dpis->send_cmd($cmd);
								$data = $db_dpis->get_array();
								$ASS_LEVEL_NAME = trim($data[LEVEL_NAME]);
								$ASS_POSITION_LEVEL = $data[POSITION_LEVEL];
								if (!$ASS_POSITION_LEVEL) $ASS_POSITION_LEVEL = $ASS_LEVEL_NAME;

								if($ASS_PER_TYPE==1){
									$cmd = " select 	a.POS_NO, b.PL_NAME, c.ORG_NAME, a.PT_CODE 
						 							from 		PER_POSITION a, PER_LINE b, PER_ORG c
						 							where	a.POS_ID=$ASS_POS_ID and a.PL_CODE=b.PL_CODE and a.ORG_ID=c.ORG_ID ";
									$db_dpis->send_cmd($cmd);
									$data = $db_dpis->get_array();
									$ASS_POS_NO = $data[POS_NO];
									$ASS_PL_NAME = trim($data[PL_NAME]);
									$ASS_ORG_NAME = trim($data[ORG_NAME]);
									$ASS_PT_CODE = trim($data[PT_CODE]);
									$cmd = " select PT_NAME from PER_TYPE where trim(PT_CODE)='$ASS_PT_CODE' ";
									$db_dpis->send_cmd($cmd);
									$data = $db_dpis->get_array();
									$ASS_PT_NAME = trim($data[PT_NAME]);
									$ASS_PL_NAME = trim($ASS_PL_NAME)?($ASS_PL_NAME . $ASS_POSITION_LEVEL . (($ASS_PT_NAME != "ทั่วไป" && $ASS_LEVEL_NO >= 6)?"$ASS_PT_NAME":"")):" ".$ASS_POSITION_LEVEL;
									
								}elseif($ASS_PER_TYPE==2){
									$cmd = " select 	b.PN_NAME, c.ORG_NAME 
						 							from 	PER_POS_EMP a, PER_POS_NAME b, PER_ORG c
						 							where	a.POEM_ID=$ASS_POEM_ID and a.PN_CODE=b.PN_CODE and a.ORG_ID=c.ORG_ID ";
									$db_dpis->send_cmd($cmd);
									$data = $db_dpis->get_array();
									$ASS_PL_NAME = trim($data[PN_NAME]);
									$ASS_ORG_NAME = trim($data[ORG_NAME]);
								}elseif($ASS_PER_TYPE==3){
									$cmd = " select 	b.EP_NAME, c.ORG_NAME 
						 							from 		PER_POS_EMPSER a, PER_EMPSER_POS_NAME b, PER_ORG c
						 							where	a.POEMS_ID=$ASS_POEMS_ID and a.EP_CODE=b.EP_CODE and a.ORG_ID=c.ORG_ID ";
									$db_dpis->send_cmd($cmd);
									$data = $db_dpis->get_array();
									$ASS_PL_NAME = trim($data[EP_NAME]);
									$ASS_ORG_NAME = trim($data[ORG_NAME]);
								}elseif($ASS_PER_TYPE==4){
									$cmd = " select 	b.TP_NAME, c.ORG_NAME 
						 							from 	PER_POS_TEMP a, PER_TEMP_POS_NAME b, PER_ORG c
						 							where	a.POT_ID=$ASS_POT_ID and a.TP_CODE=b.TP_CODE and a.ORG_ID=c.ORG_ID ";
									$db_dpis->send_cmd($cmd);
									$data = $db_dpis->get_array();
									$ASS_PL_NAME = trim($data[TP_NAME]);
									$ASS_ORG_NAME = trim($data[ORG_NAME]);
								} // end if
//								$chkdisable=($C_STATUS==1 ? "disabled=\"disabled\"":"");
//								$checked=(($CF_TYPE==1 || $CF_TYPE==2) ? "checked": "");
								echo "&nbsp;&nbsp;$CF_PER_ID&nbsp;&nbsp;$ASS_PER_NAME&nbsp;&nbsp;-&nbsp;&nbsp;$ASS_PL_NAME&nbsp;&nbsp;-&nbsp;&nbsp;$ASS_ORG_NAME";?>
								<input name="btn_kf_<?=$SUB_KF_ID?>" type="button" class="button" onClick="call_sub_sum(<?=$SUB_KF_ID?>)" value=" ... ">
								<? echo "<br>";
							} //end while loop
						?>
			  				</td>
              			</tr>
						<tr>
							<td>&nbsp;</td>
						</tr>
          			</table>
				</td>
        	</tr>
      </table>
	 </td>
   </tr>
</table>
<?
	include("jqModalDialog.html");
?>
</body>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
</script>
</html>
