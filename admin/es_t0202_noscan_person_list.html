<? 
	include("../php_scripts/connect_database.php");
	include("php_scripts/load_per_control.php");
	include("../php_scripts/calendar_data.php");
    
	include("php_scripts/es_t0202_noscan_person_list.php"); 
    if($select_org_structure==""){$select_org_structure=1;}
    $search_per_status = (isset($search_per_status))?  $search_per_status : 2;
    
    switch($CTRL_TYPE){
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
	} // end switch case

	switch($SESS_USERGROUP_LEVEL){								
		case 2 :
			$search_pv_code = $PROVINCE_CODE;
			$search_pv_name = $PROVINCE_NAME;
			$PROVINCE_CODE = $PROVINCE_CODE;
			$PROVINCE_NAME = $PROVINCE_NAME;
			break;
		case 3 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			break;
		case 4 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			break;
		case 5 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
		case 6 :
			$search_ministry_id = $MINISTRY_ID;
			$search_ministry_name = $MINISTRY_NAME;
			$search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
			$search_org_id = $ORG_ID;
			$search_org_name = $ORG_NAME;
			$search_org_id_1 = $ORG_ID_1;
			$search_org_name_1 = $ORG_NAME_1;
			$MAIN_MINISTRY_ID = $MINISTRY_ID;
			$MAIN_MINISTRY_NAME = $MINISTRY_NAME;
			$MAIN_DEPARTMENT_ID = $DEPARTMENT_ID;
			$MAIN_DEPARTMENT_NAME = $DEPARTMENT_NAME;
			$MAIN_ORG_ID = $ORG_ID;
			$MAIN_ORG_NAME = $ORG_NAME;
			break;
	} // end switch case
    
    
    //หาว่าอยู่กลุ่ม กจ. กรม หรือไม่--------------------------------
    $cmd4 = "	select	 b.CODE from	user_detail a, user_group b
					where a.group_id=b.id AND a.ID=".$SESS_USERID;
    $db_dpis2->send_cmd($cmd4);
    $data4 = $db_dpis2->get_array();
    if ($data4[CODE]) {
        $NAME_GROUP_HRD = $data4[CODE];
    }else{
        $NAME_GROUP_HRD = "";
    }
    

    
    //-ถ้าไม่ใช่กลุ่ม admin กับกลุ่ม กจ. กรม จะเอาหน่วยงานตามหมอบหมายงาน
 
    if ( ($SESS_USERGROUP !=1 && $NAME_GROUP_HRD!='HRD') ){
    	$select_org_structure=1;
        $PER_AUDIT_FLAG=1;
        if(empty($Submit3) && empty($image2) && empty($HIDSORT)  ){
           
            $search_department_id = $DEPARTMENT_ID;
			$search_department_name = $DEPARTMENT_NAME;
            
           if($SESS_AuditArray[0][0] <>0){

                $cmd_ass = " select ORG_ID,ORG_NAME from PER_ORG_ASS where ORG_ID = ".$SESS_AuditArray[0][0]; 
                $db_dpis2->send_cmd($cmd_ass);
                $data_ass = $db_dpis2->get_array();
                $search_org_name = $data_ass[ORG_NAME];
                $search_org_id = $data_ass[ORG_ID];
            }
            
            if($SESS_AuditArray[0][1] <>0){
				 $cmd_l1 = " select ORG_ID,ORG_NAME from PER_ORG_ASS where ORG_ID=".$SESS_AuditArray[0][1]; 
                $db_dpis2->send_cmd($cmd_l1);
                $data_l1 = $db_dpis2->get_array();
                $search_org_name_1 = $data_l1[ORG_NAME];
                $search_org_id_1 = $data_l1[ORG_ID];
             }
            
            

            
            
        }
        
    }
    
    
    
    /*-------------------------------------------------------------*/
    
    if( !$current_page ) $current_page = 1;
	if(!$data_per_page) $data_per_page = 30;
	$start_record = ($current_page - 1) * $data_per_page;
    
    //ค้นเฉพาะของ กจ. สำนัก ไม่เอาจากกลุ่มแดมิน กับ กจ. กรม
    if ( ($SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD')  ){
    	if($search_onlyme_flag==1){
          $arr_search_condition[] = " (wch.CREATE_USER not in
          				 (select	a.ID from	user_detail a, user_group b
					where a.group_id=b.id 
                    AND (b.ID=1 OR b.CODE='HRD')
                    
                    ) )";
        }
    
    }
    
    if ( ($SESS_USERGROUP !=1 && $NAME_GROUP_HRD!='HRD')  ){
        $tCon="(";
        for ($i=0; $i < count($SESS_AuditArray); $i++) {
            if ($i>0)
                $tCon .= " or ";
            $tCon .= "(a.ORG_ID=" .$SESS_AuditArray[$i][0];
            if ($SESS_AuditArray[$i][1] != 0)
                $tCon .= ' and a.ORG_ID_1='. $SESS_AuditArray[$i][1];
            $tCon .= ")";
        }
        $tCon .= ")";
        $arr_search_condition[] = $tCon;
    	
        if($search_org_id && !$search_org_id_1 ){
        	$arr_search_condition[] = "(a.ORG_ID=$search_org_id )";
        }else if($search_org_id && $search_org_id_1){
        	$arr_search_condition[] = "(a.ORG_ID=$search_org_id AND a.ORG_ID_1=$search_org_id_1 )";
        }
       

        }else{
        	if($search_org_id_1){ /* Release 5.1.0.4 */
                if($select_org_structure==0){ //โครงสร้างตามกฎหมาย
                    $arr_search_condition[] = "(c.ORG_ID_1=$search_org_id_1 or d.ORG_ID_1=$search_org_id_1 or e.ORG_ID_1=$search_org_id_1 or j.ORG_ID_1=$search_org_id_1)";
                }else if($select_org_structure==1){ //โครงสร้างตามมอบหมายงาน
                    $arr_search_condition[] = "(a.ORG_ID_1=$search_org_id_1)";
                }
            
            }elseif($search_org_id){
                if($select_org_structure==0){
                    $arr_search_condition[] = "(c.ORG_ID=$search_org_id or d.ORG_ID=$search_org_id or e.ORG_ID=$search_org_id or j.ORG_ID=$search_org_id)";
                }else if($select_org_structure==1){
                    $arr_search_condition[] = "(a.ORG_ID=$search_org_id)";
                }
            }elseif($search_department_id){
                $arr_search_condition[] = "(a.DEPARTMENT_ID = $search_department_id)";
            }elseif($search_ministry_id){
                unset($arr_department);
                $cmd = " select ORG_ID from PER_ORG where ORG_ID_REF=$search_ministry_id and OL_CODE='02' ";
                if($SESS_ORG_STRUCTURE==1){	$cmd = str_replace("PER_ORG","PER_ORG_ASS",$cmd); 	}
                $db_dpis->send_cmd($cmd);
                while($data = $db_dpis->get_array()) $arr_department[] = $data[ORG_ID];
                $arr_search_condition[] = "(a.DEPARTMENT_ID in (". implode(",", $arr_department) ."))";
            }elseif($PROVINCE_CODE){
                $cmd = " select distinct ORG_ID_REF from PER_ORG where PV_CODE='$PROVINCE_CODE' and OL_CODE='03' ";
                if($SESS_ORG_STRUCTURE==1){	$cmd = str_replace("PER_ORG","PER_ORG_ASS",$cmd); 	}
                $db_dpis->send_cmd($cmd);
                while($data = $db_dpis->get_array()) $arr_department[] = $data[ORG_ID_REF];
                $arr_search_condition[] = "(a.DEPARTMENT_ID in (". implode(",", $arr_department) ."))";
            } // end if  
        
	
    	}
    

	if(trim($search_per_status) < 5) {
		$temp_per_status = $search_per_status - 1;		
		$arr_search_condition[] = "(a.PER_STATUS = $temp_per_status)";	
	}
   
   	if(trim($search_name)) $arr_search_condition[] = "(a.PER_NAME like '".trim($search_name)."%' or UPPER(a.PER_ENG_NAME) like UPPER('".trim($search_name)."%'))";
   	 if(trim($search_surname)) $arr_search_condition[] = "(a.PER_SURNAME like '".trim($search_surname)."%' or UPPER(a.PER_ENG_SURNAME) like UPPER('".trim($search_surname)."%'))";
  

    if(trim($search_cardno)) $arr_search_condition[] = "(a.PER_CARDNO ='".trim($search_cardno)."')";
    if(trim($search_offno)) $arr_search_condition[] = "(a.PER_OFFNO ='".trim($search_offno)."')";
    
    if(trim($search_pos_no))  {	
		if ($search_per_type == 1 || $search_per_type==5)
			$arr_search_condition[] = "(trim(c.POS_NO) = '".trim($search_pos_no)."')";
		elseif ($search_per_type == 2) 
			$arr_search_condition[] = "(trim(d.POEM_NO) = '".trim($search_pos_no)."')";		
		elseif ($search_per_type == 3) 	
			$arr_search_condition[] = "(trim(e.POEMS_NO) = '".trim($search_pos_no)."')";
		elseif ($search_per_type == 4) 	
			$arr_search_condition[] = "(trim(j.POT_NO) = '".trim($search_pos_no)."')";
		else if ($search_per_type==0)		//ทั้งหมด
			$arr_search_condition[] = "((trim(c.POS_NO) = '".trim($search_pos_no)."') or (trim(d.POEM_NO) = '".trim($search_pos_no)."') or (trim(e.POEMS_NO) = '".trim($search_pos_no)."') or (trim(j.POT_NO) = '".trim($search_pos_no)."')) ";
	}
    
    if(trim($search_pos_no_name)){
		if ($search_per_type == 1 || $search_per_type==5)
			$arr_search_condition[] = "(trim(c.POS_NO_NAME) like '".trim($search_pos_no_name)."%')";
		elseif ($search_per_type == 2) 
			$arr_search_condition[] = "(trim(d.POEM_NO_NAME) like '".trim($search_pos_no_name)."%')";		
		elseif ($search_per_type == 3) 	
			$arr_search_condition[] = "(trim(e.POEMS_NO_NAME) like '".trim($search_pos_no_name)."%')";
		elseif ($search_per_type == 4) 	
			$arr_search_condition[] = "(trim(j.POT_NO_NAME) like '".trim($search_pos_no_name)."%')";
		else if ($search_per_type==0)		//ทั้งหมด
			$arr_search_condition[] = "((trim(c.POS_NO_NAME) like '".trim($search_pos_no_name)."%') or (trim(d.POEM_NO_NAME) like '".trim($search_pos_no_name)."%') or 
			(trim(e.POEMS_NO_NAME) like '".trim($search_pos_no_name)."%') or (trim(j.POT_NO_NAME) like '".trim($search_pos_no_name)."%')) ";
	}
    
    if(trim($search_pay_no))  $arr_search_condition[] = "(trim(c.POS_NO) = '$search_pay_no' and a.PER_TYPE = 1)";
    if(trim($search_level_no)) $arr_search_condition[] = "(trim(a.LEVEL_NO) = '". trim($search_level_no) ."')";
    if(trim($search_pl_code)) $arr_search_condition[] = "(trim(c.PL_CODE) = '". trim($search_pl_code) ."')";
    if(trim($search_pm_code)) $arr_search_condition[] = "(trim(c.PM_CODE) = '". trim($search_pm_code) ."')";
    if(trim($search_per_type)) 	$arr_search_condition[] = "(a.PER_TYPE = $search_per_type)";
    
    
    if($search_date_min && $search_date_max){ 
		 $tmpsearch_date_min =  save_date($search_date_min);
         $tmpsearch_date_max =  save_date($search_date_max);
         $arr_search_condition[] = " (   (substr(wch.START_DATE,1,10)  BETWEEN '$tmpsearch_date_min' and '$tmpsearch_date_max') 
         					or  (substr(wch.END_DATE,1,10) BETWEEN '$tmpsearch_date_min' and '$tmpsearch_date_max' ) 
                            or ( '$tmpsearch_date_min'  BETWEEN substr(wch.START_DATE,1,10) and substr(wch.END_DATE,1,10) )
    						or ( '$tmpsearch_date_max'  BETWEEN substr(wch.START_DATE,1,10) and substr(wch.END_DATE,1,10) )
                            )";
	}else if($search_date_min && empty($search_date_max)){ 
		 $tmpsearch_date_min =  save_date($search_date_min);
         $arr_search_condition[] = " ('$tmpsearch_date_min' BETWEEN substr(wch.START_DATE,1,10) and  ( CASE WHEN wch.END_DATE IS NOT NULL THEN substr(wch.END_DATE,1,10) ELSE to_char(sysdate,'yyyy-mm-dd') END) ) ";
    }else if(empty($search_date_min) && $search_date_max){ 
		 $tmpsearch_date_max =  save_date($search_date_max);
         $arr_search_condition[] = " ('$tmpsearch_date_max' BETWEEN substr(wch.START_DATE,1,10) and ( CASE WHEN wch.END_DATE IS NOT NULL THEN substr(wch.END_DATE,1,10) ELSE to_char(sysdate,'yyyy-mm-dd') END) ) ";
    }

    
    
    $search_condition = "";
	if(count($arr_search_condition)) $search_condition = " and " . implode(" and ", $arr_search_condition);

	$Tmpsearch_CANCEL_FLAG = "";
    if($search_CANCEL_FLAG==1 || empty($search_CANCEL_FLAG)) {  
    		$Tmpsearch_CANCEL_FLAG = " AND  wch.CANCEL_FLAG=1 ";  
    }else if($search_CANCEL_FLAG==2) {  
            $Tmpsearch_CANCEL_FLAG = " AND  wch.CANCEL_FLAG=0 AND wch.REC_ID =(select max(REC_ID) as REC_ID FROM TA_SET_EXCEPTPER WHERE PER_ID=wch.PER_ID)  ";
    }else if($search_CANCEL_FLAG==3) {  
            $Tmpsearch_CANCEL_FLAG = " AND wch.REC_ID =(select max(REC_ID) as REC_ID FROM TA_SET_EXCEPTPER WHERE PER_ID=wch.PER_ID)  ";
    }
    
    
    $cmd = " select 	count(distinct a.PER_ID) as count_data 
                         from  PER_PERSONAL a  
                                            left join  TA_SET_EXCEPTPER wch on(a.PER_ID=wch.PER_ID)
                                            left join PER_ORG b on(b.ORG_ID=a.ORG_ID) 
                                            left join PER_POSITION c on(c.POS_ID=a.POS_ID) 
                                            left join PER_POS_EMP d on(d.POEM_ID=a.POEM_ID) 
                                            left join PER_POS_EMPSER e on(e.POEMS_ID=a.POEMS_ID) 
                                            left join PER_LEVEL f on(f.LEVEL_NO=a.LEVEL_NO) 
                                            left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                                            left join PER_MGT h on(h.PM_CODE=c.PM_CODE)
                                            left join PER_LINE i on(i.PL_CODE=c.PL_CODE)
                                            left join PER_POS_TEMP j on (j.POT_ID=a.POT_ID)
                         where 		1=1
                         				$Tmpsearch_CANCEL_FLAG
                                        $search_condition ";
        $db_dpis->send_cmd($cmd);
        $data = $db_dpis->get_array();
        $data = array_change_key_case($data, CASE_LOWER);
		$count_data = $data[count_data];	
?>

<html>
<head>
<title><?=$webpage_title;?> - <?=$MENU_TITLE_LV0;?><?if($MENU_ID_LV1){?> - <?=$MENU_TITLE_LV1;?><?}?><?if($MENU_ID_LV2){?> - <?=$MENU_TITLE_LV2;?><?}?><?if($MENU_ID_LV3){?> - <?=$MENU_TITLE_LV3;?><?}?></title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-874">
<META HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE"> <!--//---เพิ่มมาจาก personal_master_form--->
<META HTTP-EQUIV="Cache-Control" CONTENT="NO-CACHE"> <!--//---เพิ่มมาจาก personal_master_form--->
<link rel="stylesheet" href="<?=$cssfileselected;?>" type="text/css">
<link rel="alternate stylesheet" type="text/css" media="all" href="stylesheets/calendar-blue.css" title="winter"/> <!--//---เพิ่มมาจาก personal_master_form--->
</head>
<!-------------------------------------------------------------------------------------------->
<script type="text/javascript" src="java_scripts/chk_date.js"></script>
<script type="text/javascript" src="java_scripts/calendar.js"></script>
<script type="text/javascript" src="java_scripts/calendar-th.js"></script> 
<!-------------------------------------------------------------------------------------------->
<script type="text/javascript" src="java_scripts/function_utility.js"></script> 
<script language="JavaScript">
	function change_current_page( page ){
		form1.HIDSORT.value=1;
		form1.current_page.value = page;
		form1.submit();
	}

	function changedateformat(name,str) {
		var arr = str.split('/');
		if((str) && (str != arr[0]+'/'+arr[1]+'/'+arr[2])){
			name.value = str.substr(0,2) + "/" + str.substr(2,2) + "/"  + str.substr(4,4) ;
		}
		chk_date(name, "BDH");
	}
	
	function confirm_delete(data_id , data_label,dateStart){
		if(confirm("คุณต้องการลบข้อมูลนี้ [ " + data_label + " วันที่ "+dateStart+"]  ใช่หรือไม่ ?")){
			form1.command.value = "DELETE";
			form1.HIDREC_ID.value = data_id;
			form1.submit();
		} // end if
	}
	
    function MM_openBrWindow(theURL,winName,features) { //v2.0
	  window.open(theURL,winName,features);
	}

    function call_rtf_pdf_report(report_type) {
	    var  report_type
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")));?>";

		 if (report_type==1){
		document.form1.action = "report/rpt_es_t0202_noscan_person.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate+"&FLAG_RTF=1";
		}else if (report_type==0){ 
		document.form1.action = "report/rpt_es_t0202_noscan_person.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate+"&FLAG_RTF=0";
		}
		
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "es_t0202_noscan_person_list.html";
	} 
	
	function call_export_file() {
		var currDate = new Date();
		var rptDate = currDate.getFullYear().toString() + currDate.getMonth().toString() + currDate.getDate().toString(); 
			   rptDate += currDate.getHours().toString() + currDate.getMinutes().toString() + currDate.getSeconds().toString();
		var report_title = "รายงานข้อมูล<?=($MENU_ID_LV3)?$MENU_TITLE_LV3:(($MENU_ID_LV2)?$MENU_TITLE_LV2:(($MENU_ID_LV1)?$MENU_TITLE_LV1:(($MENU_ID_LV0)?$MENU_TITLE_LV0:"")));?>";
		document.form1.action = "report/rpt_es_t0202_noscan_person_xls.php?report_title=" + encodeURIComponent(report_title) + "&table=<?=$table;?>&UTC" + rptDate;
		
		document.form1.submit();
		document.form1.target = "_self";
		document.form1.action = "es_t0202_noscan_person_list.html";
	}	
        function call_menu_desc(cate, id, name, per_id) {	
                var ulink = cfile+'?CATEGORY='+cate+'&PER_ID='+ per_id+'&UPFOR='+name+'&LAST_SUBDIR='+id;		
                parameter = "";
                MM_openBrWindow(ulink+"&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&HIDE_HEADER=1<?=($MAIN_VIEW?"&MAIN_VIEW=1":"");?>&getdate=<?=date('YmdHis');?>" + parameter,'moreeditor','toolbar=no,location=no,status=yes,menubar=no,scrollbars=yes,resizable=yes,width=950,height=1200');
        }
	function call_sort(flag) {
		form1.order_by.value=flag;		form1.sort_by.value=flag;
		if(form1.sort_type.value==flag+":asc"){
			form1.sort_type.value=flag+":desc";
		}else{ //desc
			form1.sort_type.value=flag+":asc";
		}		
		form1.command.value='SEARCH';
		form1.HIDSORT.value=1;
		form1.submit();
	} // end function call_sort
	
	function call_add_person() {
		var PerSonID=form1.HideID.value;	
	    call_openDialog("es_search_noscan_person.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	}
	
	function call_add_personShow() {
		var PerSonID=form1.HideID.value;	
	    call_openDialog("es_search_noscan_person_show.html?send_by=es_search_noscan_person&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"รายชื่อบุคลากร");		
	}
	
	function call_add_personShowHis(PerSonID) {
	    call_openDialog("es_search_noscan_person_his.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&PerSonID="+PerSonID,1000,700,"ประวัติได้รับการยกเว้นไม่ต้องลงเวลา");		
	}
	
	function call_search_ministry() {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$MINISTRY_TITLE;?>");		
	}
	
	function call_search_department() {	
		var MINISTRY_ID = <?=(($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3)?"$MINISTRY_ID":"form1.search_ministry_id.value");?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(MINISTRY_ID != ""){
			parameter = "&send_by=search_department&OL_CODE=02&ORG_ID_REF=" + MINISTRY_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog("search_org.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$DEPARTMENT_TITLE;?>");		
		}else{
			<? if($CTRL_TYPE==3 || $SESS_USERGROUP_LEVEL==3){ ?>
			alert('<?=$MINISTRY_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$MINISTRY_ALERT;?>');
			form1.btn_ministry.focus();
			<? } ?>
		} // end if
	}	
	
	function returnFrom(src, returnValue){
		 if  (src.indexOf("search_org") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				if (arrValue[7]=="search_ministry") {
					form1.search_ministry_id.value = arrValue[0];
					form1.search_ministry_name.value = arrValue[1];
					form1.search_department_id.value = "";
					form1.search_department_name.value = "";
					form1.search_org_id.value = "";
					form1.search_org_name.value = "";
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_department") {
					form1.search_department_id.value = arrValue[0];
					form1.search_department_name.value = arrValue[1];
					form1.search_org_id.value = "";
					form1.search_org_name.value = "";
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_org_0") {
					form1.search_org_id.value = arrValue[0];
					form1.search_org_name.value = arrValue[1];
					form1.search_org_id_1.value = "";
					form1.search_org_name_1.value = ""; 
				} else if (arrValue[7]=="search_org1") {
					form1.search_org_id_1.value = arrValue[0];
					form1.search_org_name_1.value = arrValue[1];
				}
			} // end if
	
		} else if  (src.indexOf("search_mgt") > -1) {
			if(returnValue){
				arrValue = returnValue.split("<::>");
				form1.search_pm_code.value = arrValue[0];
				form1.search_pm_name.value = arrValue[1];
			} // end if
			
		} else if  (src.indexOf("search_perline") > -1 || src.indexOf("search_pos_name") > -1 || src.indexOf("search_empser_pos_name") > -1 || src.indexOf("search_temp_pos_name") > -1) {
			if(returnValue){
			    arrValue = returnValue.split("<::>");
				form1.search_pl_code.value = arrValue[0];
				form1.search_pl_name.value = arrValue[1];
			} // end if
				
		}else{
			arrValue = returnValue.split("<::>");
			if(arrValue[0]=='es_add_noscan_person_dop'){
				form1.command.value='SEARCH';
				form1.submit();
			}else{
				form1.HideID.value = arrValue[1];
				var TotalNum = 0;
				if(arrValue[1] !=""){
					var Total = arrValue[1].split(",");
					TotalNum=Total.length;
					document.getElementById("btn_ministryShow").style.display='';
				}else{
					document.getElementById("btn_ministryShow").style.display='none';
				}
				document.getElementById("DIVPERSONNOSCAN_ID").innerHTML = "<br>รายชื่อบุคลากร ทั้งสิ้นที่เลือกไว้ <font color='red'>"+TotalNum+"</font> รายการ <br>";
				
			}
			
		}	
		
		tt.value = returnValue;
		
	} // end if
	
		function call_search_result () {	
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		parameter = "&send_by=search_ministry&OL_CODE=01&PV_CODE=" + PROVINCE_CODE;
	    call_openDialog("es_search_noscan_result.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,850,600,"รายชื่อบุคคลากรที่ยังไม่ได้กำหนดรอบการมาปฏิบัติราชการ   ");		
	}	
	
	function selValue(){
		
		var inputElems = document.getElementsByTagName("input"),
        count = 0;
		
        for (var i=0; i<inputElems.length; i++) {       
           if (inputElems[i].type == "checkbox" && inputElems[i].name.substr(0,15)=="PERSONNOSCAN_ID" ){
              count++;

           }

        }

		var valID = '';
		for(i=1;i<=count;i++){
		
				if(eval("form1.PERSONNOSCAN_ID"+i+".checked")==true){
					valID = valID +eval("form1.PERSONNOSCAN_ID"+i+".value")+",";
				}
		
		}
		
		var valStrID = valID.substr(0,valID.length - 1);
		form1.HideID.value = valStrID;
	}
	
	function SaveData(f){
		if(f.TIME_START.value=="") {
                    alert("กรุณาเลือก วันที่ได้รับการยกเว้น");
                    f.TIME_START.focus();
                    return false;

		} 
		if(f.TIME_START.value !="" && f.TIME_END.value !="") {
                    arrValueS = f.TIME_START.value.split("/");
                    arrValueE = f.TIME_END.value.split("/");
                    var START =arrValueS[2]+''+arrValueS[1]+''+arrValueS[0];
                    var END = arrValueE[2]+''+arrValueE[1]+''+arrValueE[0];
                    if(parseInt(START) > parseInt(END)){
                        alert("วันที่สิ้นสุด ต้องมากกว่า วันที่เริ่มต้น");
                        f.TIME_END.focus();
                        return false;
                    }
			
		} 
		if(f.HideID.value==""){
                    alert('กรุณาเลือก รายชื่อบุคลากร');
                    return false;
		}
		
		if(f.FLAG_PRINT.checked==true){
                    if(f.REMARK.value=="") {
                        alert('กรุณากรอกข้อมูล หมายเหตุ');
                        f.REMARK.focus();
                        return false;
                    }
		}
                $("#Submit_add").prop('disabled',true);
                $("#Submit_add").css('cursor','not-allowed');
		form1.submit();
	}
	
	function CHKDuplicateDate() {
		  if(form1.TIME_START.value !="") {
			  
        		var req = new XMLHttpRequest();  //Inint_AJAX();
				req.onreadystatechange = function () {
					if (req.readyState==4) {
					   // alert(req.responseText);
						if (req.status==200) {
							document.getElementById('HIDDuplicateDate').value = req.responseText;
						}else{
							document.getElementById('HIDDuplicateDate').value =0;
						}
						
					}
					
            	};
			
			
				var url = 'php_scripts/ajget_DuplicateDate.php';
				req.open("GET", url+'?PER_ID='+form1.HIDPER_ID.value+'&TIME_START='+form1.TIME_START.value+'&TIME_END='+form1.TIME_END.value+'&REC_ID='+form1.HIDREC_ID.value);
				req.setRequestHeader("Content-Type", "application/json;charset=utf-8"); // set Header
				req.send(); //ส่งค่า
				
		}

    }
	
	function UpdateData(f){
		
		
		if(f.TIME_START.value=="") {
			alert("กรุณาเลือก วันที่ได้รับการยกเว้น");
			f.TIME_START.focus();
			return false;
		}
		
		if(f.TIME_START.value !="" && f.TIME_END.value !="") {
			arrValueS = f.TIME_START.value.split("/");
			arrValueE = f.TIME_END.value.split("/");
			var START =arrValueS[2]+''+arrValueS[1]+''+arrValueS[0];
			var END = arrValueE[2]+''+arrValueE[1]+''+arrValueE[0];
			if(parseInt(START) > parseInt(END)){
				alert("วันที่สิ้นสุด ต้องมากกว่า วันที่เริ่มต้น");
				f.TIME_END.focus();
				return false;
			}
			
		}
		
		

		if(document.getElementById('HIDDuplicateDate').value==1){
			alert("เลือกวันที่ซ้ำ กรุณาตรวจสอบข้อมูลประวัติ");
			f.TIME_START.focus();
			return false;
		}
		
		if(f.FLAG_PRINT.checked==true){
			if(f.REMARK.value=="") {
				alert('กรุณากรอกข้อมูล หมายเหตุ');
				f.REMARK.focus();
				return false;
			}
		}

		//form1.submit();
	}
	
	function call_search_org_0() {	
		var DEPARTMENT_ID = <?=(($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4)?"$DEPARTMENT_ID":"form1.search_department_id.value");?>;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(DEPARTMENT_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="es_search_org_ass"; 
			parameter = "&send_by=search_org_0&OL_CODE=03&ORG_ID_REF=" + DEPARTMENT_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,900,600,"<?=$ORG_TITLE;?>");		
		
		}else{
				<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
				alert('<?=$DEPARTMENT_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
				alert('<?=$DEPARTMENT_ALERT;?>');
				form1.btn_department.focus();
			<? } ?>
		} // end if
	}
	
	function call_search_org1() {	
		var ORG_ID = form1.search_org_id.value;
		var PROVINCE_CODE = "<?=($CTRL_TYPE==2 || $SESS_USERGROUP_LEVEL==2)?"$PROVINCE_CODE":"";?>";
		if(ORG_ID != ""){
			if(form1.select_org_structure[0].checked) org_search_file ="search_org";
			else if(form1.select_org_structure[1].checked) org_search_file ="es_search_org_ass"; 
			parameter = "&send_by=search_org1&OL_CODE=04&ORG_ID_REF=" + ORG_ID + "&PV_CODE=" + PROVINCE_CODE;
		    call_openDialog(org_search_file+".html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$ORG_TITLE1;?>");		
		}else{
			<? if($CTRL_TYPE==4 || $SESS_USERGROUP_LEVEL==4){ ?>
			alert('<?=$ORG_ALERT;?> (กำหนดค่าเริ่มต้นหน่วยงาน)');
			<? }else{ ?>
			alert('<?=$ORG_ALERT;?>');
			form1.btn_org_1.focus();
			<? } ?>
		} // end if
	}
	
	
	
	
	function call_search_perline() {	
		var parameter = "";
		var PER_TYPE = form1.search_per_type.options[form1.search_per_type.options.selectedIndex].value
		parameter = "&PER_TYPE="+PER_TYPE;
		if(PER_TYPE==1 || PER_TYPE == 0){
		    call_openDialog("search_perline.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POSITION_TITLE;?>");		
		}else if(PER_TYPE==2){
		    call_openDialog("search_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_EMP_TITLE;?>");		
		}else if(PER_TYPE==3){
		    call_openDialog("search_empser_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_EMPSER_TITLE;?>");		
		}else if(PER_TYPE==4){
		    call_openDialog("search_temp_pos_name.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$POS_TEMP_TITLE;?>");		
		}
	}
	
	function call_search_mgt() {	
		var parameter = "";
	    call_openDialog("search_mgt.html?MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>" + parameter,800,600,"<?=$PM_TITLE;?>");		
	}
	
	
	function ChkdelAll(obj){
		
		var count = document.forms[0].elements.length;
		for (i=0; i<count; i++) 
		{
			var element = document.forms[0].elements[i]; 
			if(element.type == 'checkbox' && obj.checked){
				
				if(element.type == 'checkbox' && element.name.substr(0,6)=="ChkDel" )
				 {
					 	element.checked=true;	
				   }
				  
			}else{
				
				if(element.type == 'checkbox' && element.name.substr(0,6)=="ChkDel" )
				 {
					 element.checked=false; 
				  }
			}
	
		}
		
		var valID = '';
		for(x=1;x<=form1.hdnLine.value;x++){
			if(eval("form1.ChkDel"+x+".checked")==true){
				
				valID = valID +eval("form1.ChkDel"+x+".value")+",";
			}
			
		}
		var valStrID = valID.substr(0,valID.length - 1);
		form1.HidedelID.value = valStrID;
		
	}
	
	
	function CheckDel(){

		var valID = '';
		for(x=1;x<=form1.hdnLine.value;x++){
			if(eval("form1.list_show_id"+x+".checked")==false){
				
				valID = valID +eval("form1.list_show_id"+x+".value")+",";
			}
			
		}
		var valStrID = valID.substr(0,valID.length - 1);
		form1.HidedelID_F.value = valStrID;
		
		var valID1 = '';
		for(x=1;x<=form1.hdnLine.value;x++){
			if(eval("form1.list_show_id"+x+".checked")==true){
				
				valID1 = valID1 +eval("form1.list_show_id"+x+".value")+",";
			}
			
		}
		var valStrID1 = valID1.substr(0,valID1.length - 1);
		form1.HidedelID_T.value = valStrID1;
		
	}
	
	
	function seldelValue(){
		var StrChk = false;
		for(i=1;i<=form1.hdnLine.value;i++){
		
				if(eval("form1.ChkDel"+i+".checked")==true){
					StrChk = true;
				}
		}
		
		if(StrChk== false){
			alert('กรุณาเลือกรายชื่อบุคลากร');
			return false;
		}else{
			if(confirm("คุณต้องการลบ ใช่หรือไม่ ?")){
				form1.submit();
			} // end if
	    }
	

}
	
	
function ResetData(f){
	
	f.search_org_name.value="";
	f.search_org_id.value="";
	f.search_org_name_1.value="";
	f.search_org_id_1.value="";
	if(form1.PER_AUDIT_FLAG.value !=1){
		document.getElementById('select_org_structure1').checked=true;
	}
	f.search_name.value="";
	f.search_surname.value="";
	f.search_cardno.value="";
	f.search_offno.value="";
	<? if($POSITION_NO_CHAR=="Y"){?>
	f.search_pos_no_name.value="";
	<? }?>
	f.search_pos_no.value="";
	<? if($SESS_DEPARTMENT_NAME=="กรมการปกครอง"){?>
	f.search_pay_no.value="";
	<? }?>
	f.search_level_no.value="";
	f.search_pl_name.value="";
	f.search_pl_code.value="";
	f.search_pm_name.value="";
	f.search_pm_code.value="";
	f.search_per_type.value="0";
	//f.search_per_status_workcyclehis.value="1";
	f.search_date_min.value="";
	f.search_date_max.value="";
	f.search_CANCEL_FLAG.value="1";
	

}

function ResetDataSave(f){
	document.getElementById("DIVPERSONNOSCAN_ID").innerHTML = "";		
	f.HideID.value = "";
	f.TIME_START.value="";
	f.TIME_END.value="";
	f.REMARK.value="";
	
	document.getElementById("btn_ministryShow").style.display='none';

}

</script>
<?  //เช็คปุ่มที่ได้ค่าออกมา ว่าเป็นปุ่มเพิ่มหรือแก้ไข 
	if($PAGE_AUTH["edit"]=="Y" && $UPD) 
	$Submit = "Submit_edit";
	else if(!$VIEW && $PAGE_AUTH["add"]=="Y") 
	$Submit = "Submit_add";    
?>

<span id="defaultTheme"></span>
<body>
<table width="100%" border="0" cellspacing="0" cellpadding="0" class="label_normal">
	<tr>
    	<td height="10"><? include("header_menu.html");?></td>
  	</tr>
    <tr> 
	  <td align="left" valign="top">
<?	
		if ($UPD) $OPTIONAL_TITLE=" &gt; แก้ไขข้อมูล"; elseif ($VIEW) $OPTIONAL_TITLE=" &gt; ดูข้อมูล";
		include("current_location.html");
?>
	  </td>
	</tr>
  	<tr>
    	<td align="left" valign="top"><form name="form1" method="post" action="es_t0202_noscan_person_list.html" enctype="multipart/form-data">
        <input type="hidden" name="current_page" value="<?=$current_page;?>">
        <input type="hidden" name="total_page" value="<?=$total_page;?>">
        <input type="hidden" name="MENU_ID_LV0" value="<?=$MENU_ID_LV0;?>">
        <input type="hidden" name="MENU_ID_LV1" value="<?=$MENU_ID_LV1;?>">
        <input type="hidden" name="MENU_ID_LV2" value="<?=$MENU_ID_LV2;?>">
        <input type="hidden" name="MENU_ID_LV3" value="<?=$MENU_ID_LV3;?>">
        <input type="hidden" name="command" value="<?=$command;?>">
        <input type="hidden" name="table" value="<?=$table;?>">
        <input type="hidden" name="HIDREC_ID" value="<?=$HIDREC_ID;?>">
        <input type="hidden" name="HIDPER_ID" value="<?=$HIDPER_ID;?>">
        <input type="hidden" name="HID_SESS_ORG_SETLEVEL" value="<?=$SESS_ORG_SETLEVEL;?>">
        <input type="hidden" name="HidedelID_F" value="">
        <input type="hidden" name="HidedelID_T" value="">
        <input type="hidden" name="PER_AUDIT_FLAG" value="<?=$PER_AUDIT_FLAG;?>">
        <input type="hidden" name="NAME_GROUP_HRD" value="<?=$NAME_GROUP_HRD;?>">
        <input type="hidden" name="HIDSORT" value="<?=$HIDSORT;?>">
        
        <input type="hidden" name="HIDDuplicateDate" id="HIDDuplicateDate" value="0">
            
            &nbsp;
<table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
		  <tr>
		  	<td height="22" align="center" class="table_body"><?=($UPD)?"แก้ไข":"เพิ่ม";?>ข้อมูล</td>
		  </tr>		
	  </table></td>
	</tr>
  </table>
  <table width="95%" align="center" cellpadding="0" cellspacing="0" class="input_table" 
  onKeyPress="return keyEnter(event,document.form1.<?=$Submit;?>);">
    <tr>
      <td>
      
      <? if($UPD){?>
      <table width="100%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
        <tr height="5">
          <td width="18%"></td>
          <td width="30%"></td>
          <td width="16%"></td>
          <td width="31%"></td>
          </tr>
        	
        	
        	<tr>
        	  <td align="right" height="25">ชื่อ-สกุล&nbsp;:&nbsp;</td>
        	  <td >&nbsp;<?=$FULLNAME_SHOW;?></td>
        	  <td  align="right">ตำแหน่งในสายงาน&nbsp;:&nbsp;</td>
        	  <td  height="25">&nbsp;<?=$PL_NAME;?>
        	    
        	    </td>
      	  </tr>
               <tr>
                 <td align="right" height="25">สังกัดสำนัก/กอง&nbsp;:&nbsp;</td>
                 <td >&nbsp;<?=$ORG_NAME;?></td>
                 <td  align="right">ประเภทและระดับตำแหน่ง&nbsp;:&nbsp;</td>
                 <td  height="25">&nbsp;<?=$LEVEL_NAME;?></td>
               </tr>
               <tr>
                 <td height="25" colspan="4" align="right"><hr size="1"></td>
               </tr>
             </table>
             
         <? }?>
      
      <table width="100%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
        <tr>
          <td colspan="2" height="5"></td>
          </tr>
          
               <tr>
          <td width="29%" align="right" height="25"><span class="label_alert">*</span>&nbsp;ช่วงวันที่ได้รับการยกเว้น&nbsp;:&nbsp;</td>
          <td width="71%" height="25">
		  	<input name="TIME_START" type="text" class="textbox" id="TIME_START" value="<?=$TIME_START;?>" style="width:15%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.TIME_START,this.value);CHKDuplicateDate();" onChange="changedateformat(form1.TIME_START,this.value);CHKDuplicateDate();">
		  	<input type="reset" class="button" onClick="return showCalendar('TIME_START', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>">
            -
           <input name="TIME_END" type="text" class="textbox" id="TIME_END" value="<?=$TIME_END;?>" style="width:17%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.TIME_END,this.value);CHKDuplicateDate();" onChange="changedateformat(form1.TIME_END,this.value);CHKDuplicateDate();">
           <input type="reset" class="button" onClick="return showCalendar('TIME_END', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>">
            </td>	   
        </tr>
        <?  if (!$UPD) {  ?>	
         <tr valign="top">
          <td  align="right" height="25"><span class="label_alert">*</span>&nbsp;รายชื่อบุคลากร&nbsp;:&nbsp;</td>
          <td height="25" align="left"><input type="button" name="btn_ministry2" value=" กำหนดบุคลากร " class="button" onClick="call_add_person();" >
            
            <input type="hidden" value="" id="HideID" name="HideID"></input>
            &nbsp;&nbsp;
          <input type="button" name="btn_ministryShow" id="btn_ministryShow" style="display:none"  value=" แสดงรายชื่อที่เลือก " class="button" onClick="call_add_personShow();" >
            <br/>
            <label id="DIVPERSONNOSCAN_ID"></label>
             <br/> 
          </td>
        </tr>
        <? }?>
        
        <tr valign="top">
          <td align="right" height="25">&nbsp;</td>
          <td height="25"><input type="checkbox" name="FLAG_PRINT" id="FLAG_PRINT" value="1" <? if($FLAG_PRINT=='1'){ echo 'checked';}?>>
          พิมพ์ในรายงานการมาปฏิบัติราชการ
          </td>
        </tr>
         <?  if (!$UPD) {  ?>	

        <tr valign="top">
          <td align="right" height="25">&nbsp;แนบไฟล์&nbsp;:&nbsp;</td>
          <td height="25"><input type="file"  name="filename" ></td>
        </tr>
     
        <? }?>  
        <tr valign="top">
          <td width="29%" align="right" height="25">หมายเหตุ&nbsp;:&nbsp;</td>
          <td width="71%" height="25">
		  <textarea name="REMARK" id="REMARK" rows="3" cols="255" maxlength="255" class="selectbox" style="width:70%"><?=$REMARK;?></textarea>
		  </td>
        </tr>
        
        
          
          <?  if ($UPD) {  ?>	
        <tr>
          <td align="right"><?=$UPDATE_USER_TITLE;?>&nbsp;:&nbsp;</td>
          <td colspan="3"><input name="SHOW_UPDATE_USER" type="text" style="width:40%" class="textbox" value="<?=$SHOW_UPDATE_USER;?>" readonly></td>
          </tr>
        <tr>
              <td width="29%" align="right"><?=$UPDATE_DATE_TITLE;?>&nbsp;:&nbsp;</td>
              <td colspan="3"><input name="SHOW_UPDATE_DATE" type="text" style="width:25%" class="textbox" value="<?=$SHOW_UPDATE_DATE;?>" readonly></td>
              </tr>
          <? }?>  

        <tr>
        	<td align="right">&nbsp;</td>
          <td height="30"><? if ($UPD) { 
            if($PAGE_AUTH["edit"]=="Y"){
			  		if ($BUTTON_DISPLAY==1) { ?>
            <input name="Submit_edit" type="submit" class="button" onClick="form1.command.value='UPDATE'; return UpdateData(form1);" value="  <?=$EDIT_TITLE;?>  ">
            <? } else { ?>
            <input name="image" type="image" onClick="form1.command.value='UPDATE';  return UpdateData(form1);" src="images/save.png" alt="<?=$EDIT_TITLE;?>" border="0">
            <?}?>
            <?}
		  		if ($BUTTON_DISPLAY==1) { ?>
            <input type="submit" name="Reset2" value=" <?=$CANCEL_TITLE;?> " onClick="form1.command.value='CANCEL'" class="button" >
        	  <? } else { ?>
        	  <input name="image" type="image" onClick="form1.command.value='CANCEL'" src="images/cancel.gif" alt="<?=$CANCEL_TITLE;?>" border="0">
        	  <?}?>
            <? } else { 
            if($PAGE_AUTH["add"]=="Y"){
			  		if ($BUTTON_DISPLAY==1) { ?>
            <input name="Submit_add" id="Submit_add" type="submit" class="button" onClick="form1.command.value='ADD';  return SaveData(form1);" value="  <?=$ADD_TITLE;?>  ">
            <? } else { ?>
            <input name="image" id="image" type="image" onClick="form1.command.value='ADD';  return SaveData(form1);" src="images/save.png" alt="<?=$ADD_TITLE;?>" border="0">
            <?}?>
            <?}
			  	if ($BUTTON_DISPLAY==1) { ?>
            <input name="Reset2" type="button" onClick="return ResetDataSave(form1);" class="button" value=" <?=$CLEAR_TITLE;?> ">
            <? } else { ?>
            <img src="images/default.jpg" alt="<?=$CLEAR_TITLE;?>" width="32" height="32" border="0" onClick="return ResetDataSave(form1);">&nbsp;
<?}?>
            <?}?></td>
        </tr>
      </table></td>
    </tr>
  </table>
  
  
  
  <table width="95%" align="center" cellpadding="0" cellspacing="0">
  	<tr>
	  <td><table width="15%" cellpadding="0" cellspacing="0" class="input_table" style="border-bottom:none;">
		  <tr>
		  	<td height="22" align="center" class="table_body"><?=$SEARCH_TITLE;?></td>
		  </tr>		
	  </table></td>
	</tr>
  </table>
  <table width="95%" align="center"  border="0" cellspacing="0" cellpadding="0" 
  onKeyPress="return keyEnter(event,document.form1.Submit3);">
        <tr>
          <td align="center" class="input_table">
          
          <table width="100%"  border="0" cellpadding="1" cellspacing="1" class="label_normal">
            <tr>
                        <td height="22" align="right"></td>
                        <td colspan="3">
                        <input name="select_org_structure" id="select_org_structure1" type="radio" value="0" <? if($SESS_USERGROUP !=1 && $NAME_GROUP_HRD!='HRD'){ echo "disabled";}?> <?=($select_org_structure==0 )?"checked":"";?>  onClick="form1.search_org_id.value='';form1.search_org_name.value='';"><?=$LAW_STRUCTURE_TITLE;?>&nbsp;
                    <input name="select_org_structure" id="select_org_structure2" type="radio" value="1" <? if($SESS_USERGROUP !=1 && $NAME_GROUP_HRD!='HRD'){ echo "disabled";}?> <?=($select_org_structure==1)?"checked":"";?>  onClick="form1.search_org_id.value='';form1.search_org_name.value='';"><?=$ASSIGN_STRUCTURE_TITLE;?>
                    
                    </td>
              </tr>
            <tr>
              <td width="18%" height="22" align="right"><?=$MINISTRY_TITLE;?>&nbsp;:&nbsp;</td>
              <td width="32%">
			    <input type="text" name="search_ministry_name" value="<?=$search_ministry_name;?>" style="width:75%; background-color:#F9FBBE; border-width:1px;border-style: inset;border-color: initial; text-rendering: auto;color: initial;letter-spacing: normal;word-spacing: normal;" class="textbox"  readonly="true">
			    <input type="hidden" name="search_ministry_id" value="<?=$search_ministry_id;?>">
				<? if($CTRL_TYPE < 3 && $SESS_USERGROUP_LEVEL < 3){ ?>
			    <input type="button" name="btn_ministry" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_ministry()" >
			    <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_ministry_name.value=''; form1.search_ministry_id.value=''; form1.search_department_name.value=''; form1.search_department_id.value=''; return false;" align="center" alt="ล้างค่า">
				<? } // end if ?>			  </td>
              <td width="18%" align="right"><?=$DEPARTMENT_TITLE;?>&nbsp;:&nbsp;</td>
              <td width="32%">
			    <input type="text" name="search_department_name" value="<?=$search_department_name;?>" style="width:75%; background-color:#F9FBBE; border-width:1px;border-style: inset;border-color: initial; text-rendering: auto;color: initial;letter-spacing: normal;word-spacing: normal;" class="textbox"  readonly="true">
			    <input type="hidden" name="search_department_id" value="<?=$search_department_id;?>">
			    <? if($CTRL_TYPE < 4 && $SESS_USERGROUP_LEVEL < 4){ ?>
				<input type="button" name="btn_department" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_department()" >
			    <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_department_name.value=''; form1.search_department_id.value=''; return false;" align="center" alt="ล้างค่า">
				<? } // end if ?>			  </td>
            </tr>
              
              <tr>
              <td height="22" align="right"><?=$ORG_TITLE?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_org_name" id="search_org_name" value="<?=$search_org_name?>" style="width:75%; background-color:#F9FBBE; border-width:1px;border-style: inset;border-color: initial; text-rendering: auto;color: initial;letter-spacing: normal;word-spacing: normal;" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id" value="<?=$search_org_id?>">

                  <input type="button" name="btn_org" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org_0()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name.value=''; form1.search_org_id.value=''; return false;" align="center" alt="ล้างค่า">
                  </td>
              <td height="22" align="right"><?=$ORG_TITLE1?>&nbsp;:&nbsp;</td>
              <td>
                  <input type="text" name="search_org_name_1" value="<?=$search_org_name_1?>" style="width:75%; background-color:#F9FBBE; border-width:1px;border-style: inset;border-color: initial; text-rendering: auto;color: initial;letter-spacing: normal;word-spacing: normal;" class="textbox"  readonly="true" >
                  <input type="hidden" name="search_org_id_1" value="<?=$search_org_id_1?>">
                  <input type="button" name="btn_org_1" value="<?=$SELECT_TITLE?>" class="button" onClick="call_search_org1()" >
                  <input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_org_name_1.value=''; form1.search_org_id_1.value=''; return false;" align="center" alt="ล้างค่า">
              </td>
            </tr> 
            <tr>
              <td height="22" align="right"><?=$NAME_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_name"  value="<?=$search_name;?>" style="width:75%" class="textbox" ></td>
              <td align="right"><?=$SURNAME_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_surname" value="<?=$search_surname;?>" style="width:75%" class="textbox" ></td>
		      </tr>
            <tr>
              <td height="22" align="right"><?=$CARDNO_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_cardno" value="<?=$search_cardno;?>" style="width:40%" maxlength="13" class="textbox" onKeyPress="return DigitOnly();"></td>
              <td height="22" align="right"><?=$OFFNO_TITLE;?>&nbsp;:&nbsp;</td>
              <td><input type="text" name="search_offno" value="<?=$search_offno;?>" style="width:40%" maxlength="7" class="textbox" onKeyPress="return DigitOnly();"></td>
            </tr>
            <tr>
              <td height="22" align="right"><?=$POS_NO_TITLE;?>&nbsp;:&nbsp;</td>
              <td><? if ($POSITION_NO_CHAR=="Y") { ?>
			  <input type="text" name="search_pos_no_name" value="<?=$search_pos_no_name;?>" style="width:20%" class="textbox"  <?=($_GET[POS_ID])?"readonly":"";?>>
			  	<? } ?>
			  <input type="text" name="search_pos_no" value="<?=$search_pos_no;?>" style="width:40%" class="textbox" onKeyPress="return DigitOnly();" <?=($_GET[POS_ID])?"readonly":"";?>>
			  </td>
				
              <td height="22" align="right"><? if ($SESS_DEPARTMENT_NAME=="กรมการปกครอง") { ?><?=$PAY_NO_TITLE;?><? } else { ?><?=$LEVEL_TITLE;?><? } ?>&nbsp;:&nbsp;</td>
              <td>
              <? if ($SESS_DEPARTMENT_NAME=="กรมการปกครอง") { ?>
              		<input type="text" name="search_pay_no" value="<?=$search_pay_no;?>" style="width:30%" class="textbox" onKeyPress="return DigitOnly();">
              <? } else { ?>
              		<select class="selectbox" name="search_level_no"  onChange="<?=(($PAGE_AUTH["add"]=="Y" || $PAGE_AUTH["edit"]=="Y") && !$VIEW)?" check_salary_type(1, this.value);":"";?>">
                        <option value="" <?=($search_level_no=="")?"selected":"";?>>== <?=$LEVEL_TITLE;?> ==</option>
                        <?
                            $where = "";
                            $cmd = "	select LEVEL_NO_MIN, LEVEL_NO_MAX FROM PER_LINE	where PL_CODE = '$search_pl_code' ";
                            $count_per_line = $db_dpis->send_cmd($cmd);
                            if ($count_per_line) {
                                $data = $db_dpis->get_array();
                                $LEVEL_NO_MIN = trim($data[LEVEL_NO_MIN]); 
                                $LEVEL_NO_MAX = trim($data[LEVEL_NO_MAX]); 
                                $where = "";
                                if ($LEVEL_NO_MIN)
                                    $where .= " and LEVEL_NO >= '$LEVEL_NO_MIN' ";
                                if ($LEVEL_NO_MAX)
                                    $where .= " and LEVEL_NO <= '$LEVEL_NO_MAX' ";
                            }
        
                            $cmd = " select LEVEL_NO, LEVEL_NAME from PER_LEVEL where PER_TYPE = 1 and LEVEL_ACTIVE = 1 $where order by LEVEL_SEQ_NO ";
                            $db_dpis->send_cmd($cmd);
                            while($data = $db_dpis->get_array()){					
                                $TMP_LEVEL_NO = $data[LEVEL_NO];
                                $TMP_LEVEL_NAME = $data[LEVEL_NAME];
                          ?>
                        <option value="<?=$TMP_LEVEL_NO;?>" <?=(trim($search_level_no)==trim($TMP_LEVEL_NO))?"selected":"";?>><?=$TMP_LEVEL_NAME;?></option>
                        <?
                            } // end while
                          ?>
                    </select>
              <? } ?>
              </td>
            </tr>
				<tr>
          <td height="25" align="right"><?=$PL_TITLE;?>&nbsp;:&nbsp;</td>
          <td>
		  	<input type="text" name="search_pl_name" value="<?=$search_pl_name;?>" style="width:75%" class="textbox"  readonly>
            <input type="button" name="Input" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_perline()">
			<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_pl_name.value=''; form1.search_pl_code.value=''; return false;" align="center" alt="ล้างค่า">
			<input type="hidden" name="search_pl_code" value="<?=trim($search_pl_code);?>"></td>
          <td height="25" align="right"><?=$PM_TITLE;?>&nbsp;:&nbsp;</td>
          <td>
		  	<input type="text" name="search_pm_name" value="<?=$search_pm_name;?>" style="width:75%" class="textbox"  readonly>
            <input type="button" name="Input" value="<?=$SELECT_TITLE;?>" class="button" onClick="call_search_mgt()">
			<input type="image" src="images/icon_clear.gif" width="22" height="22" onClick="form1.search_pm_name.value=''; form1.search_pm_code.value=''; return false;" align="center" alt="ล้างค่า">

            <input type="hidden" name="search_pm_code" value="<?=trim($search_pm_code);?>">          </td>
            </tr>
			    
			    <tr>
			  <td height="22" align="right"><?=$PER_TYPE_TITLE;?>&nbsp;:&nbsp;</td>
			  <td><select name="search_per_type" >
			    <?  foreach($PERSON_TYPE as $key=>$value){  
					 $disinput[$key] = "";		$disinput[0]="";		$chinput[$key] = "";		
					if($SESS_PER_TYPE==0){	//ทั้งหมด
					   	if(trim($search_per_type)){
							$chinput[$SESS_PER_TYPE] = "";		$chinput[$search_per_type] = " selected";
						}else{
							$chinput[$SESS_PER_TYPE] = " selected";
						}
					}else{	//ประเภทอื่น
						$chinput[$key]=" selected";		 $chinput[0]="";		$disinput[$key]="";		$styleline[$key]="display:block";
					}
				?><option value="<?=$key;?>" <?=$chinput[$key]." ".$disinput[$key];?>><?=$value;?></option><?  } ?>
			    <? if($SESS_PER_TYPE==0 && $BKK_FLAG!=1){ ?><option value="0" <?=$chinput[0]." ".$disinput[0]; ?>>ทั้งหมด</option><? } ?>
			    </select></td>
			  <td class="label_hilight" height="22" align="right">สถานภาพ&nbsp;:&nbsp;</td>
			  <td><select name="search_per_status" class="selectbox" >
			    <option value="2" <?=($search_per_status==2)?"selected":"";?>>&nbsp;<?=($BKK_FLAG==1)?ครอง:ปกติ?>
			      </option>
			    <option value="1" <?=($search_per_status==1)?"selected":"";?>>&nbsp;รอบรรจุ</option>
			    <option value="3" <?=($search_per_status==3)?"selected":"";?>>&nbsp;<?=($BKK_FLAG==1)?ไม่ครอง:$RETIRE_TITLE?>
			      </option>
			    <? if ($ISCS_FLAG==1){ ?>
			    <option value="4" <?=($search_per_status==4)?"selected":"";?>>&nbsp;รอเลขที่ตำแหน่ง</option>
			    <? } ?>
			    <option value="5" <?=($search_per_status==5)?"selected":"";?>>&nbsp;ทั้งหมด</option>
			    </select></td>
			  </tr>
           
                <tr>
			      <td height="22" align="right">ช่วงวันที่ได้รับการยกเว้น&nbsp;:&nbsp;</td>
			      <td><input name="search_date_min" type="text" class="textbox" id="search_date_min" value="<?=$search_date_min;?>" style="width:32%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_date_min,this.value)">
                <input type="reset" class="button" onClick="return showCalendar('search_date_min', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>">
                &nbsp;-&nbsp;
                <input name="search_date_max" type="text" class="textbox" id="search_date_max" value="<?=$search_date_max;?>" style="width:32%" onKeyPress="return DateOnly();" onBlur="changedateformat(form1.search_date_max,this.value)">
                <input type="reset" class="button" onClick="return showCalendar('search_date_max', 'dd/mm/y');" value="<?=$SELECT_TITLE;?>"></td>
			      <td class="label_hilight" height="22" align="right">สถานะ&nbsp;:&nbsp;</td>
			      <td><select name="search_CANCEL_FLAG" class="selectbox" >
			    <option value="1" <?=($search_CANCEL_FLAG==1)?"selected":"";?>>&nbsp;ใช้งาน</option>
                <option value="2" <?=($search_CANCEL_FLAG==2)?"selected":"";?>>&nbsp;ยกเลิก</option>
			    <option value="3" <?=($search_CANCEL_FLAG==3)?"selected":"";?>>&nbsp;ทั้งหมด</option>
			    </select></td>
		        </tr>
                <?  if ( ($SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD')  ){ ?>
                    <tr>
                      <td height="22" align="right">&nbsp;</td>
                      <td>&nbsp;</td>
                      <td height="22" align="right"><input type="checkbox" name="search_onlyme_flag" id="search_onlyme_flag" value="<?=($search_onlyme_flag)?($search_onlyme_flag):1;?>" <?=(($search_onlyme_flag==1)?"checked":"");?>></td>
                      <td>เฉพาะผู้ตรวจสอบการลาบันทึกรายการ
                      </td>
                    </tr>
           		<? }?>
            <tr>
              <td colspan="4" height="5"></td>
            </tr>          
            <tr>
              <td align="center" colspan="4"><? if ($BUTTON_DISPLAY==1) { ?>
                <input name="Submit3" type="submit" class="button" value="<?=$SEARCH_TITLE;?>" onClick="form1.command.value='SEARCH';form1.current_page.value=0;">
                
                <input name="Reset" type="button" class="button" onClick="return ResetData(form1);" value="<?=$CLEAR_TITLE;?>">
                <? } else { ?>
                <input name="image2" type="image" onClick="form1.command.value='SEARCH';javascript:form1.current_page.value=0;" src="images/search.png" alt="<?=$SEARCH_TITLE;?>">
                 
                <input name="image" type="image" onClick="return ResetData(form1);" src="images/cancel.gif" alt="<?=$CANCEL_TITLE;?>" border="0">
                <?}?></td>
            </tr>

          </table>
          
          
          </td>
        </tr>
		<tr>
		  <td>
		  <table width="95%" border="0" align="center" cellpadding="0" cellspacing="0">
<tr><td><input type="hidden" name="order_by" value="<?=$order_by;?>">
    <input type="hidden" name="sort_by" value="<?=$sort_by;?>">
    <input type="hidden" name="sort_type" value="<?=$sort_type;?>">
    <?=$SORT_TITLE;?>
</td>
</tr>
</table>
		  <table width="100%" border="0" cellpadding="0" cellspacing="0" class="table_body_3">
            <tr>
              <td width="26%" height="22"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_report" type="button" class="button" style="width:150" value="<?=$PDF_TITLE;?>" onClick="call_rtf_pdf_report(0);"> 
				       <? if ($RTF_FLAG==1) { ?>
                <input name="btn21" type="button" class="button" style="width:150" value="<?=$RTF_TITLE;?>" onClick="call_rtf_pdf_report(1);"> 
	                    <? } ?>
                <?  } else { ?>
                <img src="images/doc_icon_pdf.jpg" border="0" alt="<?=$PDF_TITLE;?>" onClick="call_rtf_pdf_report(0);"> 
			        	 <? if ($RTF_FLAG==1) { ?>
                <img src="images/doc_icon_word.jpg" border="0" alt="<?=$RTF_TITLE;?>" onClick="call_rtf_pdf_report(1);"> 
	                     <? } ?>
                <? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
              <td width="59%" align="center">พบข้อมูล <?=$MENU_TITLE_LV2;?> ทั้งสิ้น <?=($count_data);?> รายการ</td>
              <td width="15%" align="right"><? if($PAGE_AUTH["print"]=="Y"){ ?>
                <? if ($BUTTON_DISPLAY==1) { ?>
                <input name="btn_export" type="button" class="button" style="width:130" value="<?=$EXCEL_TITLE;?>" onClick="call_export_file();">
                <?  } else { ?>
                <img src="images/doc_icon_excel.jpg" border="0" alt="<?=$EXCEL_TITLE;?>" onClick="call_export_file();">
                <? } ?>                <? }else{ echo "&nbsp;"; } ?></td>
            </tr>
          </table></td>
		</tr>
  </table>  
  <?
  
  		if(!$sort_by) $sort_by=1;
        if(!$sort_type) $sort_type="1:asc";
        $arrSort=explode(":",$sort_type);
        $SortType[$arrSort[0]]	=$arrSort[1];
        if(!$order_by) $order_by=1;
    
        if($order_by==1){	//(ค่าเริ่มต้น)
            $order_str = "ORDER BY to_number(replace(c.POS_NO,'-','')) ".$SortType[$order_by].", to_number(replace(d.POEM_NO,'-','')) ".$SortType[$order_by].", to_number(replace(e.POEMS_NO,'-','')) ".$SortType[$order_by].", to_number(replace(j.POT_NO,'-','')) ".$SortType[$order_by];
        }elseif($order_by==2) {	//
            $order_str = "ORDER BY a.PER_NAME ".$SortType[$order_by].", a.PER_SURNAME ".$SortType[$order_by];
        } elseif($order_by==3) {	
        	$order_str = "ORDER BY a.POS_ID ".$SortType[$order_by].", a.POEMS_ID ".$SortType[$order_by].", a.POEM_ID ".$SortType[$order_by];
        } elseif($order_by==4) {	     
            $order_str = "ORDER BY f.LEVEL_NAME ".$SortType[$order_by];
        } elseif($order_by==5) {	     
            $order_str = "ORDER BY a.DEPARTMENT_ID ".$SortType[$order_by];
         } elseif($order_by==6) {	     
            $order_str = "ORDER BY a.DEPARTMENT_ID_ASS ".$SortType[$order_by];
        } elseif($order_by==7) {	//
            $order_str = "ORDER BY wch.START_DATE ".$SortType[$order_by];
        } elseif($order_by==8) {	//
            $order_str = "ORDER BY wch.END_DATE ".$SortType[$order_by];
        }
    
		$total_page = ceil( $count_data / $data_per_page );
		$page_link = create_link_page($total_page, $current_page);
		$limit_data = "";
		
		if($DPISDB=="oci8"){
			$rec_start = (($current_page-1) * $data_per_page) + 1;
			$rec_end = ($current_page > 1)? ($current_page * $data_per_page) : $data_per_page;
			$cmd = " select		*
                         from (
                             select		rownum rnum, q1.*
                             from (
                                 select 	distinct
                                 			(select ex1.REC_ID from TA_SET_EXCEPTPER ex1 WHERE ex1.REC_ID  in (select max(ex2.REC_ID) from TA_SET_EXCEPTPER ex2 WHERE ex2.PER_ID=a.PER_ID) ) as REC_ID,
                                            a.PER_TYPE,
                                            g.PN_SHORTNAME||a.PER_NAME||' '||a.PER_SURNAME  AS FULLNAME_SHOW,
                                            (select ex1.START_DATE from TA_SET_EXCEPTPER ex1 WHERE ex1.REC_ID  in (select max(ex2.REC_ID) from TA_SET_EXCEPTPER ex2 WHERE ex2.PER_ID=a.PER_ID) ) as START_DATE,
                                            (select ex1.END_DATE from TA_SET_EXCEPTPER ex1 WHERE ex1.REC_ID  in (select max(ex2.REC_ID) from TA_SET_EXCEPTPER ex2 WHERE ex2.PER_ID=a.PER_ID) ) as END_DATE,
                                            c.POS_NO,d.POEM_NO,e.POEMS_NO,f.LEVEL_NAME,
                                            a.POS_ID,a.POEM_ID, a.POEMS_ID, a.POT_ID,a.DEPARTMENT_ID,
                                            a.DEPARTMENT_ID_ASS ,a.ORG_ID,a.ORG_ID_1, a.ORG_ID_2,
                                            wch.CANCEL_FLAG,wch.PER_ID,j.POT_NO,a.PER_STATUS, a.PER_CARDNO,
                                            (select ex1.CREATE_USER from TA_SET_EXCEPTPER ex1 WHERE ex1.REC_ID  in (select max(ex2.REC_ID) from TA_SET_EXCEPTPER ex2 WHERE ex2.PER_ID=a.PER_ID) ) as CREATE_USER
                                            from  PER_PERSONAL a  
                                            left join TA_SET_EXCEPTPER wch on(a.PER_ID=wch.PER_ID)
                                            left join PER_ORG b on(b.ORG_ID=a.ORG_ID) 
                                            left join PER_POSITION c on(c.POS_ID=a.POS_ID) 
                                            left join PER_POS_EMP d on(d.POEM_ID=a.POEM_ID) 
                                            left join PER_POS_EMPSER e on(e.POEMS_ID=a.POEMS_ID) 
                                            left join PER_LEVEL f on(f.LEVEL_NO=a.LEVEL_NO) 
                                            left join PER_PRENAME g on(g.PN_CODE=a.PN_CODE) 
                                            left join PER_MGT h on(h.PM_CODE=c.PM_CODE)
                                            left join PER_LINE i on(i.PL_CODE=c.PL_CODE)
                                            left join PER_POS_TEMP j on (j.POT_ID=a.POT_ID)
                                 where 	1=1
                                 
                                 $Tmpsearch_CANCEL_FLAG
                                            $search_condition
                                		    $order_str
                            ) q1
                        ) where rnum between $rec_start and $rec_end ";
		} // end if
        
        //wch.REC_ID  in (select max(REC_ID) from TA_SET_EXCEPTPER WHERE PER_ID=wch.PER_ID)
        
      //  echo "<pre>".$cmd;
        
		$count_page_data = $db_dpis->send_cmd($cmd);
		if($count_page_data){
?>
  <table width="95%" border="0" align="center" cellpadding="1" cellspacing="1" class="label_normal">
    <tr align="center" class="table_head">
      <td nowrap width="5%" onClick="call_sort(1);"><strong>
        <? if($order_by==1&&$sort_by==1){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        เลขที่ตำแหน่ง</strong></td>
      <td nowrap width="11%" height="21" onClick="call_sort(2);"><strong>
        <? if($order_by==2&&$sort_by==2){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>
        ชื่อ-สกุล</strong></td>
      <td width="11%" onClick="call_sort(3);"><? if($order_by==3&&$sort_by==3){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>ตำแหน่งในสายงาน</td>
      <td width="11%" onClick="call_sort(4);"><? if($order_by==4&&$sort_by==4){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>ระดับตำแหน่ง</td>
      <td width="14%" onClick="call_sort(5);"><? if($order_by==5&&$sort_by==5){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>สำนัก/กอง<br>ตามกฎหมาย</td>
      <td width="14%" onClick="call_sort(6);"><? if($order_by==6&&$sort_by==6){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>สำนักกอง<br>ตามมอบหมายงาน</td>
      <td width="7%" onClick="call_sort(7);"><strong>
        <? if($order_by==7&&$sort_by==7){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>วันที่เริ่มยกเว้น</strong></td>
      <td width="7%" onClick="call_sort(8);"><? if($order_by==8&&$sort_by==8){  if($SortType[$order_by]=="asc"){  echo $SORT_ASC;  }else{ echo $SORT_DESC; } }else{  echo $SORT_CUR;  } ?>วันที่สิ้นสุด</td>
      <td width="3%">ประวัติ</td>
      <? if($PAGE_AUTH["edit"]=="Y"){?>
      <td width="3%"><?=$EDIT_TITLE;?></td>
      <? }?>
      <?if($PAGE_AUTH["del"]=="Y"){?>
      <td width="3%"><?=$DEL_TITLE;?></td>
      <? }?>
      <td width="5%"><?=$ACTIVE_TITLE;?></td>
      <!--ชุดไฟล์แนบ-->
      <td width="3%">จำนวนไฟล์</td>
      <? if($PAGE_AUTH["attach"]=="Y"){?>
      <td width="3%"><span class="style2"><?=$LOAD_TITLE?> </span></td>
      <?}?>
      <!--END ชุดไฟล์แนบ-->
      
    </tr>
     <? 
			$current_list = "";
			$data_count = 0;
            $count_CREATE_USER = 0;
  			while($data = $db_dpis->get_array()) :
				$data_count++;
				if($data_count > $data_per_page) break;
				$DATA_REC_ID = $data[REC_ID];
                $DATA_CREATE_USER = $data[CREATE_USER];
                
				$current_list .= ((trim($current_list))?",":"") . "'$DATA_REC_ID'";
                $DATA_FULLNAME_SHOW = trim($data[FULLNAME_SHOW]);
				$DATA_START_DATE = show_date_format($data[START_DATE], $DATE_DISPLAY);
				$DATA_END_DATE ="";
                if($data[END_DATE]){
					$DATA_END_DATE = show_date_format(substr($data[END_DATE],0,10), $DATE_DISPLAY);
                }
				$DATA_REMARK = trim($data[REMARK]);
                $DATA_POS_NO = $data[POS_NO].$data[POEM_NO].$data[POEMS_NO].trim($data[POT_NO]);
                $DATA_LEVEL_NAME = trim($data[LEVEL_NAME]); 
                $DATA_PER_TYPE = trim($data[PER_TYPE]); 
                $DATA_DEPARTMENT_ID = trim($data[DEPARTMENT_ID]); 
                $DATA_ORG_ASS_ID = trim($data[ORG_ID]);
                $DATA_ORG_ASS_ID_1 = trim($data[ORG_ID_1]);
        		$DATA_ORG_ASS_ID_2 = trim($data[ORG_ID_2]);
                $DATA_CANCEL_FLAG = trim($data[CANCEL_FLAG]);
                $DATA_PER_ID = $data[PER_ID];
                $DATA_PER_CARDNO =  $data[PER_CARDNO];
                
                
                
                if ($DATA_PER_TYPE == 1 || $DATA_PER_TYPE == 5) {
                    $DATA_POS_ID = $data[POS_ID];
                    if ($DATA_POS_ID) {
                        $cmd = " 	select		POS_NO_NAME, POS_NO, pl.PL_NAME, po.ORG_NAME, pp.PT_CODE, po.ORG_ID, pp.PM_CODE, pp.ORG_ID_1, pp.ORG_ID_2
                                            from		PER_POSITION pp, PER_LINE pl, PER_ORG po
                                            where		pp.POS_ID=$DATA_POS_ID and pp.ORG_ID=po.ORG_ID and pp.PL_CODE=pl.PL_CODE ";
                        $db_dpis2->send_cmd($cmd);
                        $data2 = $db_dpis2->get_array();
                        $DATA_POSEM_NO = $data2[POS_NO_NAME].' '.$data2[POS_NO];
                        if ($MUNICIPALITY_FLAG==1) $DATA_POSEM_NO = pos_no_format($DATA_POSEM_NO,2);
                        $DATA_PL_NAME = $data2[PL_NAME];
                        $DATA_PT_CODE = trim($data2[PT_CODE]);
                        $DATA_PT_NAME = trim($data2[PT_NAME]);
                        $DATA_PM_CODE = trim($data2[PM_CODE]);
                        $DATA_ORG_NAME = trim($data2[ORG_NAME]);
                        $DATA_ORG_ID_1 = trim($data2[ORG_ID_1]);
                        $DATA_ORG_ID_2 = trim($data2[ORG_ID_2]);
    
                        $cmd = " 	select PM_NAME from PER_MGT	where PM_CODE='$DATA_PM_CODE'  ";
                        $db_dpis2->send_cmd($cmd);
                        $data2 = $db_dpis2->get_array();
                        $DATA_PM_NAME = trim($data2[PM_NAME]);
                        if ($SESS_DEPARTMENT_NAME=="กรมการปกครอง" && !$DATA_PM_NAME) $DATA_PM_NAME = $DATA_PL_NAME;
                    }
			
                    $DATA_PAY_ID = $data[PAY_ID];
                    if ($DATA_PAY_ID) {
                        $cmd = " 	select		POS_NO_NAME, POS_NO, po.ORG_NAME
                                            from		PER_POSITION pp, PER_ORG po
                                            where		pp.POS_ID=$DATA_PAY_ID and pp.ORG_ID=po.ORG_ID ";
                        if($SESS_ORG_STRUCTURE==1){	$cmd = str_replace("PER_ORG","PER_ORG_ASS",$cmd); 	}
                        $db_dpis2->send_cmd($cmd);
                        $data2 = $db_dpis2->get_array();
                        $DATA_PAY_NO = $data2[POS_NO_NAME] . $data2[POS_NO] . " " . $data2[ORG_NAME];
                    }
			
            } elseif ($DATA_PER_TYPE == 2) {
                $DATA_POEM_ID = $data[POEM_ID];
                if ($DATA_POEM_ID) {
                    $cmd = " 	select		POEM_NO_NAME, POEM_NO, pl.PN_NAME, po.ORG_NAME, po.ORG_ID, pp.ORG_ID_1, pp.ORG_ID_2, pl.PG_CODE   
                                    from			PER_POS_EMP pp, PER_POS_NAME pl, PER_ORG po 
                                    where		pp.POEM_ID=$DATA_POEM_ID and pp.ORG_ID=po.ORG_ID and pp.PN_CODE=pl.PN_CODE  ";
                    $db_dpis2->send_cmd($cmd);
                    $data2 = $db_dpis2->get_array();
                    $DATA_POSEM_NO = trim($data2[POEM_NO_NAME]).trim($data2[POEM_NO]);
                    $DATA_PL_NAME = trim($data2[PN_NAME]);
                    $DATA_PG_CODE = trim($data2[PG_CODE]);
                    $DATA_ORG_NAME = trim($data2[ORG_NAME]);
                    $DATA_ORG_ID_1 = trim($data2[ORG_ID_1]);
                    $DATA_ORG_ID_2 = trim($data2[ORG_ID_2]);
    
                    $cmd = " 	select PG_NAME from PER_POS_GROUP where trim(PG_CODE)='$DATA_PG_CODE'  ";
                    $db_dpis2->send_cmd($cmd);
                    $data2 = $db_dpis2->get_array();
                    $DATA_PM_NAME = trim($data2[PG_NAME]);
                }
            } elseif ($DATA_PER_TYPE == 3) {
                $DATA_POEMS_ID = $data[POEMS_ID];
                if ($DATA_POEMS_ID) {
                    $cmd = " 	select		POEMS_NO, pl.EP_NAME, po.ORG_NAME, po.ORG_ID, pp.ORG_ID_1, pp.ORG_ID_2, le.LEVEL_NAME  
                            from			PER_POS_EMPSER pp, PER_EMPSER_POS_NAME pl, PER_ORG po, PER_LEVEL le
                            where		pp.POEMS_ID=$DATA_POEMS_ID and pp.ORG_ID=po.ORG_ID and pp.EP_CODE=pl.EP_CODE  and pl.LEVEL_NO = le.LEVEL_NO";
                    $db_dpis2->send_cmd($cmd);
                    $data2 = $db_dpis2->get_array();
                    $DATA_POSEM_NO = trim($data2[POEMS_NO]);
                    $DATA_PL_NAME = trim($data2[EP_NAME]);
                    $DATA_PM_NAME = trim($data2[LEVEL_NAME]);
                    $DATA_ORG_NAME = trim($data2[ORG_NAME]);
                    $DATA_ORG_ID_1 = trim($data2[ORG_ID_1]);
                    $DATA_ORG_ID_2 = trim($data2[ORG_ID_2]);
                }
            } elseif ($DATA_PER_TYPE == 4) {
                $DATA_POT_ID = $data[POT_ID];
                if ($DATA_POT_ID) {
                    $cmd = " 	select		POT_NO, pl.TP_NAME, po.ORG_NAME, po.ORG_ID, pp.ORG_ID_1, pp.ORG_ID_2   
                                    from			PER_POS_TEMP pp, PER_TEMP_POS_NAME pl, PER_ORG po 
                                    where		pp.POT_ID=$DATA_POT_ID and pp.ORG_ID=po.ORG_ID and pp.TP_CODE=pl.TP_CODE  ";
                    $db_dpis2->send_cmd($cmd);
                    $data2 = $db_dpis2->get_array();
                    $DATA_POSEM_NO = trim($data2[POT_NO]);
                    $DATA_PL_NAME = trim($data2[TP_NAME]);
                    $DATA_ORG_NAME = trim($data2[ORG_NAME]);
                    $DATA_ORG_ID_1 = trim($data2[ORG_ID_1]);
                    $DATA_ORG_ID_2 = trim($data2[ORG_ID_2]);
                }
            }
            
            //สำหรับมอบหมายงาน
            //################################
            if ($DATA_ORG_ASS_ID) {
                $cmd = " select ORG_NAME from PER_ORG_ASS where ORG_ID=$DATA_ORG_ASS_ID ";
                $db_dpis2->send_cmd($cmd);
                $data2 = $db_dpis2->get_array();
                $DATA_ORG_ASS_NAME_0 = $data2[ORG_NAME];
                if ($DATA_ORG_ASS_NAME_0=="-") $DATA_ORG_ASS_NAME_0 = "";
            }
            if ($DATA_ORG_ASS_ID_1) {
                $cmd = " select ORG_NAME from PER_ORG_ASS where ORG_ID=$DATA_ORG_ASS_ID_1 ";
                $db_dpis2->send_cmd($cmd);
                $data2 = $db_dpis2->get_array();
                $DATA_ORG_ASS_NAME_1 = $data2[ORG_NAME];
            }
            if ($DATA_ORG_ASS_ID_2) {
                $cmd = " select ORG_NAME from PER_ORG_ASS where ORG_ID=$DATA_ORG_ASS_ID_2 ";
                $db_dpis2->send_cmd($cmd);
                $data2 = $db_dpis2->get_array();
                $DATA_ORG_ASS_NAME_2 = $data2[ORG_NAME];
            }
            $DATA_ORG_ASS_NAME = $DATA_ORG_ASS_NAME_0. "<hr>" . "&nbsp; " . $DATA_ORG_ASS_NAME_1;
            
            $cmd2 = " select count(REC_ID) AS MAXCOUNT from TA_SET_EXCEPTPER where PER_ID=$data[PER_ID]"; 
                $db_dpis2->send_cmd($cmd2);
                $data2 = $db_dpis2->get_array();
                $MAXCOUNT = $data2[MAXCOUNT];
                
                
             if ( ($SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD')  ){ 
             		$count_CREATE_USER++;
        	}else{ 
        		if ($DATA_CREATE_USER==$SESS_USERID){ 
                	$count_CREATE_USER++;
                }  
        	}
            
            
            $curstyle = "";
            if($data[PER_STATUS]== 2){		//พ้นจากส่วนราชการ
                $DATA_POS_NO ="";
                $curstyle.="color:#FF0000"; 
            } // end if	
                          
  ?>
    <tr class="table_body"  onMouseOver="this.className='table_body_over';" onMouseOut="this.className='table_body';" style="<?=$curstyle; ?>">
      <td align="center"><?=$DATA_POS_NO;?></td>
      <td height="25" align="left">&nbsp;<?=$DATA_FULLNAME_SHOW;?></td>
      <td align="left">&nbsp;<?=$DATA_PL_NAME;?></td>
      <td align="left">&nbsp;<?=$DATA_LEVEL_NAME;?></td>
      <td align="center">&nbsp;<?=$DATA_ORG_NAME;?></td>
      <td align="center">&nbsp;<?=$DATA_ORG_ASS_NAME;?></td>
      <td align="center"><?=$DATA_START_DATE;?></td>
      <td align="center"><?=$DATA_END_DATE;?></td>
      <td align="center">
      	<? if ( ($SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD')  ){ ?>
      		<a href="<?=("javascript:call_add_personShowHis('".$DATA_PER_ID."')")?>"><img src="images/desc.gif"  alt="<?=$DETAIL_TITLE?>" width="24" height="24" border="0"></a>
        <? }else{ ?> 
        		<? //if ($DATA_CREATE_USER==$SESS_USERID){ ?>
                	<a href="<?=("javascript:call_add_personShowHis('".$DATA_PER_ID."')")?>"><img src="images/desc.gif"  alt="<?=$DETAIL_TITLE?>" width="24" height="24" border="0"></a>
                <? //}?>  
        <? }?>  
            </td>
      <? if($PAGE_AUTH["edit"]=="Y"){?>
      	<td align="center">
        <? if ( ($SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD')  ){ ?>
      		<a href="<?=("javascript:form1.action+='?UPD=1';form1.HIDREC_ID.value='$DATA_REC_ID';form1.command.value='';form1.submit();");?>"><img src="images/b_edit.png" border="0" alt="<?=$EDIT_ALT;?>"></a>
        <? }else{ ?> 
        		<? if ($DATA_CREATE_USER==$SESS_USERID){ ?>
                	<a href="<?=("javascript:form1.action+='?UPD=1';form1.HIDREC_ID.value='$DATA_REC_ID';form1.command.value='';form1.submit();");?>"><img src="images/b_edit.png" border="0" alt="<?=$EDIT_ALT;?>"></a>
                <? }?>  
        <? }?>
        </td>
      <? }?>
      <? if($PAGE_AUTH["del"]=="Y"){?>
      <td align="center">
      		<? if ( ($SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD')  ){ ?>
                <? if($MAXCOUNT>1){ ?>
      					<a href="<?=("javascript:call_add_personShowHis('".$DATA_PER_ID."')")?>"><img src="images/b_drop.png"  alt="<?=$DETAIL_TITLE?>" border="0"></a>
            	<? }else{ ?>
            			<a href="<?=("javascript:confirm_delete('".$DATA_REC_ID."','".$DATA_FULLNAME_SHOW."','".$DATA_START_DATE."')")?>"><img src="images/b_drop.png" border="0" alt="ลบข้อมูล"></a>
                <? }?>  
            <? }else{ ?> 
                    <? if ($DATA_CREATE_USER==$SESS_USERID){ ?>
                        <? if($MAXCOUNT>1){ ?>
      					<a href="<?=("javascript:call_add_personShowHis('".$DATA_PER_ID."')")?>"><img src="images/b_drop.png"  alt="<?=$DETAIL_TITLE?>" border="0"></a>
            	<? }else{ ?>
            			<a href="<?=("javascript:confirm_delete('".$DATA_REC_ID."','".$DATA_FULLNAME_SHOW."','".$DATA_START_DATE."')")?>"><img src="images/b_drop.png" border="0" alt="ลบข้อมูล"></a>
                <? }?> 
                    <? }?>  
            <? }?>
      	

       </td>

      <? }?>
      <td align="center">
      <? if ( ($SESS_USERGROUP ==1 || $NAME_GROUP_HRD =='HRD')  ){ ?>
      		<input type="checkbox" onClick="return CheckDel();" name="list_show_id<?=$data_count;?>" id="list_show_id<?=$data_count;?>" value="'<?=$DATA_REC_ID;?>'" <?=(($DATA_CANCEL_FLAG==1)?"checked":"");?>>
        <? }else{ ?> 
        		<? if ($DATA_CREATE_USER==$SESS_USERID){ ?>
                	<input type="checkbox" onClick="return CheckDel();" name="list_show_id<?=$data_count;?>" id="list_show_id<?=$data_count;?>" value="'<?=$DATA_REC_ID;?>'" <?=(($DATA_CANCEL_FLAG==1)?"checked":"");?>>
                <? }?>  
        <? }?>
      
      </td>
       <!--ชุดไฟล์แนบ-->
        <!--เพิ่มเติมนับจำนวน-->
        <? 
            $parameter1=$parameter2=$parameter3=$parameter4="";

            $parameter1="TA_SET_EXCEPTPER";	 //ชื่อโฟลเดอร์ by รายการจะแยกเป็นโฟลเดอร์งานนั้นๆ
            $parameter2=$DATA_REC_ID;	//โฟลเดอร์สุดท้าย by รายการจะเป็น ไอดีของรายการนั้นๆ
            $parameter3="กำหนดบุคคลที่ไม่ต้องลงเวลา";	//ชื่อ
            $parameter4=$DATA_PER_ID;
          
         ?>
        <td align="center"><? 
            $FILE_PATH = '../attachments/'.str_replace("'" ,"",$DATA_PER_CARDNO).'/'.$parameter1.'/'.$parameter2;
            $numfiles=0;
            //echo $FILE_PATH.'<br><hr>';
            if(is_dir($FILE_PATH)){
                if ($dh = opendir($FILE_PATH)) { //นับจำนวนไฟล์ทั้งหมดใน folder
                    while (($file = readdir($dh)) !== false) { //---อ่านไฟล์ทั้งหมดมาจาก folder ($FILE_PATH) นั้น
                        if ($file != "." && $file != "..") {
                                $numfiles++;
                        } // end if
                    } // while loop readdir
                    closedir($dh);
                } // end if
             }
            ?>
            <? if(!empty($numfiles)){?>
              <a href="<?="javascript:call_menu_desc('$parameter1','$parameter2','$parameter3','$parameter4')"?>"><?=$numfiles; ?></a>
            <? }else{
              echo '-';
              }?>
        </td>
        <!-- End เพิ่มเติมนับจำนวน-->
        <? if($PAGE_AUTH["attach"]=="Y"){?>
            <? $FILE_PATH = ".../attachments/".$DATA_PER_CARDNO."/TA_SET_EXCEPTPER/".$TMP_REC_ID; ?>
            <td align="center"><a href="<?="javascript:call_menu_desc('$parameter1','$parameter2','$parameter3','$parameter4')"?>"><img src="images/file.jpg" border="0" alt="<?=$ALT_LOAD_TITLE?>"></a></td>
        <? } ?>
        <!--END ชุดไฟล์แนบ-->
    </tr>
    
    <?	 endwhile;?>
    <?if($PAGE_AUTH["edit"]=="Y"){?>
    <? if ($count_CREATE_USER > 0){ ?>
        <tr class="table_footer">
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>      
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td>&nbsp;</td>      
          <td align="center">
          
              <? if ($BUTTON_DISPLAY==1) { ?>
                    <input type="submit" name="Submit42" value="<?=$SETFLAG_TITLE;?>" onClick="form1.command.value='SETFLAG'" class="button" style="width:98%">
              <?  } else { ?>
                    <input name="image32" type="image" onClick="form1.command.value='SETFLAG'" src="images/save.png" alt="<?=$SETFLAG_TITLE;?>" border="0">
              <? } ?>
          
          </td>
           <!--ชุดไฟล์แนบ-->
          <td>&nbsp;</td>
          <? if($PAGE_AUTH["attach"]=="Y"){?>
          <td>&nbsp;</td>
          <? } ?>
          <!--END ชุดไฟล์แนบ-->
        </tr>
        	<? } ?>  
	<?}?>
  </table>
  <? if($total_page > 1) : ?>
  <table width="95%" border="0" align="center" cellpadding="2" cellspacing="2" class="label_normal">
    <tr>
      <td><?=$page_link;?></td>
    </tr>
  </table>
  <? endif; ?>&nbsp;
  <? } // if  count show ?>
  			<input name="hdnLine" type="hidden" value="<?=$data_count;?>">
  			<input type="hidden" name="current_list" value="<?=$current_list;?>">
    	</form>	
		</td>
	</tr>
</table>
<?
	include("jqModalDialog.html");
?>
</body>
<script language="JavaScript" src="java_scripts/menu_layer.js"></script>
<script type="text/javascript">
setActiveStyleSheet(document.getElementById("defaultTheme"), "winter");
function call_add_personDup(ID,TIME_START,TIME_END,FLAG_PRINT,REMARK) {
		var PerSonID=ID;	
		var START =TIME_START;
		var END = TIME_END;
		var FLAG_PRINT = FLAG_PRINT;
		var REMARK = REMARK;
	    call_openDialog("es_add_noscan_person_dop.html?send_by=es_add_ot_person_dop&MENU_ID_LV0=<?=$MENU_ID_LV0;?>&MENU_ID_LV1=<?=$MENU_ID_LV1;?>&MENU_ID_LV2=<?=$MENU_ID_LV2;?>&MENU_ID_LV3=<?=$MENU_ID_LV3;?>&HideID="+PerSonID+"&TIME_START="+START+"&TIME_END="+END+"&FLAG_PRINT="+FLAG_PRINT+"&REMARK="+encodeURIComponent(REMARK),1000,700,"รายชื่อบุคลากรที่ไม่ต้องลงเวลาและมีช่วงวันที่ตามที่เลือกซ้ำในฐานข้อมูล");
}
<?php if($OpenDialog=="1"){?>
	call_add_personDup('<?=$Dup_ID;?>','<?=$Dup_TIME_START;?>','<?=$Dup_TIME_END;?>','<?=$Dup_FLAG_PRINT;?>','<?=$Dup_REMARK;?>');
<?php }?>
</script>
</html>
